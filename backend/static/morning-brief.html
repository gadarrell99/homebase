<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/svg+xml" href="/img/homebase.svg">
    <link rel="icon" type="image/x-icon" href="/img/homebase.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/homebase-180.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morning Brief | Homebase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; }
        .main-nav { display: flex; align-items: center; padding: 0.75rem 1.5rem; background: #1e293b; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100; }
        .main-nav .logo { font-size: 1.1rem; font-weight: 600; color: #e2e8f0; margin-right: 2rem; text-decoration: none; }
        .main-nav .nav-links { display: flex; gap: 0.25rem; flex: 1; flex-wrap: wrap; }
        .main-nav .nav-links a { color: #94a3b8; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; transition: all 0.15s; }
        .main-nav .nav-links a:hover, .main-nav .nav-links a.active { color: #e2e8f0; background: #334155; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; }
        .subtitle { color: #64748b; margin-bottom: 2rem; }
        .section { background: #1e293b; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid #334155; }
        .section h2 { color: #a78bfa; font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .section-content { color: #cbd5e1; line-height: 1.6; }
        .stat-row { display: flex; gap: 2rem; margin-bottom: 0.75rem; }
        .stat { text-align: center; }
        .stat .val { font-size: 1.5rem; font-weight: 700; color: #4ade80; }
        .stat .lbl { font-size: 0.75rem; color: #64748b; }
        .status-ok { color: #4ade80; }
        .status-warn { color: #fbbf24; }
        .status-err { color: #f87171; }
        .btn { background: #4f46e5; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.9rem; }
        .btn:hover { background: #4338ca; }
        .loading { text-align: center; padding: 2rem; color: #64748b; }
        .no-data { background: #1e293b; padding: 2rem; text-align: center; border-radius: 0.5rem; color: #64748b; }
    </style>
</head>
<body>
    <nav class="main-nav">
        <a href="/" class="logo">Homebase</a>
        <div class="nav-links">
            <a href="/">Dashboard</a>
            <a href="/fleet">Fleet</a>
            <a href="/agents">Agents</a>
            <a href="/sentinel">Sentinel</a>
            <a href="/cortex">Cortex</a>
            <a href="/morning-brief" class="active">Morning Brief</a>
            <a href="/research">Research</a>
            <a href="/infra">Infra Sheet</a>
        
        <a href="/requirements">Requirements</a>
        <a href="https://gitea.rize.bm" target="_blank">Gitea</a>
    </div>
    </nav>

    <div class="container">
        <h1>‚òÄÔ∏è Morning Brief</h1>
        <p class="subtitle">Daily intelligence summary from all agents ‚Äî <span id="brief-date">Loading...</span></p>
        
        <button class="btn" onclick="generateNew()">üîÑ Generate New Briefing</button>
        
        <div id="briefing-content" style="margin-top: 2rem;">
            <div class="loading">Loading briefing...</div>
        </div>
    </div>

    <script src="/static/cache-helper.js"></script>
<script>
        async function loadBriefing() {
            const container = document.getElementById('briefing-content');
            try {
                const resp = await fetch('/api/briefing/latest');
                const data = await resp.json();
                
                if (data.error) {
                    container.innerHTML = '<div class="no-data">No briefing available yet. Click "Generate New Briefing" to create one.</div>';
                    return;
                }
                
                document.getElementById('brief-date').textContent = data.date + ' at ' + data.generated_at;
                
                let html = '';
                
                // Weather
                if (data.sections.weather) {
                    html += '<div class="section"><h2>üå§Ô∏è Weather</h2><div class="section-content">' + data.sections.weather + '</div></div>';
                }
                
                // Sales
                if (data.sections.sales) {
                    const sales = data.sections.sales;
                    html += '<div class="section"><h2>üíº Sales Pipeline</h2><div class="section-content">';
                    if (sales.status) {
                        html += sales.status;
                    } else {
                        html += '<div class="stat-row">';
                        html += '<div class="stat"><div class="val">' + (sales.new_leads || 0) + '</div><div class="lbl">New Leads</div></div>';
                        html += '<div class="stat"><div class="val">' + (sales.pipeline_value || 'N/A') + '</div><div class="lbl">Pipeline Value</div></div>';
                        html += '</div>';
                        if (sales.urgent && sales.urgent.length) {
                            html += '<p style="color: #fbbf24; margin-top: 1rem;">‚ö†Ô∏è Urgent: ' + sales.urgent.join(', ') + '</p>';
                        }
                    }
                    html += '</div></div>';
                }
                
                // Infrastructure
                if (data.sections.infrastructure) {
                    const infra = data.sections.infrastructure;
                    html += '<div class="section"><h2>üñ•Ô∏è Infrastructure</h2><div class="section-content">';
                    html += '<span class="status-ok">‚úì</span> ' + (infra.status || 'Status unknown');
                    if (infra.uptime) html += ' ‚Äî Uptime: ' + infra.uptime;
                    html += '</div></div>';
                }
                
                // Agents
                if (data.sections.agents) {
                    const agents = data.sections.agents;
                    html += '<div class="section"><h2>ü§ñ Agent Health</h2><div class="section-content">';
                    if (agents.all_healthy) {
                        html += '<span class="status-ok">‚úì All agents healthy</span> (' + agents.healthy_count + ' reporting)';
                    } else {
                        html += '<span class="status-warn">‚ö†Ô∏è Some agents need attention</span>';
                        if (agents.issues) html += '<br>' + agents.issues.join('<br>');
                    }
                    html += '</div></div>';
                }
                
                // Calendar
                if (data.sections.calendar) {
                    html += '<div class="section"><h2>üìÖ Calendar</h2><div class="section-content">' + data.sections.calendar + '</div></div>';
                }
                
                container.innerHTML = html;
                
            } catch (e) {
                container.innerHTML = '<div class="no-data">Error loading briefing: ' + e.message + '</div>';
            }
        }
        
        async function generateNew() {
            document.getElementById('briefing-content').innerHTML = '<div class="loading">Generating new briefing...</div>';
            try {
                await fetch('/api/briefing/generate');
                await initCacheFirst('homebase_briefing', 'briefing-content', loadBriefing, 0);
            } catch (e) {
                alert('Error generating briefing: ' + e.message);
            }
        }
        
        loadBriefing();
    </script>
</body>
</html>