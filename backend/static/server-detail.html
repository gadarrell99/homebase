<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Detail ‚Äî Homebase</title>
    <!-- Styles will be injected by JS or duplicated here for static serving -->
    <style>
        /* Minimal reset to prevent FOUC before CSS loads if served statically without wrapper */
        body { background: #0f172a; color: #e2e8f0; font-family: system-ui, sans-serif; }
.main-nav { display: flex; align-items: center; padding: 0.75rem 1.5rem; background: #1e293b; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100; }
.main-nav .logo { font-size: 1.1rem; font-weight: 600; color: #e2e8f0; margin-right: 2rem; text-decoration: none; }
.main-nav .nav-links { display: flex; gap: 0.25rem; flex: 1; flex-wrap: wrap; align-items: center; }
.main-nav .nav-links a { color: #94a3b8; padding: 0.5rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; text-decoration: none; transition: all 0.15s; }
.main-nav .nav-links a:hover, .main-nav .nav-links a.active { color: #e2e8f0; background: #334155; }

    /* Unified Navigation */

.main-nav 

@media (max-width: 900px) {   }

</style>
</head>
<body>
    <nav class="main-nav">
    <a href="/" class="logo">Homebase</a>
    <div class="nav-links">
        <a href="/">Dashboard</a>
        <a href="/fleet">Fleet</a>
        <a href="/agents">Agents</a>
        <a href="/sentinel">Sentinel</a>
        <a href="/research">Research</a>
        <a href="/infra">Infra Sheet</a>
        <a href="/settings">Settings</a>
        <a href="/backups">Backups</a>
    </div>
</nav>
    <!-- Content will be replaced by the shared layout if using wrap_page, 
         but since we serve static files, we include the structure here 
         and rely on the same CSS variables defined in navbar.py -->
    
    <div id="app-root">
        <!-- Navbar placeholder -->

        <div class="page-container">
            <div style="margin-bottom: 1.5rem;">
                <a href="/servers">‚Üê Back to Servers</a>
            </div>
            
            <div class="card">
                <h1 id="server-name" style="font-size: 2rem; margin-bottom: 0.5rem;">Loading...</h1>
                <div id="server-meta" style="color: var(--text-muted); font-family: monospace;"></div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div class="card">
                    <h2 style="margin-bottom: 1rem; font-size: 1.2rem;">System Status</h2>
                    <div id="system-stats" style="line-height: 1.6;">Loading stats...</div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 1rem; font-size: 1.2rem;">Security &amp; Updates</h2>
                    <div id="security-stats" style="line-height: 1.6;">Loading security info...</div>
                </div>
            </div>

            <div class="card">
                <h2 style="margin-bottom: 1rem; font-size: 1.2rem;">Recent Activity</h2>
                <div id="activity-log">No recent activity recorded.</div>
            </div>
        </div>
    </div>

    <script>
        // 1. Inject Shared CSS (Simulating the navbar.py logic for static file)
        const css = `
:root { --bg-body: #0f172a; --bg-nav: #1e293b; --bg-card: #1e293b; --bg-hover: #334155; --text-main: #e2e8f0; --text-muted: #94a3b8; --border-color: #334155; --link-color: #60a5fa; --link-hover: #93c5fd; --shadow: 0 10px 25px rgba(0,0,0,0.3); }
[data-theme="light"] { --bg-body: #f1f5f9; --bg-nav: #ffffff; --bg-card: #ffffff; --bg-hover: #e2e8f0; --text-main: #0f172a; --text-muted: #64748b; --border-color: #cbd5e1; --link-color: #2563eb; --link-hover: #1d4ed8; --shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-body); color: var(--text-main); min-height: 100vh; transition: background 0.3s, color 0.3s; }
a { color: var(--link-color); text-decoration: none; }
a:hover { color: var(--link-hover); }

.main-nav 
.theme-toggle, .print-btn, 
.theme-toggle:hover, .print-btn:hover, 
.page-container { padding: 1.5rem; max-width: 1400px; margin: 0 auto; }
.card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem; }
@media (max-width: 768px) {   }
@media print {  body { background: white; color: black; } .card { border: 1px solid #ccc; break-inside: avoid; } }
`;
        const style = document.createElement('style');
        style.textContent = css;
        document.head.appendChild(style);

        // 2. Inject Navbar
        document.getElementById('nav-placeholder').innerHTML = `
            <a href="/" class="logo">üè† Homebase</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/servers" class="active">Servers</a>
                <a href="/projects">Projects</a>
            <a href="/project-status">Status</a>
                <a href="/agents">Agents</a><a href="/sentinel">Sentinel</a>
                <a href="/metrics">Metrics</a>
                <a href="/security">Security</a>
            </div>
            <div class="nav-right">
                <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
                <button class="print-btn" onclick="window.print()">üñ®Ô∏è</button>
            </div>
        `;

        // 3. Theme Logic
        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        (function() {
            const saved = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', saved);
        })();

        // 4. Fetch Data
        async function loadData() {
            const pathParts = window.location.pathname.split('/');
            const serverId = pathParts[pathParts.length - 1];
            
            try {
                const res = await fetch('/api/servers');
                const data = await res.json();
                const server = data.servers.find(s => 
                    (s.id && s.id === serverId) || 
                    (s.name && s.name.toLowerCase().replace(/\s+/g, '-') === serverId)
                );
                
                if (server) {
                    document.getElementById('server-name').textContent = server.name;
                    document.getElementById('server-meta').textContent = `${server.ip} ‚Ä¢ ${server.user} ‚Ä¢ ${server.os || 'Linux'}`;
                    
                    document.getElementById('system-stats').innerHTML = `
                        <div><strong>Status:</strong> ${server.status}</div>
                        <div><strong>Uptime:</strong> ${server.uptime || 'Unknown'}</div>
                        <div><strong>CPU:</strong> ${server.cpu_percent || 0}%</div>
                        <div><strong>Memory:</strong> ${server.memory_used || 0} / ${server.memory_total || 0} MB</div>
                        <div><strong>Disk:</strong> ${server.disk_used || 0} / ${server.disk_total || 0} GB</div>
                    `;
                    
                    // Fetch security data specifically for this server
                    try {
                        const secRes = await fetch('/api/security/updates/' + server.ip);
                        if (secRes.ok) {
                            const secData = await secRes.json();
                            const updates = secData.updates || {};
                            document.getElementById('security-stats').innerHTML = `
                                <div><strong>Updates Available:</strong> ${updates.summary || 'None'}</div>
                                <div><strong>Critical:</strong> ${secData.critical ? 'Yes' : 'No'}</div>
                            `;
                        }
                    } catch(e) {
                        document.getElementById('security-stats').textContent = "Security data unavailable";
                    }

                } else {
                    document.getElementById('server-name').textContent = 'Server Not Found';
                }
            } catch (e) {
                console.error(e);
            }
        }
        
        loadData();
    </script>
</body>
</html>
