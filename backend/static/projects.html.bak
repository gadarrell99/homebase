<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - Homebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #111827; color: #fff; font-family: system-ui, sans-serif; }
        .status-healthy, .status-good { background: rgba(34,197,94,0.2); color: #4ade80; }
        .status-degraded, .status-warning, .status-busy { background: rgba(234,179,8,0.2); color: #facc15; }
        .status-critical, .status-error { background: rgba(239,68,68,0.2); color: #f87171; }
        .status-stale { background: rgba(249,115,22,0.2); color: #fb923c; }
        .status-offline { background: rgba(107,114,128,0.2); color: #9ca3af; }
        a.link { color: #60a5fa; text-decoration: none; }
        a.link:hover { text-decoration: underline; }
    </style>
</head>
<body class="min-h-screen p-8">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold">ğŸ  Rize Projects Dashboard</h1>
                <p class="text-gray-400" id="lastUpdate">Loading...</p>
            </div>
            <a href="/" class="link">â† Back to Homebase</a>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8" id="summary"></div>
        
        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-xl">
            <table class="w-full">
                <thead class="bg-gray-700">
                    <tr>
                        <th class="px-4 py-3 text-left">Project</th>
                        <th class="px-4 py-3 text-left">Version</th>
                        <th class="px-4 py-3 text-left">Status</th>
                        <th class="px-4 py-3 text-left">Links</th>
                        <th class="px-4 py-3 text-center">TODOs</th>
                        <th class="px-4 py-3 text-left">Last Check-In</th>
                    </tr>
                </thead>
                <tbody id="projectsTable"></tbody>
            </table>
        </div>
        
        <div class="mt-6 text-center text-gray-500 text-sm">
            Auto-refreshes every 60 seconds
        </div>
    </div>

    <script>
        const emoji = { healthy: 'ğŸŸ¢', good: 'ğŸŸ¢', degraded: 'ğŸŸ¡', warning: 'ğŸŸ¡', busy: 'ğŸŸ¡', critical: 'ğŸ”´', error: 'ğŸ”´', stale: 'ğŸŸ ', offline: 'âš«' };
        const icons = { vector: 'ğŸš', 'bps-ai': 'ğŸ‘®', 'david-bishop': 'ğŸ¤–', relay: 'âš¡', nexus: 'ğŸ”—', homebase: 'ğŸ ', dockyard: 'ğŸš¢', 'property-rize': 'ğŸ˜ï¸', claudedev: 'ğŸ–¥ï¸' };
        
        // Project URLs - Web and SSH
        const projectLinks = {
            'relay':        { web: 'https://relay.rize.bm', ssh: 'https://relay-ssh.rize.bm', ip: '192.168.65.248' },
            'bps-ai':       { web: 'https://bpsai.rize.bm', ssh: 'https://bpsai-ssh.rize.bm', ip: '192.168.65.246' },
            'nexus':        { web: 'https://nexus.rize.bm', ssh: 'https://nexus-ssh.rize.bm', ip: '192.168.65.247' },
            'homebase':     { web: 'https://homebase.rize.bm', ssh: 'https://cobalt-ssh.rize.bm', ip: '192.168.65.243' },
            'dockyard':     { web: 'https://dockyard-admin.rize.bm', ssh: 'https://dockyard-ssh.rize.bm', ip: '192.168.65.252' },
            'vector':       { web: 'https://vector.bet.bm', ssh: 'https://vector-ssh.bet.bm', ip: '192.168.65.249' },
            'david-bishop': { web: null, ssh: null, ip: '192.168.65.241' },
            'claudedev':    { web: null, ssh: 'https://claude-dev-ssh.rize.bm', ip: '192.168.65.245' }
        };
        
        function getLinks(name) {
            const links = projectLinks[name] || {};
            let html = '';
            if (links.web) html += `<a href="${links.web}" target="_blank" class="link mr-2">ğŸŒ Web</a>`;
            if (links.ssh) html += `<a href="${links.ssh}" target="_blank" class="link mr-2">ğŸ’» SSH</a>`;
            if (links.ip) html += `<span class="text-gray-500 text-xs">${links.ip}</span>`;
            return html || '<span class="text-gray-500">-</span>';
        }
        
        async function loadData() {
            try {
                const res = await fetch('/api/projects/status');
                const data = await res.json();
                
                document.getElementById('lastUpdate').textContent = 'Last updated: ' + new Date().toLocaleString();
                
                const summary = data.summary || { total: 0, healthy: 0, degraded: 0, critical: 0, stale: 0, offline: 0 };
                document.getElementById('summary').innerHTML = `
                    <div class="bg-gray-800 p-4 rounded text-center"><div class="text-2xl font-bold">${summary.total}</div><div class="text-gray-400">Total</div></div>
                    <div class="bg-green-900/50 p-4 rounded text-center"><div class="text-2xl font-bold text-green-400">${summary.healthy}</div><div class="text-gray-400">ğŸŸ¢ Healthy</div></div>
                    <div class="bg-yellow-900/50 p-4 rounded text-center"><div class="text-2xl font-bold text-yellow-400">${summary.degraded}</div><div class="text-gray-400">ğŸŸ¡ Degraded</div></div>
                    <div class="bg-red-900/50 p-4 rounded text-center"><div class="text-2xl font-bold text-red-400">${summary.critical}</div><div class="text-gray-400">ğŸ”´ Critical</div></div>
                    <div class="bg-orange-900/50 p-4 rounded text-center"><div class="text-2xl font-bold text-orange-400">${summary.stale || 0}</div><div class="text-gray-400">ğŸŸ  Stale</div></div>
                    <div class="bg-gray-700 p-4 rounded text-center"><div class="text-2xl font-bold">${summary.offline || 0}</div><div class="text-gray-400">âš« Offline</div></div>
                `;
                
                const projects = Object.entries(data.projects || {}).sort((a,b) => a[0].localeCompare(b[0]));
                document.getElementById('projectsTable').innerHTML = projects.map(([name, p]) => `
                    <tr class="border-t border-gray-700 hover:bg-gray-750">
                        <td class="px-4 py-3 font-medium">${icons[name] || 'ğŸ“'} ${name}</td>
                        <td class="px-4 py-3 font-mono text-sm">${p.version || '-'}</td>
                        <td class="px-4 py-3"><span class="px-2 py-1 rounded text-sm status-${p.status}">${emoji[p.status] || 'â“'} ${p.status}</span></td>
                        <td class="px-4 py-3 text-sm">${getLinks(name)}</td>
                        <td class="px-4 py-3 text-center"><span class="text-green-400">${p.todos_done || 0}</span>/<span class="text-yellow-400">${(p.todos_open || 0) + (p.todos_done || 0)}</span></td>
                        <td class="px-4 py-3 text-sm text-gray-400">${p.hours_since_checkin !== undefined ? p.hours_since_checkin + 'h ago' : '-'}</td>
                    </tr>
                `).join('');
            } catch (err) {
                document.getElementById('lastUpdate').innerHTML = '<span class="text-red-400">Error: ' + err.message + '</span>';
            }
        }
        
        loadData();
        setInterval(loadData, 60000);
    </script>
</body>
</html>
