{
  "meta": {
    "scanned_at": "2026-02-13T03:37:01.215494+00:00",
    "project_count": 11,
    "scanner_version": "1.0.0"
  },
  "projects": [
    {
      "name": "Best Shipping",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/best-shipping-dashboard",
      "domain": "bestshipping.rize.bm",
      "ports": [
        3001,
        8001
      ],
      "scanned_at": "2026-02-13T03:37:01.215521+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "20 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Best Shipping Dashboard\n**Version:** 1.0.0\n**Server:** .246 (Demos) | **Ports:** Backend :8001, Frontend :3001\n**Domain:** bestshipping.rize.bm\n**Status:** Demo Ready\n\n## Overview\n\nCustomer-facing dashboard for Best Shipping (Bermuda-based freight/logistics company). Provides clients with real-time visibility into shipment status, financial obligations, and account history.\n\n## Quick Start\n\n```bash\ncd ~/best-shipping-dashboard\n\n# Backend (FastAPI)\ncd backend\nsource venv/bin/activate\nuvicorn main:app --host 0.0.0.0 --port 8001\n\n# Frontend (React/Vite)\ncd ../frontend\nnpm run dev -- --port 3001\n```\n\n## Architecture\n\n| Component | Technology | Port |\n|-----------|------------|------|\n| Backend | Python FastAPI | 8001 |\n| Frontend | React + Vite + Tailwind | 3001 |\n| Database | PostgreSQL | 5432 |\n\n## Demo Credentials\n\n| Email | Password | Role |\n|-------|----------|------|\n| cornell@bestshipping.bm | demo2026 | Customer |\n| admin@bestshipping.bm | admin2026 | Admin |\n\n## API Endpoints\n\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| POST | /api/auth/login | Authentication |\n| GET | /api/health | Health check |\n| GET | /api/dashboard | Dashboard summary |\n| GET | /api/shipments | List shipments |\n| GET | /api/shipments/{id} | Shipment detail |\n| GET | /api/financials | Financial overview |\n| GET | /api/documents | Document library |\n\n## Pages\n\n| Page | Description |\n|------|-------------|\n| Dashboard | Active shipments, upcoming arrivals, outstanding balance |\n| Shipments | Filterable list with status badges |\n| Shipment Detail | Full lifecycle timeline, documents, costs |\n| Financials | Invoice list, payment history, aging |\n| Documents | Searchable document library |\n| Account | Profile and preferences |\n\n## Features\n\n- [x] User authentication (JWT)\n- [x] Shipment tracking with visual pipeline\n- [x] Financial dashboard with aging\n- [x] Document management\n- [x] Best Shipping branding (navy/white/accent blue)\n- [x] Mobile responsive\n\n## Integration Status\n\n| System | Status | Notes |\n|--------|--------|-------|\n| CargoWise | Mock | Awaiting API credentials |\n| QuickBooks | Mock | Awaiting OAuth setup |\n| Email Parser | Mock | Awaiting IMAP access |\n\n## Deployment\n\nRunning via PM2 or systemd. Accessible via Cloudflare tunnel at bestshipping.rize.bm.\n\n## Contact\n\n- Project Owner: Artie (artiedarrell@gmail.com)\n- Client Stakeholder: Cornell (Best Shipping)",
      "todo": "# TODO \u2014 Best Shipping Dashboard\n## Last Updated: 2026-02-06\n\n## P0 \u2014 Demo Blockers\n- [x] Backend API scaffolding\n- [x] Frontend build with React/Vite\n- [x] Authentication (JWT login)\n- [x] Dashboard home page\n- [x] Shipment list with filters\n- [x] Shipment detail view\n- [x] Financial overview\n- [x] Document center\n- [x] Best Shipping branding\n- [x] Deploy to .246\n\n## P1 \u2014 Demo Polish\n- [ ] Verify Vite allowedHosts for external access\n- [ ] Confirm Cloudflare tunnel for bestshipping.rize.bm\n- [ ] Create demo walkthrough script for Cornell\n- [ ] Seed 15-20 realistic Bermuda shipments\n- [ ] Test full login \u2192 dashboard \u2192 shipment detail flow\n- [ ] Mobile responsive testing\n- [ ] Screenshot deck for offline demo\n\n## P2 \u2014 Phase 2 Integrations (Post-Demo)\n- [ ] CargoWise eHub API integration\n- [ ] QuickBooks Online API (OAuth)\n- [ ] Email parser (IMAP + Claude)\n- [ ] Multi-tenant customer auth\n- [ ] Production deployment\n\n## P3 \u2014 Future Enhancements\n- [ ] Real-time shipment tracking map\n- [ ] Push notifications for status changes\n- [ ] Online payment capability\n- [ ] Microsoft Dynamics CRM integration\n- [ ] Mobile app (React Native)\n\n## Completed\n- [x] 2026-02-05: Initial spec completed\n- [x] 2026-02-06: Backend and frontend deployed to .246\n- [x] 2026-02-06: Health check passing",
      "changelog": "# Changelog \u2014 Best Shipping Dashboard\n\n## [1.0.0] - 2026-02-06\n\n### Added\n- Complete FastAPI backend with authentication\n- React/Vite frontend with Tailwind CSS\n- Dashboard home page with summary cards\n- Shipment list with filtering and search\n- Shipment detail view with timeline\n- Financial overview with invoice aging\n- Document center with preview/download\n- Best Shipping branding (navy/white/accent blue)\n- Demo credentials (cornell@bestshipping.bm)\n- Health check endpoint\n\n### Technical\n- Backend running on port 8001\n- Frontend running on port 3001\n- JWT-based authentication\n- Mock data for CargoWise, QuickBooks, email sources\n- Deployed to .246 (Demos server)\n\n## [0.1.0] - 2026-02-05\n\n### Added\n- Project spec document completed\n- Architecture design finalized\n- File structure defined",
      "todos_parsed": [
        {
          "text": "Backend API scaffolding",
          "done": true
        },
        {
          "text": "Frontend build with React/Vite",
          "done": true
        },
        {
          "text": "Authentication (JWT login)",
          "done": true
        },
        {
          "text": "Dashboard home page",
          "done": true
        },
        {
          "text": "Shipment list with filters",
          "done": true
        },
        {
          "text": "Shipment detail view",
          "done": true
        },
        {
          "text": "Financial overview",
          "done": true
        },
        {
          "text": "Document center",
          "done": true
        },
        {
          "text": "Best Shipping branding",
          "done": true
        },
        {
          "text": "Deploy to .246",
          "done": true
        },
        {
          "text": "Verify Vite allowedHosts for external access",
          "done": false
        },
        {
          "text": "Confirm Cloudflare tunnel for bestshipping.rize.bm",
          "done": false
        },
        {
          "text": "Create demo walkthrough script for Cornell",
          "done": false
        },
        {
          "text": "Seed 15-20 realistic Bermuda shipments",
          "done": false
        },
        {
          "text": "Test full login \u2192 dashboard \u2192 shipment detail flow",
          "done": false
        },
        {
          "text": "Mobile responsive testing",
          "done": false
        },
        {
          "text": "Screenshot deck for offline demo",
          "done": false
        },
        {
          "text": "CargoWise eHub API integration",
          "done": false
        },
        {
          "text": "QuickBooks Online API (OAuth)",
          "done": false
        },
        {
          "text": "Email parser (IMAP + Claude)",
          "done": false
        }
      ],
      "todos_open": 10,
      "todos_done": 10,
      "version": "1.0.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "42a8ad8 security: Block sensitive file access via Vite middleware (9 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "ackend/__pycache__/config.cpython-312.pyc"
          },
          {
            "status": "M",
            "file": "backend/__pycache__/main.cpython-312.pyc"
          },
          {
            "status": "M",
            "file": "backend/api/__pycache__/dashboard.cpython-312.pyc"
          },
          {
            "status": "M",
            "file": "backend/api/__pycache__/shipments.cpython-312.pyc"
          },
          {
            "status": "M",
            "file": "backend/api/dashboard.py"
          },
          {
            "status": "M",
            "file": "backend/api/shipments.py"
          },
          {
            "status": "M",
            "file": "backend/best_shipping.db"
          },
          {
            "status": "M",
            "file": "backend/config.py"
          },
          {
            "status": "M",
            "file": "backend/main.py"
          },
          {
            "status": "M",
            "file": "frontend/index.html"
          }
        ],
        "uncommitted_count": 20
      },
      "ports_status": [
        {
          "port": 3001,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 8001,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "BEST-SHIPPING-REQUIREMENTS.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO-SCRIPT.md",
        "DEMO_SCRIPT.md",
        "DEPLOYMENT.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/config.py",
        "backend/main.py",
        "ecosystem.config.js",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 98
    },
    {
      "name": "BPS-AI",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/bps-ai",
      "domain": "bpsai.rize.bm",
      "ports": [
        3000
      ],
      "scanned_at": "2026-02-13T03:37:15.222144+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "15 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# BPS AI - Bermuda Police Services AI Case Management\n\n> **\ud83d\udcda Documentation Navigation**\n> This is the main README. See all documentation:\n> - [Project Plan](docs/PROJECT_PLAN.md) - Development roadmap\n> - [TODO Checklist](docs/TODO.md) - Complete task tracking\n> - [Technical Spec](docs/TECHNICAL_SPEC.md) - Architecture & stack\n> - [Design Spec](docs/DESIGN_SPEC.md) - UI/UX guidelines\n> - [Database Schema](docs/DATABASE_SCHEMA.md) - Data models\n> - [API Spec](docs/API_SPEC.md) - Endpoint documentation\n> - [Security](docs/SECURITY.md) - Auth & access control\n> - [Scraper Guide](docs/SCRAPER_GUIDE.md) - Data collection\n> - [RAG Architecture](docs/RAG_ARCHITECTURE.md) - AI research system\n> - [Changelog](CHANGELOG.md) - Version history\n\n---\n\n## Project Overview\n\nAI-powered case management and reporting system for Bermuda Police Services. Features multi-model AI report generation, internal affairs monitoring, and integrated legal/news research capabilities.\n\n**Client:** Bermuda Police Services  \n**Contact:** Alexander Rollin (arollin@bps.bm)  \n**Development:** Gadarrell / Rize Business Development  \n**Version:** 0.9.28\n\n---\n\n## Live Demo URLs\n\n| Environment | URL | Purpose |\n|-------------|-----|---------|\n| Main Application | https://bpsai.rize.bm/login | Officer & Admin login |\n| Internal Affairs | https://bpsai.rize.bm/ia-login | IA-specific login (separate system) |\n| SSH Access | https://bpsai-ssh.rize.bm | Browser-based SSH |\n\n---\n\n## Login Credentials (Demo)\n\n### Main Application (bpsai.rize.bm/login)\n\n| Role | Email | Password | Access Level |\n|------|-------|----------|--------------|\n| Superintendent | superintendent@bps.bm | BPSDemo2026\\! | Full admin, case management |\n| Inspector | inspector@bps.bm | BPSDemo2026\\! | Supervisory access |\n| Officer | officer@bps.bm | BPSDemo2026\\! | Standard officer |\n| Alex Rollin | arollin@bps.bm | BPSDemo2026\\! | Detective Sergeant (IA access) |\n\n### Internal Affairs Portal (bpsai.rize.bm/ia-login)\n\n| Role | Email | Password | Access Level |\n|------|-------|----------|--------------|\n| IA Admin | ia.admin@bps.bm | IAAdmin2026\\! | Full IA admin |\n| IA Supervisor | ia.supervisor@bps.bm | IASuper2026\\! | Supervisory |\n| IA Investigator | ia.investigator@bps.bm | IAInvest2026\\! | Investigation |\n| IA Analyst | ia.analyst@bps.bm | IAAnalyst2026\\! | Analysis only |\n\n---\n\n## Monitoring\n\nThis project is monitored by **Relay/Pulse** at 192.168.65.248\n\n| Check | Endpoint |\n|-------|----------|\n| Health | /api/health |\n| Pulse Dashboard | http://192.168.65.248:8000/api/pulse/status |\n\n---\n\n## Core Features\n\n### 1. Case Management\n- **3 Case Types:** Domestic Abuse, Gang/Drug, Traffic\n- Pre-filled forms with dropdowns\n- Voice dictation support\n- Extensible template architecture\n\n### 2. Multi-AI Report Generation\n| Model | Provider | Type |\n|-------|----------|------|\n| Claude | Anthropic | Cloud |\n| GPT-4 | OpenAI | Cloud |\n| Gemini | Google | Cloud |\n| Llama 3 8B | Ollama | Local |\n| Mistral 7B | Ollama | Local |\n\n### 3. Internal Affairs Module\n- Separate authentication & database\n- Officer activity monitoring\n- Full investigation workflow\n- Audit logging\n- Purple/dark theme for visual distinction\n\n### 4. Legal & News Research (RAG)\n- **Bermuda Laws Database** - 98 scraped laws (62 police-priority)\n- **News Archive** - 10 years from Royal Gazette & Bernews\n- Vector search for AI-enhanced research\n- AI Law Assistant for statute explanations\n\n### 5. Analytics Dashboard\n- Case statistics & trends\n- AI usage metrics\n- Officer activity reports\n\n---\n\n## Tech Stack\n\n| Layer | Technology |\n|-------|------------|\n| Frontend | Next.js 14, React, TypeScript, Tailwind CSS |\n| Backend | Next.js API Routes, Node.js |\n| Database | PostgreSQL 16 + pgvector |\n| ORM | Prisma |\n| Auth | NextAuth.js |\n| AI Cloud | Claude, OpenAI, Gemini APIs |\n| AI Local | Ollama (Llama 3, Mistral) |\n| Vector DB | pgvector (PostgreSQL extension) |\n| Scraping | Puppeteer, Cheerio |\n| Hosting | Hyper-V VM, Cloudflare Tunnel |\n\n---\n\n## Quick Start\n\n```bash\n# Clone repository\ngit clone https://github.com/gadarrell99/bps-ai.git\ncd bps-ai\n\n# Install dependencies\nnpm install\n\n# Set up environment\ncp .env.example .env\n# Edit .env with your API keys\n\n# Set up database\nnpm run db:setup\nnpm run db:seed\n\n# Start development server\nnpm run dev\n```\n\n---\n\n## Project Structure\n\n```\nbps-ai/\n\u251c\u2500\u2500 README.md                \u2190 You are here\n\u251c\u2500\u2500 CHANGELOG.md             # Version history\n\u251c\u2500\u2500 CLAUDE.md                # AI agent instructions\n\u251c\u2500\u2500 VERSION\n\u251c\u2500\u2500 docs/\n\u2502   \u251c\u2500\u2500 PROJECT_PLAN.md      # Development roadmap\n\u2502   \u251c\u2500\u2500 TODO.md              # Task checklist\n\u2502   \u251c\u2500\u2500 TECHNICAL_SPEC.md    # Architecture\n\u2502   \u251c\u2500\u2500 DESIGN_SPEC.md       # UI/UX guidelines\n\u2502   \u251c\u2500\u2500 DATABASE_SCHEMA.md   # Data models\n\u2502   \u251c\u2500\u2500 API_SPEC.md          # API documentation\n\u2502   \u251c\u2500\u2500 SECURITY.md          # Security specs\n\u2502   \u251c\u2500\u2500 SCRAPER_GUIDE.md     # Scraping documentation\n\u2502   \u2514\u2500\u2500 RAG_ARCHITECTURE.md  # RAG system design\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 app/                 # Next.js app router\n\u2502   \u251c\u2500\u2500 components/          # React components\n\u2502   \u251c\u2500\u2500 lib/                 # Utilities & services\n\u2502   \u2514\u2500\u2500 styles/              # CSS/Tailwind\n\u251c\u2500\u2500 scrapers/\n\u2502   \u251c\u2500\u2500 laws/                # Bermuda laws scraper\n\u2502   \u251c\u2500\u2500 news/                # News scrapers\n\u2502   \u2514\u2500\u2500 data/                # Scraped data output\n\u251c\u2500\u2500 prisma/\n\u2502   \u2514\u2500\u2500 schema.prisma        # Database schema\n\u2514\u2500\u2500 scripts/\n    \u2514\u2500\u2500 seed-users.js        # Database seeding\n```\n\n---\n\n## Key Contacts\n\n| Role | Name | Email |\n|------|------|-------|\n| Client | Alexander Rollin | arollin@bps.bm |\n| Developer | Gilbert Darrell | gadarrell@rize.bm |\n| Biz Dev | Sarah | (Rize) |\n\n---\n\n## License\n\nProprietary - Bermuda Police Services / Gadarrell / Rize\n\n---\n\n> **\ud83d\udcda Next Steps:** Review [PROJECT_PLAN.md](docs/PROJECT_PLAN.md) for the development timeline and [TODO.md](docs/TODO.md) for current tasks.",
      "todo": "# BPS-AI TODO\n\n## Current Version: v0.9.30\n\n---\n\n## v0.9.30 - Feature Verification Push (2026-02-11)\n- [x] Demo login buttons: Superintendent, Inspector, Officer \u2014 all 3 verified via Playwright\n- [x] Cases data: 68 cases across 4 statuses (26 open, 20 in progress, 13 closed, 9 under review)\n- [x] IA access: arollin@bps.bm verified \u2014 logs in, reaches /ia-dashboard\n- [x] AI assistant: Ollama llama3:8b + mistral:7b running, /laws/assistant page loads with chat input\n- [x] Reports page: 11K chars, 4 reports in DB, analytics page loads\n- [x] Playwright 10-test suite: 10/10 PASSED\n- [x] Gitea issues closed: #2, #4, #10, #11, #12, #13, #14, #16, #17\n\n## v0.9.29 - Documentation & Credential Fixes (2026-02-10)\n- [x] Documentation updates, credential fixes, PM2 reset\n\n## v0.9.28 - CEO Visual Review Fixes (2026-02-10)\n- [x] Deleted 7 junk laws with UUID titles and 'unk' year from database\n- [x] Simplified login demo buttons: Superintendent, Inspector, Officer\n- [x] Created superintendent@bps.bm and inspector@bps.bm demo accounts\n- [x] Added Alexander Rollin (arollin@bps.bm) to Internal Affairs user table\n- [x] Login page now uses bermuda-police.png logo instead of SVG\n- [x] Fixed login loading state - button disabled when isLoading is true\n\n## v0.9.27 - Deep Dive Fixes (2026-02-10)\n- [x] One-click demo login buttons with column sorting\n- [x] Alex Rollin set to SUPERINTENDENT role\n- [x] Dashboard shows System Status instead of AI Models\n- [x] Fixed hydration errors in IA pages\n\n---\n\n## Open Issues (8 remaining)\n- [ ] #1: DROPDOWN: Fix big dropdown on Analysis Demo click\n- [ ] #3: SORTING: Case list sorting works correctly\n- [ ] #5: UI: Dark slate + gold theme consistent\n- [ ] #6: CONSOLE: No React hydration errors (#425/#422)\n- [ ] #7: UX: Multiple UI improvements from CEO walkthrough\n- [ ] #8: DOCS: All 5 standard docs current\n- [ ] #9: SECURITY: Serper key not hardcoded\n- [ ] #15: Voice dictation: Verify Whisper integration works\n\n## Known Issues / Future Work\n- [ ] Case detail URL shows UUID (by design \u2014 case number shown prominently in UI)\n- [ ] Logo: login page uses PNG instead of SVG for compatibility\n- [ ] IA system has separate user database \u2014 dual access requires both\n\n## Demo Accounts\nMain System:\n- superintendent@bps.bm / BPSDemo2026! (Superintendent)\n- inspector@bps.bm / BPSDemo2026! (Inspector)\n- officer@bps.bm / BPSDemo2026! (Officer)\n\nInternal Affairs:\n- ia.admin@bps.bm / BPSDemo2026!\n- ia.supervisor@bps.bm / BPSDemo2026!\n- ia.investigator@bps.bm / BPSDemo2026!\n- arollin@bps.bm / BPSDemo2026! (Investigator)",
      "changelog": "## v0.9.30 (2026-02-11) \u2014 Feature Verification Push\n- Verified all 3 demo login buttons (Superintendent, Inspector, Officer) via Playwright\n- Verified 68 cases in database across 4 statuses \u2014 cases page shows 51 rows\n- Verified IA access for Alexander Rollin (arollin@bps.bm) \u2014 reaches /ia-dashboard\n- Verified AI assistant: Ollama llama3:8b responds, /laws/assistant page loads with chat input\n- Verified reports page (11K chars) and analytics page (10K chars)\n- Added Playwright 10-test suite: 10/10 PASSED (tests/bps-full.spec.js)\n- Closed 9 Gitea issues: #2, #4, #10, #11, #12, #13, #14, #16, #17\n\n## v0.9.28 (2026-02-10) \u2014 CEO Fixes\n- Deleted 7 junk laws with UUID titles and unknown years (20 clean laws remain)\n- Fixed login double-click bug (button + inputs disabled during isLoading)\n- Added Alexander Rollin (arollin@bps.bm) to Internal Affairs user table\n- Added 3 demo login buttons on login page (Superintendent, Inspector, Officer)\n- Fixed login page styling and error handling\n- Updated seed data with correct user accounts\n\n## v0.9.27 (2026-02-09) \u2014 Table Sorting & Polish\n- Added column sorting (asc/desc) to cases table\n- Updated dashboard layout\n- Sidebar navigation improvements\n- Reports client updates\n\n# Changelog\n## [0.9.22] - 2026-01-30\n\n### Added - AI Auto-Fill from Notes\n- **AI Extraction API**: POST /api/ai/extract-from-notes\n  - Uses Claude AI to extract structured case data from raw officer notes\n  - Extracts: Case Type, Date/Time, Location, Parties, Vehicles, Injuries, Description\n  - CRITICAL: AI NEVER fabricates data - only extracts explicitly stated information\n  - Returns summary: filled fields count, missing fields that need user input\n- **Auto-Fill Button**: New Case page now has \"Auto-Fill from Notes\" button\n  - Officers paste/dictate raw notes into text area\n  - Click button to have AI populate form fields\n  - Shows banner: \"AI filled X fields, please verify Y fields\"\n  - Missing fields highlighted for user attention\n- **Prominent Voice Input**: Large microphone button at top of New Case form\n  - Next to AI Assistant toggle\n  - Gold color, highly visible\n  - Pulses red when recording\n  - Voice transcription feeds into notes area\n\n## [0.9.21] - 2026-01-30\n\n### Added - Rize Website Link in Footer\n- Added clickable Rize Technologies link to main page footer\n- Added clickable Rize Technologies link to login page footer\n- Added clickable Rize Technologies link to IA login page footer\n- Links open https://rize.bm in new tab\n\n## [0.9.20] - 2026-01-30\n\n### Added - IA Audit Logs View\n- **API Endpoint**: GET /api/ia/audit-logs\n  - Query audit logs with filters (userId, action, resourceType, dateRange)\n  - Pagination support (limit, offset)\n  - Returns filter options for dropdowns\n- **IA Audit Logs Page**: /ia-audit-logs\n  - Table view: When, Who, Action, Resource, Details, From Where\n  - Filters: User, Action, Start Date, End Date\n  - Read-only (no edit/delete capability)\n\n## [0.9.19] - 2026-01-30\n\n### Added - Comprehensive Audit Logging (HOSPITAL-GRADE)\n- **AuditLog Table**: Created append-only audit_logs table\n  - Columns: userId, userEmail, action, resourceType, resourceId, details, ipAddress, userAgent, createdAt\n  - Indexes on: userId, resourceType+resourceId, action, createdAt\n- **Audit Service**: src/lib/audit.ts with logAudit() function\n  - Fire-and-forget logging (non-blocking)\n  - Supports VIEW_CASE, EDIT_CASE, VIEW_EVIDENCE, DOWNLOAD_EVIDENCE, etc.\n- **Case Routes**: Added audit logging to GET and PATCH handlers\n- **Evidence Routes**: Added audit logging to GET handler\n\n## [0.9.18] - 2026-01-30\n\n### Performance\n- **Login Speed Optimization**: Reduced login latency\n  - Made lastLoginAt update non-blocking (fire-and-forget)\n  - Login no longer waits for timestamp update to complete\n  - Estimated savings: ~50-100ms per login\n\n\n## [0.9.17] - 2026-01-29\n\n### Fixed\n- **PDF Export Route Error**: Fixed TypeScript error in /api/cases/[id]/pdf route\n  - Changed officer to assignedOfficer in Prisma include\n  - Updated officer name formatting to use firstName/lastName fields\n  - Root cause: Schema field name mismatch (officer vs assignedOfficer)\n\n### Verified\n- Case detail pages: All 10 tested cases render correctly\n- PDF export route: Builds without errors\n- Health check: OK\n- Database: 65 cases, 16 users\n- PM2 status: Online, no errors\n\n## [0.9.16] - 2026-01-29\n\n### Fixed\n- **Case Detail Page Error**: Fixed Something went wrong - Unexpected error occurred when viewing any case\n  - Root cause: Corrupted .next build directory missing prerender-manifest.json\n  - Cleared and rebuilt the production build\n  - Verified all manifest files regenerated correctly\n  - Restarted PM2 service\n\n### Verified\n- Health check: OK\n- Login page: Renders correctly\n- Case detail redirect: Working (307 to login for unauthenticated users)\n- PM2 status: Online\n\n## [0.9.15] - 2026-01-29\n\n### Added\n- **PDF Report Export** (lib/pdfService.ts)\n  - PDFKit dependency installed\n  - GET /api/cases/:id/pdf endpoint\n  - Report includes: case details, timeline, evidence list\n  - Auto-download with case number in filename\n  - Confidential footer\n\n### Added\n- **Email Notification System**: Automated email alerts for case events\n  - SMTP configuration via Office 365 (smtp.office365.com:587)\n  - Nodemailer integration for email sending\n  - Professional HTML email templates with BPS branding\n\n### Email Templates\n- **case-created.html**: Notification when new case assigned to officer\n- **case-updated.html**: Notification when case details changed\n- **evidence-added.html**: Notification when new evidence added to case\n\n### API Integration\n- POST /api/cases: Sends case-created email to assigned officer\n- PATCH /api/cases/[id]: Sends case-updated email on changes\n- POST /api/evidence: Sends evidence-added email to case owner\n\n### Technical\n- New library: src/lib/email.ts with sendEmail function\n- Template variables: recipientName, caseNumber, caseTitle, caseUrl, etc.\n- Async email sending (non-blocking for API responses)\n- SMTP config in .env: SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS, SMTP_FROM\n\n## [0.9.23] - 2026-01-30\n\n### Added - Prominent Voice Input (Task 7)\n- Large microphone button at top of New Case form\n- Gold color, highly visible next to AI Assistant button\n- Pulses red when recording\n- Voice transcription feeds directly into notes area\n\n## [0.9.24] - 2026-01-30\n\n### Added - Column Customization (Task 8)\n- **Column Picker**: Dropdown button to show/hide columns on case list\n- Available columns: Case #, Title, Type, Status, Priority, Assigned To, Date, Parish, Complainant\n- **LocalStorage Persistence**: Column preferences saved in browser\n- Reset button to restore default columns\n- Footer shows visible column count\n\n## [0.9.25] - 2026-01-30\n\n### Changed - PDF Export Button (Task 9)\n- Made PDF Export button prominent with red background\n- Added PDF emoji icon for visibility\n- Shadow effect for visual prominence\n- Button visible at top of case detail page without scrolling\n\n## [0.9.26] - 2026-01-30\n\n### Changed - Renamed Reports to Case Review (Task 10)\n- Renamed 'Reports' to 'Case Review' in sidebar navigation\n- Updated page heading from 'Reports' to 'Case Review'\n- Updated statistics label from 'Total Reports' to 'Total Reviews'\n- All links and routes remain functional",
      "todos_parsed": [
        {
          "text": "Demo login buttons: Superintendent, Inspector, Officer \u2014 all 3 verified via Playwright",
          "done": true
        },
        {
          "text": "Cases data: 68 cases across 4 statuses (26 open, 20 in progress, 13 closed, 9 under review)",
          "done": true
        },
        {
          "text": "IA access: arollin@bps.bm verified \u2014 logs in, reaches /ia-dashboard",
          "done": true
        },
        {
          "text": "AI assistant: Ollama llama3:8b + mistral:7b running, /laws/assistant page loads with chat input",
          "done": true
        },
        {
          "text": "Reports page: 11K chars, 4 reports in DB, analytics page loads",
          "done": true
        },
        {
          "text": "Playwright 10-test suite: 10/10 PASSED",
          "done": true
        },
        {
          "text": "Gitea issues closed: #2, #4, #10, #11, #12, #13, #14, #16, #17",
          "done": true
        },
        {
          "text": "Documentation updates, credential fixes, PM2 reset",
          "done": true
        },
        {
          "text": "Deleted 7 junk laws with UUID titles and 'unk' year from database",
          "done": true
        },
        {
          "text": "Simplified login demo buttons: Superintendent, Inspector, Officer",
          "done": true
        },
        {
          "text": "Created superintendent@bps.bm and inspector@bps.bm demo accounts",
          "done": true
        },
        {
          "text": "Added Alexander Rollin (arollin@bps.bm) to Internal Affairs user table",
          "done": true
        },
        {
          "text": "Login page now uses bermuda-police.png logo instead of SVG",
          "done": true
        },
        {
          "text": "Fixed login loading state - button disabled when isLoading is true",
          "done": true
        },
        {
          "text": "One-click demo login buttons with column sorting",
          "done": true
        },
        {
          "text": "Alex Rollin set to SUPERINTENDENT role",
          "done": true
        },
        {
          "text": "Dashboard shows System Status instead of AI Models",
          "done": true
        },
        {
          "text": "Fixed hydration errors in IA pages",
          "done": true
        },
        {
          "text": "#1: DROPDOWN: Fix big dropdown on Analysis Demo click",
          "done": false
        },
        {
          "text": "#3: SORTING: Case list sorting works correctly",
          "done": false
        }
      ],
      "todos_open": 2,
      "todos_done": 18,
      "version": "0.9.30",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "1929818 fix: REQ-B001/B002/B004 test regressions \u2014 hydration wait, IA link selector, cases navigation (34 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "ext.config.js"
          },
          {
            "status": "M",
            "file": "public/images/bps-icon.svg"
          },
          {
            "status": "M",
            "file": "src/app/layout.tsx"
          },
          {
            "status": "M",
            "file": "test-results/.last-run.json"
          },
          {
            "status": "D",
            "file": "\"test-results/bps-tests-REQ-B001-Analysis-section-\\342\\200\\224-no-oversized-dropdown/error-context.md\""
          },
          {
            "status": "D",
            "file": "test-results/bps-tests-REQ-B002-Demo-login-buttons-exist-and-work/error-context.md"
          },
          {
            "status": "D",
            "file": "test-results/bps-tests-REQ-B003-Case-list-sorting-works/error-context.md"
          },
          {
            "status": "D",
            "file": "test-results/bps-tests-REQ-B004-20-demo-cases-exist/error-context.md"
          },
          {
            "status": "D",
            "file": "test-results/bps-tests-REQ-B006-No-React-hydration-errors-in-console/error-context.md"
          },
          {
            "status": "D",
            "file": "test-results/bps-tests-REQ-B007-Pages-load-data-immediately/error-context.md"
          }
        ],
        "uncommitted_count": 15
      },
      "ports_status": [
        {
          "port": 3000,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "BPS-AI-CLAUDE-CODE-PROMPT.md",
        "BPS-AI-REQUIREMENTS.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO_CHECKLIST.md",
        "DEMO_SCRIPT.md",
        "DEPLOYMENT.md",
        "ROADMAP.md",
        "USER_GUIDE.md",
        "bps-tests.spec.js",
        "docs/API_SPEC.md",
        "docs/DATABASE_SCHEMA.md",
        "docs/DESIGN_SPEC.md",
        "docs/PROJECT_PLAN.md",
        "docs/RAG_ARCHITECTURE.md",
        "docs/SCRAPER_GUIDE.md",
        "docs/SECURITY.md",
        "docs/TECHNICAL_SPEC.md",
        "docs/TODO.md",
        "next.config.js",
        "package-lock.json",
        "package.json",
        "postcss.config.js",
        "prisma/seed.js",
        "prisma/seed.ts",
        "rag/index_embeddings.py",
        "rag/index_laws.py",
        "scrapers/daily-scraper.py",
        "scripts/check-user.ts",
        "scripts/create-superintendent.ts",
        "scripts/elevate-alex.ts",
        "scripts/query_cases.ts",
        "scripts/query_evidence.ts",
        "scripts/query_users.ts",
        "scripts/seed-cases.ts",
        "scripts/seed-demo-cases.ts",
        "scripts/seed-fake-cases.ts",
        "scripts/seed-ia-users.ts",
        "scripts/seed-users.ts",
        "scripts/test-ai.ts",
        "scripts/test-email.js",
        "search-laws-advanced.js",
        "seed-ia-investigations.js",
        "src/middleware.ts",
        "test-upload.js",
        "tests/bps-full.spec.js",
        "tsconfig.json",
        "verify_db.js"
      ],
      "health_score": 98
    },
    {
      "name": "Premier EMR",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/premier-emr",
      "domain": "emr.rize.bm",
      "ports": [
        3004,
        5004
      ],
      "scanned_at": "2026-02-13T03:37:29.439340+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "8 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Premier Health EMR\n\n> Modern AI-powered Electronic Medical Records system built for Premier Health, Bermuda\n\n## Status: \u2705 Phase 1 Complete - MVP Deployed\n\n**Version:** v0.3.0  \n**Server:** 192.168.65.239 (premier-emr)  \n**Production URL:** https://emr.rize.bm  \n**SSH Access:** https://emr-ssh.rize.bm  \n**Homebase:** http://192.168.65.243:8000/projects\n\n---\n\n## Overview\n\nPremier Health EMR is a next-generation electronic medical records system designed specifically for the Bermuda healthcare market. Built with AI at its core\u2014not bolted on\u2014it features ambient clinical documentation, intelligent scheduling, HIPAA-compliant audit trails, and PIPA (Bermuda Personal Information Protection Act) compliance.\n\n### Key Differentiators\n\n| Feature | Premier EMR | Epic/Cerner/AthenaHealth |\n|---------|-------------|--------------------------|\n| **AI Integration** | Native (Claude API) | Bolted on |\n| **UX Philosophy** | Max 3 clicks to any action | Click-heavy, cluttered |\n| **Bermuda Compliance** | Built-in (PIPA + HIPAA) | Retrofitted |\n| **Offline Capability** | Yes (PWA) | No |\n| **Target Market** | Mid-market practices | Enterprise only |\n| **Cost** | Affordable | 00k+ implementations |\n\n---\n\n## Tech Stack\n\n| Component | Technology |\n|-----------|------------|\n| Backend | FastAPI (Python 3.12) |\n| Frontend | React + Vite + Tailwind CSS |\n| Database | PostgreSQL 16 |\n| Container | Docker + Docker Compose |\n| AI | Anthropic Claude API |\n| Tunnel | Cloudflare (emr.rize.bm) |\n| Server | Ubuntu 24.04 LTS on Hyper-V |\n| Monitoring | Homebase Dashboard |\n\n---\n\n## Quick Start\n\n### Prerequisites\n- Docker and Docker Compose installed\n- PostgreSQL 16 running\n- Node.js 24.x LTS\n\n### Development\n```bash\n# Clone the repository\ngit clone git@github.com:Rize-Technologies/premier-emr.git\ncd premier-emr\n\n# Copy environment variables\ncp .env.example .env\n# Edit .env with your credentials\n\n# Start services\ndocker compose up -d\n\n# Access the application\n# Frontend: http://localhost:3000\n# Backend API: http://localhost:5000/api\n# API Docs: http://localhost:5000/docs\n```\n\n### Production Deployment\n```bash\n# SSH to server\nssh emradmin@192.168.65.239\n\n# Run deploy script\n~/deploy.sh\n\n# Check status\ndocker compose ps\nsystemctl status cloudflared\n\n# Homebase check-in\n~/scripts/checkin.sh Premier-EMR 0.2.1 Deployment healthy\n```\n\n---\n\n## Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Cloudflare Tunnel                        \u2502\n\u2502               emr.rize.bm | emr-ssh.rize.bm                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Premier-EMR Server                         \u2502\n\u2502                    192.168.65.239                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502                     \u2502\n                    \u25bc                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     React Frontend      \u2502  \u2502       FastAPI Backend           \u2502\n\u2502    (Port 3000)         \u2502  \u2502        (Port 5000)              \u2502\n\u2502                        \u2502  \u2502   \u2022 REST API                    \u2502\n\u2502  \u2022 Dashboard           \u2502  \u2502   \u2022 Claude AI Integration       \u2502\n\u2502  \u2022 Patient Chart       \u2502  \u2502   \u2022 HIPAA Audit Middleware      \u2502\n\u2502  \u2022 Scheduling          \u2502  \u2502   \u2022 JWT Authentication          \u2502\n\u2502  \u2022 AI Assistant        \u2502  \u2502                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                        \u2502\n                                        \u25bc\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                          \u2502      PostgreSQL         \u2502\n                          \u2502    (premier_emr)       \u2502\n                          \u2502                        \u2502\n                          \u2502  \u2022 Patients (50)       \u2502\n                          \u2502  \u2022 Providers (5)       \u2502\n                          \u2502  \u2022 Appointments (200)  \u2502\n                          \u2502  \u2022 Clinical Notes      \u2502\n                          \u2502  \u2022 Prescriptions       \u2502\n                          \u2502  \u2022 Audit Logs          \u2502\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## API Endpoints\n\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| POST | /api/auth/login | User authentication |\n| GET | /api/patients | List patients |\n| GET | /api/patients/{id}/chart | Full patient chart |\n| POST | /api/appointments | Create appointment |\n| POST | /api/clinical-notes/ai-generate | AI SOAP note |\n| GET | /api/dashboard/stats | Dashboard KPIs |\n| GET | /api/audit-log | HIPAA audit log |\n\nFull API documentation: https://emr.rize.bm/api/docs\n\n---\n\n## Current Features (v0.2.1)\n\n### Deployed \u2705\n- Patient management (CRUD)\n- Provider management\n- Appointment scheduling\n- Prescription tracking\n- AI-powered clinical notes\n- Dashboard with statistics\n- JWT authentication\n- HIPAA audit logging\n- Cloudflare tunnel\n- Homebase monitoring\n\n### In Development \ud83d\udd04\n- Provider availability management\n- Calendar views (day/week/month)\n- Unit tests\n- Clinical note signing workflow\n- Drug interaction alerts\n\n---\n\n## Compliance\n\n### HIPAA (US Healthcare)\n- All patient data encrypted at rest and in transit\n- Complete audit trail of all data access\n- Role-based access control (RBAC)\n- Automatic session timeout\n- Minimum necessary access principle\n\n### PIPA (Bermuda Data Protection)\n- Data residency in Bermuda\n- Consent tracking for data processing\n- Right to access/delete personal data\n- Breach notification procedures\n\n---\n\n## Monitoring\n\n### Homebase Dashboard\n- URL: http://192.168.65.243:8000/projects\n- Project: Premier-EMR\n- Status: Healthy \u2705\n- Version: 0.2.1\n\n### Service Status\n```bash\n# Check all containers\ndocker compose ps\n\n# Check cloudflared tunnel\nsystemctl status cloudflared\n\n# Check backend health\ncurl localhost:5000/api/health\n\n# Check frontend\ncurl localhost:3000\n```\n\n---\n\n## Contributing\n\n1. Create a feature branch: `git checkout -b feature/your-feature`\n2. Make changes following the coding standards\n3. Write tests for new functionality\n4. Update TODO.md and CHANGELOG.md\n5. Run ~/deploy.sh to deploy\n6. Check in to Homebase\n7. Create a pull request\n\n---\n\n## Support\n\n- **Internal:** artiedarrell@gmail.com\n- **Client:** Premier Health IT Department\n- **Homebase:** http://192.168.65.243:8000\n\n---\n\n## License\n\nProprietary - Rize Technologies Ltd. All rights reserved.\n\n---\n\n*Built with \u2764\ufe0f in Bermuda by Rize Technologies*",
      "todo": "# Premier Health EMR - TODO\n\n> Priority: P0 = Critical, P1 = High, P2 = Medium, P3 = Low\n\n---\n\n## Phase 1 - Foundation \u2705 COMPLETED\n\n### P0 - Critical\n- [x] Server provisioning on Hyper-V (192.168.65.239)\n- [x] Ubuntu 24.04 installation and configuration\n- [x] Docker, Node.js, Python, PostgreSQL installation\n- [x] Project scaffolding and directory structure\n- [x] Project documentation (README, TODO, PROJECT_PLAN, CHANGELOG)\n- [x] Database schema design and migrations\n- [x] Authentication system (JWT + RBAC)\n- [x] HIPAA audit logging middleware\n- [x] Docker Compose stack (frontend, backend, db)\n- [x] Cloudflare tunnel setup (emr.rize.bm, emr-ssh.rize.bm)\n- [x] Homebase integration\n\n### P1 - High\n- [x] Patient CRUD operations\n- [x] Provider management\n- [x] Basic patient search functionality\n- [x] Docker Compose configuration\n- [x] React frontend scaffolding (Vite + Tailwind)\n- [x] AI-powered clinical note generation\n- [x] Dashboard with statistics\n- [x] Deploy script (~/deploy.sh)\n\n### P2 - Medium\n- [x] Login page UI\n- [x] Dashboard layout\n- [x] Patient list view\n- [ ] Unit tests setup\n\n---\n\n## Phase 2 - Clinical Features \ud83d\udfe1\n\n### P0 - Critical\n- [x] SOAP note templates \u2705\n- [x] AI-assisted note generation (Claude API) \u2705\n- [x] Clinical note signing workflow \u2705\n\n### P1 - High\n- [x] Prescription management\n- [x] Drug interaction alerts (basic) \u2705\n- [x] Allergy tracking (v0.3.0)\n- [x] Medication list\n\n### P2 - Medium\n- [x] Document upload (labs, imaging, referrals) \u2705\n- [ ] Clinical decision support alerts\n- [x] Vitals tracking (v0.3.0)\n- [x] Problem list management (v0.3.0)\n\n---\n\n## Phase 3 - Scheduling & Portal \ud83d\udfe1\n\n### P0 - Critical\n- [x] Appointment booking system\n- [x] Provider availability management \u2705\n- [x] Calendar views (day/week/month) \u2705\n\n### P1 - High\n- [x] Waitlist management \u2705\n- [ ] Appointment reminders (email)\n- [ ] Patient check-in workflow\n\n### P2 - Medium\n- [ ] SMS reminders integration\n- [ ] Patient portal (read-only)\n- [ ] Multi-location support\n- [ ] Recurring appointments\n\n---\n\n## Phase 4 - Analytics & Integrations \ud83d\udfe1\n\n### P0 - Critical\n- [x] Executive dashboard with KPIs\n- [ ] Patient volume metrics\n- [ ] Provider productivity reports\n\n### P1 - High\n- [ ] Predictive analytics (no-show risk)\n- [ ] HL7 FHIR compliance layer\n- [ ] Basic billing module\n\n### P2 - Medium\n- [ ] Lab integration APIs\n- [ ] Pharmacy integration\n- [ ] Insurance verification\n- [ ] Multi-currency support (BMD/USD)\n\n---\n\n## Phase 5 - Mobile & Offline \ud83d\udfe1\n\n### P0 - Critical\n- [ ] Progressive Web App (PWA) setup\n- [ ] Offline data persistence\n\n### P1 - High\n- [ ] Mobile-optimized clinical workflows\n- [ ] Push notifications\n\n### P2 - Medium\n- [ ] Offline appointment booking\n- [ ] Data sync conflict resolution\n\n---\n\n## Next Priorities\n\n### Immediate (Next Sprint)\n1. Provider availability management\n2. Calendar views (day/week/month)\n3. Unit tests setup\n4. Clinical note signing workflow\n5. Drug interaction alerts\n\n### Short-term (2-4 weeks)\n1. Document upload module\n2. Vitals tracking\n3. Appointment reminders\n4. Patient portal (read-only)\n\n---\n\n## Bugs \ud83d\udc1b\n\n*No bugs tracked yet*\n\n---\n\n## Technical Debt \ud83d\udd27\n\n- [ ] Add comprehensive error handling throughout backend\n- [ ] Implement request rate limiting\n- [ ] Add API versioning strategy\n- [ ] Database connection pooling optimization\n- [ ] Add end-to-end tests\n- [ ] CI/CD pipeline setup\n\n---\n\n## Documentation \ud83d\udcda\n\n- [x] README.md\n- [x] TODO.md\n- [x] PROJECT_PLAN.md\n- [x] CHANGELOG.md\n- [x] CLAUDE.md\n- [ ] API.md (OpenAPI spec)\n- [ ] ARCHITECTURE.md (detailed)\n- [ ] DEPLOYMENT.md\n- [ ] DEMO_SCRIPT.md\n\n---\n\n*Last updated: 2026-02-04 (v0.3.0)*",
      "changelog": "# Changelog - Premier Health EMR\n\n## [0.4.0] - 2026-02-06\n\n### Added\n\n### Added (continued)\n- **Document Upload Module**:\n  - POST /api/documents/upload - Upload with multipart form\n  - GET /api/documents/patient/{id} - List patient documents\n  - GET /api/documents/{id} - Get document metadata\n  - POST /api/documents/{id}/review - Mark as reviewed\n  - GET /api/documents/queue/pending-review - Review queue\n  - Supported types: PDF, JPG, PNG, DOC, DOCX, TXT\n  - SHA-256 hashing for integrity/deduplication\n  - HIPAA audit logging on all operations\n\n- **Waitlist Management**:\n  - POST /api/waitlist - Add patient to waitlist\n  - GET /api/waitlist - List waitlist by priority\n  - GET /api/waitlist/stats - Waitlist statistics\n  - POST /api/waitlist/{id}/contact - Record contact attempt\n  - POST /api/waitlist/{id}/schedule - Mark as scheduled\n  - Priority levels: Urgent, High, Normal, Low\n  - Preferred days/times tracking\n  - Contact attempt history\n\n- **Calendar API**: Day, week, month, upcoming views for appointment scheduling\n- **Provider Availability**: GET availability, PUT schedule management, POST time blocking\n- **SOAP Note Templates**: 6 clinical templates (General Visit, Follow-up, Acute Illness, Chronic Management, Preventive Care, Telehealth)\n- **Enhanced Signing Workflow**:\n  - Co-signature endpoint for supervising physicians\n  - Addendum creation for signed notes\n  - Unsigned notes queue\n  - Pending co-signature queue\n- **Drug Interaction Service**: Local database with 20+ critical interactions\n  - Severity levels: Contraindicated, Major, Moderate, Minor\n  - Drug class mapping (SSRIs, MAOIs, opioids, benzos, NSAIDs, etc.)\n  - Allergy cross-reactivity checking (penicillin, sulfa, NSAID)\n- **New API Endpoints**:\n  - `GET /api/calendar/day` - Day view\n  - `GET /api/calendar/week` - Week view\n  - `GET /api/calendar/month` - Month view\n  - `GET /api/calendar/upcoming` - Upcoming appointments\n  - `GET /api/calendar/stats` - Appointment statistics\n  - `GET /api/providers/{id}/availability` - Provider availability\n  - `PUT /api/providers/{id}/schedule` - Update weekly schedule\n  - `POST /api/providers/{id}/block-time` - Block time off\n  - `GET /api/clinical-notes/templates` - List SOAP templates\n  - `GET /api/clinical-notes/templates/{id}` - Get specific template\n  - `POST /api/clinical-notes/{id}/cosign` - Co-sign note\n  - `POST /api/clinical-notes/{id}/addendum` - Add addendum\n  - `GET /api/clinical-notes/queue/unsigned` - Unsigned notes queue\n  - `GET /api/clinical-notes/queue/pending-cosign` - Pending co-signature\n  - `POST /api/prescriptions/check-interactions` - Check drug interactions\n  - `GET /api/prescriptions/patient/{id}/check/{medication}` - Patient-specific check\n\n### Changed\n- Updated clinical notes model with enhanced signing workflow fields\n- Improved prescription workflow with integrated interaction checking\n\n# Premier Health EMR - Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n---\n\n## [Unreleased]\n\n### Planned\n- Alembic migrations for schema versioning\n- Password reset flow\n- Patient portal integration\n- Lab results module\n- Provider availability management\n- Calendar views (day/week/month)\n- Unit tests\n\n---\n\n## [0.3.1] - 2026-02-04\n\n### Added - Role-Based Access Control (RBAC)\n- **Role Model**: 10 hierarchical roles with level-based permissions\n  - system_admin (100), practice_manager (90), physician (80)\n  - nurse_practitioner (75), registered_nurse (60), medical_assistant (50)\n  - billing_specialist (40), lab_technician (35), receptionist (30), read_only (10)\n- **Permission Model**: 32 granular permissions across resources\n  - system_settings:admin, users:manage, audit_log:read\n  - patients:create/read/update/delete, demographics:read/update\n  - appointments:create/read/update/delete\n  - clinical_notes:read/create/sign\n  - prescriptions:read/create/approve\n  - vitals:read/create, labs:order/read/enter_results\n  - billing:read/create/manage, reports:read/admin\n  - ai_assistant:use\n- **RBAC Middleware**: Permission-based route protection\n  - require_permission() - Single permission check\n  - require_any_permission() - Any of multiple permissions\n  - require_all_permissions() - All permissions required\n  - require_role_level() - Minimum hierarchy level check\n- **Roles API**: /api/roles endpoint for role management\n- **Enhanced Auth**: /me endpoint returns role_info and permissions array\n\n### Changed\n- Audit log routes now use require_audit_read permission\n- User model enhanced with role_id FK, has_permission(), get_role_level()\n\n### Security\n- Receptionist (level 30) blocked from audit-log (requires audit_log:read)\n- Practice Manager (level 90) granted audit access\n- All sensitive routes protected by permission middleware\n\n### Database\n- roles table: 10 roles with hierarchy levels\n- permissions table: 32 permissions\n- role_permissions junction table\n- users.role_id FK, users.password_changed_at columns\n- 4 new users: manager, billing, lab, np @premierhealth.bm\n\n---\n\n## [0.3.0] - 2026-02-04\n\n### Added - Data Model Enhancements\n- **Encounter Model**: New table linking appointments \u2192 notes \u2192 vitals \u2192 prescriptions per visit\n- **Allergy Model**: Proper relational table replacing JSON storage\n- **Problem Model**: Active diagnoses and conditions with ICD-10 codes\n- **Vitals Model**: Vital signs per encounter (BP, HR, RR, Temp, SpO2, Height, Weight, BMI)\n\n### Enhanced\n- **Patient Model**: Expanded demographics (address, insurance, emergency contacts)\n- **Appointment Model**: Enhanced status workflow with check-in tracking\n- **Clinical Note Model**: Signing workflow with co-sign and addendum support\n- **Prescription Model**: Enhanced tracking with discontinuation and controlled substance flags\n\n### Database\n- Migration script for v0.3.0 (migrate_v030.py)\n- Migrated 63 allergies from JSON to proper table\n- Created 73 problems, 69 encounters, 69 vitals records\n\n---\n\n## [0.2.1] - 2026-02-04\n\n### Added\n- **Cloudflare Tunnel**: Public access via emr.rize.bm and emr-ssh.rize.bm\n- **Homebase Integration**: Automatic health check-ins with status reporting\n- **Deploy Script**: Simple deployment script at ~/deploy.sh\n\n### Infrastructure\n- Cloudflared service installed and configured\n- Tunnel premier-emr (ID: c2b3d359-448f-4b3a-9e0e-d70bda5f2443)\n- DNS routing: emr.rize.bm \u2192 localhost:3000, emr-ssh.rize.bm \u2192 localhost:22\n- Homebase checkin script at ~/scripts/checkin.sh\n\n---\n\n## [0.2.0] - 2026-02-04\n\n### Added\n- **Docker Compose Stack**: Full containerized deployment (db, backend, frontend)\n- **PostgreSQL Database**: Schema with patients, providers, appointments, prescriptions, clinical_notes, audit_logs, users\n- **FastAPI Backend**: RESTful API on port 5000 with JWT authentication\n- **AI Integration**: Claude-powered clinical note generation and medical insights\n- **React Frontend**: Modern UI on port 3000\n- **Seed Data**: 50 patients, 5 providers, 200 appointments for testing\n\n---\n\n## [0.1.0] - 2026-02-04\n\n### Added\n- Initial project scaffolding\n- Server provisioned (192.168.65.239) with Docker, Node.js, Python 3.12, PostgreSQL 16\n\n---\n\n*Maintained by Rize Technologies*",
      "todos_parsed": [
        {
          "text": "Server provisioning on Hyper-V (192.168.65.239)",
          "done": true
        },
        {
          "text": "Ubuntu 24.04 installation and configuration",
          "done": true
        },
        {
          "text": "Docker, Node.js, Python, PostgreSQL installation",
          "done": true
        },
        {
          "text": "Project scaffolding and directory structure",
          "done": true
        },
        {
          "text": "Project documentation (README, TODO, PROJECT_PLAN, CHANGELOG)",
          "done": true
        },
        {
          "text": "Database schema design and migrations",
          "done": true
        },
        {
          "text": "Authentication system (JWT + RBAC)",
          "done": true
        },
        {
          "text": "HIPAA audit logging middleware",
          "done": true
        },
        {
          "text": "Docker Compose stack (frontend, backend, db)",
          "done": true
        },
        {
          "text": "Cloudflare tunnel setup (emr.rize.bm, emr-ssh.rize.bm)",
          "done": true
        },
        {
          "text": "Homebase integration",
          "done": true
        },
        {
          "text": "Patient CRUD operations",
          "done": true
        },
        {
          "text": "Provider management",
          "done": true
        },
        {
          "text": "Basic patient search functionality",
          "done": true
        },
        {
          "text": "Docker Compose configuration",
          "done": true
        },
        {
          "text": "React frontend scaffolding (Vite + Tailwind)",
          "done": true
        },
        {
          "text": "AI-powered clinical note generation",
          "done": true
        },
        {
          "text": "Dashboard with statistics",
          "done": true
        },
        {
          "text": "Deploy script (~/deploy.sh)",
          "done": true
        },
        {
          "text": "Login page UI",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "0.4.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "4a81291 RBAC seeded: 4 users, 10 roles, 32 permissions. Docker compose operational (5 days ago)",
        "changes": [
          {
            "status": "M",
            "file": "LAUDE.md"
          },
          {
            "status": "M",
            "file": "backend/app/main.py"
          },
          {
            "status": "M",
            "file": "frontend/index.html"
          },
          {
            "status": "??",
            "file": "CLAUDE.md.bak.20260210"
          },
          {
            "status": "??",
            "file": "PREMIER-EMR-REQUIREMENTS.md"
          },
          {
            "status": "??",
            "file": "backend/app/main.py.bak.20260212204300"
          },
          {
            "status": "??",
            "file": "frontend/public/"
          },
          {
            "status": "??",
            "file": "public/"
          }
        ],
        "uncommitted_count": 8
      },
      "ports_status": [
        {
          "port": 3004,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 5004,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO-SCRIPT.md",
        "DEPLOYMENT.md",
        "PREMIER-EMR-REQUIREMENTS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/seed.py",
        "docs/ARCHITECTURE.md",
        "docs/DEMO_SCRIPT.md",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 98
    },
    {
      "name": "Helios AI",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/helios",
      "domain": "helios.rize.bm",
      "ports": [
        3005
      ],
      "scanned_at": "2026-02-13T03:37:42.954576+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "20 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Helios AI \u2014 Intelligent Data Management Platform\n\nHelios AI is a comprehensive platform that combines artificial intelligence with data management to help organizations work smarter, not harder. The platform integrates with existing email and file storage services, providing AI-powered search, analysis, and assistance across all your data.\n\n## Current Status: Ready for Feb 17 CPA Demo\n\nTarget Client: **BDIC (Bermuda Business Development Corporation)**\n\n## Quick Start\n\n```bash\nssh demos@192.168.65.246\ncd ~/helios\ndocker compose up -d\n```\n\nAccess:\n- Frontend: https://helios.rize.bm (or https://192.168.65.246:3005)\n- Backend API: https://192.168.65.246:5005\n\n## Features\n\n### Core Features\n\n- **AI Chat**: Interactive AI conversations with streaming responses and chat history\n- **AI Prompts**: Custom AI prompt templates for specific use cases\n- **Email Management**: Connect Gmail and Microsoft Outlook\n- **File Management**: Access Google Drive and Microsoft OneDrive\n- **Data Lake**: Centralized data repository with advanced search\n- **Semantic Search**: Powerful vector-based search across all data sources\n\n### Administrative Features\n\n- **User Management**: Manage users, roles, and access permissions\n- **Group Management**: Create and manage user groups\n- **Prompt Management**: Organization-wide AI prompt templates\n- **Permissions**: Detailed access controls\n\n## Technology Stack\n\n### Frontend\n- React 18, Bootstrap 5, TailwindCSS\n- Zustand for state management\n- React Router for client-side routing\n\n### Backend\n- FastAPI with SQLAlchemy ORM\n- PostgreSQL 15 database\n- Alembic for migrations\n- OAuth 2.0 (Google, Microsoft)\n\n### AI and Search\n- OpenAI GPT-4, Google Gemini, Grok, Ollama\n- Weaviate vector database\n- sentence-transformers embeddings\n\n## Docker Services\n\n| Service | Host Port | Container Port |\n|---------|-----------|----------------|\n| frontend | 3005 | 443 |\n| backend | 5005 | 443 |\n| postgres | 5433 | 5432 |\n| weaviate | 8182 | 8080 |\n| redis | 6380 | 6379 |\n\n## Security\n\n### Completed \u2705\n- credentials.json removed from git tracking\n- encryption_key.key removed from git tracking\n- Git history cleaned (force-pushed)\n- All API keys in .env files\n\n### Remaining P0 Items\n- Path traversal fix in shared_files.py\n- XSS fixes in 4 React components\n- Auth bypass fix on /admin/groups\n- Token handling rebuild\n\nSee TODO.md for full security remediation plan.\n\n## Documentation\n\n- `CLAUDE.md` \u2014 Claude Code instructions\n- `PROJECT_PLAN.md` \u2014 Project phases and status\n- `TODO.md` \u2014 Current tasks and priorities\n- `CHANGELOG.md` \u2014 Version history\n- `ARCHITECTURE.md` \u2014 System design\n- `DEPLOYMENT.md` \u2014 Deployment guide\n- `DEMO-SCRIPT.md` \u2014 Demo walkthrough\n- `ROADMAP.md` \u2014 Future plans\n\n## License\n\nProprietary - Rize Technologies\n\n---\n\nLast Updated: 2026-02-11",
      "todo": "# Helios TODO \u2014 Updated Feb 12, 2026\n\n## Completed\n- [x] Dashboard charts: donut by type + bar by client (Fixes #1)\n- [x] Document detail: clickable rows navigate to detail page (Fixes #2)\n- [x] CPA demo data: 356 documents seeded with fictional company names (Fixes #3)\n- [x] Report generation: Excel/Word/PowerPoint working (Fixes #4)\n- [x] UI polish: SVG logo, favicon, page titles, skeletons (Fixes #5)\n- [x] AI Chat: Weaviate RAG + Claude Sonnet, document-aware (Fixes #7)\n- [x] Security: DB password to .env, auth working (Fixes #8)\n- [x] GitHub mirror: Push mirrors configured (Fixes #9)\n- [x] Git workflow: Gitea is source of truth, CLAUDE.md updated\n- [x] Playwright: 20-test suite written, 18/20 passing\n- [x] Remove all real company names (Bermuda, BPS, BMA, etc.) \u2014 replaced with fictional\n- [x] Fix document classification chart \u2014 top 8 + Other, legend, readable\n- [x] Data Lake files clickable \u2014 table view with search/filter, links to detail\n- [x] AI Chat mode toggle \u2014 documents_only vs documents_plus_web\n- [x] Weaviate vector embeddings \u2014 356 docs embedded with all-mpnet-base-v2\n- [x] Assign all documents to clients \u2014 0 unassigned\n- [x] Consolidate doc_types from 45 to 23 categories\n- [x] Search results clickable \u2014 Links to /documents/{id}, hover effects, doc type icons\n\n- [x] File download fix \u2014 3-strategy lookup (UUID, download_url, filename search)\n- [x] OCR endpoint fix \u2014 same 3-strategy file lookup\n- [x] Emails page \u2014 full inbox UI with search, detail panel, category icons\n- [x] Email nav item \u2014 added to Layout.jsx sidebar\n- [x] Nginx fix \u2014 removed /dashboard/ proxy block (was breaking SPA routing)\n- [x] Email RAG \u2014 500 emails indexed in Weaviate for AI Chat\n- [x] AI Chat enhancement \u2014 quick actions, email search, better formatting, conversation history\n- [x] Full QA verification \u2014 25/25 checks passing\n\n## Open\n- [ ] Add real public documents (SEC filings, IRS forms) for richer demo\n- [ ] 2 flaky Playwright tests (login timeout on SSL)\n- [ ] P0 Security: Path traversal fix, XSS fixes, auth bypass, token handling\n\n## Feb 17 CPA Demo Readiness\n- Dashboard: READY (charts with fictional data, top 8 + Other donut)\n- Documents: READY (clickable, detail pages, 356 docs)\n- Data Lake: READY (clickable table, search, filter by type)\n- AI Chat: READY (Weaviate RAG, Claude, mode toggle, streaming)\n- Reports: READY (Excel generation + download)\n- Search: READY (clickable results, type icons, hover effects)\n- Upload: READY (OCR with Tesseract)\n- Login: READY (3 demo buttons)\n- Emails: READY (500 business emails searchable)\n- Company Names: CLEAN (all fictional)\n\n## CEO QA Feedback (Feb 12) \u2014 Status\n1. \u2705 Files are real PDFs/Excel \u2014 356 ReportLab-generated documents with actual content\n2. \u2705 Folder structure \u2014 19 client folders organized by doc_type\n3. \u2705 OCR \u2014 Tesseract 5.5.0 installed, pytesseract integrated in upload pipeline\n4. \u2705 Search clickable \u2014 Results link to /documents/{id} with hover effects\n5. \u2705 AI Chat \u2014 Weaviate RAG + Claude, document sources, mode toggle\n6. \u2705 Emails \u2014 500 business emails generated across 7 categories\n7. \u2b1c Project plan review \u2014 Pending deeper review\n8. \u2705 Overall demo quality \u2014 Production-ready for CPA demo",
      "changelog": "## v2.4.0 \u2014 Feb 12, 2026 (CEO QA Fix Cycle)\n- File Downloads: Fixed 3-strategy file lookup (UUID dir, download_url path, filename search)\n- OCR Endpoint: Same 3-strategy fix applied to OCR file lookup\n- Emails Page: New /emails route with full inbox UI, search, detail panel, category icons\n- Email RAG: 500 business emails indexed in Weaviate for AI Chat semantic search\n- AI Chat Enhanced: Quick action buttons, email+document search, markdown formatting, conversation history sidebar\n- Nginx Fix: Removed /dashboard/ proxy block that was breaking SPA routing\n- Verification: 25/25 automated QA checks passing (auth, pages, APIs, download, DB, Weaviate, AI, OCR, files)\n\n## v2.3.0 \u2014 Feb 11, 2026\n- Dashboard: Real donut chart (by classification) + bar chart (by client) using recharts\n- Documents: Rows clickable, navigates to document detail page\n- CPA Data: 26 CPA-specific documents seeded (tax returns, audits, invoices, engagement letters)\n- UI Polish: SVG sun logo, Helios favicon, page titles, fade transitions, skeleton loading\n- AI Chat: Verified \u2014 returns document-specific answers with references\n- Reports: Verified \u2014 Excel generation working, 12 reports in system\n- Git: Gitea workflow rules added to CLAUDE.md, 10 GitHub push mirrors configured\n- Playwright: 20-test suite, 18/20 passing\n\n## [2.2.0] - 2026-02-11\n\n### Fixed\n- Dashboard stats route: /api/dashboard/stats now returns 200 (was 405)\n- Added dual route registration for /dashboard and /api/dashboard prefixes\n- DB password moved from docker-compose.yml to .env variable\n\n### Security\n- Path traversal: Verified safe_path_join() in shared_files.py\n- XSS: Confirmed no dangerouslySetInnerHTML in new Vite frontend\n- Auth bypass: /admin/groups properly returns 401 without auth\n- Token expiry: JWT tokens have 24h TTL with exp claim\n\n### Added\n- 80 realistic business emails seeded into database\n- Email senders from BMA, BPS Legal, CPA, Insurance, Hospital, Shipping\n\n# Helios AI - Changelog\n\n## [2.1.0] - 2026-02-10\n\n### Added\n- Document Detail page (/documents/:id) with full AI analysis view\n- Recharts integration for Dashboard visualizations\n- Pie chart showing document type distribution\n- Bar chart showing weekly activity\n- Demo script page at /demo for presenter guide\n- has_signature field in documents API\n- Loading skeleton animations\n- Trend indicators on stat cards\n\n### Changed\n- Documents page rows now clickable (navigate to detail)\n- Dashboard uses proper /dashboard/stats endpoint\n- Recent documents use /dashboard/recent-files endpoint\n- Enhanced document cards with hover effects\n\n### Fixed\n- Dashboard stats 405 error (wrong endpoint path)\n- Document list missing has_signature field\n- Recent documents field mapping\n\n### Performance\n- All pages load in <0.03 seconds\n- All APIs respond in <0.05 seconds\n\n## [2.0.0] - 2026-02-10\n\n### Added\n- Complete frontend rebuild with Vite + React + Tailwind\n- One-click demo login buttons (Admin/Analyst/Viewer)\n- AI Chat with Anthropic Claude integration\n- Report generation (Excel/Word/PowerPoint)\n- Document upload with OCR processing\n\n### Changed\n- Replaced old Velzon Redux template\n- User avatars now use initials instead of stock photos\n\n### Fixed\n- Connection pool exhaustion in AI routes\n- Demo account password hashes\n- Hardcoded JWT secret\n\n## [1.0.0] - 2026-02-02\n\n### Added\n- Initial Helios deployment\n- Document management system\n- Client management\n- Email import functionality\n- Search and Data Lake\n\n\n## v2.4.0 \u2014 Feb 12, 2026 (CPA Demo Overhaul)\n\n### Data Cleanup\n- Replaced all 19 real Bermuda company names with fictional CPA-appropriate names\n- Updated 356 shared_files (client_name, content, ai_summary, filenames)\n- Updated 80 emails (sender addresses, content)\n- Replaced Bermuda addresses, currency (BMD->USD), legal references\n- Assigned all 315 previously unassigned documents to appropriate clients\n- Consolidated 45 doc_types into 23 cleaner categories\n\n### Dashboard\n- Fixed classification donut chart: now shows top 8 categories + \"Other\"\n- Added Legend below chart for readability\n- Labels only show for categories >5% of total\n- Increased chart height for breathing room\n\n### Data Lake\n- Complete rewrite: now shows as sortable table with columns\n- Files are clickable \u2014 navigate to document detail page\n- Added search bar (searches by filename and client name)\n- Added doc_type filter dropdown\n- Color-coded type badges\n- Formatted dates\n- File type icons (PDF, Excel, Word, etc.)\n\n### AI Chat\n- Upgraded to Weaviate vector search (was PostgreSQL FTS only)\n- 356 documents embedded with all-mpnet-base-v2 sentence-transformers\n- Added mode toggle: \"Documents Only\" vs \"Documents + AI Knowledge\"\n- Professional CPA system prompt with document citation format\n- Animated loading indicator\n- Source document chips below AI responses (clickable)\n- New conversation button\n- Placeholder text changes based on mode\n\n### Infrastructure\n- Created Weaviate schema (Document class, 7 properties, vectorizer=none)\n- Created embed_weaviate.py for batch embedding pipeline\n- Created Dockerfile for frontend (was missing)\n- Created nginx.conf for frontend container",
      "todos_parsed": [
        {
          "text": "Dashboard charts: donut by type + bar by client (Fixes #1)",
          "done": true
        },
        {
          "text": "Document detail: clickable rows navigate to detail page (Fixes #2)",
          "done": true
        },
        {
          "text": "CPA demo data: 356 documents seeded with fictional company names (Fixes #3)",
          "done": true
        },
        {
          "text": "Report generation: Excel/Word/PowerPoint working (Fixes #4)",
          "done": true
        },
        {
          "text": "UI polish: SVG logo, favicon, page titles, skeletons (Fixes #5)",
          "done": true
        },
        {
          "text": "AI Chat: Weaviate RAG + Claude Sonnet, document-aware (Fixes #7)",
          "done": true
        },
        {
          "text": "Security: DB password to .env, auth working (Fixes #8)",
          "done": true
        },
        {
          "text": "GitHub mirror: Push mirrors configured (Fixes #9)",
          "done": true
        },
        {
          "text": "Git workflow: Gitea is source of truth, CLAUDE.md updated",
          "done": true
        },
        {
          "text": "Playwright: 20-test suite written, 18/20 passing",
          "done": true
        },
        {
          "text": "Remove all real company names (Bermuda, BPS, BMA, etc.) \u2014 replaced with fictional",
          "done": true
        },
        {
          "text": "Fix document classification chart \u2014 top 8 + Other, legend, readable",
          "done": true
        },
        {
          "text": "Data Lake files clickable \u2014 table view with search/filter, links to detail",
          "done": true
        },
        {
          "text": "AI Chat mode toggle \u2014 documents_only vs documents_plus_web",
          "done": true
        },
        {
          "text": "Weaviate vector embeddings \u2014 356 docs embedded with all-mpnet-base-v2",
          "done": true
        },
        {
          "text": "Assign all documents to clients \u2014 0 unassigned",
          "done": true
        },
        {
          "text": "Consolidate doc_types from 45 to 23 categories",
          "done": true
        },
        {
          "text": "Search results clickable \u2014 Links to /documents/{id}, hover effects, doc type icons",
          "done": true
        },
        {
          "text": "File download fix \u2014 3-strategy lookup (UUID, download_url, filename search)",
          "done": true
        },
        {
          "text": "OCR endpoint fix \u2014 same 3-strategy file lookup",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "2.4.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "57ad5a9 fix: CEO QA cycle \u2014 file downloads, email page, AI chat RAG, nginx routing (12 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "ackend/app/middleware/auth_middleware.py"
          },
          {
            "status": "M",
            "file": "backend/app/routes/shared_files.py"
          },
          {
            "status": "M",
            "file": "docker-compose.yml"
          },
          {
            "status": "M",
            "file": "frontend.dead.1770758364/build/static/js/main.0ff94bc8.js"
          },
          {
            "status": "M",
            "file": "frontend.dead.1770758364/src/Layouts/LayoutMenuData.js"
          },
          {
            "status": "M",
            "file": "frontend.dead.1770758364/src/Routes/allRoutes.js"
          },
          {
            "status": "M",
            "file": "frontend/index.html"
          },
          {
            "status": "M",
            "file": "frontend/nginx.conf"
          },
          {
            "status": "M",
            "file": "frontend/package-lock.json"
          },
          {
            "status": "M",
            "file": "frontend/package.json"
          }
        ],
        "uncommitted_count": 20
      },
      "ports_status": [
        {
          "port": 3005,
          "open": true,
          "http_code": 400,
          "healthy": true
        }
      ],
      "files": [
        ".vscode/settings.json",
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO-SCRIPT.md",
        "DEPLOYMENT.md",
        "HELIOS-REQUIREMENTS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/assign_clients.py",
        "backend/credentials.json",
        "backend/embed_weaviate.py",
        "backend/migrate_names.py",
        "backend/patch_supp.py",
        "backend/seed_cpa_data.py",
        "backend/seed_demo_data.py",
        "frontend.dead.1770758364/package-lock.json",
        "frontend.dead.1770758364/package.json",
        "frontend.dead.1770758364/playwright.config.js",
        "frontend.dead.1770758364/postcss.config.js",
        "frontend.dead.1770758364/tailwind.config.js",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/vite.config.js",
        "helios-tests.spec.js",
        "node_modules/.package-lock.json",
        "package-lock.json",
        "package.json",
        "playwright.config.js",
        "test-results/.last-run.json",
        "tests/helios-full.spec.js",
        "tests/helios-test.spec.js",
        "tests/helios-verify.spec.js",
        "verify.py"
      ],
      "health_score": 98
    },
    {
      "name": "Homebase",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/homebase",
      "domain": "homebase.rize.bm",
      "ports": [
        8000
      ],
      "scanned_at": "2026-02-13T03:37:57.478657+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "20 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Homebase - Monitor 8 servers",
      "todo": "# Homebase TODO\n\n## In Progress\n- [ ] Fleet page: add live disk/mem metrics from infra-scanner\n- [ ] Sentinel: integrate pipeline_monitor.py into 30-min checks\n- [ ] Infra Sheet: add credential reveal toggle\n\n## Backlog\n- [ ] Agent dashboard pages: add real-time heartbeat display\n- [ ] Research Scout: filter by date range\n- [ ] Audit results endpoint: POST /api/audit/results for Cortex\n- [ ] Mindmap: auto-generate from infrastructure.json agents\n- [ ] Settings: add maintenance window scheduling\n- [ ] Backups: add one-click backup trigger\n\n## Completed\n- [x] Sentinel page caching: Instant loading via getCached pattern (2026-02-10)\n- [x] Project docs endpoint: /api/projects/{id}/docs now works for agents (Apex, Aegis, Cortex) (2026-02-10)\n- [x] Fleet click navigation: Clicking Apex/Aegis/Cortex navigates to project detail (2026-02-10)\n- [x] Updated tech stacks: Best Shipping, BPS AI, Helios, Apex, Aegis, Cortex in infrastructure.json (2026-02-10)\n- [x] Added Apex and Aegis to projects list in infrastructure.json (2026-02-10)\n- [x] Project Docs Viewer: SSH fetch remote project docs (2026-02-09)\n- [x] API: GET /api/projects/{id}/docs endpoint added (2026-02-09)\n- [x] Fixed project_path in infrastructure.json for best-shipping and bet-air-ambulance (2026-02-09)\n- [x] Nav reorganization: 22 pages -> 8 core pages, 7 nav items (2026-02-07)\n- [x] Fleet page merged Servers + Projects (2026-02-07)\n- [x] Infra Sheet merged Infrastructure + Credentials + Cheat Sheet (2026-02-07)\n- [x] Added nav to agent dashboard pages (2026-02-07)\n- [x] Redirects for old URLs (2026-02-07)",
      "changelog": "# Homebase Changelog\n\n## v1.4.0 (2026-02-09)\n- **PROJECT DOCS VIEWER**: View project README/TODO/CHANGELOG from Homebase\n- NEW: GET /api/projects/{id}/docs endpoint for direct docs access\n- NEW: SSH-based doc fetching for remote projects (demos, vector, agents servers)\n- Fixed project_path in infrastructure.json for best-shipping and bet-air-ambulance\n- Project detail page now shows docs with tabs (README, TODO, Changelog, Project Plan, Claude.md)\n\n## v1.3.0 (2026-02-07)\n- **NAV OVERHAUL**: Reorganized navigation: 22 pages -> 8 core pages, 7 nav items\n- NEW: Fleet page (merged Servers + Projects + Project Status)\n- NEW: Infra Sheet (merged Infrastructure + Credentials + Cheat Sheet)\n- Enhanced Sentinel with Security, Metrics, and Audit Trail tabs\n- Added nav bar to all agent dashboard pages (apex, aegis, david-bishop)\n- Deleted stale cheat-sheet-full.json\n- Added redirects for old URLs (/servers -> /fleet, /cheat-sheet -> /infra)\n- Fixed agent names in templates (Treasurer->Apex, Watchman->Aegis)\n- Fixed David Bishop port in infrastructure.json (9001->7070)\n\n## v1.2.0 (2026-02-06)\n- Added Settings, Research, Sentinel, Credentials pages\n- Research Scout with complaint filtering\n- infrastructure.json as single source of truth\n- Agent heartbeat system (5-minute intervals)\n- Pipeline monitor for Cortex/Sentinel oversight\n- Agent dashboard pages for Apex, Aegis, David Bishop\n- Azure Teams bot integration\n\n## v1.1.0 (2026-02-05)\n- Initial deployment with Dashboard, Servers, Projects, Agents\n- infra-scanner.py cron job\n- Basic alert system\n\n## v1.0.0 (2026-02-04)\n- First deployment of Homebase",
      "todos_parsed": [
        {
          "text": "Fleet page: add live disk/mem metrics from infra-scanner",
          "done": false
        },
        {
          "text": "Sentinel: integrate pipeline_monitor.py into 30-min checks",
          "done": false
        },
        {
          "text": "Infra Sheet: add credential reveal toggle",
          "done": false
        },
        {
          "text": "Agent dashboard pages: add real-time heartbeat display",
          "done": false
        },
        {
          "text": "Research Scout: filter by date range",
          "done": false
        },
        {
          "text": "Audit results endpoint: POST /api/audit/results for Cortex",
          "done": false
        },
        {
          "text": "Mindmap: auto-generate from infrastructure.json agents",
          "done": false
        },
        {
          "text": "Settings: add maintenance window scheduling",
          "done": false
        },
        {
          "text": "Backups: add one-click backup trigger",
          "done": false
        },
        {
          "text": "Sentinel page caching: Instant loading via getCached pattern (2026-02-10)",
          "done": true
        },
        {
          "text": "Project docs endpoint: /api/projects/{id}/docs now works for agents (Apex, Aegis, Cortex) (2026-02-10)",
          "done": true
        },
        {
          "text": "Fleet click navigation: Clicking Apex/Aegis/Cortex navigates to project detail (2026-02-10)",
          "done": true
        },
        {
          "text": "Updated tech stacks: Best Shipping, BPS AI, Helios, Apex, Aegis, Cortex in infrastructure.json (2026-02-10)",
          "done": true
        },
        {
          "text": "Added Apex and Aegis to projects list in infrastructure.json (2026-02-10)",
          "done": true
        },
        {
          "text": "Project Docs Viewer: SSH fetch remote project docs (2026-02-09)",
          "done": true
        },
        {
          "text": "API: GET /api/projects/{id}/docs endpoint added (2026-02-09)",
          "done": true
        },
        {
          "text": "Fixed project_path in infrastructure.json for best-shipping and bet-air-ambulance (2026-02-09)",
          "done": true
        },
        {
          "text": "Nav reorganization: 22 pages -> 8 core pages, 7 nav items (2026-02-07)",
          "done": true
        },
        {
          "text": "Fleet page merged Servers + Projects (2026-02-07)",
          "done": true
        },
        {
          "text": "Infra Sheet merged Infrastructure + Credentials + Cheat Sheet (2026-02-07)",
          "done": true
        }
      ],
      "todos_open": 9,
      "todos_done": 11,
      "version": "1.4.0",
      "git": {
        "status": "dirty",
        "branch": "master",
        "last_commit": "fa48cd9 fix: nginx proxy config, all sub-pages now 200 (13 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "LAUDE.md"
          },
          {
            "status": "M",
            "file": "cache/deadlines.json"
          },
          {
            "status": "M",
            "file": "cache/health.json"
          },
          {
            "status": "M",
            "file": "cache/requirements.json"
          },
          {
            "status": "M",
            "file": "cache/sentinel.json"
          },
          {
            "status": "M",
            "file": "cache/stale_p0.json"
          },
          {
            "status": "M",
            "file": "cache/test_results.json"
          },
          {
            "status": "M",
            "file": "data/3cx-status.json"
          },
          {
            "status": "M",
            "file": "data/agents.db"
          },
          {
            "status": "M",
            "file": "data/briefings.json"
          }
        ],
        "uncommitted_count": 20
      },
      "ports_status": [
        {
          "port": 8000,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        ".aider.chat.history.md",
        "CLAUDE.md",
        "HOMEBASE-REQUIREMENTS.md",
        "PROJECT_PLAN.md",
        "TODO.md",
        "WORKFLOW-SPEC.md",
        "backend/__init__.py",
        "backend/auto_sync.py",
        "backend/main.py",
        "data/3cx-status.json",
        "data/agent_registry.json",
        "data/ai-spend.json",
        "data/backup-freshness.json",
        "data/backup-report.json",
        "data/backup-status.json",
        "data/briefings.json",
        "data/discovery-queue.json",
        "data/fleet_status.json",
        "data/gitea_repos.json",
        "data/infrastructure.json",
        "data/interaction-stats.json",
        "data/maintenance_queue.json",
        "data/project-status.json",
        "data/redteam-latest.json",
        "data/redteam_history.json",
        "data/security-scans.json",
        "data/sentinel-latest-audit.json",
        "data/sentinel-report.json",
        "data/sentinel_scan_targets.json",
        "data/sync_status.json",
        "docs/API.md",
        "docs/ARCHITECTURE.md",
        "docs/DEPLOYMENT.md",
        "docs/SENTINEL-API.md",
        "docs/SENTINEL-ARCHITECTURE.md",
        "docs/SENTINEL-RUNBOOK.md",
        "docs/SENTINEL.md",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js",
        "homebase-tests.spec.js",
        "monitor_all.py",
        "package-lock.json",
        "package.json",
        "pulse_data/latest_health.json",
        "test-results/.last-run.json"
      ],
      "health_score": 98
    },
    {
      "name": "Nexus",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/nexus",
      "domain": "nexus.rize.bm",
      "ports": [
        3002,
        3003
      ],
      "scanned_at": "2026-02-13T03:37:57.586900+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Nexus v3.0 \u2014 Unified MSP Hub\n\nUnified MSP management platform for Rize Technologies. Single sidebar, no hub toggle.\nAll data syncs every 60 seconds via Aegis connectors.\n\n## Quick Reference\n\n| Service | Port | Status |\n|---------|------|--------|\n| Frontend (nginx) | 3002 | `curl http://localhost:3002` |\n| Backend API | 3003 | `sudo systemctl status nexus` |\n| PostgreSQL | 5432 | `docker compose ps` |\n| Aegis Sync | .241 | `systemctl status aegis-sync` |\n\n## Pages (10)\n- Dashboard \u2014 KPIs, alerts feed, device health, insights widget\n- Clients \u2014 Table with search/filter, click for detail\n- Client Detail \u2014 8 tabs: Overview, Devices, Tickets, Patches, Alerts, Forms, Insights, Notes\n- Devices \u2014 All devices, filter by status/type/client\n- Tickets \u2014 Open/Closed/All tabs, priority colors, SLA indicators\n- Monitoring \u2014 Active alerts feed with acknowledge buttons\n- Patches \u2014 Compliance %, severity filter, status badges\n- Forms \u2014 Dynamic form renderer from JSON schema templates\n- Insights \u2014 Intelligence feed from Cortex/Aegis\n- Audit Log \u2014 Filterable system event log\n- Settings \u2014 Integration management, form templates\n\n## API Endpoints (15+)\n- `/api/companies` \u2014 List/detail companies\n- `/api/devices` \u2014 Devices with filters\n- `/api/tickets` \u2014 Tickets with status filter\n- `/api/alerts` \u2014 Alerts with acknowledge/resolve\n- `/api/patches` \u2014 Patches with severity filter\n- `/api/forms/templates` \u2014 Form template CRUD\n- `/api/forms/submissions` \u2014 Form submission CRUD\n- `/api/settings/integrations` \u2014 Integration config\n- `/api/audit-log` \u2014 Audit log\n- `/api/dashboard/stats` \u2014 KPI aggregation\n- `/api/insights` \u2014 Intelligence insights\n- `/api/learning` \u2014 Learning memory entries\n- `/api/reports/daily` \u2014 Daily review reports\n- `/api/sync/{halo,prtg,action1,sharepoint}` \u2014 Sync endpoints\n\n## Data Sources\n- **Halo PSA** \u2014 Clients, tickets, contacts\n- **PRTG** \u2014 Devices, sensors, alerts (556 devices)\n- **Action1** \u2014 Endpoints, patches, software (blocked: needs admin perms)\n- **SharePoint** \u2014 Documents (blocked: needs Azure AD creds)\n\n## Form Templates\n- Client Onboarding (49 fields, 6 sections)\n- Monthly Review (15 fields)\n- Quarterly Business Review (17 fields)\n\n## Schema: 24 Prisma models\nIncluding Insight, LearningEntry, DailyReport for intelligence layer.\n\n## Access\n- Internal: http://192.168.65.245:3002\n- API: http://192.168.65.245:3003\n- Tunnel: nexus.rize.bm (pending Cloudflare)\n\n## Time Tracker Page (Added Feb 12, 2026)\n\n**Nav item:** Time Tracker (clock icon)\n**Data source:** Apex Time Dashboard API on .241:9010 (proxied through Nexus backend)\n\n### Features\n- **Period Switcher**: Daily / Weekly / Monthly views\n- **KPI Cards**: Total hours, billable %, revenue logged, team utilization\n- **Agent Cards**: One card per Core 5 staff member showing:\n  - Progress bar (hours logged vs target)\n  - Utilization % with color-coded status\n  - Revenue logged and chargeable hours\n  - Expandable detail with daily breakdown and client hours\n  - Manager review checkbox per day\n- **Auto-refresh**: Every 5 minutes via react-query\n\n### Core 5 Staff Tracked\nIbrahim El Charif, Mary Ocoy, Prabin AT, Haroon Kareem, DesRon deShield-Burchall\n\n### Architecture\n```\nNginx:3002 \u2192 Express:3003 (proxy /api/time/*) \u2192 FastAPI:9010 (.241) \u2192 Halo PSA API\n```\n\n### Backend Proxy\nAdded to `backend/src/app.ts`: forwards all `/api/time/*` requests to `http://192.168.65.241:9010` with 120s timeout.\n\n### Frontend Components\nAdded to `frontend/src/App.tsx`:\n- `TimeTrackerPage` \u2014 Main page with period switcher + KPI cards\n- `AgentCard` \u2014 Expandable per-person card with details\n- `ProgressBar` \u2014 Color-coded progress indicator",
      "todo": "# Nexus TODO\n\n## Completed (v3.0.0)\n- [x] Merge Support/MSP hubs into unified sidebar\n- [x] Complete frontend rewrite (10 pages, 782 lines)\n- [x] Intelligence layer (Insight, LearningEntry, DailyReport models \u2014 24 total)\n- [x] 15+ unified API endpoints (all return 200)\n- [x] Forms engine (3 templates: Onboarding 49 fields, Monthly 15 fields, QBR 17 fields)\n- [x] Settings page with integration management\n- [x] Aegis 60s sync engine (systemd service, PRTG 556 devices, 48 alerts)\n- [x] Insights page with dedup + recurrence tracking (17 initial insights)\n- [x] Dashboard KPIs + alert feed + insights widget\n- [x] Audit log page\n- [x] Aegis intelligence analyzer (Phase 6B \u2014 4 analysis categories)\n- [x] Cortex daily strategic review script (Phase 6C)\n- [x] Learning memory engine (Phase 6E \u2014 patterns, baselines, effectiveness)\n- [x] Analyzer integrated into sync engine (runs every 5th cycle)\n- [x] UFW rule for .241 \u2192 .245:3003 cross-server access\n\n## Blocked (CEO Action Required)\n- [ ] Cloudflare tunnel: nexus.rize.bm (need dashboard entry)\n- [ ] SharePoint: Azure AD App Registration\n- [ ] Action1: Admin API permissions (403 on endpoints)\n- [ ] Halo PSA: Client endpoint 403 (check OAuth scopes)\n- [ ] Gitea push: Need credentials configured\n\n## Next Up\n- [ ] Playwright E2E tests\n- [ ] PDF export for completed forms\n- [ ] Ticket trend chart (30 day opened vs closed)\n- [ ] Device health heatmap by client\n- [ ] Contract renewal calendar\n- [ ] Drag-and-drop form template editor\n- [ ] Real-time WebSocket updates (replace polling)\n- [ ] Redis caching layer for sync data",
      "changelog": "# Nexus Changelog\n\n## v3.0.0 (2026-02-12)\n\n### Major Rewrite\n- Complete frontend rewrite from dual-hub (Support/MSP toggle) to unified MSP hub\n- 10 pages: Dashboard, Clients, Devices, Tickets, Monitoring, Patches, Forms, Insights, Audit Log, Settings\n- Dark theme (Slate #0F172A) with Nexus purple (#7C3AED) accent\n- React + TypeScript + TanStack React Query (60s auto-refetch)\n\n### Backend\n- 24 Prisma models (added Insight, LearningEntry, DailyReport)\n- 15+ API endpoints for unified data access\n- Intelligence routes: insights CRUD, learning CRUD, daily reports\n- Backend bound to 0.0.0.0 for cross-server access\n\n### Intelligence Layer (Phase 6)\n- Aegis Analyzer: 4 analysis categories (device_health, patch_compliance, ticket_intelligence, data_quality)\n- Cortex Daily Review: Executive summary aggregation, submitted to /api/reports/daily\n- Learning Engine: Pattern extraction, baseline tracking, effectiveness measurement\n- Analyzer integrated into sync engine (every 5th cycle = 5 min)\n- 17 initial insights generated, 3 learning entries\n\n### Sync Engine\n- Aegis 60s sync on .241 (systemd aegis-sync.service)\n- PRTG: 556 devices, 48 alerts synced\n- Halo: 3 companies synced (mock mode pending OAuth scope fix)\n- Action1: Auth OK, endpoints 403 (admin perms needed)\n\n### Forms Engine\n- 3 form templates: Client Onboarding (49 fields), Monthly Review (15 fields), QBR (17 fields)\n- Dynamic JSON schema renderer supporting 10 field types\n- Auto-save with debounce\n\n### Infrastructure\n- UFW rule: .241 \u2192 .245:3003 for cross-server sync\n- Crons: Cortex daily review 7 AM AST, Aegis sync continuous\n- VERSION: 3.0.0",
      "todos_parsed": [
        {
          "text": "Merge Support/MSP hubs into unified sidebar",
          "done": true
        },
        {
          "text": "Complete frontend rewrite (10 pages, 782 lines)",
          "done": true
        },
        {
          "text": "Intelligence layer (Insight, LearningEntry, DailyReport models \u2014 24 total)",
          "done": true
        },
        {
          "text": "15+ unified API endpoints (all return 200)",
          "done": true
        },
        {
          "text": "Forms engine (3 templates: Onboarding 49 fields, Monthly 15 fields, QBR 17 fields)",
          "done": true
        },
        {
          "text": "Settings page with integration management",
          "done": true
        },
        {
          "text": "Aegis 60s sync engine (systemd service, PRTG 556 devices, 48 alerts)",
          "done": true
        },
        {
          "text": "Insights page with dedup + recurrence tracking (17 initial insights)",
          "done": true
        },
        {
          "text": "Dashboard KPIs + alert feed + insights widget",
          "done": true
        },
        {
          "text": "Audit log page",
          "done": true
        },
        {
          "text": "Aegis intelligence analyzer (Phase 6B \u2014 4 analysis categories)",
          "done": true
        },
        {
          "text": "Cortex daily strategic review script (Phase 6C)",
          "done": true
        },
        {
          "text": "Learning memory engine (Phase 6E \u2014 patterns, baselines, effectiveness)",
          "done": true
        },
        {
          "text": "Analyzer integrated into sync engine (runs every 5th cycle)",
          "done": true
        },
        {
          "text": "UFW rule for .241 \u2192 .245:3003 cross-server access",
          "done": true
        },
        {
          "text": "Cloudflare tunnel: nexus.rize.bm (need dashboard entry)",
          "done": false
        },
        {
          "text": "SharePoint: Azure AD App Registration",
          "done": false
        },
        {
          "text": "Action1: Admin API permissions (403 on endpoints)",
          "done": false
        },
        {
          "text": "Halo PSA: Client endpoint 403 (check OAuth scopes)",
          "done": false
        },
        {
          "text": "Gitea push: Need credentials configured",
          "done": false
        }
      ],
      "todos_open": 5,
      "todos_done": 15,
      "version": "3.0.0",
      "git": {
        "status": "clean",
        "branch": "master",
        "last_commit": "89f58c6 fix: systemd service for backend, CLAUDE.md update, .env port fix (6 hours ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3002,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 3003,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEPLOYMENT.md",
        "HANDOFF.md",
        "HANDOVER.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RELAY.md",
        "STATUS.md",
        "TODO.md",
        "backend/package-lock.json",
        "backend/package.json",
        "backend/tsconfig.json",
        "checks/relay_check.py",
        "checks/security_check.py",
        "checks/service_check.py",
        "checks/system_check.py",
        "docs/AI_INTEGRATION.md",
        "docs/BACKUP.md",
        "docs/CLOUDFLARE_ACCESS.md",
        "docs/FILE_MAP.md",
        "docs/HALO_API.md",
        "docs/HANDOVER.md",
        "docs/SETUP.md",
        "docs/TODO.md",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.ts",
        "package-lock.json",
        "package.json",
        "tsconfig.json"
      ],
      "health_score": 100
    },
    {
      "name": "Dockyard WiFi",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/dockyard-wifi-portal",
      "domain": "dockyardwifi.rize.bm",
      "ports": [
        8080,
        8081
      ],
      "scanned_at": "2026-02-13T03:37:57.723735+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: DEPLOYMENT.md"
        },
        {
          "severity": "info",
          "message": "8 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": "# Dockyard WiFi Captive Portal\n\n## Project Overview\n\nA self-hosted captive portal system for the Royal Naval Dockyard in Bermuda. This system provides WiFi access to tourists and visitors through an ad-supported model with premium upgrade options.\n\n**Owner:** Rize Technologies Ltd  \n**Location:** Royal Naval Dockyard, Bermuda  \n**Launch Target:** February 28, 2026\n\n### Business Model\n\n1. **Free Tier (Ad-Supported):** Users watch a 30-second video ad to receive 1 hour of WiFi access. Limited to 1 hour free per day (resets at 12:01 AM).\n\n2. **Premium Passes:** Users can skip ads and get extended access:\n   - 6 hours: $4\n   - 24 hours: $7\n   - 72 hours: $12\n\n3. **Sponsorship Revenue:** Main sponsor banner on splash page (\"WiFi Brought to you by [Sponsor]\") plus video ad slots sold to local businesses.\n\n### Key Design Principles\n\n- **Self-Hosted:** No monthly SaaS fees, full data ownership\n- **PIPA Compliant:** Bermuda Personal Information Protection Act - explicit consent, opt-out options\n- **Mobile-First:** All user-facing pages optimized for smartphones\n- **Revenue-Focused:** Multiple monetization streams (ads, passes, sponsorships)\n- **Simple Stack:** Plain HTML/CSS/JavaScript, no complex frameworks\n\n---\n\n## Architecture\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Cloudflare Tunnels                           \u2502\n\u2502         dockyardwifi.rize.bm    dockyard-admin.rize.bm         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Ubuntu 24.04 VM (192.168.65.252)                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502   Backend   \u2502  \u2502    Admin    \u2502  \u2502 Postgres \u2502  \u2502  Redis   \u2502  \u2502\n\u2502  \u2502  Port 3000  \u2502  \u2502  Port 3001  \u2502  \u2502  Port    \u2502  \u2502  Port    \u2502  \u2502\n\u2502  \u2502  (Express)  \u2502  \u2502  (Express)  \u2502  \u2502  5432    \u2502  \u2502  6379    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                      Docker Compose                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Infrastructure\n\n- **Host Server:** Dell PowerEdge R720 running Windows Server 2022 with Hyper-V\n- **VM:** Ubuntu 24.04 LTS (4 vCPU, 8GB RAM, 100GB SSD)\n- **Containerization:** Docker Compose\n- **External Access:** Cloudflare Tunnels (zero-trust, no open ports)\n- **DNS:** Cloudflare (rize.bm domain)\n\n---\n\n## Tech Stack\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| Backend API | Node.js 20 + Express.js | User-facing API, session management |\n| Admin API | Node.js 20 + Express.js | Admin dashboard API |\n| Database | PostgreSQL 16 | Persistent data storage |\n| Cache | Redis 7 | Session caching (future) |\n| Frontend | Plain HTML/CSS/JavaScript | No build tools, simple deployment |\n| Email | Microsoft 365 SMTP | Reminder emails |\n| Tunnels | Cloudflare | Secure external access |\n\n---\n\n## Features\n\n### Completed \u2705\n\n#### User-Facing (Splash Page)\n- [x] Email capture with PIPA-compliant consent checkboxes\n- [x] Terms of Service and Privacy Policy links\n- [x] Video ad player with 30-second minimum watch time\n- [x] Skip button appears after 30 seconds for longer videos\n- [x] Session status display with countdown timer\n- [x] Warning state when session expires in <10 minutes\n- [x] Premium pass selection (6hr, 24hr, 72hr)\n- [x] Main sponsor banner (\"WiFi Brought to you by...\")\n- [x] \"Visit [Advertiser]\" button during video playback\n- [x] Mobile-responsive design with glassmorphism effects\n\n#### Session Management\n- [x] MAC address-based device tracking\n- [x] 1-hour free limit enforcement (no unlimited free via multiple ads)\n- [x] Session extension via additional ad views (disabled after 1hr limit)\n- [x] Session expiration and automatic cleanup\n- [x] Email reminders before session expiry (10min, 30min, 1hr, 2hr based on pass type)\n\n#### Admin Dashboard\n- [x] Real-time statistics (active sessions, views, completion rate, revenue)\n- [x] 9 tabs: Ad Rotation, Video Library, Sponsors, Sessions, Subscribers, Events, Pricing, Audit Log, Analytics, Settings\n- [x] Ad slot management (10 slots, assign videos, enable/disable)\n- [x] Video library with upload, edit, archive, restore\n- [x] Sponsor management with banner preview\n- [x] Active session view with terminate capability\n- [x] Subscriber export (CSV)\n- [x] Comprehensive audit logging\n- [x] Voucher generation and management\n- [x] Voucher stats (total, active, redeemed, fully used)\n- [x] CSV export of voucher codes\n\n#### Analytics & Tracking (Industry Standard)\n- [x] Impression tracking (page views)\n- [x] Click tracking (sponsor/ad clicks)\n- [x] Click-through rate (CTR) calculation\n- [x] Video quartile tracking (25%, 50%, 75%, 100%)\n- [x] Watch time tracking\n- [x] Unique viewer counts\n- [x] Device type detection (mobile/desktop)\n- [x] Daily/weekly/monthly breakdowns\n- [x] Per-sponsor and per-video metrics\n\n#### Email System\n- [x] Microsoft 365 SMTP integration\n- [x] Session expiry reminders\n- [x] Marketing opt-in tracking\n- [x] PIPA-compliant unsubscribe\n\n### Pending \ud83d\udd32\n\n- [ ] Payment processing (Authorize.net integration)\n- [ ] Network integration (RADIUS authentication)\n- [ ] DHCP integration (MAC address capture)\n- [ ] DNS hijack (redirect to captive portal)\n- [ ] Bandwidth limiting per session type\n- [ ] Social login (Facebook, Google)\n- [x] Voucher/coupon codes (v1.2.0)\n- [ ] Multi-language support\n\n---\n\n## Database Schema\n\n### Core Tables\n```sql\n-- User sessions (WiFi access)\nsessions (\n    id UUID PRIMARY KEY,\n    mac_address VARCHAR(50),\n    ip_address VARCHAR(50),\n    email VARCHAR(255),\n    device_type VARCHAR(50),\n    user_agent TEXT,\n    session_type VARCHAR(50),      -- 'free_ad', 'paid_6hr', 'paid_24hr', 'paid_72hr'\n    free_seconds_used INTEGER,     -- Track 1-hour free limit\n    started_at TIMESTAMP,\n    expires_at TIMESTAMP,\n    marketing_opt_in BOOLEAN,\n    reminder_sent_at TIMESTAMP,\n    created_at TIMESTAMP\n)\n\n-- Email subscribers (marketing list)\nemail_subscribers (\n    id UUID PRIMARY KEY,\n    email VARCHAR(255) UNIQUE,\n    marketing_opt_in BOOLEAN,\n    consent_timestamp TIMESTAMP,\n    source VARCHAR(100),\n    created_at TIMESTAMP\n)\n\n-- Ad video library\nad_videos (\n    id UUID PRIMARY KEY,\n    title VARCHAR(255),\n    filename VARCHAR(255),\n    video_path VARCHAR(500),\n    advertiser_name VARCHAR(255),\n    advertiser_url VARCHAR(500),\n    duration_seconds INTEGER,\n    total_views INTEGER,\n    total_completions INTEGER,\n    total_clicks INTEGER,\n    is_archived BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Ad rotation slots (10 slots)\nad_slots (\n    slot_number INTEGER PRIMARY KEY,  -- 1-10\n    video_id UUID REFERENCES ad_videos(id),\n    is_active BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Sponsor library\nsponsors (\n    id UUID PRIMARY KEY,\n    name VARCHAR(255),\n    logo_url VARCHAR(500),\n    website_url VARCHAR(500),\n    banner_url VARCHAR(500),\n    notes TEXT,\n    is_active BOOLEAN,\n    is_archived BOOLEAN,\n    total_impressions INTEGER,\n    total_clicks INTEGER,\n    created_at TIMESTAMP\n)\n\n-- Main sponsor slot\nsponsor_slot (\n    id INTEGER PRIMARY KEY,        -- Always 1\n    sponsor_id UUID REFERENCES sponsors(id),\n    is_active BOOLEAN,\n    updated_at TIMESTAMP\n)\n\n-- Ad impressions/events tracking\nad_impressions (\n    id UUID PRIMARY KEY,\n    ad_type VARCHAR(50),           -- 'main_sponsor', 'video_ad'\n    ad_id VARCHAR(100),\n    ad_name VARCHAR(255),\n    session_id UUID,\n    mac_address VARCHAR(50),\n    ip_address VARCHAR(50),\n    user_agent TEXT,\n    device_type VARCHAR(50),\n    event_type VARCHAR(50),        -- 'impression', 'click', 'view_start', 'view_25', 'view_50', 'view_75', 'view_complete'\n    view_duration_seconds INTEGER,\n    video_duration_seconds INTEGER,\n    created_at TIMESTAMP\n)\n\n-- Video ad events (legacy, still used)\nvideo_ad_events (\n    id UUID PRIMARY KEY,\n    session_id UUID,\n    ad_slot_id INTEGER,\n    event_type VARCHAR(50),\n    watch_duration_seconds INTEGER,\n    video_duration_seconds INTEGER,\n    completed BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Pricing configuration\npricing_config (\n    id SERIAL PRIMARY KEY,\n    pass_type VARCHAR(50),\n    duration_hours INTEGER,\n    price_cents INTEGER,\n    is_active BOOLEAN,\n    display_order INTEGER\n)\n\n-- Payment transactions (future)\ntransactions (\n    id UUID PRIMARY KEY,\n    session_id UUID,\n    pass_type VARCHAR(50),\n    amount_cents INTEGER,\n    currency VARCHAR(10),\n    payment_method VARCHAR(50),\n    payment_status VARCHAR(50),\n    created_at TIMESTAMP\n)\n\n-- Audit log\naudit_log (\n    id UUID PRIMARY KEY,\n    user_email VARCHAR(255),\n    action VARCHAR(100),\n    entity_type VARCHAR(100),\n    entity_id VARCHAR(255),\n    old_values JSONB,\n    new_values JSONB,\n    ip_address VARCHAR(50),\n    created_at TIMESTAMP\n)\n```\n\n---\n\n## API Endpoints\n\n### Backend (Port 3000) - User-Facing\n\n| Method | Endpoint | Purpose |\n|--------|----------|---------|\n| POST | `/api/v1/sessions` | Create new session (on page load) |\n| GET | `/api/v1/sessions/check/:mac` | Check if device has active session |\n| POST | `/api/v1/sessions/:id/email` | Save email and consent |\n| POST | `/api/v1/sessions/:id/video-event` | Track video watch events |\n| GET | `/api/v1/next-video` | Get next video from rotation |\n| GET | `/api/v1/sponsor` | Get current main sponsor |\n| POST | `/api/v1/track` | Track ad impressions/clicks |\n| GET | `/api/v1/ad-stats/:type/:id` | Get ad performance stats |\n\n### Admin (Port 3001) - Dashboard\n\n| Method | Endpoint | Purpose |\n|--------|----------|---------|\n| GET | `/api/admin/stats` | Dashboard statistics |\n| GET | `/api/admin/ads` | Get ad rotation slots |\n| PUT | `/api/admin/ads/:slot` | Update ad slot |\n| GET | `/api/admin/ad-videos` | Get video library |\n| POST | `/api/admin/ad-videos` | Add video metadata |\n| PUT | `/api/admin/ad-videos/:id` | Update video |\n| POST | `/api/admin/ad-videos/:id/archive` | Archive video |\n| POST | `/api/admin/ad-videos/:id/restore` | Restore video |\n| POST | `/api/admin/upload-video` | Upload video file |\n| GET | `/api/admin/sponsors` | Get all sponsors |\n| POST | `/api/admin/sponsors` | Add sponsor |\n| PUT | `/api/admin/sponsors/:id` | Update sponsor |\n| PUT | `/api/admin/sponsors/:id/archive` | Archive sponsor |\n| PUT | `/api/admin/sponsors/:id/restore` | Restore sponsor |\n| GET | `/api/admin/sponsors/main` | Get main sponsor |\n| PUT | `/api/admin/sponsors/main/:id` | Set main sponsor |\n| GET | `/api/admin/sessions` | Get all sessions |\n| GET | `/api/admin/sessions/active` | Get active sessions |\n| POST | `/api/admin/sessions/:id/terminate` | Terminate session |\n| GET | `/api/admin/subscribers` | Get subscribers |\n| GET | `/api/admin/subscribers/export` | Export CSV |\n| GET | `/api/admin/events` | Get video events |\n| GET | `/api/admin/pricing` | Get pricing config |\n| GET | `/api/admin/audit-logs` | Get audit logs |\n| GET | `/api/admin/analytics/summary` | Analytics overview |\n| GET | `/api/admin/analytics/sponsor` | Sponsor analytics |\n| GET | `/api/admin/analytics/videos` | Video analytics |\n| GET | `/api/admin/analytics/events` | Recent events |\n| POST | `/api/admin/reset-stats` | Reset all statistics |\n\n---\n\n## File Structure\n```\ndockyard-wifi-portal/\n\u251c\u2500\u2500 docker-compose.yml          # Container orchestration\n\u251c\u2500\u2500 README.md                   # This file\n\u251c\u2500\u2500 CLAUDE_INSTRUCTIONS.md      # AI assistant guidelines\n\u2502\n\u251c\u2500\u2500 backend/                    # User-facing service\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 index.js               # Express server, all API routes\n\u2502   \u2514\u2500\u2500 public/\n\u2502       \u251c\u2500\u2500 index.html         # Splash page (main portal)\n\u2502       \u251c\u2500\u2500 pages/\n\u2502       \u2502   \u251c\u2500\u2500 terms.html     # Terms of Service\n\u2502       \u2502   \u2514\u2500\u2500 privacy.html   # Privacy Policy\n\u2502       \u2514\u2500\u2500 ads/               # Video files\n\u2502           \u2514\u2500\u2500 videos/        # Uploaded ad videos\n\u2502\n\u251c\u2500\u2500 admin/                      # Admin dashboard service\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 server.js              # Express server, admin API routes\n\u2502   \u2514\u2500\u2500 public/\n\u2502       \u2514\u2500\u2500 index.html         # Admin dashboard SPA\n\u2502\n\u2514\u2500\u2500 database/\n    \u2514\u2500\u2500 schema.sql             # Database schema\n```\n\n---\n\n## Session Flow\n\n### New User Flow\n```\n1. User connects to WiFi \u2192 Router redirects to portal\n2. GET / \u2192 Splash page loads\n3. POST /api/v1/sessions \u2192 Create session, get session ID\n4. GET /api/v1/sponsor \u2192 Load main sponsor banner (track impression)\n5. User enters email, checks consent boxes\n6. POST /api/v1/sessions/:id/email \u2192 Save email\n7. GET /api/v1/next-video \u2192 Get video to play\n8. User watches video (track: view_start, view_25, view_50, view_75)\n9. After 30 seconds \u2192 POST /api/v1/sessions/:id/video-event (complete)\n10. Session authorized for 1 hour\n11. Success screen shown\n12. User redirected to internet\n```\n\n### Returning User Flow\n```\n1. User connects to WiFi \u2192 Router redirects to portal\n2. GET / \u2192 Splash page loads\n3. POST /api/v1/sessions \u2192 Create/get session\n4. GET /api/v1/sessions/check/:mac \u2192 Check existing session\n5. If authorized \u2192 Show session status with countdown\n6. If expired \u2192 Show email form (or premium options if 1hr limit reached)\n```\n\n### 1-Hour Free Limit Logic\n```javascript\n// In video-event handler:\nif (session.free_seconds_used >= 3600) {\n    return { limit_reached: true, message: \"Free limit reached\" };\n}\n\n// Grant time (max 1 hour total)\nconst remaining = 3600 - session.free_seconds_used;\nconst grant = Math.min(3600, remaining); // Grant up to 1 hour, but not exceeding limit\nsession.free_seconds_used += grant;\nsession.expires_at = NOW() + grant seconds;\n```\n\n---\n\n## Email Reminder System\n\nThe backend runs a background job every 60 seconds checking for sessions that need reminders:\n```javascript\n// Reminder timing by session type:\n- free_ad:    10 minutes before expiry\n- paid_6hr:   30 minutes before expiry\n- paid_24hr:  60 minutes before expiry\n- paid_72hr:  120 minutes before expiry\n```\n\nEmail includes:\n- Time remaining\n- Link to buy premium pass\n- Unsubscribe link\n\n---\n\n## Analytics Metrics Explained\n\n### For Sponsors/Advertisers\n\n| Metric | Definition | Industry Standard |\n|--------|------------|-------------------|\n| Impressions | Number of times ad was displayed | Yes |\n| Clicks | Number of times ad was clicked | Yes |\n| CTR | Clicks \u00f7 Impressions \u00d7 100 | Yes |\n| Unique Viewers | Distinct devices that saw ad | Yes |\n\n### For Video Ads\n\n| Metric | Definition | Industry Standard |\n|--------|------------|-------------------|\n| View Start | Video started playing | Yes (MRC) |\n| View 25% | Watched 25% of video | Yes (MRC) |\n| View 50% | Watched 50% of video | Yes (MRC) |\n| View 75% | Watched 75% of video | Yes (MRC) |\n| View Complete | Watched 100% of video | Yes (MRC) |\n| Completion Rate | Completes \u00f7 Starts \u00d7 100 | Yes |\n| Avg Watch Time | Average seconds watched | Yes |\n\n*MRC = Media Rating Council standard for video ad measurement*\n\n---\n\n## Security Considerations\n\n### Implemented\n\n- [x] Cloudflare Tunnel (no exposed ports)\n- [x] Admin dashboard behind Cloudflare Access (SSO)\n- [x] SQL parameterized queries (no SQL injection)\n- [x] CORS configured\n- [x] Helmet.js security headers\n- [x] Audit logging for admin actions\n\n### Recommended (Future)\n\n- [ ] Rate limiting on API endpoints\n- [ ] CAPTCHA for form submissions\n- [ ] MAC address validation/sanitization\n- [ ] Session token encryption\n- [ ] Database connection pooling limits\n\n---\n\n## Deployment\n\n### Start Services\n```bash\ncd ~/dockyard-wifi-portal\ndocker-compose up -d\n```\n\n### Restart After Code Changes\n```bash\ndocker-compose restart backend admin\n```\n\n### View Logs\n```bash\ndocker-compose logs --tail 50 backend\ndocker-compose logs --tail 50 admin\n```\n\n### Database Access\n```bash\ndocker exec -it dockyard-postgres psql -U wifi_app -d dockyard_wifi",
      "todo": "# Dockyard WiFi Portal - TODO List\n\n**Last Updated:** February 4, 2026\n\n---\n\n## \u2705 COMPLETED\n\n### Security\n- [x] Secrets moved to .env file (not in git)\n- [x] CORS restricted to specific origins\n- [x] CSP headers enabled (with scriptSrcAttr for inline handlers)\n- [x] Admin CSP media-src & CORS fix (v1.3.6) - admin video playback works\n- [x] Admin port locked to localhost only (127.0.0.1:3001)\n- [x] Server-side ad completion validation (nonce + timing)\n- [x] Free limit tracking (max 1 hour per device per day)\n- [x] Tester email bypass for testing\n- [x] Rate limiting (general: 100/15min, strict: 10/min, video: 5/min)\n- [x] Error sanitization (generic messages to clients, details logged - both backend & admin)\n- [x] Admin JWT validation (Cloudflare Access token verification)\n- [x] Input validation (email, MAC, UUID, string sanitization)\n- [x] Comprehensive audit logging (all admin actions tracked)\n\n### Session Management\n- [x] Session check endpoint (/api/v1/sessions/check/:mac)\n- [x] Active session display with countdown timer\n- [x] Free seconds tracking (free_seconds_used column)\n- [x] Persistent device ID (localStorage fallback for spoofed MACs)\n- [x] 1-hour daily free limit enforcement (resets at midnight)\n- [x] \"Free WiFi Limit Reached\" screen when limit hit\n- [x] Connection counters (total, free, paid per user)\n\n### Email System\n- [x] SMTP via Microsoft 365 (dockyard@rize.bm)\n- [x] Session expiry reminder emails\n- [x] Welcome email on first connection (with marketing opt-in)\n- [x] Follow-up email template (7 days after last connection)\n- [x] Unsubscribe endpoint (/api/v1/unsubscribe)\n- [x] Test email endpoint (/api/v1/test-emails)\n\n### Analytics & Tracking\n- [x] Ad impressions table\n- [x] Click tracking with CTR calculation\n- [x] Video quartile tracking (25%, 50%, 75%, 100%)\n- [x] Sponsor performance metrics\n- [x] Admin Analytics tab\n\n### Admin Dashboard\n- [x] 9 tabs: Ad Rotation, Videos, Sponsors, Sessions, Subscribers, Events, Pricing, Audit, Analytics, Settings\n- [x] Video upload and slot assignment\n- [x] Active session termination\n- [x] Subscriber export (CSV)\n- [x] Audit logging\n\n### UX Improvements\n\n### Documentation (v1.5.0)\n- [x] User Guide (docs/USER_GUIDE.md)\n- [x] Admin Guide (docs/ADMIN_GUIDE.md)\n- [x] Sponsor Onboarding Guide (docs/SPONSOR_ONBOARDING_GUIDE.md)\n\n### Video Playback (v1.5.0)\n- [x] Cross-browser video playback fixes\n- [x] Proper MIME type headers\n- [x] Enhanced video player with autoplay handling\n- [x] Video error recovery\n\n### Cookie Tracking (v1.5.0)\n- [x] Client-side free hour tracking via cookies\n- [x] Backup tracking independent of server\n- [x] Browser back button handling (returns to portal, not Google)\n- [x] \"Start Browsing\" button closes success screen properly\n\n---\n\n## \ud83d\udd04 IN PROGRESS\n\n### Email Design\n- [ ] Angel: Design branded HTML templates for all 4 emails (test emails sent to apelaez@rize.bm)\n\n### OAuth Integration (Feb 28 Deadline)\n- [x] Add Google/Facebook sign-in BUTTONS to portal UI (v1.4.0)\n- [ ] Facebook OAuth credentials (BLOCKED: awaiting business verification ~2 days)\n- [x] Build /privacy page (v1.4.6 - PIPA compliant)\n- [x] Build /terms page (v1.4.6)\n- [x] Build /api/auth/facebook/delete endpoint (v1.4.6)\n- [ ] Create 1024x1024 app icon for Facebook\n\n### Completed Jan 30\n- [x] Google OAuth - credentials added, app published in production\n- [x] Halo ticket created for Prabin to update GCP branding\n\n---\n\n## \ud83d\udccb TODO - HIGH PRIORITY\n\n### Payment Integration\n- [x] Authorize.net account setup (v1.6.0)\n- [x] Payment form on splash page (v1.6.0 - /upgrade page)\n- [x] Backend payment processing endpoint (v1.6.0)\n- [x] Transaction recording in database (v1.6.0)\n- [x] Receipt email on purchase (v1.6.0 - pending email template)\n- [x] Session upgrade on successful payment (v1.6.0)\n\n### Network Integration\n- [ ] Ubiquiti controller integration\n- [ ] RADIUS authentication\n- [ ] DHCP integration for MAC address capture\n- [ ] DNS hijack for captive portal redirect\n- [ ] Bandwidth limiting per session type\n\n---\n\n## \ud83d\udccb TODO - MEDIUM PRIORITY\n\n### User Experience\n- [x] Social login (Facebook, Google) - v1.4.0\n- [ ] Multi-language support\n- [x] Voucher/coupon codes (v1.2.0)\n\n### Admin Enhancements\n- [ ] PDF report generation\n- [ ] Scheduled report emails\n- [ ] A/B testing for ad creatives\n- [ ] Bulk video upload\n\n---\n\n## \ud83d\udccb TODO - LOW PRIORITY / FUTURE\n\n- [x] Mobile responsiveness fixes - v1.4.4\n- [ ] Mobile app for admin\n- [ ] Real-time dashboard websockets\n- [ ] Multiple location support\n- [ ] White-label capability\n\n---\n\n## \ud83d\udc1b KNOWN ISSUES\n\n1. **MAC addresses unreliable** - Browsers can't read real MAC; using localStorage device ID\n2. **Follow-up email timing** - Runs hourly; first emails won't send until 7 days after connections\n\n---\n\n## \ud83d\udcc5 DEADLINES\n\n- **Project Launch:** February 28, 2026\n- **Payment Integration:** Target mid-February\n- **Network Integration:** Requires coordination with dockyard IT\n\n---\n\n## Related Documentation\n\n| Document | Purpose |\n|----------|---------|\n| [README.md](README.md) | Technical overview and setup |\n| [DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md](DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md) | Complete project documentation for stakeholders |\n| [TODO.md](TODO.md) | Task tracking - completed and pending |\n| [HANDOFF_PROMPT.md](HANDOFF_PROMPT.md) | Session continuity for developers |\n| [CLAUDE_INSTRUCTIONS.md](CLAUDE_INSTRUCTIONS.md) | AI assistant guidelines |\n\n**Important:** Read all documentation files before making changes to understand the full project context.\n\n---\n\n## \ud83d\udd04 FRESHSALES CRM INTEGRATION\n\n### Completed \u2705\n- [x] FreshSales API connection working\n- [x] Auto-sync contacts on marketing opt-in\n- [x] Set subscription_status (1=subscribed, 2=unsubscribed)\n- [x] Add `dockyard-wifi` tag to all synced contacts\n- [x] Add lead source via cf_wifi_source field (\"Dockyard WiFi Portal\")\n- [x] Sync existing email_subscribers (batch sync completed Jan 27, 2026)\n- [x] Update contact on unsubscribe (syncs to FreshSales automatically)\n\n### Quick Wins (Ready to Implement)\n(All completed - see above)\n\n### Needs Angel/Admin Setup in FreshSales\n- [ ] Create \"Dockyard WiFi Portal\" lead source\n- [ ] Create custom fields: cf_first_wifi_visit, cf_last_wifi_visit, cf_wifi_pass_type\n- [ ] Create \"Dockyard WiFi 2026\" campaign (optional)\n- [ ] Decide: Portal sends emails vs FreshSales sends emails\n\n### Advanced (Future)\n- [ ] Log WiFi sessions as Sales Activities\n- [ ] Create Deals on pass purchases\n- [ ] Webhook: FreshSales \u2192 Portal for unsubscribes\n- [ ] Lifecycle stages (New \u2192 Engaged \u2192 Customer \u2192 Churned)\n\n### Files\n- `/backend/freshsalesService.js` - API wrapper\n- `/backend/index.js` - Auto-sync on opt-in (line ~250)\n\n### API Reference\n```\nDomain: rizetechnologies.myfreshworks.com\nAuth Header: Authorization: Token token=OT1axCqJZ33LA1FpVPSfpA\n```\n\n---\n\n## \ud83c\udd95 FROM FEB 2 MEETING (Libby/Sarah/Michael/Polina/Gilbert)\n\n### Captive Portal - Advertising Features\n- [ ] Video ad slots: 6x 30-second spots at $1,000 each (splash page)\n- [ ] Splash page sponsor banner for Main Sponsor ($20K package \u2014 details TBD)\n- [ ] Ad impression/performance analytics visible to advertisers\n- [ ] Backend portal already has video upload + analytics \u2014 verify sponsor reporting meets advertiser needs\n\n### Captive Portal - Email Automation (4 emails)\n- [x] Email 1: Auto sign-up welcome response (v1.5.0)\n- [x] Email 2: Session expiring reminder (v1.5.0)\n- [ ] Email 3: TBD \u2014 define purpose (follow-up offer? return visit promo?)\n- [ ] Email 4: TBD \u2014 define purpose (feedback survey? loyalty program?)\n- [ ] Email sponsorship pricing: define cost for sponsor placement in emails\n\n### B2B Pricing & Payment Plans\n- [ ] 1-year plan: less 5% Early Bird Discount\n- [ ] 6-month plan: pay during peak season (April-September)\n- [ ] 12-month plan: monthly payments + 5% admin fee\n- [ ] Build B2B payment/invoicing workflow (separate from B2C guest passes)\n- [ ] B2B sales PDF asset (Libby/Tuo creating)\n- [ ] B2B landing page (Libby/Tuo creating)\n\n### B2C Pricing (DECISION NEEDED)\n- [ ] Define WiFi hour pass price\n- [ ] Define 1-day pass price\n- [ ] Define 2-day pass price\n- [ ] Current pricing in admin: 6hr/$4, 24hr/$7, 72hr/$12 \u2014 confirm or update\n\n### Physical Signage & Assets (Libby/Tuo)\n- [x] QR codes for WiFi access - v1.5.0 (added to Admin Settings)\n- [ ] Digital screen content for existing Dockyard screens\n- [ ] Wall decal designs\n- [ ] Interrupter/lollipop signs\n- [ ] Ferry railing banners\n- [ ] TV screen and billboard locations (Libby sent internal doc Feb 2)\n\n### Hardware Deployment (End of February)\n- [ ] Raspberry Pi deployment for new digital screens\n- [ ] Deploy screens in customs area\n- [ ] Additional access points (Abraham/Ubiquiti \u2014 waiting)\n- [ ] Outdoor area coverage (goal: end of February)\n- [ ] Mall indoor coverage (goal: ready by February)\n\n### Network / QoS\n- [ ] Subscriber priority over guests in high-density areas\n- [ ] Bandwidth management per session type\n\n### Marketing & Promotion\n- [ ] Cruise ship staff engagement strategy (promote WiFi without conflicting with cruise lines)\n- [ ] Wayfinding signage for cruise ship passengers\n- [ ] Leverage existing customs screens for WiFi advertising\n- [ ] Email list monetization strategy (large volume expected from tourist captures)\n\n### Stakeholders\n- Libby Cook-Toppan (Tuo Collective) \u2014 Marketing/advertising lead\n- Sarah Manders (Rize) \u2014 Sales/signage coordination\n- Michael Branco (Celeste) \u2014 Network deployment\n- Polina Branco (Celeste) \u2014 Meeting coordination\n- Angel Pelaez (Rize) \u2014 Email template design",
      "changelog": "## [1.8.0] - 2026-02-04\n\n### Added\n- **Payment Gateway Admin Panel**\n  - Multi-gateway support: Authorize.net (primary) + Stripe (backup)\n  - Credential management from admin dashboard (stored in DB, not .env)\n  - Test Connection button to verify credentials without processing charges\n  - Automatic failover after 3 consecutive gateway failures\n  - Gateway event log with success/failure/failover tracking\n\n- **QR Code System**\n  - QR code generation service for signage\n  - Printable poster (8.5x11) with branding and instructions\n  - Printable sticker sheet (9 per page for cutting)\n  - Downloadable PNG (1024px) and SVG formats\n  - QR API routes: /api/qr/image, /api/qr/poster, /api/qr/stickers\n\n- **Social Login Prep**\n  - Added Stripe env vars to docker-compose.yml\n  - Added Instagram OAuth env vars\n  - Social login buttons ready (pending Meta verification)\n\n### Technical\n- New tables: payment_gateways, payment_gateway_log\n- New services: gatewayManager.js, qrGenerator.js\n- New routes: gatewayRoutes.js, qrRoutes.js\n- Payment config now reads from DB via GatewayManager\n\n## [1.7.0] - 2026-02-04\n\n### Added\n- **Admin Settings Page**\n  - 54 configurable settings across 10 categories\n  - Categories: General, Free Tier, Payments, Video Ads, Email, Vouchers, Social Login, Branding, Sponsors, Network\n  - Collapsible category sections with toggle switches for booleans\n  - Bulk save functionality with change tracking\n  - Settings stored in new `settings` database table\n\n- **Settings API Routes**\n  - GET /api/admin/settings - Fetch all settings grouped by category\n  - GET /api/admin/settings/:key - Get single setting\n  - PUT /api/admin/settings/:key - Update single setting\n  - POST /api/admin/settings/bulk - Bulk update multiple settings\n\n### Fixed\n- **Docker Environment Variables**\n  - Fixed Authorize.net credentials not being passed to backend container\n  - Added AUTHORIZE_NET_API_LOGIN_ID, TRANSACTION_KEY, PUBLIC_CLIENT_KEY, ENV to docker-compose.yml\n  - Payment config endpoint now properly reflects configured state\n\n### Technical\n- New migration: backend/migrations/add_settings_table.sql\n- New route file: backend/routes/settingsRoutes.js\n- Settings JS functions added to admin dashboard\n- Audit logging for settings changes\n\n## [1.6.0] - 2026-02-04\n\n### Added\n- **Authorize.net Payment Integration (P0)**\n  - Accept.js for PCI-compliant card tokenization\n  - Payment plans: 6hr/$4, 24hr/$7, 72hr/$12\n  - Full payment lifecycle: charge, refund, void\n  - Payment page at /upgrade with responsive design\n  - Auto-select plan from URL query parameter\n  - Device ID tracking for payment association\n\n- **Admin Payments Tab**\n  - Revenue overview dashboard (30-day stats)\n  - Plan breakdown visualization (6hr, 24hr, 72hr counts)\n  - Filterable payments table with pagination\n  - Refund and void actions from admin UI\n  - CSV export of payment data\n  - Payment audit logging\n\n- **Database Schema**\n  - payments table with full transaction details\n  - payment_audit_log for action tracking\n  - daily_revenue for aggregated stats\n  - Auto-update trigger for daily revenue\n\n- **Security**\n  - CSP updated for Authorize.net Accept.js\n  - Card data never touches server (tokenization)\n  - Payment audit trail\n\n### Technical\n- Added authorizenet npm package\n- Created services/paymentConfig.js\n- Created services/paymentService.js\n- Created routes/paymentRoutes.js\n- Payment routes wired into Express app\n- Admin server payment endpoints added\n\n---\n\n## [1.5.0] - 2026-02-04\n\n### Added\n- **Video Playback Improvements (P1)**\n  - Added proper MIME type headers for MP4 videos\n  - Enhanced video element with better cross-browser attributes (playsinline, preload, muted autoplay)\n  - Added video error handling and recovery\n  - Added Accept-Ranges header for seeking support\n  - Fixed autoplay restrictions handling\n\n- **Cookie-based Free Hour Tracking (P1)**\n  - Added client-side free hour tracking via cookies\n  - Backup tracking independent of server-side validation\n  - Daily reset at midnight\n\n- **Email Templates (P1)**\n  - Added Purchase Confirmation email (Email 5)\n  - Added Feedback Survey email (Email 6)\n  - Updated test emails endpoint to include all 6 email types\n\n- **QR Code Generation (P1)**\n  - Added /api/v1/qrcode endpoint for PNG generation\n  - Added /api/v1/qrcode/download endpoint for print-ready downloads\n  - QR codes customizable by size (up to 2000px)\n  - QR code section added to Admin Settings page\n  - Branded colors (Dockyard blue #0077b6)\n\n- **Documentation Guides (P1)**\n  - Created docs/USER_GUIDE.md for public visitors\n  - Created docs/ADMIN_GUIDE.md for administrators\n  - Created docs/SPONSOR_ONBOARDING_GUIDE.md for advertisers\n\n### Verified\n- 30-second minimum video enforcement (server-side nonce + timing validation)\n- Video rotation logic (sequential slot cycling 1-10 with fallback)\n- Social login buttons (Google OAuth working, Facebook pending credentials)\n- Voucher system (already implemented in v1.2.0)\n\n### Technical\n- Added mime-types package for MIME detection\n- Added qrcode package for QR generation\n- Enhanced express.static configuration\n\n---\n\n## [1.4.7-docs] - 2026-02-03\n\n### Added\n- Updated TODO.md with all technical items from Feb 2 planning meeting\n- Added Phase 6 (Advertising & Monetization) to PROJECT_PLAN.md\n- B2B payment plans, B2C pricing decisions needed, physical signage, hardware deployment\n- Email automation sequence (4 emails), ad slot pricing, sponsor packages\n- Key stakeholder contacts added\n\n---\n\n## [1.4.6] - 2026-01-30\n\n### Added\n- **Facebook Data Deletion Endpoint** (Facebook App Review requirement)\n  - POST /api/auth/facebook/delete - Accepts signed_request from Facebook\n  - Parses and validates Facebook signed requests with HMAC-SHA256\n  - Deletes user data (email_subscribers, sessions) for Facebook ID\n  - Returns confirmation URL and code per Facebook spec\n  - GET /api/auth/facebook/deletion-status - User-facing status page\n  - Created data_deletion_requests table for audit trail\n\n### Changed\n- **Legal Pages Updated**: Updated effective dates to January 30, 2026\n  - /pages/privacy.html - PIPA-compliant privacy policy\n  - /pages/terms.html - Terms of Service with Bermuda jurisdiction\n\n---\n\n## [1.4.5] - 2026-01-30\n\n### Fixed\n- **OAuth Environment Variables**: Added OAuth config to docker-compose.yml\n  - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET passed to backend container\n  - GOOGLE_CALLBACK_URL with default value\n  - FACEBOOK_APP_ID, FACEBOOK_APP_SECRET passed to backend container\n  - FACEBOOK_CALLBACK_URL with default value\n  - Google \"Sign in with Google\" button now visible on portal\n  - Facebook button remains hidden until credentials configured\n  - Cleaned up .env file (removed duplicate entries)\n\n---\n\n## [1.4.4] - 2026-01-30\n\n### Fixed\n- **Mobile Responsiveness** (Task 5)\n  - Added @media query for screens under 480px\n  - Increased tap targets to minimum 44px\n  - Buttons now min-height 48px on mobile\n  - Prevented horizontal scroll with overflow-x: hidden\n  - Video player scales to 50vh on mobile\n  - Improved checkbox tap targets\n  - Optimized font sizes and padding for small screens\n\n---\n\n## [1.4.3] - 2026-01-30\n\n### Added\n- **Admin Pricing Controls** (Task 4)\n  - Editable pricing in Admin dashboard\n  - PUT /api/admin/pricing/:id endpoint\n  - Edit modal for each price tier\n  - Configure: duration hours, price cents, active status\n  - Changes apply immediately to portal\n\n---\n\n## [1.4.2] - 2026-01-30\n\n### Added\n- **Sponsor Image Upload** (Task 3)\n  - File upload input in Add Sponsor form\n  - Accepts JPG, PNG, GIF, WebP (max 5MB)\n  - Stores in /uploads/sponsors/\n  - Preview after upload\n  - Backend: upload-sponsor-image endpoint\n\n---\n\n## [1.4.0] - 2026-01-30\n\n### Added\n- **Google OAuth Login** (Task 1)\n  - \"Sign in with Google\" button on portal\n  - Backend: googleAuthService.js enhanced\n  - Grants 1 hour free WiFi on successful auth\n  - Auto-hides if not configured\n\n- **Facebook OAuth Login** (Task 2)\n  - \"Sign in with Facebook\" button on portal\n  - Backend: facebookAuthService.js created\n  - Passport-facebook integration\n  - Handles case where Facebook doesnt share email\n\n### Configuration Required\nAdd to .env:\n- GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET\n- FACEBOOK_APP_ID, FACEBOOK_APP_SECRET\n\n---\n\n### Fixed\n- **CSP Headers Update**: Enhanced media-src directive for video playback\n  - Updated backend and admin CSP to include specific domain\n  - Added https://dockyardwifi.rize.bm to media-src\n  - Added https://dockyard-admin.rize.bm to CORS whitelist\n  - Ensures video playback works across all components\n\n## [1.3.5] - 2026-01-29\n### Changed\n- **Footer Link**: Made Rize Technologies clickable\n  - Links to https://rize.bm\n  - Opens in new tab\n  - White underlined styling to indicate clickability\n\n## [1.3.4] - 2026-01-29\n### Removed\n- **Reset Stats Button**: Removed from admin Analytics/Settings page\n  - Prevents accidental data loss\n  - Stats data is preserved and protected\n\n## [1.3.3] - 2026-01-29\n### Removed\n- **Multi-language Support**: Removed Spanish and Portuguese language options\n  - Removed language switcher UI from portal\n  - Removed i18n JavaScript code\n  - Deleted es.json and pt.json locale files\n  - Portal now displays English only as intended for launch\n\n## [1.3.2] - 2026-01-29\n### Fixed\n- **Voucher Time Addition**: Vouchers now ADD time instead of RESETTING session\n  - User with 50min remaining + 1hr voucher = 1hr 50min (was: reset to 59min)\n  - Checks if session is still active and adds duration to existing expiry\n  - If session expired, starts fresh from current time\n  - Updated success message to show total expiry time\n\n## [1.3.1] - 2026-01-29\n### Fixed\n- **CSP Headers for Admin Videos**: Added media-src directive to admin backend CSP\n  - Videos now play correctly in Admin Video Library and Add Rotation preview\n  - Allows media from self, https:, blob:, and data: sources\n  - Resolves Loading media violates Content Security Policy browser console errors\n\n## [1.3.0] - 2026-01-29\n### Added\n- **Multi-language Support**: Portal now supports English, Spanish, Portuguese\n  - Language switcher in top-right corner of portal card\n  - Translation files in /locales/ (en.json, es.json, pt.json)\n  - localStorage-based language preference persistence\n  - All UI strings translated including errors, buttons, labels\n  - data-i18n attributes for dynamic translation updates\n- Google OAuth foundation prepared (awaiting credentials)\n\n## [1.2.0] - 2026-01-28\n### Added\n- **Voucher/Coupon System**: Staff can generate vouchers for free WiFi access\n  - Admin dashboard Vouchers tab for generating and managing vouchers\n  - Support for free_hour (60 min) and free_day (24 hr) voucher types\n  - Single-use or multi-use vouchers with configurable usage limits\n  - Voucher expiration dates\n  - CSV export of voucher codes\n  - Voucher stats tracking (total, active, redeemed, fully used)\n- **User Voucher Redemption**: Users can redeem voucher codes on the splash page\n  - New voucher input field on the main portal",
      "todos_parsed": [
        {
          "text": "Secrets moved to .env file (not in git)",
          "done": true
        },
        {
          "text": "CORS restricted to specific origins",
          "done": true
        },
        {
          "text": "CSP headers enabled (with scriptSrcAttr for inline handlers)",
          "done": true
        },
        {
          "text": "Admin CSP media-src & CORS fix (v1.3.6) - admin video playback works",
          "done": true
        },
        {
          "text": "Admin port locked to localhost only (127.0.0.1:3001)",
          "done": true
        },
        {
          "text": "Server-side ad completion validation (nonce + timing)",
          "done": true
        },
        {
          "text": "Free limit tracking (max 1 hour per device per day)",
          "done": true
        },
        {
          "text": "Tester email bypass for testing",
          "done": true
        },
        {
          "text": "Rate limiting (general: 100/15min, strict: 10/min, video: 5/min)",
          "done": true
        },
        {
          "text": "Error sanitization (generic messages to clients, details logged - both backend & admin)",
          "done": true
        },
        {
          "text": "Admin JWT validation (Cloudflare Access token verification)",
          "done": true
        },
        {
          "text": "Input validation (email, MAC, UUID, string sanitization)",
          "done": true
        },
        {
          "text": "Comprehensive audit logging (all admin actions tracked)",
          "done": true
        },
        {
          "text": "Session check endpoint (/api/v1/sessions/check/:mac)",
          "done": true
        },
        {
          "text": "Active session display with countdown timer",
          "done": true
        },
        {
          "text": "Free seconds tracking (free_seconds_used column)",
          "done": true
        },
        {
          "text": "Persistent device ID (localStorage fallback for spoofed MACs)",
          "done": true
        },
        {
          "text": "1-hour daily free limit enforcement (resets at midnight)",
          "done": true
        },
        {
          "text": "\"Free WiFi Limit Reached\" screen when limit hit",
          "done": true
        },
        {
          "text": "Connection counters (total, free, paid per user)",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.8.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "17db722 fix: add missing initGatewayPanel JS function for admin Gateways tab (33 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "dmin/public/index.html"
          },
          {
            "status": "M",
            "file": "backend/public/index-new.html"
          },
          {
            "status": "M",
            "file": "backend/public/index.html"
          },
          {
            "status": "M",
            "file": "backend/public/pages/privacy.html"
          },
          {
            "status": "M",
            "file": "backend/public/pages/terms.html"
          },
          {
            "status": "M",
            "file": "backend/public/payment.html"
          },
          {
            "status": "??",
            "file": "admin/public/img/"
          },
          {
            "status": "??",
            "file": "backend/public/img/"
          }
        ],
        "uncommitted_count": 8
      },
      "ports_status": [
        {
          "port": 8080,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 8081,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "CHANGELOG.md",
        "CLAUDE.md",
        "CLAUDE_INSTRUCTIONS.md",
        "DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md",
        "HANDOFF.md",
        "HANDOFF_PROMPT.md",
        "OAUTH-REQUIREMENTS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RELAY.md",
        "TODO.md",
        "admin/package-lock.json",
        "admin/package.json",
        "admin/server.js",
        "admin/voucherService.js",
        "backend/emailService.js",
        "backend/facebookAuthService.js",
        "backend/freshsalesService.js",
        "backend/googleAuthService.js",
        "backend/index.js",
        "backend/package-lock.json",
        "backend/package.json",
        "backend/voucherService.js",
        "docs/ADMIN_GUIDE.md",
        "docs/PAYMENT_INTEGRATION.md",
        "docs/SPONSOR_ONBOARDING_GUIDE.md",
        "docs/USER_GUIDE.md",
        "node_modules/.package-lock.json",
        "package-lock.json",
        "package.json"
      ],
      "health_score": 88
    },
    {
      "name": "David Bishop",
      "server": "agents",
      "type": "agent",
      "path": "/home/david",
      "domain": "davidbot.rize.bm",
      "ports": [
        9001
      ],
      "scanned_at": "2026-02-13T03:37:57.888112+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: SPEC.md, SECURITY.md, INTEGRATIONS.md, RUNBOOK.md, ESCALATION.md, AUDIT-LOG.md"
        },
        {
          "severity": "critical",
          "message": "Port 9001 not responding"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": "# David Bishop \u2014 Sales & BD Assistant\n\n**Version:** v2026.2.4  \n**Server:** 192.168.65.241 (david@)  \n**Gateway:** OpenClaw v2026.1.29, port 18789  \n**Status:** \u2705 Active\n\n## Channels\n| Channel | Identifier | Status |\n|---------|-----------|--------|\n| MS Teams | Bot ID [DAVID_APP_ID_REDACTED] | \u2705 Active (port 3978) |\n| Telegram | @Morpheus_99_bot | \u2705 Active |\n| Email (inbound) | dbishop@rize.bm (polled every 5 min) | \u2705 Active |\n| Email (outbound) | dbishop@rize.bm via send-email.py | \u2705 Active |\n\n## Quickstart\n```bash\n# Check status\nssh david@192.168.65.241 \"systemctl --user status openclaw-gateway\"\n\n# View recent logs\nssh david@192.168.65.241 \"journalctl --user -u openclaw-gateway --since '1 hour ago' --no-pager | tail -30\"\n\n# Emergency stop\nssh david@192.168.65.241 \"bash ~/scripts/kill-switch.sh\"\n\n# Notify Artie manually\nssh david@192.168.65.241 \"bash ~/scripts/notify-artie.sh 'Subject' 'Message'\"\n```\n\n## Security\n- **Tier 1 (Admin):** Artie/Gilbert \u2014 full access\n- **Tier 2 (Trusted):** @rize.bm, @celeste.bm, @tuocollective.com \u2014 business only, sanitized\n- **Tier 3 (External):** Blocked\n- See INPUT-SECURITY.md for full rules\n\n## Cron Jobs\n| Schedule | Script | Purpose |\n|----------|--------|---------|\n| */5 | poll-email-inbound.py | Check dbishop inbox for new emails |\n| */5 | sync-output-logs.sh | Sync session logs to audit JSONL |\n| 0 3 | nightly-security-scan.sh | Security audit |\n| 0 11 | daily-digest (via cron) | Email summary to Artie |\n| 0 */6 | health-check (via cron) | System health verification |\n\n## Key Files\n| File | Purpose |\n|------|---------|\n| ~/.openclaw/openclaw.json | Main config |\n| ~/.openclaw/workspace/IDENTITY.md | Role + contact resolution |\n| ~/.openclaw/workspace/SECURITY.md | Authority hierarchy |\n| ~/.openclaw/workspace/INPUT-SECURITY.md | Inbound message rules |\n| ~/.openclaw/workspace/DATA-RESTRICTIONS.md | Output exclusion zones |\n| ~/scripts/notify-artie.sh | Multi-channel owner notification |\n| ~/scripts/content-filter.py | Output content scanning |\n| ~/scripts/kill-switch.sh | Emergency gateway stop |\n| ~/scripts/graph-api-helper.py | Rate-limited Graph API client |\n| ~/logs/outputs/openclaw-output.jsonl | Audit trail |",
      "todo": "# David Bishop \u2014 TODO\n\n## \u2705 Completed (Feb 4, 2026)\n\n### Contact Resolution\n- [x] Artie/Gilbert mapped with explicit IDs (Telegram 837188550, Teams gadarrell@rize.bm, email)\n- [x] notify-artie.sh \u2014 multi-channel fallback (Telegram + personal email + work email)\n- [x] IDENTITY.md updated with full contact resolution table\n\n### Security Architecture\n- [x] INPUT-SECURITY.md \u2014 Tier 1 (Admin), Tier 2 (Trusted), Tier 3 (External)\n- [x] Input sanitization rules (prompt injection, code injection, data exfiltration)\n- [x] Content filter (content-filter.py) \u2014 output scanning\n- [x] Kill switch (kill-switch.sh) ready\n\n### Email\n- [x] Email inbound polling (poll-email-inbound.py, every 5 min)\n- [x] Email rate limit handling (graph-api-helper.py with exponential backoff)\n- [x] Email send via send-email.py (positional args: from to subject body)\n\n### Monitoring & Logging\n- [x] Output JSONL audit trail (sync-output-logs.sh \u2192 ~/logs/outputs/openclaw-output.jsonl)\n- [x] Nightly security scan (3 AM)\n- [x] Daily digest email (11 AM)\n- [x] Health check (every 6h)\n- [x] Escalation failure log (~/logs/escalation-failures.log)\n- [x] Graph API rate limit log (~/logs/graph-rate-limits.log)\n\n### Deployment\n- [x] Teams app published org-wide (v1.0.1) via Teams Admin Center\n- [x] Deep link: https://teams.microsoft.com/l/chat/0/0?users=28:[DAVID_APP_ID_REDACTED]\n- [x] dmPolicy: open with allowFrom wildcards\n- [x] Fake --raw-stream flags removed from service file\n\n### Removed\n- [x] Red team script moved to Homebase (scripts disabled, logs preserved)\n- [x] Teams message tracker removed (Graph API doesn't support app-only auth for /chats)\n\n## \u2b1c Pending\n\n### Credential Rotation (moved to Homebase)\n- [ ] Rotate Telegram bot token via @BotFather\n- [ ] Rotate Teams appPassword in Azure AD\n- [ ] Update openclaw.json with new creds\n\n### Enhancements\n- [ ] Refine content-filter.py keyword list (1855 false positives on \"token\")\n- [ ] Add session log analyzer to nightly scan\n- [ ] Wire graph-api-helper.py into read-email.py as replacement\n- [ ] Dockyard WiFi proposal templates (docxtpl)\n\n## EMAIL ROUTING CHANGES (From Homebase Feedback 2026-02-05)\n\n### Current Problem:\n- David sending non-David items\n- Mixed email sources\n\n### New Routing:\n- David regular work updates \u2192 dbishop@rize.bm\n- David security flags \u2192 Sentinel \u2192 aidev@rize.bm \u2192 Artie\n- David should NOT send Talos job alerts\n\n### Scripts to Update:\n- ~/scripts/homebase-heartbeat.sh\n- ~/scripts/daily-report.sh\n- ~/scripts/verbose-report.sh\n- ~/scripts/send-email.py (check FROM address logic)\n- Any script that sends to artiedarrell@gmail.com\n\n### Alert Workflow:\n- Security issues: POST to Sentinel /api/agents/david-bishop/flag\n- Sentinel evaluates and sends to CEO if warranted\n- Regular updates: send directly via dbishop@rize.bm",
      "changelog": "# David Bishop \u2014 Changelog\n\n\n## v2026.2.4 \u2014 Security Architecture & Monitoring Overhaul\n\n### Added\n- INPUT-SECURITY.md \u2014 3-tier inbound message security (Admin/Trusted/External)\n- notify-artie.sh \u2014 Multi-channel notification (Telegram + 2x email)\n- graph-api-helper.py \u2014 Rate-limited Graph API client with exponential backoff\n- poll-email-inbound.py \u2014 Email inbound polling with tier classification (cron */5)\n- sync-output-logs.sh \u2014 Session-to-output JSONL sync for audit trail (cron */5)\n- Escalation failure logging (~/logs/escalation-failures.log)\n- Graph API rate limit logging (~/logs/graph-rate-limits.log)\n- Teams app manifest v1.0.1 published org-wide\n\n### Changed\n- IDENTITY.md \u2014 Added explicit contact resolution (Artie=Gilbert, all channel IDs)\n- IDENTITY.md \u2014 Added email search best practices and rate limit guidance\n- IDENTITY.md \u2014 Added inbound message handling workflow\n- SECURITY.md \u2014 Added tier cross-references and inbound rules\n- redteam-david.sh \u2014 Fixed integer expression error, UFW detection, email args\n- Gateway service file \u2014 Removed fake --raw-stream flags, cleaned ExecStart\n- send-email.py calls \u2014 Standardized to positional args (from to subject body)\n\n### Removed\n- Red team security testing (moved to Homebase agent)\n- Teams message tracker (Graph /chats API incompatible with app-only auth)\n- Broken --raw-stream / OPENCLAW_RAW_STREAM config\n\n### Fixed\n- Contact resolution: \"Artie\" now maps to chatId 837188550 (was unresolvable)\n- All 3 notification channels working (Telegram, personal email, work email)\n- UFW firewall detection in cron context (reads /etc/ufw/ufw.conf, no sudo)\n- Email rate limiting (was hitting 429s on rapid searches)\n- Service file corruption from sed cleanup (ExecStart repaired)",
      "todos_parsed": [
        {
          "text": "Artie/Gilbert mapped with explicit IDs (Telegram 837188550, Teams gadarrell@rize.bm, email)",
          "done": true
        },
        {
          "text": "notify-artie.sh \u2014 multi-channel fallback (Telegram + personal email + work email)",
          "done": true
        },
        {
          "text": "IDENTITY.md updated with full contact resolution table",
          "done": true
        },
        {
          "text": "INPUT-SECURITY.md \u2014 Tier 1 (Admin), Tier 2 (Trusted), Tier 3 (External)",
          "done": true
        },
        {
          "text": "Input sanitization rules (prompt injection, code injection, data exfiltration)",
          "done": true
        },
        {
          "text": "Content filter (content-filter.py) \u2014 output scanning",
          "done": true
        },
        {
          "text": "Kill switch (kill-switch.sh) ready",
          "done": true
        },
        {
          "text": "Email inbound polling (poll-email-inbound.py, every 5 min)",
          "done": true
        },
        {
          "text": "Email rate limit handling (graph-api-helper.py with exponential backoff)",
          "done": true
        },
        {
          "text": "Email send via send-email.py (positional args: from to subject body)",
          "done": true
        },
        {
          "text": "Output JSONL audit trail (sync-output-logs.sh \u2192 ~/logs/outputs/openclaw-output.jsonl)",
          "done": true
        },
        {
          "text": "Nightly security scan (3 AM)",
          "done": true
        },
        {
          "text": "Daily digest email (11 AM)",
          "done": true
        },
        {
          "text": "Health check (every 6h)",
          "done": true
        },
        {
          "text": "Escalation failure log (~/logs/escalation-failures.log)",
          "done": true
        },
        {
          "text": "Graph API rate limit log (~/logs/graph-rate-limits.log)",
          "done": true
        },
        {
          "text": "Teams app published org-wide (v1.0.1) via Teams Admin Center",
          "done": true
        },
        {
          "text": "Deep link: https://teams.microsoft.com/l/chat/0/0?users=28:[DAVID_APP_ID_REDACTED]",
          "done": true
        },
        {
          "text": "dmPolicy: open with allowFrom wildcards",
          "done": true
        },
        {
          "text": "Fake --raw-stream flags removed from service file",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "2026.2.4",
      "git": {
        "status": "clean",
        "branch": "unknown",
        "last_commit": "unknown",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 9001,
          "open": false,
          "http_code": 0,
          "healthy": false
        }
      ],
      "files": [],
      "health_score": 65
    },
    {
      "name": "Apex",
      "server": "agents",
      "type": "agent",
      "path": "/home/agents/apex",
      "domain": null,
      "ports": [
        9002
      ],
      "scanned_at": "2026-02-13T03:38:15.155495+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "20 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Apex Finance Agent\n\n**Phase 1: Mock Observer \u2014 COMPLETE**\n\nApex is a read-only finance intelligence agent for Rize Technology Group. It monitors Xero (accounting) and Halo PSA (timesheets) to produce financial reports, detect revenue leakage, and classify billing models.\n\n## Quick Start\n\n```bash\n# Service is managed by systemd\nsudo systemctl status apex.service\n\n# View logs\ntail -f ~/apex/logs/apex.log\n\n# Test health\ncurl http://localhost:9002/health\n```\n\n## API Endpoints\n\n### Health & Status\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /health | GET | Health check with uptime |\n| /status | GET | Full status with integrations |\n\n### Reports\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /api/reports/latest | GET | Most recent report of any type |\n| /api/reports/daily | GET | Daily P&L digest with unbilled hours |\n| /api/reports/weekly | GET | Weekly revenue/margin analysis |\n\n### Analysis\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /api/analysis/leakage | GET | Revenue leakage detection (5 types) |\n| /api/analysis/billing-models | GET | Client billing classifications |\n| /api/analysis/unbilled | GET | Unbilled hours by client |\n\n### Messaging\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /api/teams/message | POST | Handle Teams messages via Homebase |\n\n## Revenue Leakage Detection\n\nApex detects 5 types of revenue leakage:\n\n1. **UNBILLED_HOURS** \u2014 Time logged in Halo but not invoiced in Xero\n2. **AYCE_OVERUSE** \u2014 AYCE clients using more hours than their fee supports\n3. **PRICING_DEVIATION** \u2014 Invoices with rates different from contract\n4. **STALE_TIMESHEET** \u2014 Timesheet entries older than 30 days without invoice\n5. **MISSING_TIMESHEET** \u2014 Invoice exists but no backing timesheet (audit risk)\n\n## Billing Models\n\nApex classifies clients into:\n- **AYCE** \u2014 All-You-Can-Eat flat monthly fee\n- **AYCE+Hourly** \u2014 Flat fee plus project/hourly billing\n- **Hourly** \u2014 All time billed at hourly rate\n\n## Scheduled Tasks\n\n| Task | Schedule | Description |\n|------|----------|-------------|\n| Daily Digest | 07:00 UTC | P&L snapshot, unbilled hours, alerts |\n| Weekly Report | Mon 07:00 UTC | Revenue trends, margin analysis |\n| Leakage Scan | Every 6 hours | Detect new revenue leakage |\n\n## Mock Data\n\nGenerate mock data for testing:\n```bash\npython3 ~/apex/scripts/generate_mock_data.py\n```\n\nCreates 12 clients, 6 months of P&L, 100+ timesheets, 60+ invoices.\n\n## Configuration\n\nKey environment variables in .env:\n- MOCK_MODE=true (Phase 1)\n- READ_ONLY_MODE=true (NEVER change to false)\n- ANTHROPIC_API_KEY \u2014 Primary LLM\n- OPENROUTER_API_KEY \u2014 Fallback LLM\n- HOMEBASE_URL \u2014 For Teams relay\n\n## Safety\n\n\u26a0\ufe0f **READ_ONLY_MODE=true** \u2014 Agent cannot modify any data\n\u26a0\ufe0f **MOCK_MODE=true** \u2014 Uses mock data, not live APIs\n\n## Directory Structure\n\n```\n~/apex/\n\u251c\u2500\u2500 main.py              # FastAPI application\n\u251c\u2500\u2500 analysis/\n\u2502   \u251c\u2500\u2500 revenue_leakage.py   # Leakage detection\n\u2502   \u251c\u2500\u2500 billing_classifier.py # Billing model classification\n\u2502   \u2514\u2500\u2500 anomaly_detector.py   # Anomaly detection\n\u251c\u2500\u2500 integrations/\n\u2502   \u251c\u2500\u2500 xero_client.py       # Xero API client\n\u2502   \u251c\u2500\u2500 halo_client.py       # Halo PSA client\n\u2502   \u2514\u2500\u2500 homebase_client.py   # Homebase relay\n\u251c\u2500\u2500 reporting/\n\u2502   \u251c\u2500\u2500 financial_summary.py # Report generators\n\u2502   \u251c\u2500\u2500 daily_digest.py      # Daily report\n\u2502   \u2514\u2500\u2500 weekly_report.py     # Weekly report\n\u251c\u2500\u2500 scripts/\n\u2502   \u2514\u2500\u2500 generate_mock_data.py # Mock data generator\n\u251c\u2500\u2500 db/\n\u2502   \u2514\u2500\u2500 mock_data.json       # Generated mock data\n\u251c\u2500\u2500 reports/               # Generated reports\n\u2514\u2500\u2500 logs/                  # Application logs\n```\n\n## Support\n\nContact: artiedarrell@gmail.com\n\n\n## Halo Time Report \u2014 Financial Lens (Added Feb 12, 2026)\n\n**Script:** `scripts/halo-time-report.py`\n\n### Purpose\nGenerates a workforce revenue impact section for the daily financial digest.\nAnalyzes Halo PSA timesheet data through a financial lens.\n\n### What it reports:\n- Revenue Summary (hours logged, chargeable, revenue captured vs at risk)\n- Week-over-Week Trend (logging up or down)\n- Agent Chargeable Performance (who is generating billable hours)\n- Client Billable Hours (per-client breakdown with dollar values)\n- Unbilled Time Exposure (revenue leakage risk per agent)\n- Compliance Scorecard (team-wide metrics)\n\n### Usage:\n```bash\npython3 scripts/halo-time-report.py           # Print report\npython3 scripts/halo-time-report.py --json    # JSON output\n```\n\n### Import for digest integration:\n```python\nfrom halo_time_report import get_report_section\nsection = get_report_section()\n```\n\n### Data Sources:\n- `/Timesheet` \u2014 Agent daily hours (actual, target, chargeable, unlogged)\n- `/Actions` \u2014 Individual time entries with ticket context\n- `/Tickets/{id}` \u2014 Client attribution per time entry\n- `/ChargeRate` \u2014 Billing rates ($50/hr, $100/hr)\n\n### Key Metrics:\n- Default rate: $100/hr\n- Revenue at risk = unlogged hours \u00d7 $100/hr\n- External vs internal (Rize Technologies) client separation\n\n\n## Apex Time Dashboard API (Added Feb 12, 2026)\n\n**Script:** `scripts/time-dashboard-api.py`\n**Port:** 9010\n**Service:** `systemctl --user status apex-time-dashboard`\n\n### Purpose\nProvides a real-time REST API for the \"Core 5\" staff time tracking dashboard in Nexus. Pulls data from Halo PSA `/Timesheet` and `/Actions` endpoints.\n\n### Core 5 Staff\n| ID | Name | Type |\n|----|------|------|\n| 3 | Ibrahim El Charif | Full-time |\n| 13 | Mary Ocoy | Full-time |\n| 16 | Prabin AT | Full-time |\n| 17 | Haroon Kareem | Full-time |\n| 32 | DesRon deShield-Burchall | Full-time |\n\n### Endpoints\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /health | GET | Health check |\n| /api/time/core5/daily | GET | Today's hours per Core 5 agent |\n| /api/time/core5/weekly | GET | This week's hours per Core 5 agent |\n| /api/time/core5/monthly | GET | This month's hours per Core 5 agent |\n| /api/time/core5/detail/{agent_id} | GET | Detailed time entries for one agent |\n| /api/time/core5/review/{agent_id} | POST | Toggle review status for an agent/date |\n| /api/time/core5/reviews | GET | All review marks |\n\n### Response Format\n```json\n{\n  \"period\": \"weekly\",\n  \"start\": \"2026-02-09\",\n  \"end\": \"2026-02-12\",\n  \"agents\": [\n    {\n      \"agent_id\": 3,\n      \"name\": \"Ibrahim El Charif\",\n      \"hours_logged\": 18.1,\n      \"hours_target\": 24.0,\n      \"hours_chargeable\": 12.5,\n      \"utilization_pct\": 75.4,\n      \"charge_pct\": 52.1,\n      \"revenue_logged\": 937.5,\n      \"revenue_target\": 1800.0,\n      \"status\": \"ok\"\n    }\n  ]\n}\n```\n\n### Performance\n- Summary endpoints use `/Timesheet` only (2-3s first call, <0.2s cached)\n- Detail endpoint paginates `/Actions` (slower, ~10s for full history)\n- Cache TTL: 5 minutes\n- Default rate: $75/hr blended average\n\n### Review System\n- Reviews stored in `data/time-reviews.json`\n- Keyed by date and agent_id\n- Toggle: POST with `{\"date\": \"2026-02-12\"}` body\n\n## Finance Dashboard Integration (Feb 12, 2026)\nApex owns and feeds the finance dashboard at finance.rize.bm (.245:9020).\n\n**Data Flow:** Apex Time API (.241:9010) -> Express proxy (.245:9020) -> React frontend\n\n**Insights Engine:** Runs every 2 hours via cron, analyzing Core 5 time data for:\n- Compliance gaps (who's not logging)\n- Trends (low chargeable ratios)\n- Revenue opportunities (unlogged hours x rates)\n- Dashboard health (is the frontend up, is data fresh)\n- Improvement proposals (new features to build)\n\n**Files:**\n- scripts/time-dashboard-api.py \u2014 FastAPI serving time data + insights\n- scripts/insights-engine.py \u2014 Cron-based analysis engine\n- scripts/insights_router.py \u2014 FastAPI router for insights endpoints\n- data/insights/current.json \u2014 Latest insights\n- data/insights/YYYY-MM-DD.json \u2014 Daily archives",
      "todo": "# Apex Finance Agent \u2014 TODO\n\n## Phase 1: Mock Observer \u2014 COMPLETE \u2705\n\n- [x] FastAPI server on port 9002\n- [x] /health endpoint with memory + uptime\n- [x] Teams message handler via Homebase\n- [x] Heartbeat to Homebase every 5 minutes\n- [x] MOCK_MODE=true with hardcoded safety check\n- [x] READ_ONLY_MODE=true with hardcoded safety check\n- [x] Xero API client (mock responses)\n- [x] Halo PSA client (mock responses)\n- [x] Revenue leakage analyzer (5 detection types)\n- [x] Daily digest generator\n- [x] Weekly report generator\n- [x] /reports/latest endpoint\n- [x] /reports/daily endpoint\n- [x] /reports/weekly endpoint\n- [x] /analysis/leakage endpoint\n- [x] /analysis/billing-models endpoint\n- [x] /analysis/unbilled endpoint\n- [x] Switch LLM to Anthropic API (with OpenRouter fallback)\n- [x] Scheduled report generation (APScheduler)\n- [x] MS Teams webhook for report delivery\n- [x] Email report delivery (SMTP)\n- [x] Mock data generator with 12 Bermuda clients\n- [x] Billing model classifier\n\n---\n\n## Phase 2: Live Read-Only \u2014 IN PROGRESS \ud83d\udd04\n\n### Xero Integration\n- [ ] Complete Xero OAuth flow (exchange authorization code for tokens)\n- [ ] Store refresh token securely\n- [ ] Test token refresh cycle\n- [ ] Test live P&L reports\n- [ ] Test live invoice listing (all statuses)\n- [ ] Test live contact/client sync\n- [ ] Test bank transactions (for cash flow)\n\n### Halo PSA Integration\n- [ ] Verify client_secret in .env works\n- [ ] Test live timesheet entries\n- [ ] Test live ticket details\n- [ ] Test live client contracts\n- [ ] Test agent utilization data\n\n### Billing Analysis\n- [ ] Connect billing classifier to live data\n- [ ] Validate leakage detection vs Mary's manual reconciliation\n- [ ] Historical trend analysis with 6+ months data\n\n### Scheduled Reports\n- [ ] Enable daily digest at 07:00 UTC (3:00 AM ADT)\n- [ ] Enable weekly report Monday 07:00 UTC\n- [ ] Verify reports contain live data\n\n### Communication\n- [ ] Bot Framework reply flow for Teams responses\n\n### Validation\n- [ ] Confirm no false positives for 2 weeks\n- [ ] Document accuracy metrics in AUDIT-LOG.md\n\n---\n\n## Phase 3: Advisory Mode \u2014 PLANNED \ud83d\udccb\n\n- [ ] Recommend billing corrections\n- [ ] Flag unbilled hours for invoicing suggestions\n- [ ] Suggest AYCE repricing when consumption exceeds plan\n- [ ] Proactive alerts for revenue risks\n- [ ] AI-powered anomaly detection in timesheets\n- [ ] Contract renewal recommendations\n\n---\n\n## Phase 4: Supervised Execution \u2014 FUTURE \u23f3\n\n- [ ] Generate draft invoices for CEO review\n- [ ] Unbilled hours \u2192 invoice suggestions\n- [ ] Project milestone billing drafts\n- [ ] Test rollback capability\n\n---\n\n## Phase 5: Autonomous (Limited) \u2014 FUTURE \ud83d\udd2e\n\n- [ ] Automated recurring invoice generation\n- [ ] Payment reminder sequences\n- [ ] Standard billing corrections\n- [ ] Cash flow forecasting\n- [ ] Continuous Sentinel audit integration\n- [ ] Quarterly human review process\n\n## Halo Time Report (Feb 12, 2026)\n\n- [x] Deep dive into Halo time logging API model\n- [x] Build halo-time-report.py (financial lens)\n- [x] Revenue impact calculation (unlogged \u00d7 rate)\n- [x] Per-client billable hours breakdown\n- [x] Agent chargeable ratio tracking\n- [x] Week-over-week trend analysis\n- [x] Unbilled time exposure alerts\n- [ ] Integrate get_report_section() into financial-digest.py\n- [ ] Add cron schedule for standalone time report\n- [ ] Historical trend tracking (save weekly snapshots)\n\n## Time Dashboard API (Feb 12, 2026)\n\n- [x] Build time-dashboard-api.py (FastAPI on port 9010)\n- [x] GET /api/time/core5/daily \u2014 Today's hours per Core 5 agent\n- [x] GET /api/time/core5/weekly \u2014 This week's hours\n- [x] GET /api/time/core5/monthly \u2014 This month's hours\n- [x] GET /api/time/core5/detail/{agent_id} \u2014 Per-agent detail with entries\n- [x] POST /api/time/core5/review/{agent_id} \u2014 Toggle review status\n- [x] GET /api/time/core5/reviews \u2014 All review marks\n- [x] Systemd service (apex-time-dashboard.service)\n- [x] UFW rule for port 9010 from LAN\n- [x] Response caching (5 min TTL)\n- [x] Use /Timesheet for fast summary (not /Actions pagination)\n- [ ] Add authentication (API key or JWT)\n- [ ] Historical trend snapshots (save daily to DB)\n- [ ] Webhook alerts for zero-logging Core 5 members",
      "changelog": "# Apex Finance Agent \u2014 Changelog\n\n## [1.2.0] \u2014 2026-02-08 (Overnight Build)\n\n### Added\n- **Mock Data Generator** (scripts/generate_mock_data.py)\n  - 12 realistic Bermuda MSP clients with billing models\n  - 6 months of P&L data\n  - 100+ timesheet entries\n  - 60+ invoices with various statuses\n  - Automatic leakage detection on generated data\n  - Contract rate cards for all clients\n\n- **Enhanced Revenue Leakage Analyzer**\n  - 5 detection types: UNBILLED_HOURS, AYCE_OVERUSE, PRICING_DEVIATION, STALE_TIMESHEET, MISSING_TIMESHEET\n  - Risk scoring (0-100) with levels: MINIMAL, LOW, MEDIUM, HIGH, CRITICAL\n  - Per-finding recommendations\n  - Filter by type or client\n\n- **Billing Model Classifier** (analysis/billing_classifier.py)\n  - Classifies clients as AYCE, AYCE+Hourly, or Hourly\n  - Detects model drift (overuse, underutilization, AYCE candidates)\n  - Generates billing recommendations\n\n- **Scheduled Reports** (APScheduler)\n  - Daily digest at 07:00 UTC (3:00 AM ADT)\n  - Weekly report Monday 07:00 UTC\n  - Leakage scan every 6 hours\n  - Auto-save to reports/ directory\n\n- **Report Delivery**\n  - Teams webhook via Homebase relay\n  - SMTP email to CEO\n\n### Changed\n- LLM backend now tries Anthropic API first, falls back to OpenRouter\n- All API endpoints return structured JSON with timestamps\n- Improved error handling across all modules\n\n### Fixed\n- Main.py now properly imports from analysis/ and reporting/ modules\n- Revenue leakage analyzer uses mock_data.json when available\n\n## [1.1.0] \u2014 2026-02-06\n\n### Added\n- API endpoints: /reports/latest, /reports/daily, /reports/weekly\n- Analysis endpoints: /analysis/leakage, /analysis/billing-models, /analysis/unbilled\n- Anthropic API integration with fallback\n- Heartbeat to Homebase every 5 minutes\n- Teams message handler\n\n### Changed\n- Upgraded to FastAPI with async handlers\n- Improved logging to logs/apex.log\n\n## [1.0.0] \u2014 2026-02-05\n\n### Added\n- Initial release\n- FastAPI server on port 9002\n- Health and status endpoints\n- Mock Xero client\n- Mock Halo PSA client\n- READ_ONLY_MODE and MOCK_MODE safety checks\n\n## [2026-02-12] Financial Digest Bug Fixes\n\n### Fixed\n- **Bug 1**: Cash double-counting - Bank accounts now deduplicated by AccountID\n- **Bug 2**: Credit cards as cash - Credit cards separated as liabilities, net cash calculated\n- **Bug 3**: AR aging split - Actionable AR (<90 days) vs Legacy AR (90+ days) with 61-90 day bucket\n- **Bug 4**: Xero Payments 500 error - Fixed date format to DateTime(year,month,day) instead of ISO string\n- **Bug 5**: Xero Aged Receivables 400 error - Corrected to use only date= parameter\n- **Bug 6**: Added Halo workforce utilization section with Core 5 team tracking\n\n### Added\n- `scripts/halo_time_helper.py` - Workforce utilization calculator\n- `integrations/xero_client.py::get_aged_receivables()` - Aged receivables report function\n- Cash position now shows bank accounts and credit cards separately\n- AR aging split into actionable (0-60d, 61-90d) vs legacy (90+d)\n- Workforce utilization with working days MTD and per-agent hour tracking\n\n### Changed\n- `scripts/financial-digest.py` - All 6 bug fixes integrated\n- `integrations/xero_client.py` - Date format fixes for API calls\n\n### Technical Details\n- Bank accounts deduplicated by AccountID to prevent double-counting\n- Credit card balances subtracted from bank total for net cash position\n- AR aging buckets: current, 30_days, 60_days, 61_90, 90_plus\n- Xero API date filters use DateTime(y,m,d) not ISO strings\n- Halo Timesheet API returns LIST not dict\n- Core 5 team: Ibrahim, Prabin, Mary, Haroon, DesRon",
      "todos_parsed": [
        {
          "text": "FastAPI server on port 9002",
          "done": true
        },
        {
          "text": "/health endpoint with memory + uptime",
          "done": true
        },
        {
          "text": "Teams message handler via Homebase",
          "done": true
        },
        {
          "text": "Heartbeat to Homebase every 5 minutes",
          "done": true
        },
        {
          "text": "MOCK_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "READ_ONLY_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "Xero API client (mock responses)",
          "done": true
        },
        {
          "text": "Halo PSA client (mock responses)",
          "done": true
        },
        {
          "text": "Revenue leakage analyzer (5 detection types)",
          "done": true
        },
        {
          "text": "Daily digest generator",
          "done": true
        },
        {
          "text": "Weekly report generator",
          "done": true
        },
        {
          "text": "/reports/latest endpoint",
          "done": true
        },
        {
          "text": "/reports/daily endpoint",
          "done": true
        },
        {
          "text": "/reports/weekly endpoint",
          "done": true
        },
        {
          "text": "/analysis/leakage endpoint",
          "done": true
        },
        {
          "text": "/analysis/billing-models endpoint",
          "done": true
        },
        {
          "text": "/analysis/unbilled endpoint",
          "done": true
        },
        {
          "text": "Switch LLM to Anthropic API (with OpenRouter fallback)",
          "done": true
        },
        {
          "text": "Scheduled report generation (APScheduler)",
          "done": true
        },
        {
          "text": "MS Teams webhook for report delivery",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.2.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "a47fb35 feat: Finance API router \u2014 7 endpoints for dashboard Phase 3 (4 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "gitignore"
          },
          {
            "status": "M",
            "file": "CHANGELOG.md"
          },
          {
            "status": "M",
            "file": "CLAUDE.md"
          },
          {
            "status": "M",
            "file": "PROJECT_PLAN.md"
          },
          {
            "status": "M",
            "file": "README.md"
          },
          {
            "status": "M",
            "file": "SECURITY.md"
          },
          {
            "status": "M",
            "file": "SPEC.md"
          },
          {
            "status": "M",
            "file": "TODO.md"
          },
          {
            "status": "M",
            "file": "analysis/billing_classifier.py"
          },
          {
            "status": "M",
            "file": "analysis/revenue_leakage.py"
          }
        ],
        "uncommitted_count": 20
      },
      "ports_status": [
        {
          "port": 9002,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        "CHANGELOG.md",
        "RUNBOOK.md",
        "SECURITY.md",
        "TODO.md",
        "config/IDENTITY.md",
        "data/improvement-tracker.json",
        "data/xero-snapshot-2026-02-12.json",
        "reports/daily_20260208_054118.json",
        "reports/daily_20260208_110000.json",
        "reports/daily_20260208_132942.json",
        "reports/daily_20260208_133338.json",
        "reports/daily_20260209_110000.json",
        "reports/daily_20260210_110004.json",
        "reports/daily_20260211_110004.json",
        "reports/daily_20260212_110004.json",
        "reports/leakage_20260208_100000.json",
        "reports/leakage_20260208_160000.json",
        "reports/leakage_20260208_220000.json",
        "reports/leakage_20260209_040000.json",
        "reports/leakage_20260209_100000.json",
        "reports/leakage_20260209_160000.json",
        "reports/leakage_20260209_220000.json",
        "reports/leakage_20260210_040006.json",
        "reports/leakage_20260210_100005.json",
        "reports/leakage_20260210_160004.json",
        "reports/leakage_20260210_220005.json",
        "reports/leakage_20260211_040004.json",
        "reports/leakage_20260211_100004.json",
        "reports/leakage_20260211_160005.json",
        "reports/leakage_20260211_220005.json",
        "reports/leakage_20260212_040005.json",
        "reports/leakage_20260212_100005.json",
        "reports/leakage_20260212_160005.json",
        "reports/leakage_20260212_220010.json",
        "reports/weekly_20260208_054118.json",
        "reports/weekly_20260208_132942.json",
        "reports/weekly_20260208_133338.json",
        "reports/weekly_20260209_110000.json",
        "scripts/finance_router.py",
        "scripts/financial-digest-v2.py",
        "scripts/financial-digest.py",
        "scripts/generate_mock_data.py",
        "scripts/halo-time-report.py",
        "scripts/halo_time_helper.py",
        "scripts/insights-engine.py",
        "scripts/insights_router.py",
        "scripts/time-dashboard-api.py",
        "scripts/xero-authorize.py",
        "scripts/xero-refresh-token.py",
        "scripts/xero-sync.py"
      ],
      "health_score": 98
    },
    {
      "name": "Aegis",
      "server": "agents",
      "type": "agent",
      "path": "/home/agents/aegis",
      "domain": null,
      "ports": [
        9003
      ],
      "scanned_at": "2026-02-13T03:38:30.439599+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "20 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Aegis \u2014 Infrastructure Intelligence Agent\n\n**Version:** 1.2.0\n**Host:** agents@192.168.65.241\n**Port:** 9003\n**Status:** MOCK MODE (Phase 1 Complete)\n\n---\n\n## Overview\n\nAegis is Rize Technology Group's infrastructure intelligence agent. It reads data from PRTG (network monitoring), Action1 (patch management), and Halo PSA (ticketing) to identify alert patterns, compliance gaps, and operational risks.\n\n**Phase 1 (Current):** Read-only observer with mock data \u2014 **COMPLETE**\n**Phase 2 (Planned):** Live PRTG, Action1, Halo read access. Daily/weekly reports.\n**Phase 3 (Future):** Advisory mode \u2014 recommends ticket responses, suggests remediation.\n\n---\n\n## Architecture\n\n```\naegis/\n\u251c\u2500\u2500 main.py                  # FastAPI server \u2014 endpoints, heartbeat, Teams handler\n\u251c\u2500\u2500 .env                     # Configuration (MOCK_MODE=true, READ_ONLY_MODE=true)\n\u251c\u2500\u2500 config.py                # Config loader\n\u251c\u2500\u2500 integrations/\n\u2502   \u251c\u2500\u2500 prtg_client.py       # PRTG \u2014 sensors, alerts, devices, history\n\u2502   \u251c\u2500\u2500 action1_client.py    # Action1 \u2014 endpoints, patches, compliance\n\u2502   \u251c\u2500\u2500 halo_client.py       # Halo PSA \u2014 tickets, SLA breaches\n\u2502   \u2514\u2500\u2500 homebase_client.py   # Homebase relay integration\n\u251c\u2500\u2500 intelligence/\n\u2502   \u251c\u2500\u2500 alert_correlator.py  # PRTG alert \u2194 Halo ticket matching\n\u2502   \u251c\u2500\u2500 pattern_detector.py  # Recurring pattern detection\n\u2502   \u251c\u2500\u2500 asset_tracker.py     # SSL/domain/license tracking\n\u2502   \u2514\u2500\u2500 anomaly_detector.py  # Anomaly detection\n\u251c\u2500\u2500 reporting/\n\u2502   \u251c\u2500\u2500 infrastructure_report.py  # Daily briefing + weekly compliance\n\u2502   \u251c\u2500\u2500 daily_briefing.py    # Detailed daily report generator\n\u2502   \u2514\u2500\u2500 templates/           # Report templates\n\u251c\u2500\u2500 monitor/\n\u2502   \u251c\u2500\u2500 synthetic_monitor.py # HTTP endpoint checks (every 5 min)\n\u2502   \u251c\u2500\u2500 login_monitor.py     # Login flow tests (every 15 min)\n\u2502   \u251c\u2500\u2500 browser_monitor.py   # Playwright browser tests (daily 6 AM UTC)\n\u2502   \u251c\u2500\u2500 config.json          # Endpoint configuration\n\u2502   \u251c\u2500\u2500 results.json         # Synthetic check results\n\u2502   \u251c\u2500\u2500 browser_results.json # Browser check results\n\u2502   \u2514\u2500\u2500 screenshots/         # Browser screenshots\n\u251c\u2500\u2500 reports/                 # Generated reports storage\n\u251c\u2500\u2500 logs/                    # Log files\n\u2514\u2500\u2500 docs/\n    \u251c\u2500\u2500 README.md, CLAUDE.md, TODO.md, CHANGELOG.md, PROJECT_PLAN.md\n```\n\n## Endpoints\n\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /health | GET | Health check with memory/uptime |\n| /status | GET | Agent status + config (includes scheduler status) |\n| /api/teams/message | POST | Teams message handler |\n| /api/alerts/active | GET | Active PRTG alerts (mock data) |\n| /api/correlations | GET | Alert-to-ticket correlations |\n| /api/patterns | GET | Detected recurring patterns + recommendations |\n| /api/reports/daily | GET | Generate daily infrastructure briefing |\n| /api/reports/weekly | GET | Generate weekly compliance report |\n| /api/monitor/status | GET | Synthetic monitoring results |\n| /alerts/active | GET | (Legacy) Active PRTG alerts |\n| /correlations | GET | (Legacy) Alert-to-ticket correlations |\n| /patterns | GET | (Legacy) Detected patterns |\n| /reports/daily | GET | (Legacy) Daily briefing |\n| /reports/weekly | GET | (Legacy) Weekly compliance |\n| /infrastructure/summary | GET | Aggregated infrastructure health |\n| /compliance | GET | Patch compliance summary |\n| /assets | GET | Asset health (SSL, licenses, domains) |\n\n## LLM Integration\n\nAegis uses AI to respond to Teams messages:\n- **Primary:** Anthropic API (claude-sonnet-4-20250514)\n- **Fallback:** OpenRouter (anthropic/claude-opus-4)\n\n## Scheduled Tasks\n\n| Task | Schedule | Description |\n|------|----------|-------------|\n| Synthetic Monitor | Every 5 min | HTTP checks on all tunnel endpoints |\n| Login Monitor | Every 15 min | Login flow verification |\n| Browser Monitor | Daily 06:00 UTC | Playwright browser tests with screenshots |\n| Daily Briefing | 07:30 UTC | Infrastructure health report \u2192 Teams + email |\n| Weekly Compliance | Mon 08:00 UTC | Compliance report \u2192 Teams + email |\n| Heartbeat | Every 5 min | Status to Homebase with monitor summary |\n\n## Safety\n\n- **MOCK_MODE=true** \u2014 All integrations return mock data\n- **READ_ONLY_MODE=true** \u2014 Hardcoded startup check (agent refuses to start if false)\n- No write operations to PRTG, Action1, Halo, or any external API\n- Homebase monitors via heartbeat every 5 minutes\n- All API endpoints return mock/cached data only\n\n\n## Halo Time Report \u2014 Operational Lens (Added Feb 12, 2026)\n\n**Script:** `scripts/halo-time-report.py`\n\n### Purpose\nGenerates a workforce utilization and compliance section for the daily operations report.\nAnalyzes Halo PSA timesheet data through an operational/capacity lens.\n\n### What it reports:\n- Team Summary (utilization rate, chargeable hours, unlogged gap)\n- Per-Agent Utilization (actual vs target hours, status icons)\n- Today's Logging Status (who has logged today)\n- Compliance Violators (zero-loggers alert)\n- Overworked/Underworked Detection (>45h or <10h flags)\n- Ticket Load vs Hours Correlation (tickets per agent vs time logged)\n- Week-over-Week Trend\n- Compliance Scorecard with letter grade\n\n### Usage:\n```bash\npython3 scripts/halo-time-report.py           # Print report\npython3 scripts/halo-time-report.py --json    # JSON output\n```\n\n### Import for briefing integration:\n```python\nfrom halo_time_report import get_report_section\nsection = get_report_section()\n```\n\n### Data Sources:\n- `/Timesheet` \u2014 Agent daily hours\n- `/Agent` \u2014 Full staff list with IDs\n- `/Tickets` \u2014 Open ticket counts per agent\n\n### Thresholds:\n- Overworked: >45h/week\n- Underworked: <10h/week (full-timers)\n- Utilization grades: Green \u226575%, Yellow \u226550%, Orange \u226525%, Red >0%, Black = 0\n- Overall grade: A (\u226580% compliance + \u226575% util) through D (Critical)\n\n\n## Time Compliance Check (Added Feb 12, 2026)\n\n**Script:** `scripts/time-compliance-check.py`\n\n### Purpose\nGenerates real-time compliance alerts for the Core 5 staff based on Halo PSA timesheet data. Detects under-logging, zero-hour days, and pace warnings.\n\n### Alert Types\n| Type | Severity | Trigger |\n|------|----------|---------|\n| zero_hours | Critical | 0 hours logged today (after 4 PM AST) |\n| low_utilization | Warning | Below 50% of weekly target by Wednesday |\n| pace_warning | Warning | Projected weekly total below 75% of target |\n| zero_week | Critical | 0 hours for entire week so far |\n\n### Usage\n```bash\n# Text output\npython3 scripts/time-compliance-check.py\n\n# JSON import\nfrom time_compliance_check import get_compliance_alerts, get_alert_text\nalerts = get_compliance_alerts()  # Returns dict with alerts + summary\ntext = get_alert_text()           # Returns formatted text\n```\n\n### Output Example\n```\n\u26a0\ufe0f TIME COMPLIANCE ALERTS\n   Week: 2026-02-09 to 2026-02-12\n   Alerts: 2 (0 critical, 2 warnings)\n\n   \ud83d\udfe1 LOW UTIL: Mary Ocoy \u2014 10.6h logged (44% of 24h target)\n   \ud83d\udfe1 LOW UTIL: DesRon deShield-Burchall \u2014 8.5h logged (35% of 24h target)\n\n   \ud83d\udcca PACE SUMMARY\n   \ud83d\udfe2 Ibrahim El Charif         |  18.1h (75%) | Projected: 22.6h/40h\n   \ud83d\udd34 Mary Ocoy                 |  10.6h (44%) | Projected: 13.2h/40h\n   \ud83d\udfe1 Prabin AT                 |  12.0h (50%) | Projected: 15.0h/40h\n   \ud83d\udfe2 Haroon Kareem             |  19.1h (79%) | Projected: 23.8h/40h\n   \ud83d\udd34 DesRon deShield-Burchall  |   8.5h (35%) | Projected: 10.6h/40h\n```",
      "todo": "# Aegis Infrastructure Agent \u2014 TODO\n\n## Phase 1: Mock Observer \u2014 COMPLETE \u2705\n\n- [x] FastAPI server on port 9003\n- [x] /health endpoint with memory + uptime\n- [x] Teams message handler via Homebase\n- [x] Heartbeat to Homebase every 5 minutes\n- [x] MOCK_MODE=true with hardcoded safety check\n- [x] READ_ONLY_MODE=true with hardcoded safety check\n- [x] PRTG API client (mock sensors, alerts, devices)\n- [x] Action1 API client (mock endpoints, patches, compliance)\n- [x] Halo PSA ticket client (mock tickets, SLA breaches)\n- [x] Alert correlator (PRTG alert \u2194 Halo ticket matching)\n- [x] Pattern detector (repeat offenders, flapping, concentration)\n- [x] Daily briefing generator\n- [x] Weekly compliance report generator\n- [x] /api/alerts/active endpoint\n- [x] /api/correlations endpoint\n- [x] /api/patterns endpoint\n- [x] /api/reports/daily and /api/reports/weekly endpoints\n- [x] /api/monitor/status endpoint (synthetic monitor results)\n- [x] Switch LLM to Anthropic API (with OpenRouter fallback)\n- [x] Scheduled report generation (APScheduler \u2014 daily 07:30 UTC, weekly Monday 08:00 UTC)\n- [x] MS Teams webhook for report delivery\n- [x] Heartbeat includes monitor summary (endpoints_healthy, endpoints_total)\n- [x] Synthetic monitor (HTTP checks every 5 minutes via cron)\n- [x] Login monitor (form POST tests every 15 minutes via cron)\n- [x] Browser monitor with Playwright (daily 06:00 UTC, screenshots, JS error detection)\n\n---\n\n## Phase 2: Live Read-Only \u2014 IN PROGRESS \ud83d\udd04\n\n### Integration Tasks\n- [ ] Connect to live PRTG (verify passhash works)\n- [ ] Connect to live Action1 (verify API key)\n- [ ] Connect to live Halo PSA (verify OAuth)\n\n### Asset Tracking\n- [ ] Build asset tracker (SSL certs, domains, licenses)\n- [ ] SSL certificate expiration monitoring\n- [ ] Domain registration expiration tracking\n- [ ] Software license renewal tracking\n\n### Scheduled Reports\n- [ ] Daily briefing at 07:00 UTC (3:00 AM ADT)\n- [ ] Weekly compliance report Monday 07:00 UTC\n\n### Communication\n- [ ] Bot Framework reply flow for Teams responses\n\n### Validation\n- [ ] Validate correlation accuracy vs Ibrahim's manual triage\n- [ ] Confirm no false positives for 2 weeks\n- [ ] Document accuracy metrics in AUDIT-LOG.md\n\n---\n\n## Phase 3: Advisory Mode \u2014 PLANNED \ud83d\udccb\n\n- [ ] Recommend ticket responses based on alert patterns\n- [ ] Suggest remediation steps for recurring issues\n- [ ] Proactive infrastructure risk alerts\n- [ ] Historical trend analysis and reporting\n- [ ] Anomaly detection for unusual patterns\n- [ ] Customer health scoring based on alert frequency\n\n---\n\n## Phase 4: Supervised Execution \u2014 FUTURE \u23f3\n\n- [ ] Acknowledge low-priority PRTG alerts (with approval)\n- [ ] Create Halo tickets from correlation data (with approval)\n- [ ] Schedule patch deployments (with approval)\n- [ ] Test rollback capability\n\n---\n\n## Phase 5: Autonomous (Limited) \u2014 FUTURE \ud83d\udd2e\n\n- [ ] Auto-acknowledge specific alert types\n- [ ] Auto-create tickets for known patterns\n- [ ] Auto-schedule routine patches\n- [ ] Continuous Sentinel audit integration\n- [ ] Quarterly human review process\n\n## Halo Time Report (Feb 12, 2026)\n\n- [x] Build halo-time-report.py (operational lens)\n- [x] Per-agent utilization tracking\n- [x] Time logging compliance alerts (zero-loggers)\n- [x] Ticket load vs hours correlation\n- [x] Overworked/underworked detection\n- [x] Week-over-week trend analysis\n- [x] Compliance scorecard with letter grade\n- [x] Ticket counts per agent (via /Agent + /Tickets mapping)\n- [ ] Integrate get_report_section() into morning-briefing.py\n- [ ] Add cron schedule for standalone time report\n- [ ] Daily compliance email to managers\n\n## Time Compliance Check (Feb 12, 2026)\n\n- [x] Build time-compliance-check.py (Core 5 alerts)\n- [x] Zero-hours detection (critical, after 4 PM)\n- [x] Low utilization alerts (warning, by Wednesday)\n- [x] Pace warning alerts (projected miss)\n- [x] Zero-week detection (critical)\n- [x] JSON and text output modes\n- [x] Importable functions for morning-briefing.py integration\n- [ ] Integrate into morning-briefing.py (auto-include compliance section)\n- [ ] Add cron: run at 4 PM AST (20:00 UTC) daily for zero-hour check\n- [ ] Email alerts to managers for critical violations\n- [ ] Escalation to Cortex for persistent non-compliance",
      "changelog": "# Changelog \u2014 Aegis Infrastructure Agent\n\n## v1.2.0 \u2014 2026-02-08\n### Overnight Build \u2014 Phase 1 Complete\n- **New API Endpoints:**\n  - GET /api/alerts/active \u2014 Returns active PRTG alerts (mock data)\n  - GET /api/correlations \u2014 Returns PRTG alert \u2194 Halo ticket correlations\n  - GET /api/patterns \u2014 Returns recurring alert patterns with recommendations\n  - GET /api/reports/daily \u2014 Returns latest daily infrastructure briefing\n  - GET /api/reports/weekly \u2014 Returns latest weekly compliance report\n  - GET /api/monitor/status \u2014 Returns synthetic monitoring results\n\n- **LLM Integration:**\n  - Primary: Anthropic API (claude-sonnet-4-20250514)\n  - Fallback: OpenRouter (anthropic/claude-opus-4)\n  - Added ANTHROPIC_MODEL to .env\n\n- **Scheduled Reports:**\n  - APScheduler integrated for automated report generation\n  - Daily briefing at 07:30 UTC (3:30 AM ADT)\n  - Weekly compliance report Monday 08:00 UTC (4:00 AM ADT)\n  - Reports sent via Teams webhook + email (SMTP)\n\n- **Monitor Integration:**\n  - Heartbeat now includes monitor_summary, endpoints_healthy, endpoints_total\n  - /api/monitor/status exposes synthetic check results\n\n- **Browser Monitor (Playwright):**\n  - monitor/browser_monitor.py \u2014 Headless Chrome browser testing\n  - Takes screenshots of each endpoint (saved to monitor/screenshots/)\n  - Detects JS console errors\n  - Verifies page content rendered (not just 200 OK)\n  - Runs daily at 06:00 UTC via cron\n  - Auto-cleans screenshots older than 7 days\n\n## v1.1.0 \u2014 2026-02-07\n### Integration Stubs + Intelligence\n- integrations/prtg_client.py \u2014 PRTG API client with mock data (sensors, alerts, devices, history)\n- integrations/action1_client.py \u2014 Action1 RMM client with mock data (endpoints, patches, compliance)\n- integrations/halo_client.py \u2014 Halo PSA ticket client with mock data (tickets, SLA breaches)\n- intelligence/alert_correlator.py \u2014 PRTG alert \u2194 Halo ticket matching with confidence scoring\n- intelligence/pattern_detector.py \u2014 Recurring pattern detection (repeat offenders, flapping, concentration)\n- reporting/infrastructure_report.py \u2014 Daily briefing + weekly compliance report generator\n- Hardcoded READ_ONLY_MODE safety check at startup\n- MOCK_MODE fixed to true\n- Documentation: README.md, CLAUDE.md, TODO.md, CHANGELOG.md, PROJECT_PLAN.md\n\n## v1.0.0 \u2014 2026-02-06\n### Initial Deployment\n- FastAPI server on port 9003\n- /health endpoint\n- Teams message handler via Homebase\n- Heartbeat to Homebase\n- System prompt with Phase 1 restrictions",
      "todos_parsed": [
        {
          "text": "FastAPI server on port 9003",
          "done": true
        },
        {
          "text": "/health endpoint with memory + uptime",
          "done": true
        },
        {
          "text": "Teams message handler via Homebase",
          "done": true
        },
        {
          "text": "Heartbeat to Homebase every 5 minutes",
          "done": true
        },
        {
          "text": "MOCK_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "READ_ONLY_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "PRTG API client (mock sensors, alerts, devices)",
          "done": true
        },
        {
          "text": "Action1 API client (mock endpoints, patches, compliance)",
          "done": true
        },
        {
          "text": "Halo PSA ticket client (mock tickets, SLA breaches)",
          "done": true
        },
        {
          "text": "Alert correlator (PRTG alert \u2194 Halo ticket matching)",
          "done": true
        },
        {
          "text": "Pattern detector (repeat offenders, flapping, concentration)",
          "done": true
        },
        {
          "text": "Daily briefing generator",
          "done": true
        },
        {
          "text": "Weekly compliance report generator",
          "done": true
        },
        {
          "text": "/api/alerts/active endpoint",
          "done": true
        },
        {
          "text": "/api/correlations endpoint",
          "done": true
        },
        {
          "text": "/api/patterns endpoint",
          "done": true
        },
        {
          "text": "/api/reports/daily and /api/reports/weekly endpoints",
          "done": true
        },
        {
          "text": "/api/monitor/status endpoint (synthetic monitor results)",
          "done": true
        },
        {
          "text": "Switch LLM to Anthropic API (with OpenRouter fallback)",
          "done": true
        },
        {
          "text": "Scheduled report generation (APScheduler \u2014 daily 07:30 UTC, weekly Monday 08:00 UTC)",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.2.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "368ccc3 security: comprehensive .gitignore for credential protection (27 hours ago)",
        "changes": [
          {
            "status": "M",
            "file": "gitignore"
          },
          {
            "status": "M",
            "file": "CHANGELOG.md"
          },
          {
            "status": "M",
            "file": "CLAUDE.md"
          },
          {
            "status": "M",
            "file": "PROJECT_PLAN.md"
          },
          {
            "status": "M",
            "file": "README.md"
          },
          {
            "status": "M",
            "file": "SECURITY.md"
          },
          {
            "status": "M",
            "file": "SPEC.md"
          },
          {
            "status": "M",
            "file": "TODO.md"
          },
          {
            "status": "M",
            "file": "config.py"
          },
          {
            "status": "M",
            "file": "integrations/action1_client.py"
          }
        ],
        "uncommitted_count": 20
      },
      "ports_status": [
        {
          "port": 9003,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        ".3cx-credentials.json",
        "AUDIT-LOG.md",
        "CHANGELOG.md",
        "DEPLOYMENT.md",
        "ESCALATION.md",
        "INTEGRATIONS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "ROADMAP.md",
        "RUNBOOK.md",
        "SECURITY.md",
        "TODO.md",
        "TROUBLESHOOTING.md",
        "browser-monitor.py",
        "config/IDENTITY.md",
        "connectors/__init__.py",
        "connectors/action1_connector.py",
        "connectors/base_connector.py",
        "connectors/halo_connector.py",
        "connectors/prtg_connector.py",
        "connectors/sharepoint_connector.py",
        "connectors/sync_all.py",
        "data/action1-2026-02-10.json",
        "data/action1-2026-02-11.json",
        "data/action1-2026-02-12.json",
        "data/latest_monitor.json",
        "data/prtg-intel-2026-02-10.json",
        "data/prtg-intel-2026-02-11.json",
        "data/prtg-intel-2026-02-12.json",
        "db/__init__.py",
        "db/models.py",
        "main.py",
        "monitor/browser-results.json",
        "monitor/browser_monitor.py",
        "monitor/config.json",
        "monitor/results.json",
        "monitor/strikes.json",
        "monitors/synthetic_monitor.py",
        "reporting/__init__.py",
        "reporting/asset_report.py",
        "reporting/compliance_report.py",
        "reporting/daily_briefing.py",
        "reporting/infrastructure_report.py",
        "scripts/action1-sync.py",
        "scripts/halo-time-report.py",
        "scripts/monitor-3cx-sbc.py",
        "scripts/morning-briefing.py",
        "scripts/prtg-intelligence.py",
        "scripts/time-compliance-check.py",
        "sync_engine.py"
      ],
      "health_score": 98
    },
    {
      "name": "BET Air Ambulance",
      "server": "vector",
      "type": "infrastructure",
      "path": "/home/betadmin/bet",
      "domain": "vector.rize.bm",
      "ports": [
        3000
      ],
      "scanned_at": "2026-02-13T03:38:44.451711+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: DEPLOYMENT.md"
        },
        {
          "severity": "critical",
          "message": "Port 3000 not responding"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": "# Vector-BET - Bermuda Emergency Transport\n\n> **Air Ambulance Operations Platform**\n> \n> **Organization**: Bermuda Emergency Transport (BET) - Nonprofit\n> \n> **Purpose**: Manage air ambulance flights, patient transport, medical crew scheduling, and insurance quoting\n\n> **Related Docs:** [TODO.md](TODO.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [ADSB_TECHNICAL.md](ADSB_TECHNICAL.md) | [HANDOFF.md](HANDOFF.md) | [CHANGELOG.md](CHANGELOG.md)\n\n## Overview\n\nVector is a comprehensive air ambulance operations platform for Bermuda Emergency Transport (BET), a nonprofit organization providing critical medical transport services for Bermuda. The platform manages the complete lifecycle of medical air transport cases, from initial intake through patient delivery, including:\n\n- **Case Management**: Full patient case lifecycle tracking\n- **Aviation Intelligence**: Real-time aircraft tracking and flight planning\n- **AI Document Intake**: Automated extraction from medical documents\n- **Crew Management**: Pilot and medical staff scheduling\n- **Insurance Quoting**: Dollar-per-mile pricing for insurance companies\n\n## Tech Stack\n\n- **Backend**: Python FastAPI + PostgreSQL\n- **Frontend**: React 19 + Vite + TailwindCSS  \n- **Server**: Ubuntu 24.04 VM (192.168.65.249)\n- **External Access**: Cloudflare Tunnels\n- **ADS-B Receiver**: Raspberry Pi + RTL-SDR (roof-mounted)\n- **AI**: Claude Sonnet 4 (Anthropic) for document extraction\n- **Monitoring**: Email alerts + PRTG endpoints\n\n## URLs\n\n| Service | URL |\n|---------|-----|\n| App | https://app.bet.bm |\n| API | https://vector.bet.bm |\n| API Docs | https://vector.bet.bm/docs |\n| Vector SSH | vector-ssh.bet.bm (via cloudflared) |\n| Pi SSH | adsb-ssh.bet.bm (via cloudflared) |\n\n## Key Features\n\n### Case Management\n- Full case lifecycle (Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)\n- Patient demographics with passport tracking\n- Companion information for family escorts\n- Clinical documentation and medical history\n- Document management (14 categories)\n- Audit logging (PIPA/HIPAA compliant)\n\n### AI Document Intake\n- Upload up to 25 documents (PDF, Word, Excel, images)\n- Claude Sonnet 4 extracts 30+ fields automatically\n- Multi-document intelligent merging\n- Background processing with progress tracking\n- One-click case creation from extracted data\n\n### Aviation Intelligence\n- Real-time aircraft tracking (ADS-B + OpenSky + FlightAware)\n- Weather and NOTAMs display\n- Flight planning with distance/time calculation\n- LJ45 range checking\n- Hidden aircraft detection\n\n### Crew Management\n- Pilot and medical staff profiles\n- License/certification tracking\n- Case crew assignments\n- Availability status\n\n### Quoting System\n- Dynamic quote calculator\n- Flat rate and per-mile pricing\n- Common routes: Bermuda to Boston, Toronto, NYC, Miami\n\n### eAPIS Integration\n- Electronic manifest generation\n- XML and text export formats\n- US/Canada customs compliance\n\n### Mobile PWA\n- Offline-capable progressive web app\n- Voice transcription for mobile intake\n- IndexedDB for offline data storage\n\n## Aviation Data Sources\n\n| Source | Type | Update Rate | Coverage |\n|--------|------|-------------|----------|\n| Local ADS-B | Primary | Real-time | ~250nm from Bermuda |\n| OpenSky Network | Secondary | 30s cache | Global |\n| FlightAware | Scraper | 8-12 min | TXKF arrivals/departures |\n| ADS-B Exchange | API | Real-time | Global |\n\n## Services\n\n### Vector Server (192.168.65.249)\n```bash\nsudo systemctl status vector-api vector-frontend adsb-tunnel\nsudo systemctl restart vector-api\nsudo journalctl -u vector-api -n 50\n```\n\n### ADS-B Receiver (192.168.111.240)\n```bash\nssh -o ProxyCommand=\"cloudflared access ssh --hostname adsb-ssh.bet.bm\" pi@adsb-ssh.bet.bm\nsudo systemctl status readsb cloudflared\n```\n\n## Quick Reference\n```bash\n# Database access\ndocker exec -it vector-db psql -U vector -d vector\n\n# Git operations\ncd /opt/vector && git add -A && git commit -m \"message\" && git push\n```\n\n## Security\n\n- All services bound to localhost\n- Cloudflare tunnels handle external access\n- Cloudflare Access policies protect endpoints\n- Anthropic API key in backend/.env\n\n## Organization\n\n**Bermuda Emergency Transport (BET)** is a nonprofit organization providing air ambulance services for Bermuda residents requiring emergency or scheduled medical transport to specialized care facilities in North America.\n\n**Technical Partner**: Rize Technologies Ltd - Bermuda",
      "todo": "# Vector-BET TODO\n\n> **Related Docs:** [README.md](README.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [ADSB_TECHNICAL.md](ADSB_TECHNICAL.md) | [HANDOFF.md](HANDOFF.md) | [CHANGELOG.md](CHANGELOG.md)\n\n---\n\n## EXISTING FEATURES (Verified Working)\n\n### Core Case Management \u2713\n- [x] Database schema design\n- [x] Basic API structure (FastAPI)\n- [x] Cases CRUD API\n- [x] Parties API\n- [x] Flights API\n- [x] Frontend scaffolding (React 19 + Vite + Tailwind)\n- [x] Dashboard with stats\n- [x] Cases list with search/filter\n- [x] Case detail page with all fields\n- [x] Workflow stepper (5 phases: Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)\n- [x] Status transitions with validation\n- [x] Inline edit mode for case fields\n\n### Patient & Companion Management \u2713\n- [x] Patient demographics (phone, email, address, weight)\n- [x] Patient passport tracking (number, expiry, country)\n- [x] Companion info fields\n- [x] Companion passport tracking\n- [x] Next of kin contact\n- [x] Past medical history\n- [x] Clinical documentation\n\n### Document Management \u2713\n- [x] Document upload/download/delete\n- [x] Document types (14 categories)\n- [x] Timeline events display\n- [x] Audit logging (PIPA/HIPAA compliant)\n- [x] Audit log viewer with export\n\n### Flight Planning \u2713\n- [x] Flight planning - multi-leg support\n- [x] Airport database (24,223 airports)\n- [x] Searchable airport dropdown\n- [x] Auto-return leg creation\n- [x] Distance/time calculation (Haversine)\n- [x] LJ45 range checking with warnings\n- [x] Facilities database (45+ hospitals)\n- [x] Facilities search API\n- [x] Destination normalization (city/state/country)\n\n### Crew Management \u2713\n- [x] Crew database (12 members: pilots + medical)\n- [x] Crew CRUD with full profile editing\n- [x] License/certification tracking\n- [x] Crew availability status\n- [x] Case crew assignments table\n\n### Settings & Admin \u2713\n- [x] Settings system (81 settings, 12 categories)\n- [x] Aircraft profiles (configurable speed, range)\n- [x] Admin sidebar layout\n- [x] User context with admin detection\n\n### Security \u2713\n- [x] Cloudflare Access authentication module\n- [x] Server-side JWT validation\n- [x] get_current_user dependency for all routes\n- [x] require_admin dependency for admin routes\n- [x] /api/users/me endpoint\n- [x] Auto-create users on first login\n- [x] File upload size limit enforcement\n- [x] File extension allowlist per document type\n- [x] Magic bytes validation\n- [x] Generic error messages (hide SQL details)\n- [x] Frontend fetches user from API\n\n### Local ADS-B Integration \u2713\n- [x] Roof-mounted ADS-B receiver (Raspberry Pi + RTL-SDR)\n- [x] Cloudflare Tunnel for Pi connectivity\n- [x] Beast protocol decoder service\n- [x] Merged data sources (local ADSB + OpenSky + FlightAware)\n- [x] Deduplication by ICAO hex\n- [x] Resilient reconnection with exponential backoff\n- [x] USB watchdog script for Pi stability\n- [x] ADSB health endpoint for PRTG monitoring\n- [x] FlightAware scraper\n- [x] Source tracking column in aviation_movements\n\n### Email & Alerting \u2713\n- [x] SMTP email service\n- [x] Source monitoring service\n- [x] Alert on source down > 30 minutes\n- [x] Cooldown to prevent alert spam\n- [x] /api/aviation/sources/status endpoint\n\n### AI Document Intake \u2713\n- [x] Claude Sonnet 4 integration\n- [x] Multi-document upload (up to 25 files)\n- [x] PDF/Word/Excel/Image extraction\n- [x] Intelligent field merging\n- [x] Confidence scoring\n- [x] Background job processing\n- [x] One-click case creation\n- [x] Patient demographics extraction\n- [x] Database columns for new fields\n- [x] Anti-hallucination validation\n\n### Aviation Intelligence \u2713\n- [x] Fixed FlightAware scraper (correct table parsing)\n- [x] FlightSchedule component with 6 tabs\n- [x] Hidden aircraft detection (blocked from FlightAware)\n- [x] Merged /api/aviation/schedule endpoint\n- [x] Search filter in FlightSchedule\n- [x] Aircraft photos from Planespotters.net\n- [x] Simplified Aviation page (removed duplicate tabs)\n- [x] Source tracking for all movements\n- [x] data_source_status table\n- [x] ADS-B Exchange API integration\n\n### Quoting System \u2713\n- [x] Dynamic Quote Calculator (flat rate AND per-mile pricing)\n- [x] Quoted/actual pricing fields on cases\n\n### eAPIS Manifest \u2713\n- [x] eAPIS Manifest Generator (XML + text export)\n\n### Reports \u2713\n- [x] Monthly Financial Report (auto-generate + email)\n- [x] Monthly Directors Report (auto-generate + email)\n- [x] Report scheduling system\n\n### Mobile PWA \u2713\n- [x] Mobile PWA with offline support\n- [x] Voice transcription for mobile intake\n- [x] IndexedDB for offline data storage\n\n### Relay Integration \u2713\n- [x] Health endpoint at /health\n- [x] Monitored in Pulse dashboard\n\n---\n\n## PLANNED FEATURES (Not Yet Implemented)\n\n### \ud83d\udea8 PRIORITY: Production Readiness\n- [ ] OpenSky API credentials (reduce rate limiting)\n- [ ] Troubleshoot ADS-B Pi connection (offline)\n- [ ] Fix Pi power supply (5V 3A + powered USB hub)\n\n### Provider Mobile App (Nurses & Paramedics)\n- [ ] Offline-capable PWA for medical crew\n- [ ] Patient notes entry even when offline\n- [ ] Sync when reconnected\n- [ ] Secure access for field staff\n\n### Aircraft Tracking Enhancement\n- [ ] FlightAware API integration (official, not scraper)\n- [ ] Assign tail number to patient case\n- [ ] Automated takeoff and landing alerts\n- [ ] Push notifications to case stakeholders\n\n### Payment Processing\n- [ ] Insurance pre-authorization workflow\n- [ ] Authorization obtained on patient's behalf\n- [ ] Credit card processing integration\n- [ ] Bank transfer support\n- [ ] Invoice generation\n\n### Schedule Management\n- [ ] 24/7 coverage scheduling (2 pilots, 1-2 nurses, 1 paramedic, office staff)\n- [ ] Shift scheduling interface\n- [ ] On-call rotation management\n- [ ] Availability conflicts detection\n\n### Phase 2: NICE TO HAVE\n- [ ] Timeline-based ePCR (electronic Patient Care Report)\n- [ ] Satellite Tracking for over-ocean flights\n- [ ] Push Notifications\n- [ ] Dark Mode for Pilots\n\n### Phase 3: FUTURE\n- [ ] NEMSIS v3.5 Compliance (US EMS reporting standard)\n- [ ] HL7/FHIR Integration (healthcare interoperability)\n- [ ] ForeFlight API\n- [ ] Real-time WebSocket Updates\n- [ ] Billing/Invoicing Module\n\n---\n\n## Common Routes (For Reference)\n\nBermuda air ambulance services commonly fly to these destinations:\n- **Bermuda \u2192 Boston** (Boston Medical Center, MGH, etc.)\n- **Bermuda \u2192 New York** (NYC area hospitals)\n- **Bermuda \u2192 Miami** (Jackson Memorial, etc.)\n- **Bermuda \u2192 Toronto** (Canadian medical facilities)\n\n---\n\n## Notes\n\n- This is **AIR AMBULANCE** software for **Bermuda Emergency Transport (BET)**, a nonprofit\n- All terminology uses patient (not passenger), pilot/medical crew (not driver)\n- Platform manages flights, not ferries or buses",
      "changelog": "# Changelog\n\n> **Related Docs:** [README.md](README.md) | [TODO.md](TODO.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [HANDOFF.md](HANDOFF.md)\n\n## [1.0.1] - 2026-01-28\n### Documentation\n- Updated README.md with comprehensive air ambulance description\n- Clarified BET as Bermuda Emergency Transport nonprofit\n- Reorganized TODO.md to clearly separate existing vs planned features\n- Added planned features: Provider Mobile App, Payment Processing, Schedule Management\n- Added common routes reference (Boston, NYC, Miami, Toronto)\n- Cross-referenced all markdown documentation files\n\n## [1.0.0] - 2026-01-23\n### Added\n- Relay/Pulse integration\n- Health endpoint at /health\n\n## [0.11.0] - 2026-01-27\n### Added (Session 11)\n- Display patient_email, patient_address, next_of_kin on case detail\n- Dynamic Quote Calculator (flat rate AND per-mile pricing)\n- eAPIS Manifest Generator (XML + text export)\n- Monthly Financial Report (auto-generate + email)\n- Monthly Directors Report (auto-generate + email)\n- Report scheduling system\n- Mobile PWA with offline support\n- Voice transcription for mobile intake\n- IndexedDB for offline data storage\n- ADS-B Exchange API integration\n- AI anti-hallucination validation\n\n## [0.10.0] - 2026-01-08\n### Added (Session 10)\n- Fixed FlightAware scraper (correct table parsing)\n- FlightSchedule component with 6 tabs\n- Hidden aircraft detection\n- Aircraft photos from Planespotters.net\n- Simplified Aviation page\n\n## [0.9.0] - 2026-01-07\n### Added (Session 9)\n- AI Document Intake system (Claude Sonnet 4)\n- Multi-document upload (up to 25 files)\n- Patient demographics extraction\n- Background job processing\n\n## [0.8.0] - 2026-01-07\n### Added (Session 8)\n- Local ADS-B receiver integration\n- SMTP email service\n- Source monitoring and alerting\n- FlightAware scraper\n\n## Previous\n- Full case management system\n- Aviation intelligence tracking\n- Multi-source ADS-B integration\n- OpenSky API integration\n- Crew management\n- Settings system\n- Security hardening",
      "todos_parsed": [
        {
          "text": "Database schema design",
          "done": true
        },
        {
          "text": "Basic API structure (FastAPI)",
          "done": true
        },
        {
          "text": "Cases CRUD API",
          "done": true
        },
        {
          "text": "Parties API",
          "done": true
        },
        {
          "text": "Flights API",
          "done": true
        },
        {
          "text": "Frontend scaffolding (React 19 + Vite + Tailwind)",
          "done": true
        },
        {
          "text": "Dashboard with stats",
          "done": true
        },
        {
          "text": "Cases list with search/filter",
          "done": true
        },
        {
          "text": "Case detail page with all fields",
          "done": true
        },
        {
          "text": "Workflow stepper (5 phases: Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)",
          "done": true
        },
        {
          "text": "Status transitions with validation",
          "done": true
        },
        {
          "text": "Inline edit mode for case fields",
          "done": true
        },
        {
          "text": "Patient demographics (phone, email, address, weight)",
          "done": true
        },
        {
          "text": "Patient passport tracking (number, expiry, country)",
          "done": true
        },
        {
          "text": "Companion info fields",
          "done": true
        },
        {
          "text": "Companion passport tracking",
          "done": true
        },
        {
          "text": "Next of kin contact",
          "done": true
        },
        {
          "text": "Past medical history",
          "done": true
        },
        {
          "text": "Clinical documentation",
          "done": true
        },
        {
          "text": "Document upload/download/delete",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.0.1",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "129eafd Auto-backup: $(date \"+%Y-%m-%d %H:%M\") (11 days ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3000,
          "open": false,
          "http_code": 0,
          "healthy": false
        }
      ],
      "files": [
        "ADSB_TECHNICAL.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "HANDOFF.md",
        "README.md",
        "TODO.md",
        "VECTOR_TECHNICAL_BRIEFING.md",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 65
    }
  ],
  "issues": [
    {
      "project": "David Bishop",
      "server": "agents",
      "severity": "critical",
      "message": "Port 9001 not responding"
    },
    {
      "project": "BET Air Ambulance",
      "server": "vector",
      "severity": "critical",
      "message": "Port 3000 not responding"
    },
    {
      "project": "Dockyard WiFi",
      "server": "rize-apps",
      "severity": "warning",
      "message": "Missing required docs: DEPLOYMENT.md"
    },
    {
      "project": "David Bishop",
      "server": "agents",
      "severity": "warning",
      "message": "Missing required docs: SPEC.md, SECURITY.md, INTEGRATIONS.md, RUNBOOK.md, ESCALATION.md, AUDIT-LOG.md"
    },
    {
      "project": "BET Air Ambulance",
      "server": "vector",
      "severity": "warning",
      "message": "Missing required docs: DEPLOYMENT.md"
    },
    {
      "project": "Best Shipping",
      "server": "demos",
      "severity": "info",
      "message": "20 uncommitted changes"
    },
    {
      "project": "BPS-AI",
      "server": "demos",
      "severity": "info",
      "message": "15 uncommitted changes"
    },
    {
      "project": "Premier EMR",
      "server": "demos",
      "severity": "info",
      "message": "8 uncommitted changes"
    },
    {
      "project": "Helios AI",
      "server": "demos",
      "severity": "info",
      "message": "20 uncommitted changes"
    },
    {
      "project": "Homebase",
      "server": "rize-apps",
      "severity": "info",
      "message": "20 uncommitted changes"
    },
    {
      "project": "Dockyard WiFi",
      "server": "rize-apps",
      "severity": "info",
      "message": "8 uncommitted changes"
    },
    {
      "project": "Apex",
      "server": "agents",
      "severity": "info",
      "message": "20 uncommitted changes"
    },
    {
      "project": "Aegis",
      "server": "agents",
      "severity": "info",
      "message": "20 uncommitted changes"
    }
  ],
  "summary": {
    "total": 11,
    "healthy": 8,
    "warning": 3,
    "critical": 0
  }
}