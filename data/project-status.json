{
  "meta": {
    "scanned_at": "2026-02-07T23:10:02.184969+00:00",
    "project_count": 11,
    "scanner_version": "1.0.0"
  },
  "projects": [
    {
      "name": "Best Shipping",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/best-shipping-dashboard",
      "domain": "bestshipping.rize.bm",
      "ports": [
        3001,
        8001
      ],
      "scanned_at": "2026-02-07T23:10:02.185016+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Best Shipping Dashboard\n**Version:** 1.0.0\n**Server:** .246 (Demos) | **Ports:** Backend :8001, Frontend :3001\n**Domain:** bestshipping.rize.bm\n**Status:** Demo Ready\n\n## Overview\n\nCustomer-facing dashboard for Best Shipping (Bermuda-based freight/logistics company). Provides clients with real-time visibility into shipment status, financial obligations, and account history.\n\n## Quick Start\n\n```bash\ncd ~/best-shipping-dashboard\n\n# Backend (FastAPI)\ncd backend\nsource venv/bin/activate\nuvicorn main:app --host 0.0.0.0 --port 8001\n\n# Frontend (React/Vite)\ncd ../frontend\nnpm run dev -- --port 3001\n```\n\n## Architecture\n\n| Component | Technology | Port |\n|-----------|------------|------|\n| Backend | Python FastAPI | 8001 |\n| Frontend | React + Vite + Tailwind | 3001 |\n| Database | PostgreSQL | 5432 |\n\n## Demo Credentials\n\n| Email | Password | Role |\n|-------|----------|------|\n| cornell@bestshipping.bm | demo2026 | Customer |\n| admin@bestshipping.bm | admin2026 | Admin |\n\n## API Endpoints\n\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| POST | /api/auth/login | Authentication |\n| GET | /api/health | Health check |\n| GET | /api/dashboard | Dashboard summary |\n| GET | /api/shipments | List shipments |\n| GET | /api/shipments/{id} | Shipment detail |\n| GET | /api/financials | Financial overview |\n| GET | /api/documents | Document library |\n\n## Pages\n\n| Page | Description |\n|------|-------------|\n| Dashboard | Active shipments, upcoming arrivals, outstanding balance |\n| Shipments | Filterable list with status badges |\n| Shipment Detail | Full lifecycle timeline, documents, costs |\n| Financials | Invoice list, payment history, aging |\n| Documents | Searchable document library |\n| Account | Profile and preferences |\n\n## Features\n\n- [x] User authentication (JWT)\n- [x] Shipment tracking with visual pipeline\n- [x] Financial dashboard with aging\n- [x] Document management\n- [x] Best Shipping branding (navy/white/accent blue)\n- [x] Mobile responsive\n\n## Integration Status\n\n| System | Status | Notes |\n|--------|--------|-------|\n| CargoWise | Mock | Awaiting API credentials |\n| QuickBooks | Mock | Awaiting OAuth setup |\n| Email Parser | Mock | Awaiting IMAP access |\n\n## Deployment\n\nRunning via PM2 or systemd. Accessible via Cloudflare tunnel at bestshipping.rize.bm.\n\n## Contact\n\n- Project Owner: Artie (artiedarrell@gmail.com)\n- Client Stakeholder: Cornell (Best Shipping)",
      "todo": "# TODO \u2014 Best Shipping Dashboard\n## Last Updated: 2026-02-06\n\n## P0 \u2014 Demo Blockers\n- [x] Backend API scaffolding\n- [x] Frontend build with React/Vite\n- [x] Authentication (JWT login)\n- [x] Dashboard home page\n- [x] Shipment list with filters\n- [x] Shipment detail view\n- [x] Financial overview\n- [x] Document center\n- [x] Best Shipping branding\n- [x] Deploy to .246\n\n## P1 \u2014 Demo Polish\n- [ ] Verify Vite allowedHosts for external access\n- [ ] Confirm Cloudflare tunnel for bestshipping.rize.bm\n- [ ] Create demo walkthrough script for Cornell\n- [ ] Seed 15-20 realistic Bermuda shipments\n- [ ] Test full login \u2192 dashboard \u2192 shipment detail flow\n- [ ] Mobile responsive testing\n- [ ] Screenshot deck for offline demo\n\n## P2 \u2014 Phase 2 Integrations (Post-Demo)\n- [ ] CargoWise eHub API integration\n- [ ] QuickBooks Online API (OAuth)\n- [ ] Email parser (IMAP + Claude)\n- [ ] Multi-tenant customer auth\n- [ ] Production deployment\n\n## P3 \u2014 Future Enhancements\n- [ ] Real-time shipment tracking map\n- [ ] Push notifications for status changes\n- [ ] Online payment capability\n- [ ] Microsoft Dynamics CRM integration\n- [ ] Mobile app (React Native)\n\n## Completed\n- [x] 2026-02-05: Initial spec completed\n- [x] 2026-02-06: Backend and frontend deployed to .246\n- [x] 2026-02-06: Health check passing",
      "changelog": "# Changelog \u2014 Best Shipping Dashboard\n\n## [1.0.0] - 2026-02-06\n\n### Added\n- Complete FastAPI backend with authentication\n- React/Vite frontend with Tailwind CSS\n- Dashboard home page with summary cards\n- Shipment list with filtering and search\n- Shipment detail view with timeline\n- Financial overview with invoice aging\n- Document center with preview/download\n- Best Shipping branding (navy/white/accent blue)\n- Demo credentials (cornell@bestshipping.bm)\n- Health check endpoint\n\n### Technical\n- Backend running on port 8001\n- Frontend running on port 3001\n- JWT-based authentication\n- Mock data for CargoWise, QuickBooks, email sources\n- Deployed to .246 (Demos server)\n\n## [0.1.0] - 2026-02-05\n\n### Added\n- Project spec document completed\n- Architecture design finalized\n- File structure defined",
      "todos_parsed": [
        {
          "text": "Backend API scaffolding",
          "done": true
        },
        {
          "text": "Frontend build with React/Vite",
          "done": true
        },
        {
          "text": "Authentication (JWT login)",
          "done": true
        },
        {
          "text": "Dashboard home page",
          "done": true
        },
        {
          "text": "Shipment list with filters",
          "done": true
        },
        {
          "text": "Shipment detail view",
          "done": true
        },
        {
          "text": "Financial overview",
          "done": true
        },
        {
          "text": "Document center",
          "done": true
        },
        {
          "text": "Best Shipping branding",
          "done": true
        },
        {
          "text": "Deploy to .246",
          "done": true
        },
        {
          "text": "Verify Vite allowedHosts for external access",
          "done": false
        },
        {
          "text": "Confirm Cloudflare tunnel for bestshipping.rize.bm",
          "done": false
        },
        {
          "text": "Create demo walkthrough script for Cornell",
          "done": false
        },
        {
          "text": "Seed 15-20 realistic Bermuda shipments",
          "done": false
        },
        {
          "text": "Test full login \u2192 dashboard \u2192 shipment detail flow",
          "done": false
        },
        {
          "text": "Mobile responsive testing",
          "done": false
        },
        {
          "text": "Screenshot deck for offline demo",
          "done": false
        },
        {
          "text": "CargoWise eHub API integration",
          "done": false
        },
        {
          "text": "QuickBooks Online API (OAuth)",
          "done": false
        },
        {
          "text": "Email parser (IMAP + Claude)",
          "done": false
        }
      ],
      "todos_open": 10,
      "todos_done": 10,
      "version": "1.0.0",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "3fc4fdf BEST Shipping Dashboard: demo-ready, Cornell login, systemd services, full API (16 minutes ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3001,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 8001,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "DEMO-SCRIPT.md",
        "DEMO_SCRIPT.md",
        "DEPLOYMENT.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/config.py",
        "backend/main.py",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 100
    },
    {
      "name": "BPS-AI",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/bps-ai",
      "domain": "bpsai.rize.bm",
      "ports": [
        3000
      ],
      "scanned_at": "2026-02-07T23:10:16.231509+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# BPS AI - Bermuda Police Services AI Case Management\n\n> **\ud83d\udcda Documentation Navigation**\n> This is the main README. See all documentation:\n> - [Project Plan](docs/PROJECT_PLAN.md) - Development roadmap\n> - [TODO Checklist](docs/TODO.md) - Complete task tracking\n> - [Technical Spec](docs/TECHNICAL_SPEC.md) - Architecture & stack\n> - [Design Spec](docs/DESIGN_SPEC.md) - UI/UX guidelines\n> - [Database Schema](docs/DATABASE_SCHEMA.md) - Data models\n> - [API Spec](docs/API_SPEC.md) - Endpoint documentation\n> - [Security](docs/SECURITY.md) - Auth & access control\n> - [Scraper Guide](docs/SCRAPER_GUIDE.md) - Data collection\n> - [RAG Architecture](docs/RAG_ARCHITECTURE.md) - AI research system\n> - [Changelog](CHANGELOG.md) - Version history\n\n---\n\n## Project Overview\n\nAI-powered case management and reporting system for Bermuda Police Services. Features multi-model AI report generation, internal affairs monitoring, and integrated legal/news research capabilities.\n\n**Client:** Bermuda Police Services  \n**Contact:** Alexander Rollin (arollin@bps.bm)  \n**Development:** Gadarrell / Rize Business Development  \n**Version:** 0.9.26\n\n---\n\n## Live Demo URLs\n\n| Environment | URL | Purpose |\n|-------------|-----|---------|\n| Main Application | https://bpsai.rize.bm/login | Officer & Admin login |\n| Internal Affairs | https://bpsai.rize.bm/ia-login | IA-specific login (separate system) |\n| SSH Access | https://bpsai-ssh.rize.bm | Browser-based SSH |\n\n---\n\n## Login Credentials (Demo)\n\n### Main Application (bpsai.rize.bm/login)\n\n| Role | Email | Password | Access Level |\n|------|-------|----------|--------------|\n| Superintendent | rizeadmin@bps.bm | BPSDemo2026\\! | Full admin rights |\n| Admin | admin@bps.bm | BPSAdmin2026\\! | Administration |\n| Officer | officer@bps.bm | BPSOfficer2026\\! | Standard officer |\n| Demo | demo@bps.bm | BPSDemo2026\\! | Demo user |\n\n### Internal Affairs Portal (bpsai.rize.bm/ia-login)\n\n| Role | Email | Password | Access Level |\n|------|-------|----------|--------------|\n| IA Admin | ia.admin@bps.bm | IAAdmin2026\\! | Full IA admin |\n| IA Supervisor | ia.supervisor@bps.bm | IASuper2026\\! | Supervisory |\n| IA Investigator | ia.investigator@bps.bm | IAInvest2026\\! | Investigation |\n| IA Analyst | ia.analyst@bps.bm | IAAnalyst2026\\! | Analysis only |\n\n---\n\n## Monitoring\n\nThis project is monitored by **Relay/Pulse** at 192.168.65.248\n\n| Check | Endpoint |\n|-------|----------|\n| Health | /api/health |\n| Pulse Dashboard | http://192.168.65.248:8000/api/pulse/status |\n\n---\n\n## Core Features\n\n### 1. Case Management\n- **3 Case Types:** Domestic Abuse, Gang/Drug, Traffic\n- Pre-filled forms with dropdowns\n- Voice dictation support\n- Extensible template architecture\n\n### 2. Multi-AI Report Generation\n| Model | Provider | Type |\n|-------|----------|------|\n| Claude | Anthropic | Cloud |\n| GPT-4 | OpenAI | Cloud |\n| Gemini | Google | Cloud |\n| Llama 3 8B | Ollama | Local |\n| Mistral 7B | Ollama | Local |\n\n### 3. Internal Affairs Module\n- Separate authentication & database\n- Officer activity monitoring\n- Full investigation workflow\n- Audit logging\n- Purple/dark theme for visual distinction\n\n### 4. Legal & News Research (RAG)\n- **Bermuda Laws Database** - 98 scraped laws (62 police-priority)\n- **News Archive** - 10 years from Royal Gazette & Bernews\n- Vector search for AI-enhanced research\n- AI Law Assistant for statute explanations\n\n### 5. Analytics Dashboard\n- Case statistics & trends\n- AI usage metrics\n- Officer activity reports\n\n---\n\n## Tech Stack\n\n| Layer | Technology |\n|-------|------------|\n| Frontend | Next.js 14, React, TypeScript, Tailwind CSS |\n| Backend | Next.js API Routes, Node.js |\n| Database | PostgreSQL 16 + pgvector |\n| ORM | Prisma |\n| Auth | NextAuth.js |\n| AI Cloud | Claude, OpenAI, Gemini APIs |\n| AI Local | Ollama (Llama 3, Mistral) |\n| Vector DB | pgvector (PostgreSQL extension) |\n| Scraping | Puppeteer, Cheerio |\n| Hosting | Hyper-V VM, Cloudflare Tunnel |\n\n---\n\n## Quick Start\n\n```bash\n# Clone repository\ngit clone https://github.com/gadarrell99/bps-ai.git\ncd bps-ai\n\n# Install dependencies\nnpm install\n\n# Set up environment\ncp .env.example .env\n# Edit .env with your API keys\n\n# Set up database\nnpm run db:setup\nnpm run db:seed\n\n# Start development server\nnpm run dev\n```\n\n---\n\n## Project Structure\n\n```\nbps-ai/\n\u251c\u2500\u2500 README.md                \u2190 You are here\n\u251c\u2500\u2500 CHANGELOG.md             # Version history\n\u251c\u2500\u2500 CLAUDE.md                # AI agent instructions\n\u251c\u2500\u2500 VERSION\n\u251c\u2500\u2500 docs/\n\u2502   \u251c\u2500\u2500 PROJECT_PLAN.md      # Development roadmap\n\u2502   \u251c\u2500\u2500 TODO.md              # Task checklist\n\u2502   \u251c\u2500\u2500 TECHNICAL_SPEC.md    # Architecture\n\u2502   \u251c\u2500\u2500 DESIGN_SPEC.md       # UI/UX guidelines\n\u2502   \u251c\u2500\u2500 DATABASE_SCHEMA.md   # Data models\n\u2502   \u251c\u2500\u2500 API_SPEC.md          # API documentation\n\u2502   \u251c\u2500\u2500 SECURITY.md          # Security specs\n\u2502   \u251c\u2500\u2500 SCRAPER_GUIDE.md     # Scraping documentation\n\u2502   \u2514\u2500\u2500 RAG_ARCHITECTURE.md  # RAG system design\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 app/                 # Next.js app router\n\u2502   \u251c\u2500\u2500 components/          # React components\n\u2502   \u251c\u2500\u2500 lib/                 # Utilities & services\n\u2502   \u2514\u2500\u2500 styles/              # CSS/Tailwind\n\u251c\u2500\u2500 scrapers/\n\u2502   \u251c\u2500\u2500 laws/                # Bermuda laws scraper\n\u2502   \u251c\u2500\u2500 news/                # News scrapers\n\u2502   \u2514\u2500\u2500 data/                # Scraped data output\n\u251c\u2500\u2500 prisma/\n\u2502   \u2514\u2500\u2500 schema.prisma        # Database schema\n\u2514\u2500\u2500 scripts/\n    \u2514\u2500\u2500 seed-users.js        # Database seeding\n```\n\n---\n\n## Key Contacts\n\n| Role | Name | Email |\n|------|------|-------|\n| Client | Alexander Rollin | arollin@bps.bm |\n| Developer | Gilbert Darrell | gadarrell@rize.bm |\n| Biz Dev | Sarah | (Rize) |\n\n---\n\n## License\n\nProprietary - Bermuda Police Services / Gadarrell / Rize\n\n---\n\n> **\ud83d\udcda Next Steps:** Review [PROJECT_PLAN.md](docs/PROJECT_PLAN.md) for the development timeline and [TODO.md](docs/TODO.md) for current tasks.",
      "todo": "# BPS-AI TODO\n\n## Current Version: v0.9.26\n\n---\n\n## v0.9.26 - Case Review Rename\n- [x] Renamed Reports to Case Review in navigation\n- [x] Updated page titles and labels\n- [x] All routes remain functional\n\n## v0.9.25 - Prominent PDF Export\n- [x] Made PDF Export button prominent (red, shadow)\n- [x] Added PDF emoji icon\n- [x] Button visible without scrolling\n\n## v0.9.24 - Column Customization\n- [x] Column picker dropdown on case list\n- [x] Show/hide columns (Case #, Title, Type, Status, Priority, Officer, Date, Parish, Complainant)\n- [x] localStorage persistence for preferences\n- [x] Reset to defaults button\n\n## v0.9.23 - Prominent Voice Input\n- [x] Large microphone button at top of New Case form\n- [x] Gold color, next to AI Assistant button\n- [x] Pulses red when recording\n- [x] Voice feeds into notes area\n\n\n## v0.9.22 - AI Auto-Fill & Voice Input\n- [x] AI extraction API (/api/ai/extract-from-notes)\n- [x] Auto-Fill from Notes button on New Case page\n- [x] AI fills form fields from raw notes\n- [x] AI NEVER fabricates - prompts user for missing fields\n- [x] \"AI filled X fields, verify Y fields\" message\n- [x] Prominent voice input button at top of New Case form\n- [x] Voice transcription feeds into notes area\n\n\n## v0.9.21 - Footer Link\n- [x] Added Rize Technologies link to main page\n- [x] Added Rize Technologies link to login page\n- [x] Added Rize Technologies link to IA login\n\n\n## v0.9.20 - IA Audit View\n- [x] Created /api/ia/audit-logs API endpoint\n- [x] Created /ia-audit-logs page\n- [x] Added filters: user, action, date range\n- [x] Read-only table view\n\n\n## v0.9.19 - Audit Logging\n- [x] Created audit_logs table in schema\n- [x] Created audit service (src/lib/audit.ts)\n- [x] Added VIEW_CASE logging to case routes\n- [x] Added EDIT_CASE logging to case routes\n- [x] Added VIEW_EVIDENCE logging to evidence routes\n\n\n## v0.9.18 - Login Performance\n- [x] Made lastLoginAt update non-blocking\n- [x] Reduced login latency by ~50-100ms\n\n\n## v0.9.17 - PDF Route Fix\n- [x] Fixed PDF export route TypeScript error\n- [x] Changed officer to assignedOfficer in Prisma include\n- [x] Updated officer name formatting\n- [x] Verified all 10 test cases render correctly\n- [x] Rebuilt and restarted PM2\n\n\n## v0.9.16 - Bug Fix\n- [x] Fixed case detail page \"Something went wrong\" error\n- [x] Rebuilt corrupted .next build directory\n- [x] Verified all manifest files generated correctly\n- [x] PM2 service restarted successfully\n\n## v0.9.15 - PDF Export\n- [x] PDF export endpoint (/api/cases/:id/pdf)\n- [x] PDFKit integration\n- [x] Case details, timeline, evidence in report\n- [x] Confidential footer\n- [x] Auto-download with case number filename\n\n## v0.9.14 - Email Notifications\n- [x] Email service created (lib/emailService.ts)\n- [x] SMTP configured (Office365)\n- [x] notifyCaseAssigned, notifyStatusChange, notifyNewEvidence\n- [x] Test email sent successfully\n- [x] Email templates: case-created, case-updated, evidence-added\n\n## v0.9.13 - Evidence Upload\n- [x] Real evidence file upload system\n- [x] Upload API endpoint (/api/evidence/upload)\n- [x] File serving API (/api/files/[...path])\n- [x] Drag-and-drop file upload form\n- [x] File preview (images, video, audio, PDF)\n- [x] File download functionality\n- [x] 10MB file size limit\n\n## v0.9.12 - Verification\n- [x] Database connection verification (Main + IA)\n- [x] Endpoint health check (all 200 OK)\n- [x] Demo readiness confirmed\n\n## v0.9.10 - Browser Testing\n- [x] Browser verification testing - ALL PAGES PASS\n- [x] Edit page exists at /cases/[id]/edit with audit logging\n- [x] Data counts verified: 16 users, 65 cases, 136 evidence, 10 IA investigations\n\n## v0.9.9 - Features\n- [x] Profile page with user info, stats\n- [x] Edit case with audit warning popup\n- [x] Edit case form (full case editing)\n- [x] Cases list filterable by status, type, priority\n- [x] Cases list sortable (newest, oldest, priority, case number)\n- [x] Dashboard stats clickable (links to filtered views)\n- [x] 50 fake cases with realistic data\n- [x] 130 evidence records\n- [x] 10 IA investigations with documents\n- [x] IA investigation detail page\n- [x] Voice dictation in new case form\n\n## Demo Complete (v0.9.4)\n- [x] AI Legal Assistant with anti-hallucination\n- [x] Evidence immutability system\n- [x] Chain of custody tracking\n- [x] Audit trail for all evidence actions\n- [x] Demo cases with realistic evidence\n- [x] Demo script for Alex\n- [x] User guide documentation\n- [x] Mock government integration placeholders\n\n---\n\n## Before Demo (High Priority)\n- [x] Test login with Alex credentials\n- [x] Verify all demo cases display correctly\n- [x] Check AI responses for each demo query\n\n## Post-Demo (Current Sprint)\n- [x] Real evidence file upload (local storage) - DONE v0.9.13\n- [x] Email notifications for case updates - DONE v0.9.14\n- [x] PDF report export - DONE v0.9.15\n- [ ] Mobile-responsive improvements (audit needed)\n\n---\n\n## Future Integrations (Pending Agreements)\n- [ ] Bermuda Court System API\n- [ ] Transportation Control Department API\n- [ ] Immigration Department API\n- [ ] Bermuda Hospitals Board (with warrant system)\n\n## Technical Debt\n- [ ] Add comprehensive test suite\n- [ ] Implement proper error boundaries\n- [ ] Add loading states to all data fetching\n- [ ] Optimize database queries\n\n---\n\n*Last Updated: 2026-01-29*",
      "changelog": "# Changelog\n## [0.9.22] - 2026-01-30\n\n### Added - AI Auto-Fill from Notes\n- **AI Extraction API**: POST /api/ai/extract-from-notes\n  - Uses Claude AI to extract structured case data from raw officer notes\n  - Extracts: Case Type, Date/Time, Location, Parties, Vehicles, Injuries, Description\n  - CRITICAL: AI NEVER fabricates data - only extracts explicitly stated information\n  - Returns summary: filled fields count, missing fields that need user input\n- **Auto-Fill Button**: New Case page now has \"Auto-Fill from Notes\" button\n  - Officers paste/dictate raw notes into text area\n  - Click button to have AI populate form fields\n  - Shows banner: \"AI filled X fields, please verify Y fields\"\n  - Missing fields highlighted for user attention\n- **Prominent Voice Input**: Large microphone button at top of New Case form\n  - Next to AI Assistant toggle\n  - Gold color, highly visible\n  - Pulses red when recording\n  - Voice transcription feeds into notes area\n\n## [0.9.21] - 2026-01-30\n\n### Added - Rize Website Link in Footer\n- Added clickable Rize Technologies link to main page footer\n- Added clickable Rize Technologies link to login page footer\n- Added clickable Rize Technologies link to IA login page footer\n- Links open https://rize.bm in new tab\n\n## [0.9.20] - 2026-01-30\n\n### Added - IA Audit Logs View\n- **API Endpoint**: GET /api/ia/audit-logs\n  - Query audit logs with filters (userId, action, resourceType, dateRange)\n  - Pagination support (limit, offset)\n  - Returns filter options for dropdowns\n- **IA Audit Logs Page**: /ia-audit-logs\n  - Table view: When, Who, Action, Resource, Details, From Where\n  - Filters: User, Action, Start Date, End Date\n  - Read-only (no edit/delete capability)\n\n## [0.9.19] - 2026-01-30\n\n### Added - Comprehensive Audit Logging (HOSPITAL-GRADE)\n- **AuditLog Table**: Created append-only audit_logs table\n  - Columns: userId, userEmail, action, resourceType, resourceId, details, ipAddress, userAgent, createdAt\n  - Indexes on: userId, resourceType+resourceId, action, createdAt\n- **Audit Service**: src/lib/audit.ts with logAudit() function\n  - Fire-and-forget logging (non-blocking)\n  - Supports VIEW_CASE, EDIT_CASE, VIEW_EVIDENCE, DOWNLOAD_EVIDENCE, etc.\n- **Case Routes**: Added audit logging to GET and PATCH handlers\n- **Evidence Routes**: Added audit logging to GET handler\n\n## [0.9.18] - 2026-01-30\n\n### Performance\n- **Login Speed Optimization**: Reduced login latency\n  - Made lastLoginAt update non-blocking (fire-and-forget)\n  - Login no longer waits for timestamp update to complete\n  - Estimated savings: ~50-100ms per login\n\n\n## [0.9.17] - 2026-01-29\n\n### Fixed\n- **PDF Export Route Error**: Fixed TypeScript error in /api/cases/[id]/pdf route\n  - Changed officer to assignedOfficer in Prisma include\n  - Updated officer name formatting to use firstName/lastName fields\n  - Root cause: Schema field name mismatch (officer vs assignedOfficer)\n\n### Verified\n- Case detail pages: All 10 tested cases render correctly\n- PDF export route: Builds without errors\n- Health check: OK\n- Database: 65 cases, 16 users\n- PM2 status: Online, no errors\n\n## [0.9.16] - 2026-01-29\n\n### Fixed\n- **Case Detail Page Error**: Fixed Something went wrong - Unexpected error occurred when viewing any case\n  - Root cause: Corrupted .next build directory missing prerender-manifest.json\n  - Cleared and rebuilt the production build\n  - Verified all manifest files regenerated correctly\n  - Restarted PM2 service\n\n### Verified\n- Health check: OK\n- Login page: Renders correctly\n- Case detail redirect: Working (307 to login for unauthenticated users)\n- PM2 status: Online\n\n## [0.9.15] - 2026-01-29\n\n### Added\n- **PDF Report Export** (lib/pdfService.ts)\n  - PDFKit dependency installed\n  - GET /api/cases/:id/pdf endpoint\n  - Report includes: case details, timeline, evidence list\n  - Auto-download with case number in filename\n  - Confidential footer\n\n### Added\n- **Email Notification System**: Automated email alerts for case events\n  - SMTP configuration via Office 365 (smtp.office365.com:587)\n  - Nodemailer integration for email sending\n  - Professional HTML email templates with BPS branding\n\n### Email Templates\n- **case-created.html**: Notification when new case assigned to officer\n- **case-updated.html**: Notification when case details changed\n- **evidence-added.html**: Notification when new evidence added to case\n\n### API Integration\n- POST /api/cases: Sends case-created email to assigned officer\n- PATCH /api/cases/[id]: Sends case-updated email on changes\n- POST /api/evidence: Sends evidence-added email to case owner\n\n### Technical\n- New library: src/lib/email.ts with sendEmail function\n- Template variables: recipientName, caseNumber, caseTitle, caseUrl, etc.\n- Async email sending (non-blocking for API responses)\n- SMTP config in .env: SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS, SMTP_FROM\n\n## [0.9.23] - 2026-01-30\n\n### Added - Prominent Voice Input (Task 7)\n- Large microphone button at top of New Case form\n- Gold color, highly visible next to AI Assistant button\n- Pulses red when recording\n- Voice transcription feeds directly into notes area\n\n## [0.9.24] - 2026-01-30\n\n### Added - Column Customization (Task 8)\n- **Column Picker**: Dropdown button to show/hide columns on case list\n- Available columns: Case #, Title, Type, Status, Priority, Assigned To, Date, Parish, Complainant\n- **LocalStorage Persistence**: Column preferences saved in browser\n- Reset button to restore default columns\n- Footer shows visible column count\n\n## [0.9.25] - 2026-01-30\n\n### Changed - PDF Export Button (Task 9)\n- Made PDF Export button prominent with red background\n- Added PDF emoji icon for visibility\n- Shadow effect for visual prominence\n- Button visible at top of case detail page without scrolling\n\n## [0.9.26] - 2026-01-30\n\n### Changed - Renamed Reports to Case Review (Task 10)\n- Renamed 'Reports' to 'Case Review' in sidebar navigation\n- Updated page heading from 'Reports' to 'Case Review'\n- Updated statistics label from 'Total Reports' to 'Total Reviews'\n- All links and routes remain functional",
      "todos_parsed": [
        {
          "text": "Renamed Reports to Case Review in navigation",
          "done": true
        },
        {
          "text": "Updated page titles and labels",
          "done": true
        },
        {
          "text": "All routes remain functional",
          "done": true
        },
        {
          "text": "Made PDF Export button prominent (red, shadow)",
          "done": true
        },
        {
          "text": "Added PDF emoji icon",
          "done": true
        },
        {
          "text": "Button visible without scrolling",
          "done": true
        },
        {
          "text": "Column picker dropdown on case list",
          "done": true
        },
        {
          "text": "Show/hide columns (Case #, Title, Type, Status, Priority, Officer, Date, Parish, Complainant)",
          "done": true
        },
        {
          "text": "localStorage persistence for preferences",
          "done": true
        },
        {
          "text": "Reset to defaults button",
          "done": true
        },
        {
          "text": "Large microphone button at top of New Case form",
          "done": true
        },
        {
          "text": "Gold color, next to AI Assistant button",
          "done": true
        },
        {
          "text": "Pulses red when recording",
          "done": true
        },
        {
          "text": "Voice feeds into notes area",
          "done": true
        },
        {
          "text": "AI extraction API (/api/ai/extract-from-notes)",
          "done": true
        },
        {
          "text": "Auto-Fill from Notes button on New Case page",
          "done": true
        },
        {
          "text": "AI fills form fields from raw notes",
          "done": true
        },
        {
          "text": "AI NEVER fabricates - prompts user for missing fields",
          "done": true
        },
        {
          "text": "\"AI filled X fields, verify Y fields\" message",
          "done": true
        },
        {
          "text": "Prominent voice input button at top of New Case form",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "0.9.22",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "761b322 17 users seeded, systemd service, court/laws API endpoints operational (23 minutes ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3000,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO_CHECKLIST.md",
        "DEMO_SCRIPT.md",
        "DEPLOYMENT.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "USER_GUIDE.md",
        "docs/API_SPEC.md",
        "docs/DATABASE_SCHEMA.md",
        "docs/DESIGN_SPEC.md",
        "docs/PROJECT_PLAN.md",
        "docs/RAG_ARCHITECTURE.md",
        "docs/SCRAPER_GUIDE.md",
        "docs/SECURITY.md",
        "docs/TECHNICAL_SPEC.md",
        "docs/TODO.md",
        "next.config.js",
        "package-lock.json",
        "package.json",
        "postcss.config.js",
        "prisma/seed.js",
        "prisma/seed.ts",
        "rag/index_embeddings.py",
        "rag/index_laws.py",
        "scrapers/daily-scraper.py",
        "scrapers/sync-to-db.js",
        "scripts/check-user.ts",
        "scripts/create-superintendent.ts",
        "scripts/elevate-alex.ts",
        "scripts/query_cases.ts",
        "scripts/query_evidence.ts",
        "scripts/query_users.ts",
        "scripts/seed-cases.ts",
        "scripts/seed-demo-cases.ts",
        "scripts/seed-fake-cases.ts",
        "scripts/seed-ia-users.ts",
        "scripts/seed-users.ts",
        "scripts/test-ai.ts",
        "scripts/test-email.js",
        "search-laws-advanced.js",
        "seed-ia-investigations.js",
        "src/middleware.ts",
        "tailwind.config.js",
        "test-upload.js",
        "tsconfig.json",
        "verify_db.js"
      ],
      "health_score": 100
    },
    {
      "name": "Premier EMR",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/premier-emr",
      "domain": "emr.rize.bm",
      "ports": [
        3004,
        5004
      ],
      "scanned_at": "2026-02-07T23:10:29.652326+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Premier Health EMR\n\n> Modern AI-powered Electronic Medical Records system built for Premier Health, Bermuda\n\n## Status: \u2705 Phase 1 Complete - MVP Deployed\n\n**Version:** v0.3.0  \n**Server:** 192.168.65.239 (premier-emr)  \n**Production URL:** https://emr.rize.bm  \n**SSH Access:** https://emr-ssh.rize.bm  \n**Homebase:** http://192.168.65.243:8000/projects\n\n---\n\n## Overview\n\nPremier Health EMR is a next-generation electronic medical records system designed specifically for the Bermuda healthcare market. Built with AI at its core\u2014not bolted on\u2014it features ambient clinical documentation, intelligent scheduling, HIPAA-compliant audit trails, and PIPA (Bermuda Personal Information Protection Act) compliance.\n\n### Key Differentiators\n\n| Feature | Premier EMR | Epic/Cerner/AthenaHealth |\n|---------|-------------|--------------------------|\n| **AI Integration** | Native (Claude API) | Bolted on |\n| **UX Philosophy** | Max 3 clicks to any action | Click-heavy, cluttered |\n| **Bermuda Compliance** | Built-in (PIPA + HIPAA) | Retrofitted |\n| **Offline Capability** | Yes (PWA) | No |\n| **Target Market** | Mid-market practices | Enterprise only |\n| **Cost** | Affordable | 00k+ implementations |\n\n---\n\n## Tech Stack\n\n| Component | Technology |\n|-----------|------------|\n| Backend | FastAPI (Python 3.12) |\n| Frontend | React + Vite + Tailwind CSS |\n| Database | PostgreSQL 16 |\n| Container | Docker + Docker Compose |\n| AI | Anthropic Claude API |\n| Tunnel | Cloudflare (emr.rize.bm) |\n| Server | Ubuntu 24.04 LTS on Hyper-V |\n| Monitoring | Homebase Dashboard |\n\n---\n\n## Quick Start\n\n### Prerequisites\n- Docker and Docker Compose installed\n- PostgreSQL 16 running\n- Node.js 24.x LTS\n\n### Development\n```bash\n# Clone the repository\ngit clone git@github.com:Rize-Technologies/premier-emr.git\ncd premier-emr\n\n# Copy environment variables\ncp .env.example .env\n# Edit .env with your credentials\n\n# Start services\ndocker compose up -d\n\n# Access the application\n# Frontend: http://localhost:3000\n# Backend API: http://localhost:5000/api\n# API Docs: http://localhost:5000/docs\n```\n\n### Production Deployment\n```bash\n# SSH to server\nssh emradmin@192.168.65.239\n\n# Run deploy script\n~/deploy.sh\n\n# Check status\ndocker compose ps\nsystemctl status cloudflared\n\n# Homebase check-in\n~/scripts/checkin.sh Premier-EMR 0.2.1 Deployment healthy\n```\n\n---\n\n## Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Cloudflare Tunnel                        \u2502\n\u2502               emr.rize.bm | emr-ssh.rize.bm                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Premier-EMR Server                         \u2502\n\u2502                    192.168.65.239                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502                     \u2502\n                    \u25bc                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     React Frontend      \u2502  \u2502       FastAPI Backend           \u2502\n\u2502    (Port 3000)         \u2502  \u2502        (Port 5000)              \u2502\n\u2502                        \u2502  \u2502   \u2022 REST API                    \u2502\n\u2502  \u2022 Dashboard           \u2502  \u2502   \u2022 Claude AI Integration       \u2502\n\u2502  \u2022 Patient Chart       \u2502  \u2502   \u2022 HIPAA Audit Middleware      \u2502\n\u2502  \u2022 Scheduling          \u2502  \u2502   \u2022 JWT Authentication          \u2502\n\u2502  \u2022 AI Assistant        \u2502  \u2502                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                        \u2502\n                                        \u25bc\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                          \u2502      PostgreSQL         \u2502\n                          \u2502    (premier_emr)       \u2502\n                          \u2502                        \u2502\n                          \u2502  \u2022 Patients (50)       \u2502\n                          \u2502  \u2022 Providers (5)       \u2502\n                          \u2502  \u2022 Appointments (200)  \u2502\n                          \u2502  \u2022 Clinical Notes      \u2502\n                          \u2502  \u2022 Prescriptions       \u2502\n                          \u2502  \u2022 Audit Logs          \u2502\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## API Endpoints\n\n| Method | Endpoint | Description |\n|--------|----------|-------------|\n| POST | /api/auth/login | User authentication |\n| GET | /api/patients | List patients |\n| GET | /api/patients/{id}/chart | Full patient chart |\n| POST | /api/appointments | Create appointment |\n| POST | /api/clinical-notes/ai-generate | AI SOAP note |\n| GET | /api/dashboard/stats | Dashboard KPIs |\n| GET | /api/audit-log | HIPAA audit log |\n\nFull API documentation: https://emr.rize.bm/api/docs\n\n---\n\n## Current Features (v0.2.1)\n\n### Deployed \u2705\n- Patient management (CRUD)\n- Provider management\n- Appointment scheduling\n- Prescription tracking\n- AI-powered clinical notes\n- Dashboard with statistics\n- JWT authentication\n- HIPAA audit logging\n- Cloudflare tunnel\n- Homebase monitoring\n\n### In Development \ud83d\udd04\n- Provider availability management\n- Calendar views (day/week/month)\n- Unit tests\n- Clinical note signing workflow\n- Drug interaction alerts\n\n---\n\n## Compliance\n\n### HIPAA (US Healthcare)\n- All patient data encrypted at rest and in transit\n- Complete audit trail of all data access\n- Role-based access control (RBAC)\n- Automatic session timeout\n- Minimum necessary access principle\n\n### PIPA (Bermuda Data Protection)\n- Data residency in Bermuda\n- Consent tracking for data processing\n- Right to access/delete personal data\n- Breach notification procedures\n\n---\n\n## Monitoring\n\n### Homebase Dashboard\n- URL: http://192.168.65.243:8000/projects\n- Project: Premier-EMR\n- Status: Healthy \u2705\n- Version: 0.2.1\n\n### Service Status\n```bash\n# Check all containers\ndocker compose ps\n\n# Check cloudflared tunnel\nsystemctl status cloudflared\n\n# Check backend health\ncurl localhost:5000/api/health\n\n# Check frontend\ncurl localhost:3000\n```\n\n---\n\n## Contributing\n\n1. Create a feature branch: `git checkout -b feature/your-feature`\n2. Make changes following the coding standards\n3. Write tests for new functionality\n4. Update TODO.md and CHANGELOG.md\n5. Run ~/deploy.sh to deploy\n6. Check in to Homebase\n7. Create a pull request\n\n---\n\n## Support\n\n- **Internal:** artiedarrell@gmail.com\n- **Client:** Premier Health IT Department\n- **Homebase:** http://192.168.65.243:8000\n\n---\n\n## License\n\nProprietary - Rize Technologies Ltd. All rights reserved.\n\n---\n\n*Built with \u2764\ufe0f in Bermuda by Rize Technologies*",
      "todo": "# Premier Health EMR - TODO\n\n> Priority: P0 = Critical, P1 = High, P2 = Medium, P3 = Low\n\n---\n\n## Phase 1 - Foundation \u2705 COMPLETED\n\n### P0 - Critical\n- [x] Server provisioning on Hyper-V (192.168.65.239)\n- [x] Ubuntu 24.04 installation and configuration\n- [x] Docker, Node.js, Python, PostgreSQL installation\n- [x] Project scaffolding and directory structure\n- [x] Project documentation (README, TODO, PROJECT_PLAN, CHANGELOG)\n- [x] Database schema design and migrations\n- [x] Authentication system (JWT + RBAC)\n- [x] HIPAA audit logging middleware\n- [x] Docker Compose stack (frontend, backend, db)\n- [x] Cloudflare tunnel setup (emr.rize.bm, emr-ssh.rize.bm)\n- [x] Homebase integration\n\n### P1 - High\n- [x] Patient CRUD operations\n- [x] Provider management\n- [x] Basic patient search functionality\n- [x] Docker Compose configuration\n- [x] React frontend scaffolding (Vite + Tailwind)\n- [x] AI-powered clinical note generation\n- [x] Dashboard with statistics\n- [x] Deploy script (~/deploy.sh)\n\n### P2 - Medium\n- [x] Login page UI\n- [x] Dashboard layout\n- [x] Patient list view\n- [ ] Unit tests setup\n\n---\n\n## Phase 2 - Clinical Features \ud83d\udfe1\n\n### P0 - Critical\n- [x] SOAP note templates \u2705\n- [x] AI-assisted note generation (Claude API) \u2705\n- [x] Clinical note signing workflow \u2705\n\n### P1 - High\n- [x] Prescription management\n- [x] Drug interaction alerts (basic) \u2705\n- [x] Allergy tracking (v0.3.0)\n- [x] Medication list\n\n### P2 - Medium\n- [x] Document upload (labs, imaging, referrals) \u2705\n- [ ] Clinical decision support alerts\n- [x] Vitals tracking (v0.3.0)\n- [x] Problem list management (v0.3.0)\n\n---\n\n## Phase 3 - Scheduling & Portal \ud83d\udfe1\n\n### P0 - Critical\n- [x] Appointment booking system\n- [x] Provider availability management \u2705\n- [x] Calendar views (day/week/month) \u2705\n\n### P1 - High\n- [x] Waitlist management \u2705\n- [ ] Appointment reminders (email)\n- [ ] Patient check-in workflow\n\n### P2 - Medium\n- [ ] SMS reminders integration\n- [ ] Patient portal (read-only)\n- [ ] Multi-location support\n- [ ] Recurring appointments\n\n---\n\n## Phase 4 - Analytics & Integrations \ud83d\udfe1\n\n### P0 - Critical\n- [x] Executive dashboard with KPIs\n- [ ] Patient volume metrics\n- [ ] Provider productivity reports\n\n### P1 - High\n- [ ] Predictive analytics (no-show risk)\n- [ ] HL7 FHIR compliance layer\n- [ ] Basic billing module\n\n### P2 - Medium\n- [ ] Lab integration APIs\n- [ ] Pharmacy integration\n- [ ] Insurance verification\n- [ ] Multi-currency support (BMD/USD)\n\n---\n\n## Phase 5 - Mobile & Offline \ud83d\udfe1\n\n### P0 - Critical\n- [ ] Progressive Web App (PWA) setup\n- [ ] Offline data persistence\n\n### P1 - High\n- [ ] Mobile-optimized clinical workflows\n- [ ] Push notifications\n\n### P2 - Medium\n- [ ] Offline appointment booking\n- [ ] Data sync conflict resolution\n\n---\n\n## Next Priorities\n\n### Immediate (Next Sprint)\n1. Provider availability management\n2. Calendar views (day/week/month)\n3. Unit tests setup\n4. Clinical note signing workflow\n5. Drug interaction alerts\n\n### Short-term (2-4 weeks)\n1. Document upload module\n2. Vitals tracking\n3. Appointment reminders\n4. Patient portal (read-only)\n\n---\n\n## Bugs \ud83d\udc1b\n\n*No bugs tracked yet*\n\n---\n\n## Technical Debt \ud83d\udd27\n\n- [ ] Add comprehensive error handling throughout backend\n- [ ] Implement request rate limiting\n- [ ] Add API versioning strategy\n- [ ] Database connection pooling optimization\n- [ ] Add end-to-end tests\n- [ ] CI/CD pipeline setup\n\n---\n\n## Documentation \ud83d\udcda\n\n- [x] README.md\n- [x] TODO.md\n- [x] PROJECT_PLAN.md\n- [x] CHANGELOG.md\n- [x] CLAUDE.md\n- [ ] API.md (OpenAPI spec)\n- [ ] ARCHITECTURE.md (detailed)\n- [ ] DEPLOYMENT.md\n- [ ] DEMO_SCRIPT.md\n\n---\n\n*Last updated: 2026-02-04 (v0.3.0)*",
      "changelog": "# Changelog - Premier Health EMR\n\n## [0.4.0] - 2026-02-06\n\n### Added\n\n### Added (continued)\n- **Document Upload Module**:\n  - POST /api/documents/upload - Upload with multipart form\n  - GET /api/documents/patient/{id} - List patient documents\n  - GET /api/documents/{id} - Get document metadata\n  - POST /api/documents/{id}/review - Mark as reviewed\n  - GET /api/documents/queue/pending-review - Review queue\n  - Supported types: PDF, JPG, PNG, DOC, DOCX, TXT\n  - SHA-256 hashing for integrity/deduplication\n  - HIPAA audit logging on all operations\n\n- **Waitlist Management**:\n  - POST /api/waitlist - Add patient to waitlist\n  - GET /api/waitlist - List waitlist by priority\n  - GET /api/waitlist/stats - Waitlist statistics\n  - POST /api/waitlist/{id}/contact - Record contact attempt\n  - POST /api/waitlist/{id}/schedule - Mark as scheduled\n  - Priority levels: Urgent, High, Normal, Low\n  - Preferred days/times tracking\n  - Contact attempt history\n\n- **Calendar API**: Day, week, month, upcoming views for appointment scheduling\n- **Provider Availability**: GET availability, PUT schedule management, POST time blocking\n- **SOAP Note Templates**: 6 clinical templates (General Visit, Follow-up, Acute Illness, Chronic Management, Preventive Care, Telehealth)\n- **Enhanced Signing Workflow**:\n  - Co-signature endpoint for supervising physicians\n  - Addendum creation for signed notes\n  - Unsigned notes queue\n  - Pending co-signature queue\n- **Drug Interaction Service**: Local database with 20+ critical interactions\n  - Severity levels: Contraindicated, Major, Moderate, Minor\n  - Drug class mapping (SSRIs, MAOIs, opioids, benzos, NSAIDs, etc.)\n  - Allergy cross-reactivity checking (penicillin, sulfa, NSAID)\n- **New API Endpoints**:\n  - `GET /api/calendar/day` - Day view\n  - `GET /api/calendar/week` - Week view\n  - `GET /api/calendar/month` - Month view\n  - `GET /api/calendar/upcoming` - Upcoming appointments\n  - `GET /api/calendar/stats` - Appointment statistics\n  - `GET /api/providers/{id}/availability` - Provider availability\n  - `PUT /api/providers/{id}/schedule` - Update weekly schedule\n  - `POST /api/providers/{id}/block-time` - Block time off\n  - `GET /api/clinical-notes/templates` - List SOAP templates\n  - `GET /api/clinical-notes/templates/{id}` - Get specific template\n  - `POST /api/clinical-notes/{id}/cosign` - Co-sign note\n  - `POST /api/clinical-notes/{id}/addendum` - Add addendum\n  - `GET /api/clinical-notes/queue/unsigned` - Unsigned notes queue\n  - `GET /api/clinical-notes/queue/pending-cosign` - Pending co-signature\n  - `POST /api/prescriptions/check-interactions` - Check drug interactions\n  - `GET /api/prescriptions/patient/{id}/check/{medication}` - Patient-specific check\n\n### Changed\n- Updated clinical notes model with enhanced signing workflow fields\n- Improved prescription workflow with integrated interaction checking\n\n# Premier Health EMR - Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n---\n\n## [Unreleased]\n\n### Planned\n- Alembic migrations for schema versioning\n- Password reset flow\n- Patient portal integration\n- Lab results module\n- Provider availability management\n- Calendar views (day/week/month)\n- Unit tests\n\n---\n\n## [0.3.1] - 2026-02-04\n\n### Added - Role-Based Access Control (RBAC)\n- **Role Model**: 10 hierarchical roles with level-based permissions\n  - system_admin (100), practice_manager (90), physician (80)\n  - nurse_practitioner (75), registered_nurse (60), medical_assistant (50)\n  - billing_specialist (40), lab_technician (35), receptionist (30), read_only (10)\n- **Permission Model**: 32 granular permissions across resources\n  - system_settings:admin, users:manage, audit_log:read\n  - patients:create/read/update/delete, demographics:read/update\n  - appointments:create/read/update/delete\n  - clinical_notes:read/create/sign\n  - prescriptions:read/create/approve\n  - vitals:read/create, labs:order/read/enter_results\n  - billing:read/create/manage, reports:read/admin\n  - ai_assistant:use\n- **RBAC Middleware**: Permission-based route protection\n  - require_permission() - Single permission check\n  - require_any_permission() - Any of multiple permissions\n  - require_all_permissions() - All permissions required\n  - require_role_level() - Minimum hierarchy level check\n- **Roles API**: /api/roles endpoint for role management\n- **Enhanced Auth**: /me endpoint returns role_info and permissions array\n\n### Changed\n- Audit log routes now use require_audit_read permission\n- User model enhanced with role_id FK, has_permission(), get_role_level()\n\n### Security\n- Receptionist (level 30) blocked from audit-log (requires audit_log:read)\n- Practice Manager (level 90) granted audit access\n- All sensitive routes protected by permission middleware\n\n### Database\n- roles table: 10 roles with hierarchy levels\n- permissions table: 32 permissions\n- role_permissions junction table\n- users.role_id FK, users.password_changed_at columns\n- 4 new users: manager, billing, lab, np @premierhealth.bm\n\n---\n\n## [0.3.0] - 2026-02-04\n\n### Added - Data Model Enhancements\n- **Encounter Model**: New table linking appointments \u2192 notes \u2192 vitals \u2192 prescriptions per visit\n- **Allergy Model**: Proper relational table replacing JSON storage\n- **Problem Model**: Active diagnoses and conditions with ICD-10 codes\n- **Vitals Model**: Vital signs per encounter (BP, HR, RR, Temp, SpO2, Height, Weight, BMI)\n\n### Enhanced\n- **Patient Model**: Expanded demographics (address, insurance, emergency contacts)\n- **Appointment Model**: Enhanced status workflow with check-in tracking\n- **Clinical Note Model**: Signing workflow with co-sign and addendum support\n- **Prescription Model**: Enhanced tracking with discontinuation and controlled substance flags\n\n### Database\n- Migration script for v0.3.0 (migrate_v030.py)\n- Migrated 63 allergies from JSON to proper table\n- Created 73 problems, 69 encounters, 69 vitals records\n\n---\n\n## [0.2.1] - 2026-02-04\n\n### Added\n- **Cloudflare Tunnel**: Public access via emr.rize.bm and emr-ssh.rize.bm\n- **Homebase Integration**: Automatic health check-ins with status reporting\n- **Deploy Script**: Simple deployment script at ~/deploy.sh\n\n### Infrastructure\n- Cloudflared service installed and configured\n- Tunnel premier-emr (ID: c2b3d359-448f-4b3a-9e0e-d70bda5f2443)\n- DNS routing: emr.rize.bm \u2192 localhost:3000, emr-ssh.rize.bm \u2192 localhost:22\n- Homebase checkin script at ~/scripts/checkin.sh\n\n---\n\n## [0.2.0] - 2026-02-04\n\n### Added\n- **Docker Compose Stack**: Full containerized deployment (db, backend, frontend)\n- **PostgreSQL Database**: Schema with patients, providers, appointments, prescriptions, clinical_notes, audit_logs, users\n- **FastAPI Backend**: RESTful API on port 5000 with JWT authentication\n- **AI Integration**: Claude-powered clinical note generation and medical insights\n- **React Frontend**: Modern UI on port 3000\n- **Seed Data**: 50 patients, 5 providers, 200 appointments for testing\n\n---\n\n## [0.1.0] - 2026-02-04\n\n### Added\n- Initial project scaffolding\n- Server provisioned (192.168.65.239) with Docker, Node.js, Python 3.12, PostgreSQL 16\n\n---\n\n*Maintained by Rize Technologies*",
      "todos_parsed": [
        {
          "text": "Server provisioning on Hyper-V (192.168.65.239)",
          "done": true
        },
        {
          "text": "Ubuntu 24.04 installation and configuration",
          "done": true
        },
        {
          "text": "Docker, Node.js, Python, PostgreSQL installation",
          "done": true
        },
        {
          "text": "Project scaffolding and directory structure",
          "done": true
        },
        {
          "text": "Project documentation (README, TODO, PROJECT_PLAN, CHANGELOG)",
          "done": true
        },
        {
          "text": "Database schema design and migrations",
          "done": true
        },
        {
          "text": "Authentication system (JWT + RBAC)",
          "done": true
        },
        {
          "text": "HIPAA audit logging middleware",
          "done": true
        },
        {
          "text": "Docker Compose stack (frontend, backend, db)",
          "done": true
        },
        {
          "text": "Cloudflare tunnel setup (emr.rize.bm, emr-ssh.rize.bm)",
          "done": true
        },
        {
          "text": "Homebase integration",
          "done": true
        },
        {
          "text": "Patient CRUD operations",
          "done": true
        },
        {
          "text": "Provider management",
          "done": true
        },
        {
          "text": "Basic patient search functionality",
          "done": true
        },
        {
          "text": "Docker Compose configuration",
          "done": true
        },
        {
          "text": "React frontend scaffolding (Vite + Tailwind)",
          "done": true
        },
        {
          "text": "AI-powered clinical note generation",
          "done": true
        },
        {
          "text": "Dashboard with statistics",
          "done": true
        },
        {
          "text": "Deploy script (~/deploy.sh)",
          "done": true
        },
        {
          "text": "Login page UI",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "0.4.0",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "4a81291 RBAC seeded: 4 users, 10 roles, 32 permissions. Docker compose operational (23 minutes ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3004,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 5004,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO-SCRIPT.md",
        "DEPLOYMENT.md",
        "PROJECT_PLAN.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/seed.py",
        "docs/ARCHITECTURE.md",
        "docs/DEMO_SCRIPT.md",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 100
    },
    {
      "name": "Helios AI",
      "server": "demos",
      "type": "demo",
      "path": "/home/demos/helios",
      "domain": "helios.rize.bm",
      "ports": [
        3005
      ],
      "scanned_at": "2026-02-07T23:10:43.214127+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ARCHITECTURE.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEMO-SCRIPT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "API.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": ".env.example",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ROADMAP.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# BMA Document AI - Intelligent Data Management Platform\n\nBMA Document AI is a comprehensive platform that combines artificial intelligence with data management to help you work smarter, not harder. Our platform integrates with your existing email and file storage services, providing AI-powered search, analysis, and assistance across all your data.\n\n## \ud83d\ude80 Features\n\n### Core Features\n\n- **AI Chat**: Interactive AI conversations with streaming responses and chat history storage\n- **AI Prompts**: Create and manage custom AI prompt templates for specific use cases\n- **Email Management**: Connect and manage emails from Gmail and Microsoft Outlook\n- **File Management**: Access and manage files from Google Drive and Microsoft OneDrive\n- **Data Lake**: Centralized data repository with advanced search capabilities\n- **Semantic Search**: Powerful search across all your data sources\n\n### Administrative Features\n\n- **User Management**: Manage users, assign roles, and control access permissions\n- **Group Management**: Create and manage user groups for better organization\n- **Prompt Management**: Create and manage AI prompt templates for your organization\n- **Permissions**: Configure detailed access controls and permissions\n\n## \ud83d\udee0\ufe0f Technology Stack\n\n### Frontend\n\n- **React 18** - Modern React with hooks and functional components\n- **Bootstrap 5** - Responsive UI framework\n- **TailwindCSS** - Utility-first CSS framework\n- **Reactstrap** - Bootstrap components for React\n- **Redux & Redux Saga** - State management\n- **React Router** - Client-side routing\n\n### Backend\n\n- **FastAPI** - Modern Python web framework\n- **SQLAlchemy** - SQL toolkit and ORM\n- **PostgreSQL** - Primary database\n- **Alembic** - Database migrations\n- **OpenAI API** - AI model integration\n- **OAuth 2.0** - Authentication with Google and Microsoft\n\n### AI & Search\n\n- **OpenAI GPT Models** - Advanced language models\n- **Vector Database** - Semantic search capabilities\n- **Embedding Generation** - Text-to-vector conversion\n- **Streaming Responses** - Real-time AI interactions\n\n## \ud83d\udccb Prerequisites\n\n- Node.js >= 16\n- Python >= 3.8\n- PostgreSQL >= 12\n- Docker & Docker Compose (optional)\n\n## \ud83d\ude80 Quick Start\n\n### Using Docker (Recommended)\n\n1. **Clone the repository**\n\n   ```bash\n   git clone <repository-url>\n   cd helios\n   ```\n\n2. **Set up environment variables**\n\n   ```bash\n   cp .env.example .env\n   # Edit .env with your configuration\n   ```\n\n3. **Start the application**\n\n   ```bash\n   docker-compose up -d\n   ```\n\n4. **Access the application**\n   - Frontend: http://localhost:3000\n   - Backend API: http://localhost:8000\n   - API Documentation: http://localhost:8000/docs\n\n### Manual Setup\n\n#### Backend Setup\n\n1. **Create virtual environment**\n\n   ```bash\n   cd backend\n   python -m venv venv\n   source venv/bin/activate  # On Windows: venv\\Scripts\\activate\n   ```\n\n2. **Install dependencies**\n\n   ```bash\n   pip install -r requirements.txt\n   ```\n\n3. **Set up database**\n\n   ```bash\n   # Configure your database connection in .env\n   # Run migrations\n   alembic upgrade head\n   ```\n\n4. **Start the backend**\n   ```bash\n   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000\n   ```\n\n#### Frontend Setup\n\n1. **Install dependencies**\n\n   ```bash\n   cd frontend\n   npm install\n   ```\n\n2. **Start the development server**\n   ```bash\n   npm start\n   ```\n\n## \ud83d\udd27 Configuration\n\n### Environment Variables\n\nCreate a `.env` file in the root directory with the following variables:\n\n```env\n# Database\nDATABASE_URL=postgresql://username:password@localhost:5432/helios_db\n\n# OpenAI\nOPENAI_API_KEY=your_openai_api_key\n\n# Admin User\nADMIN_EMAIL=admin@example.com\nADMIN_PASSWORD=secure_password\n\n# OAuth (Google)\nGOOGLE_CLIENT_ID=your_google_client_id\nGOOGLE_CLIENT_SECRET=your_google_client_secret\n\n# OAuth (Microsoft)\nMICROSOFT_CLIENT_ID=your_microsoft_client_id\nMICROSOFT_CLIENT_SECRET=your_microsoft_client_secret\n\n# Security\nSECRET_KEY=your_secret_key\nJWT_SECRET=your_jwt_secret\n```\n\n## \ud83d\udcd6 Usage Guide\n\n### Getting Started\n\n1. **Authentication**: Sign in using your Google or Microsoft account, or create a new account with email and password\n2. **Connect Accounts**: Go to Settings (accessible from your profile) to connect your Gmail, Outlook, Google Drive, and OneDrive accounts for data integration\n3. **Start Chatting**: Use the AI Chat feature to ask questions about your data or get assistance with tasks\n4. **Explore Data**: Browse your emails, files, and use the search functionality to find specific information\n5. **Create Prompts**: Build custom AI prompt templates for specific workflows and use cases\n\n### Account Connections\n\nTo enable email and file integration, users must connect their accounts through the Settings page:\n\n1. **Access Settings**: Click on your profile picture/name in the top navigation, then select \"Settings\"\n2. **Google Integration**: Click \"Login with Google\" to connect Gmail and Google Drive\n3. **Microsoft Integration**: Click \"Login with Microsoft\" to connect Outlook and OneDrive\n4. **Security**: Your data remains secure with OAuth 2.0 authentication and minimal required permissions\n5. **Management**: Disconnect accounts at any time through the Settings page\n\n### AI Chat Features\n\n- **Real-time Streaming**: Get AI responses as they're generated\n- **Chat History**: All conversations are automatically stored and searchable\n- **Context Awareness**: AI remembers previous conversations\n- **Multiple Models**: Support for OpenAI GPT and Ollama models\n\n### Data Integration\n\n- **Email Integration**: Connect Gmail and Outlook for email analysis\n- **File Integration**: Access Google Drive and OneDrive files\n- **Vector Search**: Advanced semantic search across all data\n- **Data Embedding**: Automatic content embedding for AI analysis\n\n### Administrative Tools\n\n- **User Management**: Create, edit, and manage user accounts\n- **Group Management**: Organize users into groups with specific permissions\n- **Prompt Templates**: Create reusable AI prompt templates\n- **Access Control**: Fine-grained permission management\n\n## \ud83d\udd12 Security Features\n\n- **OAuth 2.0 Authentication**: Secure login with Google and Microsoft\n- **Role-Based Access Control**: Granular permissions system\n- **Encrypted Data Storage**: All sensitive data is encrypted\n- **Session Management**: Secure session handling\n- **API Rate Limiting**: Protection against abuse\n\n## \ud83e\uddea Testing\n\n### Backend Tests\n\n```bash\ncd backend\npytest\n```\n\n### Frontend Tests\n\n```bash\ncd frontend\nnpm test\n```\n\n## \ud83d\udcda API Documentation\n\nThe API documentation is automatically generated and available at:\n\n- Swagger UI: http://localhost:8000/docs\n- ReDoc: http://localhost:8000/redoc\n\n## \ud83e\udd1d Contributing\n\n1. Fork the repository\n2. Create a feature branch (`git checkout -b feature/amazing-feature`)\n3. Commit your changes (`git commit -m 'Add amazing feature'`)\n4. Push to the branch (`git push origin feature/amazing-feature`)\n5. Open a Pull Request\n\n## \ud83d\udcc4 License\n\nThis project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.\n\n## \ud83c\udd98 Support\n\nIf you need assistance with BMA Document AI or have questions about any features, please:\n\n- Check the About page in the application\n- Contact your system administrator\n- Refer to the platform documentation\n- Open an issue on GitHub\n\n## \ud83d\udd04 Changelog\n\n### v1.0.0\n\n- Initial release\n- AI Chat with streaming responses\n- Email and file integration\n- Vector search capabilities\n- Administrative dashboard\n- OAuth authentication\n- Chat history storage\n\n---\n\n**BMA Document AI** - Empowering your data with artificial intelligence.",
      "todo": "# Helios TODO\n\n## Security Review Summary (Feb 2, 2026)\nChatGPT codebase audit identified 7 findings. Categorized below by demo-blocking vs post-demo hardening.\n\n---\n\n## P0 - CRITICAL (Demo Blockers)\n\n### Security - Must Fix Before Any External Demo\n- [ ] **Rotate all exposed secrets** - credentials.json, encryption_key.key, hardcoded passwords in docker-compose.yml, alembic.ini, connection.py, auth.py, frontend config are ALL compromised since they're in git history\n- [ ] **Remove secrets from repo** - add .gitignore entries, use .env for all secrets, run `git filter-branch` or BFG to scrub history\n- [ ] **Fix path traversal in file upload/download** - shared_files.py uses user-controlled folder/file names in os.path.join without safe resolution. Store by server-generated IDs, validate absolute paths against base directory\n- [ ] **Fix XSS via dangerouslySetInnerHTML** - AiPromptContent.jsx, EmailModal.jsx, SearchBar.jsx, EmailToolbar.js all render untrusted HTML. Add DOMPurify sanitization or render as plain text\n- [ ] **Fix auth middleware bypass** - /admin/groups paths skip auth checks. Remove bypass, require auth on ALL admin routes\n- [ ] **Fix token handling** - refresh token has hardcoded secret, broken datetime, Redis storage not namespaced per user. Rebuild to fail-closed if secrets missing\n\n### Infrastructure - Demo Readiness\n- [ ] Verify all 5 Docker containers healthy (backend, frontend, weaviate, redis, postgres)\n- [ ] Create BDIC demo user account\n- [ ] Test AI chat functionality end-to-end\n- [ ] Setup Cloudflare tunnel for helios.rize.bm\n- [ ] Load sample BDIC-relevant documents for demo\n- [ ] Test semantic search with sample docs\n- [ ] Verify document upload/download workflow\n\n---\n\n## P1 - HIGH (Demo Polish / Pre-Production)\n\n### Security Hardening\n- [ ] **Stop logging document content** - remove `logger.info(f\"conditions : {conditions}\")` and similar in ai_process.py. Add log redaction\n- [ ] **Policy gate for external AI models** - when internet mode enabled, document content goes to external providers. Add explicit approval toggle for regulated tenants, default OFF\n- [ ] **Protect content integrity** - embedding_generator.py text \"cleanup\" alters extracted text (names, numbers, capitalization). Store raw extracted text as source of truth, keep normalized text as separate derived field\n- [ ] **Remove wildcard CORS** - restrict to specific origins\n- [ ] **Add CSP headers** - prevent XSS even if sanitization is bypassed\n- [ ] Add malware scanning on document upload\n\n### Demo Experience\n- [ ] Create demo walkthrough script for BDIC\n- [ ] Screenshot/record key features\n- [ ] Configure email integration (OAuth) if needed for demo\n- [ ] Prepare presentation deck\n- [ ] Test with realistic BDIC document types (regulatory filings, compliance docs, etc.)\n\n---\n\n## P2 - MEDIUM (Post-Demo Hardening)\n\n### Security & Compliance\n- [ ] **Chunk-level indexing with citations** - return search results as references + short snippets, not full document content\n- [ ] **Object-level RBAC** - enforce permissions in every retrieval query, not just UI layer\n- [ ] **Encryption & key management** - KMS-backed keys, rotation, no keys in containers/repos\n- [ ] **Audit trails** - who accessed what, when, how (search, view, export, AI), with retention controls\n- [ ] **Tokens out of localStorage** - use httpOnly cookies for regulated tenants\n- [ ] Production SSL certs (Let's Encrypt via Cloudflare)\n- [ ] Decide compliance target: SOC 2, ISO 27001, or Bermuda PIPA-driven control set\n- [ ] Add secret scanning in CI/CD pipeline\n- [ ] API rate limiting\n\n### Infrastructure\n- [ ] Backup strategy (database + uploaded documents)\n- [ ] Add to Homebase monitoring\n- [ ] Performance tuning\n- [ ] Database migration strategy\n\n---\n\n## P3 - LOW (Future Roadmap)\n- [ ] Multi-tenant support with proper isolation\n- [ ] On-prem inference option (restrict external model calls entirely)\n- [ ] Redaction layer for external AI calls (strip PII before sending)\n- [ ] Advanced analytics & usage reporting\n- [ ] Mobile-responsive improvements\n- [ ] Automated compliance reporting\n\n---\n\n## Completed\n- [x] VM provisioned (.240 / heliosdev)\n- [x] Ubuntu 24.04 + Docker v29.2.1 + Compose v5.0.2\n- [x] Security (UFW, fail2ban, SSH keys, subnet whitelisted)\n- [x] SSH key auth configured\n- [x] Passwordless sudo for heliosdev\n- [x] Git repo cloned\n- [x] API keys configured (OpenAI, Gemini, Anthropic)\n- [x] SSL self-signed certs generated\n- [x] Environment files created\n- [x] Project docs created (PROJECT_PLAN, TODO, CHANGELOG, CLAUDE.md)\n- [x] Docker stack initiated\n- [x] ChatGPT security review completed\n\n---\n\n## Decision Log\n| Date | Decision | Rationale |\n|------|----------|-----------|\n| 2026-02-02 | BMA demo on hold, pivoting to BDIC | Client priority shift |\n| 2026-02-02 | Security fixes before demo | Can't demo regulated tool with path traversal and XSS |\n| 2026-02-02 | Raw text preservation required | BDIC is a regulator - altered document text kills legal defensibility |\n\nLast Updated: 2026-02-02",
      "changelog": "# Helios Changelog\n\n## [Unreleased] - Security Remediation\n### Security\n- Pending: Rotate all exposed secrets\n- Pending: Fix path traversal in shared_files.py\n- Pending: Fix XSS in React components\n- Pending: Fix auth middleware bypass\n- Pending: Fix token handling\n- Pending: Scrub git history\n\n---\n\n## [1.0.1] - 2026-02-02 (Security Review)\n\n### Changed\n- Target client changed from BMA to BDIC\n- Demo blocked pending security fixes\n\n### Security Audit Findings\n- **Critical**: Credentials exposed in git history (credentials.json, encryption_key.key, docker-compose.yml, alembic.ini, auth.py)\n- **Critical**: Path traversal vulnerability in shared_files.py\n- **Critical**: XSS via dangerouslySetInnerHTML in 4 React components\n- **Critical**: Auth middleware bypass on /admin/groups routes\n- **High**: Token handling issues (hardcoded secret, broken datetime)\n- **Medium**: Document content logged to console\n- **Medium**: Wildcard CORS enabled\n\n### Added\n- Comprehensive security-focused TODO.md\n- Decision log tracking client pivot and security prioritization\n\n---\n\n## [1.0.0] - 2026-02-02 (Initial Deployment)\n\n### Added\n- VM provisioned at 192.168.65.240 (heliosdev)\n- Ubuntu 24.04 LTS\n- Docker v29.2.1 + Compose v5.0.2\n- Self-signed SSL certificates\n- Security: UFW (22,80,443,2222), fail2ban with subnet whitelist\n- SSH key authentication from claudedev\n- Passwordless sudo for heliosdev\n- Project documentation (PROJECT_PLAN.md, TODO.md, CHANGELOG.md, CLAUDE.md)\n- API keys configured (OpenAI, Gemini, Anthropic)\n\n### Stack\n- Frontend: React 18, Bootstrap 5, TailwindCSS, Redux\n- Backend: FastAPI, SQLAlchemy, PostgreSQL 15\n- AI: OpenAI GPT, Google Gemini, Anthropic Claude\n- Search: Weaviate vector DB\n- Cache: Redis\n\n---\n\n## [0.0.0] - Pre-deployment\n- Initial codebase from Rize-Technologies/helios-ai\n\n---\n\nLast Updated: 2026-02-02",
      "todos_parsed": [
        {
          "text": "**Rotate all exposed secrets** - credentials.json, encryption_key.key, hardcoded passwords in docker-compose.yml, alembic.ini, connection.py, auth.py, frontend config are ALL compromised since they're in git history",
          "done": false
        },
        {
          "text": "**Remove secrets from repo** - add .gitignore entries, use .env for all secrets, run `git filter-branch` or BFG to scrub history",
          "done": false
        },
        {
          "text": "**Fix path traversal in file upload/download** - shared_files.py uses user-controlled folder/file names in os.path.join without safe resolution. Store by server-generated IDs, validate absolute paths against base directory",
          "done": false
        },
        {
          "text": "**Fix XSS via dangerouslySetInnerHTML** - AiPromptContent.jsx, EmailModal.jsx, SearchBar.jsx, EmailToolbar.js all render untrusted HTML. Add DOMPurify sanitization or render as plain text",
          "done": false
        },
        {
          "text": "**Fix auth middleware bypass** - /admin/groups paths skip auth checks. Remove bypass, require auth on ALL admin routes",
          "done": false
        },
        {
          "text": "**Fix token handling** - refresh token has hardcoded secret, broken datetime, Redis storage not namespaced per user. Rebuild to fail-closed if secrets missing",
          "done": false
        },
        {
          "text": "Verify all 5 Docker containers healthy (backend, frontend, weaviate, redis, postgres)",
          "done": false
        },
        {
          "text": "Create BDIC demo user account",
          "done": false
        },
        {
          "text": "Test AI chat functionality end-to-end",
          "done": false
        },
        {
          "text": "Setup Cloudflare tunnel for helios.rize.bm",
          "done": false
        },
        {
          "text": "Load sample BDIC-relevant documents for demo",
          "done": false
        },
        {
          "text": "Test semantic search with sample docs",
          "done": false
        },
        {
          "text": "Verify document upload/download workflow",
          "done": false
        },
        {
          "text": "**Stop logging document content** - remove `logger.info(f\"conditions : {conditions}\")` and similar in ai_process.py. Add log redaction",
          "done": false
        },
        {
          "text": "**Policy gate for external AI models** - when internet mode enabled, document content goes to external providers. Add explicit approval toggle for regulated tenants, default OFF",
          "done": false
        },
        {
          "text": "**Protect content integrity** - embedding_generator.py text \"cleanup\" alters extracted text (names, numbers, capitalization). Store raw extracted text as source of truth, keep normalized text as separate derived field",
          "done": false
        },
        {
          "text": "**Remove wildcard CORS** - restrict to specific origins",
          "done": false
        },
        {
          "text": "**Add CSP headers** - prevent XSS even if sanitization is bypassed",
          "done": false
        },
        {
          "text": "Add malware scanning on document upload",
          "done": false
        },
        {
          "text": "Create demo walkthrough script for BDIC",
          "done": false
        }
      ],
      "todos_open": 20,
      "todos_done": 0,
      "version": "1.0.1",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "3dc0f66 Fixed env vars (ADMIN_EMAIL/PASSWORD), backend container recreated, all 5 containers healthy (23 minutes ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3005,
          "open": true,
          "http_code": 400,
          "healthy": true
        }
      ],
      "files": [
        ".vscode/settings.json",
        "API.md",
        "ARCHITECTURE.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEMO-SCRIPT.md",
        "DEPLOYMENT.md",
        "PROJECT_PLAN.md",
        "README.md",
        "ROADMAP.md",
        "TODO.md",
        "backend/credentials.json",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js"
      ],
      "health_score": 100
    },
    {
      "name": "Homebase",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/homebase",
      "domain": "homebase.rize.bm",
      "ports": [
        8000
      ],
      "scanned_at": "2026-02-07T23:10:56.787667+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "info",
          "message": "5 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Homebase - Monitor 8 servers",
      "todo": "# Homebase TODO\n\n## In Progress\n- [ ] Fleet page: add live disk/mem metrics from infra-scanner\n- [ ] Sentinel: integrate pipeline_monitor.py into 30-min checks\n- [ ] Infra Sheet: add credential reveal toggle\n\n## Backlog\n- [ ] Agent dashboard pages: add real-time heartbeat display\n- [ ] Research Scout: filter by date range\n- [ ] Audit results endpoint: POST /api/audit/results for Cortex\n- [ ] Mindmap: auto-generate from infrastructure.json agents\n- [ ] Settings: add maintenance window scheduling\n- [ ] Backups: add one-click backup trigger\n\n## Completed\n- [x] Nav reorganization: 22 pages \u2192 8 core pages, 7 nav items (2026-02-07)\n- [x] Fleet page merged Servers + Projects (2026-02-07)\n- [x] Infra Sheet merged Infrastructure + Credentials + Cheat Sheet (2026-02-07)\n- [x] Added nav to agent dashboard pages (2026-02-07)\n- [x] Redirects for old URLs (2026-02-07)",
      "changelog": "# Homebase Changelog\n\n## v1.3.0 (2026-02-07)\n- **NAV OVERHAUL**: Reorganized navigation: 22 pages \u2192 8 core pages, 7 nav items\n- NEW: Fleet page (merged Servers + Projects + Project Status)\n- NEW: Infra Sheet (merged Infrastructure + Credentials + Cheat Sheet)\n- Enhanced Sentinel with Security, Metrics, and Audit Trail tabs\n- Added nav bar to all agent dashboard pages (apex, aegis, david-bishop)\n- Deleted stale cheat-sheet-full.json\n- Added redirects for old URLs (/servers \u2192 /fleet, /cheat-sheet \u2192 /infra)\n- Fixed agent names in templates (Treasurer\u2192Apex, Watchman\u2192Aegis)\n- Fixed David Bishop port in infrastructure.json (9001\u21927070)\n\n## v1.2.0 (2026-02-06)\n- Added Settings, Research, Sentinel, Credentials pages\n- Research Scout with complaint filtering\n- infrastructure.json as single source of truth\n- Agent heartbeat system (5-minute intervals)\n- Pipeline monitor for Cortex/Sentinel oversight\n- Agent dashboard pages for Apex, Aegis, David Bishop\n- Azure Teams bot integration\n\n## v1.1.0 (2026-02-05)\n- Initial deployment with Dashboard, Servers, Projects, Agents\n- infra-scanner.py cron job\n- Basic alert system\n\n## v1.0.0 (2026-02-04)\n- First deployment of Homebase",
      "todos_parsed": [
        {
          "text": "Fleet page: add live disk/mem metrics from infra-scanner",
          "done": false
        },
        {
          "text": "Sentinel: integrate pipeline_monitor.py into 30-min checks",
          "done": false
        },
        {
          "text": "Infra Sheet: add credential reveal toggle",
          "done": false
        },
        {
          "text": "Agent dashboard pages: add real-time heartbeat display",
          "done": false
        },
        {
          "text": "Research Scout: filter by date range",
          "done": false
        },
        {
          "text": "Audit results endpoint: POST /api/audit/results for Cortex",
          "done": false
        },
        {
          "text": "Mindmap: auto-generate from infrastructure.json agents",
          "done": false
        },
        {
          "text": "Settings: add maintenance window scheduling",
          "done": false
        },
        {
          "text": "Backups: add one-click backup trigger",
          "done": false
        },
        {
          "text": "Nav reorganization: 22 pages \u2192 8 core pages, 7 nav items (2026-02-07)",
          "done": true
        },
        {
          "text": "Fleet page merged Servers + Projects (2026-02-07)",
          "done": true
        },
        {
          "text": "Infra Sheet merged Infrastructure + Credentials + Cheat Sheet (2026-02-07)",
          "done": true
        },
        {
          "text": "Added nav to agent dashboard pages (2026-02-07)",
          "done": true
        },
        {
          "text": "Redirects for old URLs (2026-02-07)",
          "done": true
        }
      ],
      "todos_open": 9,
      "todos_done": 5,
      "version": "1.3.0",
      "git": {
        "status": "dirty",
        "branch": "master",
        "last_commit": "0f03dd7 v1.3: Nav overhaul (9 items, no dropdown), fleet dedup, project detail with docs, agent depth (integrations/phase/daily output), mind map with servers, sentinel docs (README/TODO/roadmap), infra creds (9 logins, 5 API keys, SMTP, SSH), removed Treasurer/Watchman refs, updated PROJECT_PLAN + CLAUDE.md (24 minutes ago)",
        "changes": [
          {
            "status": "M",
            "file": "ata/agents.db"
          },
          {
            "status": "M",
            "file": "data/credential-scan.json"
          },
          {
            "status": "M",
            "file": "data/infrastructure.json"
          },
          {
            "status": "M",
            "file": "data/project-status.json"
          },
          {
            "status": "M",
            "file": "data/uptime.db"
          }
        ],
        "uncommitted_count": 5
      },
      "ports_status": [
        {
          "port": 8000,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        ".aider.chat.history.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEPLOYMENT.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RIZE-CHEATSHEET.md",
        "TODO.md",
        "backend/__init__.py",
        "backend/main.py",
        "data/alerts.json",
        "data/audit-fixes.json",
        "data/backup-freshness.json",
        "data/backup-report.json",
        "data/backup-status.json",
        "data/cheat-sheet-full.json",
        "data/credential-scan.json",
        "data/credentials.json",
        "data/discovery-queue.json",
        "data/infrastructure.json",
        "data/overlord-report.json",
        "data/project-status.json",
        "data/redteam_history.json",
        "data/security-scans.json",
        "data/sentinel-report.json",
        "docs/API.md",
        "docs/ARCHITECTURE.md",
        "docs/DEPLOYMENT.md",
        "docs/SENTINEL.md",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js",
        "pulse_data/latest_health.json",
        "scripts/test_history_api.py",
        "test_smtp.py"
      ],
      "health_score": 98
    },
    {
      "name": "Nexus",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/nexus",
      "domain": "nexus.rize.bm",
      "ports": [
        3002,
        3003
      ],
      "scanned_at": "2026-02-07T23:10:56.895936+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Nexus - IT Support Intelligence Platform\n\nUnified IT support platform aggregating client context from Halo PSA, Microsoft 365 (Teams, SharePoint, Email), PRTG monitoring, and AI providers. Provides a \"Client 360\" view enabling support staff to quickly understand client history, assets, tickets, network status, and communications in one place.\n\n## Quick Reference\n\n| Service | Port | Status |\n|---------|------|--------|\n| Backend API | 3001 | `sudo systemctl status nexus` |\n| PostgreSQL | 5432 | `docker compose ps` |\n| Redis | 6379 | `docker compose ps` |\n| Elasticsearch | 9200 | `docker compose ps` |\n\n## URLs\n- **Production:** https://nexus.rize.bm\n- **Local API:** http://localhost:3001\n- **SSH Access:** https://nexus-ssh.rize.bm\n- **PRTG:** https://prtg.rize.bm\n- **GitHub:** https://github.com/gadarrell99/context-ai\n\n## API Endpoints\n\n### Core APIs\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| `/health` | GET | Health check with memory stats |\n| `/api/companies` | GET | List all companies |\n| `/api/client360/:id` | GET | Full company context view |\n| `/api/clients` | GET | List all clients |\n| `/api/tickets` | GET | List all tickets |\n| `/api/search?q=` | GET | Elasticsearch search |\n| `/api/ask` | POST | AI query `{question}` |\n| `/api/settings` | GET/POST | View/update settings |\n\n### PRTG Monitoring APIs (v1.14.0)\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| `/api/prtg/status` | GET | Dashboard summary (down/warning/up counts) |\n| `/api/prtg/sensor/:objid` | GET | Single sensor details with PRTG link |\n| `/api/prtg/refresh` | POST | Force refresh PRTG cache |\n\n**Note:** PRTG API requires Cloudflare bypass configuration. See TODO.md for details.\n\n### Sync APIs\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| `/api/sync/clients` | POST | Sync Halo clients |\n| `/api/sync/users` | POST | Sync Halo users |\n| `/api/sync/tickets` | POST | Sync all Halo tickets |\n| `/api/sync/actions` | POST | Sync ticket actions |\n| `/api/sync/assets` | POST | Sync Halo assets |\n| `/api/sync/emails?email=` | POST | Sync user emails |\n| `/api/sync/sharepoint` | POST | Sync SharePoint docs |\n| `/api/sync/teams` | POST | Sync Teams messages |\n| `/api/sync/index` | POST | Rebuild search index |\n| `/api/sync/linking` | POST | Re-run client linking |\n\n### Relay Integration APIs\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| `/api/relay/context/:companyId` | GET | Full client context |\n| `/api/relay/search` | POST | Search across all data |\n| `/api/relay/ask` | POST | AI-powered Q&A |\n| `/api/relay/companies` | GET | List companies with stats |\n\n## Quick Start\n```bash\n# Start Docker services\ncd /opt/it-nexus && docker compose up -d\n\n# Start backend (if not using systemd)\ncd backend && npm run dev\n\n# Or restart systemd service\nsudo systemctl restart nexus\n```\n\n## Common Commands\n```bash\n# Check all services\ndocker compose ps && sudo systemctl status nexus --no-pager | head -5\n\n# View logs\nsudo journalctl -u nexus -f\n\n# Restart everything\ndocker compose restart && sudo systemctl restart nexus\n\n# Health check\ncurl http://localhost:3001/health\n\n# Test PRTG integration\ncurl http://localhost:3001/api/prtg/status\n```\n\n## File Structure\nSee: [docs/FILE_MAP.md](docs/FILE_MAP.md)\n\n## Configuration\nSee: [docs/SETUP.md](docs/SETUP.md)\n\n## Next Steps (TODO)\nSee: [TODO.md](TODO.md)\n\n## Changelog\nSee: [CHANGELOG.md](CHANGELOG.md)\n\n## AI Configuration\n- **Primary:** Anthropic Claude (recommended)\n- **Alternatives:** OpenAI GPT-4, Google Gemini\n- **Local Embeddings:** Ollama (nomic-embed-text)\n- Configure via `/api/settings` or database `settings` table\n\n## PRTG Configuration (v1.14.0)\nEnvironment variables in `.env`:\n- `PRTG_URL` - PRTG server URL (default: https://prtg.rize.bm)\n- `PRTG_USERNAME` - API username\n- `PRTG_PASSHASH` - API passhash authentication\n\n**Status:** Awaiting Cloudflare bypass configuration. See TODO.md for resolution options.\n\n## Data Sources\n| Source | Records | Sync Frequency |\n|--------|---------|----------------|\n| Companies (Halo) | 44 | Every 4 hours |\n| Clients (Halo) | 12 | Every 4 hours |\n| Tickets (Halo) | 30,780 | Every 4 hours |\n| Assets (Halo) | 50 | Every 4 hours |\n| Interactions (Email/Teams) | 259 | On-demand |\n| Documents (SharePoint) | 11,303 | On-demand |\n| PRTG Sensors | Real-time | 60-second cache |\n\n---\n\n*Version: 1.14.0 | Last updated: 2026-01-28*",
      "todo": "# Nexus - TODO List\n**Last Updated:** 2026-01-30\n\n---\n\n## Priority Legend\n- P0 - Critical/Blocking\n- P1 - High Priority\n- P2 - Medium Priority\n- P3 - Nice to Have\n\n---\n\n## Completed in v1.15.0\n\n### SharePoint Settings UI (P1 - DONE)\n- [x] **Settings panel created** - New SharePointSettingsPanel component in Settings view\n- [x] **Add settings** - Form to add include paths, exclude paths, and allowed sites\n- [x] **Delete settings** - Trash button to remove any setting\n- [x] **Color-coded lists** - Green for includes, red for excludes, blue for allowed sites\n- [x] **Real-time updates** - Changes reflect immediately via React Query\n\n---\n\n## Completed in v1.14.0\n\n## Completed in v1.14.2\n\n### Domain Display Fix (P2 - DONE)\n- [x] **Derive domain from client emails** - If company.domain not set, extract from first client email\n- [x] **Filter common providers** - Exclude gmail, hotmail, yahoo, outlook domains\n\n### Time-Off User Fix (P2 - DONE)\n- [x] **Match current user** - Time-off now uses logged-in user's email to find their ID\n- [x] **Passed currentUser prop** - TimeOffView receives current user data\n\n### SharePoint Configuration (P1 - DONE)\n- [x] **Folder filtering** - Management, Executive, HR, Personnel, Confidential, Board excluded\n- [x] **Include paths** - Only /Sales/ and /Technical/ indexed\n- [x] **Configuration in filters.ts** - SHAREPOINT_INCLUDE_PATHS, SHAREPOINT_EXCLUDE_PATHS\n\n### PRTG Integration (P1 - DONE)\n**Status:** Code complete - Awaiting Cloudflare bypass configuration\n\n- [x] **PRTG service created** (`backend/src/services/prtg/client.ts`)\n- [x] **API endpoints added**: `/api/prtg/status`, `/api/prtg/sensor/:id`, `/api/prtg/refresh`\n- [x] **Dashboard PRTG panel** - Shows down/warning/paused/up sensor counts\n- [x] **Credentials configured** - PRTG_URL, PRTG_USERNAME, PRTG_PASSHASH in .env\n- [x] **Direct links to PRTG** - Each sensor links to PRTG web UI\n\n**BLOCKER:** PRTG is behind Cloudflare bot protection. Needs one of:\n- Cloudflare Access service token for API\n- Internal IP/hostname bypass\n- Cloudflare WAF rule to whitelist Nexus IP (192.168.65.247)\n\n---\n\n## Completed in v1.13.0\n\n### SLA Breach Fix (P0 - DONE)\n- [x] **Fixed false SLA breaches** - Tickets with status 2/4/8/21/22 no longer show as breached\n- [x] **Tech engagement detection** - Status changes now correctly indicate tech response\n\n### AI Anti-Hallucination (P0 - DONE)\n- [x] **Require hard references** - AI must cite ticket #, asset names, or document names\n- [x] **Verification disclaimer** - Added warning if response lacks proper citations\n- [x] **Clearer prompts** - Strengthened instructions against making up data\n\n### Verified Working\n- [x] Dashboard shows 50 assets accurately\n- [x] Recent tickets are clickable with detail modal\n- [x] Client 360 shows open tickets, domains, contacts\n- [x] BEST Shipping mastersheet is indexed\n- [x] Authentication works via Cloudflare Access\n\n---\n\n## PENDING WORK\n\n### Cloudflare PRTG Bypass (P1 - STILL BLOCKING)\n- [ ] Configure Cloudflare Access service token for PRTG API\n- [ ] OR: Get internal PRTG IP/hostname that bypasses Cloudflare\n- [ ] OR: Add WAF rule to whitelist Nexus server IP\n- [ ] Test PRTG API access after bypass configured\n- [ ] Verify dashboard shows real sensor data\n\n### Frontend Time Off (P2 - DONE)\n- [x] Time off request form component (backend ready)\n- [x] Pending requests list with approve/deny buttons\n- [x] Admin approval interface\n- [x] Integration with user management via email matching\n\n---\n\n## Tech Debt\n\n### Performance\n- [ ] Implement incremental sync (only changed records)\n- [ ] Add database query caching\n- [ ] Optimize Elasticsearch indexing batch size\n\n### Code Quality\n- [ ] Add unit tests (Jest)\n- [ ] Add integration tests\n- [ ] Set up CI/CD pipeline\n- [ ] Add ESLint + Prettier\n\n### Monitoring (P1)\n- [ ] Set up health check endpoint monitoring\n- [ ] Configure alerts for service down events\n- [ ] Add Prometheus metrics endpoint\n\n### Cloudflare Access (P0 - Manual)\n- [ ] Configure Cloudflare Access policies in dashboard\n- [ ] Set @rize.bm email restriction\n- [ ] Test one-time PIN authentication\n\n---\n\n## Future Enhancements (P3)\n\n### AI Improvements\n- [ ] Semantic search with Ollama embeddings\n- [ ] RAG (Retrieval Augmented Generation) for better answers\n- [ ] Conversation history for follow-up questions\n\n### Dashboard Enhancements\n- [ ] Real-time WebSocket updates\n- [ ] Customizable dashboard widgets\n- [ ] User-specific dashboard preferences\n\n---\n\n*Last updated: 2026-01-28 by Claude Code*\n\n## Teams Sync Permission Issue (RESOLVED 2026-01-29)\n\nTeams sync now working after permissions granted in Azure Portal.\n\n**Current Status:** The app can access Users (87 found) and Emails, but Groups/Teams return 403 Forbidden.\n\n**Required Permissions to Add in Azure Portal:**\n1. Go to Azure Portal > App Registrations > Select the app (Client ID: b48dc8a2-ae77-4505-b117-02fafebed6e9)\n2. Go to API Permissions > Add permission > Microsoft Graph\n3. Add these Application permissions:\n   - `Group.Read.All` - to list Teams/groups\n   - `ChannelMessage.Read.All` - to read channel messages\n4. Click \"Grant admin consent\" after adding\n\n**Note:** These are Application permissions (not Delegated), since this is a daemon/background sync service.\n\n\n## Completed in v1.16.0\n\n### Admin Control Panel (Task 11 - DONE)\n- [x] Admin view in navigation\n- [x] User list with Name, Email, Role, Status, Department\n- [x] Add user functionality\n- [x] Edit user functionality\n- [x] Enable/Disable user toggle\n- [x] Role management (Admin, Manager, User, Staff)\n- [x] User search and filtering\n- [x] Audit log tracking and display\n\n### Service Status Monitor (Task 15 - DONE)\n- [x] Service Status widget on dashboard\n- [x] Google Workspace monitoring\n- [x] Microsoft 365 monitoring\n- [x] Cloudflare monitoring\n- [x] Auto-refresh every 5 minutes\n- [x] Status colors (green/yellow/red)\n- [x] Links to status pages\n\n### Time Off Conflict Detection API (Task 14 - DONE)\n- [x] GET /api/timeoff/conflicts endpoint\n- [x] Overlap detection for date ranges\n- [x] Threshold calculation (50% team max)\n- [x] Conflict warning messages",
      "changelog": "# Nexus Changelog\n\n## [2.0.0] - 2026-01-30\n\n### Changed\n- **RENAMED**: Project renamed from 'Context Hub' to 'Nexus'\n- Updated all branding, URLs, documentation\n- New URL: https://nexus.rize.bm (was context.rize.bm)\n- New service: nexus.service (was context-hub.service)\n- New path: /opt/nexus (was /opt/it-context-hub)\n- Docker containers: nexus-db, nexus-redis, nexus-es\n\n### Infrastructure\n- systemd service renamed\n- Docker compose container names updated\n- All package.json files updated\n\n---\n\n## [1.16.4] - 2026-01-30\n\n### Verified - All Context Hub Tasks Complete\n\n#### Task 11: Admin Control Panel (v1.16.0)\n- Admin view in navigation with user management\n- User list: Name, Email, Role, Status, Department\n- Add/Edit/Enable/Disable users\n- Roles: Admin, Manager, User, Staff\n- User search/filtering\n- Audit log tracking\n\n#### Task 12: Time Off Request System (v1.16.1)\n- Time Off navigation item\n- Request form: Start Date, End Date, Type (Vacation/Sick/Personal/Other), Notes\n- User sees their requests with status (Pending/Approved/Denied)\n- API: POST /api/timeoff for submissions\n\n#### Task 13: Manager Time Off Approval (v1.16.2)\n- Pending requests list with Approve (green) and Deny (red) buttons\n- Review mutation calls POST /api/timeoff/:id/review\n- Status updates on approval/denial\n- Approved requests shown in separate section\n\n#### Task 14: Time Off Conflict Detection (v1.16.3)\n- Conflict check endpoint: GET /api/timeoff/conflicts\n- Overlap detection for date ranges\n- 50% team capacity threshold (configurable)\n- Conflict warning messages\n\n#### Task 15: Service Status Monitor (v1.16.4)\n- Service Status widget on dashboard\n- Monitors: Google Workspace, Microsoft 365, Cloudflare\n- Auto-refresh every 5 minutes\n- Status indicators: Operational/Degraded/Down\n- Links to external status pages\n\n## [1.15.6] - 2026-01-29\n\n### Added - AI Response Ticket Links\n- Ticket numbers in AI responses are now clickable\n- Regex matches #12345, ticket #12345, Ticket 12345 patterns\n- Links open Halo PSA ticket detail page in new tab\n- Blue underlined styling to indicate clickability\n\n## [1.15.5] - 2026-01-29\n\n### Fixed - Browser Back Button\n- Added browser history management using pushState/popstate\n- Back button now returns to previous Context Hub page\n- Forward button also works correctly\n- State (view, selected company) is preserved in history\n\n## [1.15.4] - 2026-01-29\n\n### Added - Client 360 Click Handlers\n- Stat cards (Documents, Assets, Tickets) are now clickable\n- Clicking scrolls to the relevant section\n- Added Documents section to Client 360 detail view\n- Documents show name, path, and link to SharePoint\n\n## [1.15.3] - 2026-01-29\n\n### Fixed - Ticket Count Discrepancy\n- Removed take: 50 limit from Client 360 detail ticket query\n- Removed take: 200 limit from AI service ticket query\n- All ticket counts now use full dataset without artificial limits\n- Ensures consistent counts between Dashboard, Client Detail, and AI\n\n## [1.15.2] - 2026-01-29\n\n### Fixed - Halo Ticket URL Format\n- Updated ticket URL format from /tickets/{id} to /Tickets/Ticket/{id}\n- Fixes: Clicking tickets went to \"page does not exist\"\n- Ticket links now open correct Halo PSA ticket detail page\n\n## [1.15.1] - 2026-01-29\n\n### Fixed - Gemini Model Error\n- Updated Gemini API model from deprecated gemini-pro to gemini-1.5-flash\n- Fixes: \"AI Error: models/gemini-pro is not found for API version v1\"\n- AI queries with Gemini provider now work correctly\n\n## [1.15.0] - 2026-01-29\n\n### Added - SharePoint Settings UI\n\n#### New Features\n- SharePoint Settings Panel - Added configurable UI in Settings view\n- Add/remove include paths (folders to index)\n- Add/remove exclude paths (folders to skip)\n- Add/remove allowed sites (SharePoint sites to crawl)\n- Real-time updates without page refresh\n\n#### Files Changed\n- frontend/src/App.tsx: Added SharePointSettingsPanel component\n- VERSION: Updated to 1.15.0\n- CHANGELOG.md: This entry\n\n## [1.14.1] - 2026-01-28\n\n### Fixed - Client360 White Page Bug (CH-001)\n\n#### Critical Bug Fix\n- **Fixed white page crash when clicking on clients in Client360 view**\n  - Root cause: Destructuring API response without null checks caused \"Cannot read properties of undefined\" error\n  - When API returned malformed or incomplete data, `const { company, emails } = data` would crash if `data.company` was undefined\n  - All subsequent property access (`company.name`, `company.clients`, etc.) would throw and cause React to show white page\n\n#### Code Changes (`frontend/src/App.tsx`)\n- Added safe data extraction with optional chaining: `const company = data?.company`\n- Added default empty array for emails: `const emails = data?.emails || []`\n- Added explicit null check: `if (error || \\!data || \\!company)`\n- Added user-friendly error UI with \"Back to clients\" button instead of white page\n- Error state now shows red-bordered card with AlertCircle icon and helpful message\n\n#### Impact\n- Users can now safely click on any client without risk of white page crash\n- If client data fails to load, users see helpful error message and can navigate back\n- No more console errors for \"Cannot read properties of undefined\"\n\n## [1.14.0] - 2026-01-28\n\n### Added - PRTG Network Monitoring Integration\n\n#### PRTG API Integration\n- **New PRTG monitoring service** (`backend/src/services/prtg/client.ts`)\n  - `fetchSensors(statusCodes)` - Fetch sensors filtered by status (down, warning, paused)\n  - `fetchAlerts(count)` - Get recent alert messages from PRTG\n  - `getSensorDetails(objid)` - Get details for a specific sensor\n  - `buildPrtgLink(objid)` - Build clickable link to PRTG UI\n  - `getStatusSummary()` - Aggregated dashboard summary with caching (1 min TTL)\n\n#### New API Endpoints\n- `GET /api/prtg/status` - Dashboard summary with down/warning/paused/up counts\n- `GET /api/prtg/sensor/:objid` - Single sensor details with PRTG link\n- `POST /api/prtg/refresh` - Force refresh of PRTG cache\n\n#### Dashboard PRTG Panel\n- **Network Monitoring panel on dashboard**\n  - Shows real-time sensor status (down, warning, paused, up counts)\n  - Lists down sensors with device names and error messages\n  - Lists warning sensors with expandable list\n  - Direct links to PRTG UI for each sensor\n  - \"All Systems OK\" indicator when no issues\n  - Auto-refreshes every 60 seconds\n  - Graceful error handling when PRTG unavailable\n\n#### Configuration\n- Added PRTG credentials to `.env`:\n  - `PRTG_URL` - PRTG server URL\n  - `PRTG_USERNAME` - API username\n  - `PRTG_PASSHASH` - API passhash authentication\n\n### Known Issues\n- **Cloudflare Challenge** - PRTG is behind Cloudflare bot protection\n  - API calls return Cloudflare challenge page instead of JSON\n  - Requires Cloudflare bypass configuration or internal IP access\n  - Integration code is complete and will work once access configured\n  - Dashboard shows \"Unavailable\" status with error message until resolved\n\n### Changed\n- Version updated to 1.14.0\n- Dashboard updated with PRTG monitoring section\n\n## [1.13.0] - 2026-01-27\n\n### Fixed\n\n#### SLA Breach Logic\n- **Fixed false SLA breaches for answered tickets**\n  - Tickets with status 2 (In Progress), 4 (Awaiting Response), 8 (Pending), \n    21 (Third Party), 22 (Awaiting Customer) are now correctly marked as tech-engaged\n  - Only tickets with status 1 (New) with no tech actions show as SLA breached\n  - Dashboard SLA counts now accurately reflect actual breaches\n\n#### AI Anti-Hallucination\n- **Strengthened AI response accuracy**\n  - Updated prompts to require specific references (ticket #, asset names, document names)\n  - Ticket lists now include Halo ticket IDs (e.g., #32415)\n  - Added verification disclaimer if response lacks proper citations\n  - Clear \"not in database\" messages when data unavailable\n\n#### Dashboard Activity Feed\n- **Recent activity now includes internal ticket ID** for reliable modal lookup\n\n### Already Working (Verified)\n- Dashboard shows 50 assets accurately\n- Recent tickets are clickable with full detail modal\n- Client 360 shows open ticket counts, domains, and all data correctly\n- BEST Shipping mastersheet is indexed in SharePoint\n- Authentication works via Cloudflare Access headers\n\n### Changed\n- Version updated to 1.13.0\n\n## [1.12.0] - 2026-01-27\n\n### Added - UI Overhaul & AI Improvements\n\n#### Dark Theme Dashboard\n- **Complete dark theme redesign** - Slate color scheme across all pages\n  - Dark sidebar with improved navigation styling\n  - Dark header with modern search bar\n  - All cards, tables, and buttons use dark theme\n  - Better contrast for SLA breach/warning indicators\n\n#### Company Domain Auto-Population\n- **Domain extraction from client emails** - Companies now show domains\n  - Automatically extracts most common domain from client emails\n  - Updates company records with inferred domains\n  - Excludes common email providers (gmail, yahoo, etc.)\n\n#### Ollama Integration for Local AI\n- **Ollama provider option** - Run AI queries locally for free\n  - Added llama3.2:3b model for chat queries\n  - nomic-embed-text already available for embeddings\n  - Settings page now includes Ollama as AI provider option\n  - Falls back gracefully if Ollama isn't running\n\n#### Multi-Source Search Indexing\n- **Expanded Elasticsearch indexing**\n  - Tickets: summary, details, status, actions\n  - Emails: subject, content, sender\n  - Teams messages: content, sender\n  - Documents (SharePoint): name, path\n  - Assets: name, type, serial number\n  - Cross-index search with fuzzy matching\n\n### Fixed\n\n#### AI Sensitive Data Detection\n- **Reduced false positives** - No longer blocks legitimate business queries\n  - Removed overly broad PII patterns\n  - Only detects explicit PII with keyword context (e.g., \"SSN: 123-45-6789\")\n  - Sensitive HR keywords now require exact phrase match\n  - Questions about assets, tickets, companies work without blocking\n\n#### Client 360 Click Handlers\n- **Fixed client card click navigation**\n  - Clicking a client card now properly navigates to detail view\n  - Added Globe icon to show domain info\n  - Back button resets selection correctly\n\n### Changed\n- Version updated to 1.12.0\n- Settings page shows API key status as \"Configured\" instead of masked dots\n- Added \"Refresh Client Linking and Domains\" button to settings\n\n### Infrastructure\n- Cron jobs running: syncs every 4 hours, backups at 2am/3am\n- Ollama service running on localhost:11434\n- Elasticsearch indexing all data sources\n\n## [1.12.0] - 2026-01-27\n\n### Added - UI Overhaul & AI Improvements\n\n#### Dark Theme Dashboard\n- **Complete dark theme redesign** - Slate color scheme across all pages\n  - Dark sidebar with improved navigation styling\n  - Dark header with modern search bar\n  - All cards, tables, and buttons use dark theme\n  - Better contrast for SLA breach/warning indicators\n\n#### Company Domain Auto-Population\n- **Domain extraction from client emails** - Companies now show domains\n  - Automatically extracts most common domain from client emails\n  - Updates company records with inferred domains\n  - Excludes common email providers (gmail, yahoo, etc.)\n\n#### Ollama Integration for Local AI\n- **Ollama provider option** - Run AI queries locally for free\n  - Added llama3.2:3b model for chat queries\n  - nomic-embed-text already available for embeddings\n  - Settings page now includes Ollama as AI provider option\n  - Falls back gracefully if Ollama isn't running\n\n#### Multi-Source Search Indexing\n- **Expanded Elasticsearch indexing**\n  - Tickets: summary, details, status, actions\n  - Emails: subject, content, sender\n  - Teams messages: content, sender\n  - Documents (SharePoint): name, path\n  - Assets: name, type, serial number\n  - Cross-index search with fuzzy matching\n\n### Fixed\n\n#### AI Sensitive Data Detection\n- **Reduced false positives** - No longer blocks legitimate business queries\n  - Removed overly broad PII patterns\n  - Only detects explicit PII with keyword context (e.g., \"SSN: 123-45-6789\")\n  - Sensitive HR keywords now require exact phrase match\n  - Questions about assets, tickets, companies work without blocking\n\n#### Client 360 Click Handlers\n- **Fixed client card click navigation**\n  - Clicking a client card now properly navigates to detail view\n  - Added Globe icon to show domain info\n  - Back button resets selection correctly\n\n### Changed\n- Version updated to 1.12.0\n- Settings page shows API key status as \"Configured\" instead of masked dots\n- Added \"Refresh Client Linking and Domains\" button to settings\n\n### Infrastructure\n- Cron jobs running: syncs every 4 hours, backups at 2am/3am\n- Ollama service running on localhost:11434\n- Elasticsearch indexing all data sources\n\n## [1.9.111] - 2026-01-27\n## [1.11.0] - 2026-01-27\n\n### Added - Dashboard Overhaul & AI Improvements\n- **New Operations Dashboard** - Complete redesign focused on ticket operations\n  - Active tickets count with real-time updates\n  - SLA breach tracking (red alerts for overdue tickets)\n  - SLA warning tracking (yellow alerts for approaching deadlines)\n  - Recent ticket activity feed (last 15 updates)\n  - Technician workload summary by team\n  - Removed client list (moved to Client 360)\n\n- **SLA Tracking** - Added SLA fields to ticket data\n  - respond_by and fix_by timestamps from Halo\n  - sla_excluded flag for excluded tickets\n  - Automatic SLA status calculation (breached, approaching, on track)\n\n- **Improved AI Query** - Multi-source search capability\n  - Searches across: tickets, assets, emails, SharePoint docs, Teams messages\n  - Smart company name extraction from questions\n  - Focused context when company is identified\n  - Asset counts by type per company\n  - Better aggregated answers for questions like \"How many PCs does BEST have?\"\n\n### Fixed\n- **Client 360** - Fixed click handlers for client selection\n  - Clicking clients now properly navigates to detail view\n  - Added back button for navigation\n  - Improved client card styling and interaction\n\n### Changed\n- **AI Provider** - Default changed from OpenAI to Anthropic (Claude)\n  - Settings page now shows Anthropic as recommended option\n  - Still supports OpenAI and Gemini as alternatives\n\n### Removed\n- **Review AI** - Removed from navigation (rarely used, confusing purpose)\n\n### Infrastructure\n- **Ollama** - Installed and configured for local embeddings\n  - Running on http://localhost:11434\n  - nomic-embed-text model pulled for semantic search\n\n\n\n### Fixed\n- **project_id validation** - API now accepts integers and auto-converts to strings\n  - Added Pydantic field_validator to coerce integer project_ids to strings\n  - Improved error message when invalid type is provided\n  - Updated API docstring to clarify project_id must be a STRING\n\n### Added\n- **COMMON_MISTAKES.md** - New documentation file with common API errors and solutions\n  - Documents project_id string requirement\n  - Lists other common mistakes and how to avoid them\n  - Located in ~/relay/docs/COMMON_MISTAKES.md\n\n### Improved\n- **CLAUDE.md** - Added note about project_id format in \"How to Test\" section\n\n\n## [1.9.110] - 2026-01-27\n\n### Added - Phase 10.x Complete\n- **Phase 10.2: Structured JSON outputs** - All agents now return structured JSON\n  - Commander returns: plan, steps, files_to_create, done_criteria\n  - Worker returns: files_created, verification_commands, summary\n  - Reviewer returns: approved, issues, suggestions\n  - Updated json_parser.py integration in worker_service.py\n  - Fixed Reviewer API to parse JSON instead of text-based approval\n\n- **Phase 10.3: Self-Fix Loop** - Retry mechanism with error context\n  - Worker retries up to 3 times on failure with error context\n  - Error history passed to subsequent attempts\n  - After 3 failures: escalate to Commander for alternative approach\n  - If still fails: mark task as blocked and track for user review\n  - Added retry_count tracking to job results\n\n- **Phase 10.4: Milestone-Based Execution** - Track progress per milestone\n  - Jobs with >5 steps grouped into milestones (5 steps each)\n  - Milestone tracker logs start and completion\n  - Progress tracking per milestone\n  - Event logging for milestone_complete\n  - Milestone failure tracking\n\n### Fixed\n- **Reviewer JSON parsing bug** - Reviewer API now correctly parses JSON responses\n  - Was using text-based \"APPROVE\" check, now uses JSON extraction\n  - Fallback to text-based check if JSON not found\n  - Properly returns approved field from JSON\n\n### Improved\n- Better logging for Commander, Worker, and Reviewer JSON data\n- Milestone progress visible in worker logs\n- Retry attempts logged with error context\n\n\n## [1.9.109] - 2026-01-26\n\n### Fixed\n- **REVIEWER_PROMPT format() error** - Escaped curly braces in JSON examples\n- JSON examples now use double braces to prevent KeyError\n- file_context placeholder remains unescaped for proper substitution\n\n\n# Changelog\n## [1.9.104] - 2026-01-25\n\n### Fixed\n- **Regex group error** - `match.group(1)` \u2192 `match.group(0)` for non-capturing groups\n- Fixes \"no such group\" error during file verification\n\n## [1.9.103] - 2026-01-25\n\n### Fixed\n- **Error propagation** - \"Unknown error\" now shows actual failure reason\n- When verification fails: \"Verification failed: X missing, Y errors\"\n- When review rejects: includes review feedback\n- `success` field now correctly reflects approval status\n\n## [1.9.102] - 2026-01-25\n\n### Fixed (Critical Bugs)\n- **Removed local fallback execution** - Jobs fail properly if remote fails\n- **Reviewer error = reject** - Non-200 and exceptions now reject (fail-safe)\n- **Execution failure is fatal** - Jobs stop immediately on exec failure\n- **Job queue file locking** - Atomic writes prevent corruption\n\n### Improved\n- **Expanded verification regex** - Catches relative paths like `backend/*.py`\n- **Job-level cost tracking** - Track costs per job_id and project_id\n- **Documentation overhaul** - Clarified vision based on user feedback\n\n## [1.9.101] - 2026-01-25\n### Changed\n- **Documentation Overhaul** - Post-ChatGPT audit\n  - Updated TODO.md with critical fixes and phases 10-14\n  - Updated PROJECT_PLAN.md with health assessment\n  - Identified 4 critical bugs to fix before Phase 10\n\n### Identified (To Fix)\n- Local fallback execution (security risk)\n- Reviewer non-200 defaults to approval\n- Execution failure not fatal\n- No file locking on job queue\n\n## [1.9.101] - 2026-01-25\n### Changed\n- **Documentation Overhaul** - Post-ChatGPT audit\n  - Updated TODO.md with critical fixes and phases 10-14\n  - Updated PROJECT_PLAN.md with health assessment\n  - Identified 4 critical bugs to fix before Phase 10\n\n### Identified (To Fix)\n- Local fallback execution (security risk)\n- Reviewer non-200 defaults to approval\n- Execution failure not fatal\n- No file locking on job queue\n\n## [1.9.90] - 2026-01-25\n\n### Added\n- **Read Phase**: Load project docs (README, TODO, PLAN, SPEC) before executing tasks\n- **Dynamic Context Loading**: Gets project paths from database, not hardcoded\n- **Project Dashboard API**: `/api/autonomous/project/{id}/dashboard`\n- **Job Detail API**: `/api/autonomous/jobs/{id}/detail`\n- **Event Filtering API**: `/api/autonomous/events?type=job&project_id=X`\n- **Export Job Logs API**: `/api/autonomous/jobs/{id}/export?format=markdown`\n- **Cost Summary API**: `/api/autonomous/costs/summary?days=7`",
      "todos_parsed": [
        {
          "text": "**Settings panel created** - New SharePointSettingsPanel component in Settings view",
          "done": true
        },
        {
          "text": "**Add settings** - Form to add include paths, exclude paths, and allowed sites",
          "done": true
        },
        {
          "text": "**Delete settings** - Trash button to remove any setting",
          "done": true
        },
        {
          "text": "**Color-coded lists** - Green for includes, red for excludes, blue for allowed sites",
          "done": true
        },
        {
          "text": "**Real-time updates** - Changes reflect immediately via React Query",
          "done": true
        },
        {
          "text": "**Derive domain from client emails** - If company.domain not set, extract from first client email",
          "done": true
        },
        {
          "text": "**Filter common providers** - Exclude gmail, hotmail, yahoo, outlook domains",
          "done": true
        },
        {
          "text": "**Match current user** - Time-off now uses logged-in user's email to find their ID",
          "done": true
        },
        {
          "text": "**Passed currentUser prop** - TimeOffView receives current user data",
          "done": true
        },
        {
          "text": "**Folder filtering** - Management, Executive, HR, Personnel, Confidential, Board excluded",
          "done": true
        },
        {
          "text": "**Include paths** - Only /Sales/ and /Technical/ indexed",
          "done": true
        },
        {
          "text": "**Configuration in filters.ts** - SHAREPOINT_INCLUDE_PATHS, SHAREPOINT_EXCLUDE_PATHS",
          "done": true
        },
        {
          "text": "**PRTG service created** (`backend/src/services/prtg/client.ts`)",
          "done": true
        },
        {
          "text": "**API endpoints added**: `/api/prtg/status`, `/api/prtg/sensor/:id`, `/api/prtg/refresh`",
          "done": true
        },
        {
          "text": "**Dashboard PRTG panel** - Shows down/warning/paused/up sensor counts",
          "done": true
        },
        {
          "text": "**Credentials configured** - PRTG_URL, PRTG_USERNAME, PRTG_PASSHASH in .env",
          "done": true
        },
        {
          "text": "**Direct links to PRTG** - Each sensor links to PRTG web UI",
          "done": true
        },
        {
          "text": "**Fixed false SLA breaches** - Tickets with status 2/4/8/21/22 no longer show as breached",
          "done": true
        },
        {
          "text": "**Tech engagement detection** - Status changes now correctly indicate tech response",
          "done": true
        },
        {
          "text": "**Require hard references** - AI must cite ticket #, asset names, or document names",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "2.0.0",
      "git": {
        "status": "clean",
        "branch": "unknown",
        "last_commit": "unknown",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3002,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 3003,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEPLOYMENT.md",
        "HANDOFF.md",
        "HANDOVER.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RELAY.md",
        "STATUS.md",
        "TODO.md",
        "backend/package-lock.json",
        "backend/package.json",
        "backend/tsconfig.json",
        "checks/relay_check.py",
        "checks/security_check.py",
        "checks/service_check.py",
        "checks/system_check.py",
        "docs/AI_INTEGRATION.md",
        "docs/BACKUP.md",
        "docs/CLOUDFLARE_ACCESS.md",
        "docs/FILE_MAP.md",
        "docs/HALO_API.md",
        "docs/HANDOVER.md",
        "docs/SETUP.md",
        "docs/TODO.md",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.ts",
        "package-lock.json",
        "package.json",
        "tsconfig.json"
      ],
      "health_score": 100
    },
    {
      "name": "Dockyard WiFi",
      "server": "rize-apps",
      "type": "infrastructure",
      "path": "/home/rizeadmin/dockyard-wifi-portal",
      "domain": "dockyardwifi.rize.bm",
      "ports": [
        8080,
        8081
      ],
      "scanned_at": "2026-02-07T23:10:57.022339+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: DEPLOYMENT.md"
        },
        {
          "severity": "info",
          "message": "2 uncommitted changes"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": "# Dockyard WiFi Captive Portal\n\n## Project Overview\n\nA self-hosted captive portal system for the Royal Naval Dockyard in Bermuda. This system provides WiFi access to tourists and visitors through an ad-supported model with premium upgrade options.\n\n**Owner:** Rize Technologies Ltd  \n**Location:** Royal Naval Dockyard, Bermuda  \n**Launch Target:** February 28, 2026\n\n### Business Model\n\n1. **Free Tier (Ad-Supported):** Users watch a 30-second video ad to receive 1 hour of WiFi access. Limited to 1 hour free per day (resets at 12:01 AM).\n\n2. **Premium Passes:** Users can skip ads and get extended access:\n   - 6 hours: $4\n   - 24 hours: $7\n   - 72 hours: $12\n\n3. **Sponsorship Revenue:** Main sponsor banner on splash page (\"WiFi Brought to you by [Sponsor]\") plus video ad slots sold to local businesses.\n\n### Key Design Principles\n\n- **Self-Hosted:** No monthly SaaS fees, full data ownership\n- **PIPA Compliant:** Bermuda Personal Information Protection Act - explicit consent, opt-out options\n- **Mobile-First:** All user-facing pages optimized for smartphones\n- **Revenue-Focused:** Multiple monetization streams (ads, passes, sponsorships)\n- **Simple Stack:** Plain HTML/CSS/JavaScript, no complex frameworks\n\n---\n\n## Architecture\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Cloudflare Tunnels                           \u2502\n\u2502         dockyardwifi.rize.bm    dockyard-admin.rize.bm         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Ubuntu 24.04 VM (192.168.65.252)                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502   Backend   \u2502  \u2502    Admin    \u2502  \u2502 Postgres \u2502  \u2502  Redis   \u2502  \u2502\n\u2502  \u2502  Port 3000  \u2502  \u2502  Port 3001  \u2502  \u2502  Port    \u2502  \u2502  Port    \u2502  \u2502\n\u2502  \u2502  (Express)  \u2502  \u2502  (Express)  \u2502  \u2502  5432    \u2502  \u2502  6379    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                      Docker Compose                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Infrastructure\n\n- **Host Server:** Dell PowerEdge R720 running Windows Server 2022 with Hyper-V\n- **VM:** Ubuntu 24.04 LTS (4 vCPU, 8GB RAM, 100GB SSD)\n- **Containerization:** Docker Compose\n- **External Access:** Cloudflare Tunnels (zero-trust, no open ports)\n- **DNS:** Cloudflare (rize.bm domain)\n\n---\n\n## Tech Stack\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| Backend API | Node.js 20 + Express.js | User-facing API, session management |\n| Admin API | Node.js 20 + Express.js | Admin dashboard API |\n| Database | PostgreSQL 16 | Persistent data storage |\n| Cache | Redis 7 | Session caching (future) |\n| Frontend | Plain HTML/CSS/JavaScript | No build tools, simple deployment |\n| Email | Microsoft 365 SMTP | Reminder emails |\n| Tunnels | Cloudflare | Secure external access |\n\n---\n\n## Features\n\n### Completed \u2705\n\n#### User-Facing (Splash Page)\n- [x] Email capture with PIPA-compliant consent checkboxes\n- [x] Terms of Service and Privacy Policy links\n- [x] Video ad player with 30-second minimum watch time\n- [x] Skip button appears after 30 seconds for longer videos\n- [x] Session status display with countdown timer\n- [x] Warning state when session expires in <10 minutes\n- [x] Premium pass selection (6hr, 24hr, 72hr)\n- [x] Main sponsor banner (\"WiFi Brought to you by...\")\n- [x] \"Visit [Advertiser]\" button during video playback\n- [x] Mobile-responsive design with glassmorphism effects\n\n#### Session Management\n- [x] MAC address-based device tracking\n- [x] 1-hour free limit enforcement (no unlimited free via multiple ads)\n- [x] Session extension via additional ad views (disabled after 1hr limit)\n- [x] Session expiration and automatic cleanup\n- [x] Email reminders before session expiry (10min, 30min, 1hr, 2hr based on pass type)\n\n#### Admin Dashboard\n- [x] Real-time statistics (active sessions, views, completion rate, revenue)\n- [x] 9 tabs: Ad Rotation, Video Library, Sponsors, Sessions, Subscribers, Events, Pricing, Audit Log, Analytics, Settings\n- [x] Ad slot management (10 slots, assign videos, enable/disable)\n- [x] Video library with upload, edit, archive, restore\n- [x] Sponsor management with banner preview\n- [x] Active session view with terminate capability\n- [x] Subscriber export (CSV)\n- [x] Comprehensive audit logging\n- [x] Voucher generation and management\n- [x] Voucher stats (total, active, redeemed, fully used)\n- [x] CSV export of voucher codes\n\n#### Analytics & Tracking (Industry Standard)\n- [x] Impression tracking (page views)\n- [x] Click tracking (sponsor/ad clicks)\n- [x] Click-through rate (CTR) calculation\n- [x] Video quartile tracking (25%, 50%, 75%, 100%)\n- [x] Watch time tracking\n- [x] Unique viewer counts\n- [x] Device type detection (mobile/desktop)\n- [x] Daily/weekly/monthly breakdowns\n- [x] Per-sponsor and per-video metrics\n\n#### Email System\n- [x] Microsoft 365 SMTP integration\n- [x] Session expiry reminders\n- [x] Marketing opt-in tracking\n- [x] PIPA-compliant unsubscribe\n\n### Pending \ud83d\udd32\n\n- [ ] Payment processing (Authorize.net integration)\n- [ ] Network integration (RADIUS authentication)\n- [ ] DHCP integration (MAC address capture)\n- [ ] DNS hijack (redirect to captive portal)\n- [ ] Bandwidth limiting per session type\n- [ ] Social login (Facebook, Google)\n- [x] Voucher/coupon codes (v1.2.0)\n- [ ] Multi-language support\n\n---\n\n## Database Schema\n\n### Core Tables\n```sql\n-- User sessions (WiFi access)\nsessions (\n    id UUID PRIMARY KEY,\n    mac_address VARCHAR(50),\n    ip_address VARCHAR(50),\n    email VARCHAR(255),\n    device_type VARCHAR(50),\n    user_agent TEXT,\n    session_type VARCHAR(50),      -- 'free_ad', 'paid_6hr', 'paid_24hr', 'paid_72hr'\n    free_seconds_used INTEGER,     -- Track 1-hour free limit\n    started_at TIMESTAMP,\n    expires_at TIMESTAMP,\n    marketing_opt_in BOOLEAN,\n    reminder_sent_at TIMESTAMP,\n    created_at TIMESTAMP\n)\n\n-- Email subscribers (marketing list)\nemail_subscribers (\n    id UUID PRIMARY KEY,\n    email VARCHAR(255) UNIQUE,\n    marketing_opt_in BOOLEAN,\n    consent_timestamp TIMESTAMP,\n    source VARCHAR(100),\n    created_at TIMESTAMP\n)\n\n-- Ad video library\nad_videos (\n    id UUID PRIMARY KEY,\n    title VARCHAR(255),\n    filename VARCHAR(255),\n    video_path VARCHAR(500),\n    advertiser_name VARCHAR(255),\n    advertiser_url VARCHAR(500),\n    duration_seconds INTEGER,\n    total_views INTEGER,\n    total_completions INTEGER,\n    total_clicks INTEGER,\n    is_archived BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Ad rotation slots (10 slots)\nad_slots (\n    slot_number INTEGER PRIMARY KEY,  -- 1-10\n    video_id UUID REFERENCES ad_videos(id),\n    is_active BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Sponsor library\nsponsors (\n    id UUID PRIMARY KEY,\n    name VARCHAR(255),\n    logo_url VARCHAR(500),\n    website_url VARCHAR(500),\n    banner_url VARCHAR(500),\n    notes TEXT,\n    is_active BOOLEAN,\n    is_archived BOOLEAN,\n    total_impressions INTEGER,\n    total_clicks INTEGER,\n    created_at TIMESTAMP\n)\n\n-- Main sponsor slot\nsponsor_slot (\n    id INTEGER PRIMARY KEY,        -- Always 1\n    sponsor_id UUID REFERENCES sponsors(id),\n    is_active BOOLEAN,\n    updated_at TIMESTAMP\n)\n\n-- Ad impressions/events tracking\nad_impressions (\n    id UUID PRIMARY KEY,\n    ad_type VARCHAR(50),           -- 'main_sponsor', 'video_ad'\n    ad_id VARCHAR(100),\n    ad_name VARCHAR(255),\n    session_id UUID,\n    mac_address VARCHAR(50),\n    ip_address VARCHAR(50),\n    user_agent TEXT,\n    device_type VARCHAR(50),\n    event_type VARCHAR(50),        -- 'impression', 'click', 'view_start', 'view_25', 'view_50', 'view_75', 'view_complete'\n    view_duration_seconds INTEGER,\n    video_duration_seconds INTEGER,\n    created_at TIMESTAMP\n)\n\n-- Video ad events (legacy, still used)\nvideo_ad_events (\n    id UUID PRIMARY KEY,\n    session_id UUID,\n    ad_slot_id INTEGER,\n    event_type VARCHAR(50),\n    watch_duration_seconds INTEGER,\n    video_duration_seconds INTEGER,\n    completed BOOLEAN,\n    created_at TIMESTAMP\n)\n\n-- Pricing configuration\npricing_config (\n    id SERIAL PRIMARY KEY,\n    pass_type VARCHAR(50),\n    duration_hours INTEGER,\n    price_cents INTEGER,\n    is_active BOOLEAN,\n    display_order INTEGER\n)\n\n-- Payment transactions (future)\ntransactions (\n    id UUID PRIMARY KEY,\n    session_id UUID,\n    pass_type VARCHAR(50),\n    amount_cents INTEGER,\n    currency VARCHAR(10),\n    payment_method VARCHAR(50),\n    payment_status VARCHAR(50),\n    created_at TIMESTAMP\n)\n\n-- Audit log\naudit_log (\n    id UUID PRIMARY KEY,\n    user_email VARCHAR(255),\n    action VARCHAR(100),\n    entity_type VARCHAR(100),\n    entity_id VARCHAR(255),\n    old_values JSONB,\n    new_values JSONB,\n    ip_address VARCHAR(50),\n    created_at TIMESTAMP\n)\n```\n\n---\n\n## API Endpoints\n\n### Backend (Port 3000) - User-Facing\n\n| Method | Endpoint | Purpose |\n|--------|----------|---------|\n| POST | `/api/v1/sessions` | Create new session (on page load) |\n| GET | `/api/v1/sessions/check/:mac` | Check if device has active session |\n| POST | `/api/v1/sessions/:id/email` | Save email and consent |\n| POST | `/api/v1/sessions/:id/video-event` | Track video watch events |\n| GET | `/api/v1/next-video` | Get next video from rotation |\n| GET | `/api/v1/sponsor` | Get current main sponsor |\n| POST | `/api/v1/track` | Track ad impressions/clicks |\n| GET | `/api/v1/ad-stats/:type/:id` | Get ad performance stats |\n\n### Admin (Port 3001) - Dashboard\n\n| Method | Endpoint | Purpose |\n|--------|----------|---------|\n| GET | `/api/admin/stats` | Dashboard statistics |\n| GET | `/api/admin/ads` | Get ad rotation slots |\n| PUT | `/api/admin/ads/:slot` | Update ad slot |\n| GET | `/api/admin/ad-videos` | Get video library |\n| POST | `/api/admin/ad-videos` | Add video metadata |\n| PUT | `/api/admin/ad-videos/:id` | Update video |\n| POST | `/api/admin/ad-videos/:id/archive` | Archive video |\n| POST | `/api/admin/ad-videos/:id/restore` | Restore video |\n| POST | `/api/admin/upload-video` | Upload video file |\n| GET | `/api/admin/sponsors` | Get all sponsors |\n| POST | `/api/admin/sponsors` | Add sponsor |\n| PUT | `/api/admin/sponsors/:id` | Update sponsor |\n| PUT | `/api/admin/sponsors/:id/archive` | Archive sponsor |\n| PUT | `/api/admin/sponsors/:id/restore` | Restore sponsor |\n| GET | `/api/admin/sponsors/main` | Get main sponsor |\n| PUT | `/api/admin/sponsors/main/:id` | Set main sponsor |\n| GET | `/api/admin/sessions` | Get all sessions |\n| GET | `/api/admin/sessions/active` | Get active sessions |\n| POST | `/api/admin/sessions/:id/terminate` | Terminate session |\n| GET | `/api/admin/subscribers` | Get subscribers |\n| GET | `/api/admin/subscribers/export` | Export CSV |\n| GET | `/api/admin/events` | Get video events |\n| GET | `/api/admin/pricing` | Get pricing config |\n| GET | `/api/admin/audit-logs` | Get audit logs |\n| GET | `/api/admin/analytics/summary` | Analytics overview |\n| GET | `/api/admin/analytics/sponsor` | Sponsor analytics |\n| GET | `/api/admin/analytics/videos` | Video analytics |\n| GET | `/api/admin/analytics/events` | Recent events |\n| POST | `/api/admin/reset-stats` | Reset all statistics |\n\n---\n\n## File Structure\n```\ndockyard-wifi-portal/\n\u251c\u2500\u2500 docker-compose.yml          # Container orchestration\n\u251c\u2500\u2500 README.md                   # This file\n\u251c\u2500\u2500 CLAUDE_INSTRUCTIONS.md      # AI assistant guidelines\n\u2502\n\u251c\u2500\u2500 backend/                    # User-facing service\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 index.js               # Express server, all API routes\n\u2502   \u2514\u2500\u2500 public/\n\u2502       \u251c\u2500\u2500 index.html         # Splash page (main portal)\n\u2502       \u251c\u2500\u2500 pages/\n\u2502       \u2502   \u251c\u2500\u2500 terms.html     # Terms of Service\n\u2502       \u2502   \u2514\u2500\u2500 privacy.html   # Privacy Policy\n\u2502       \u2514\u2500\u2500 ads/               # Video files\n\u2502           \u2514\u2500\u2500 videos/        # Uploaded ad videos\n\u2502\n\u251c\u2500\u2500 admin/                      # Admin dashboard service\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 package.json\n\u2502   \u251c\u2500\u2500 server.js              # Express server, admin API routes\n\u2502   \u2514\u2500\u2500 public/\n\u2502       \u2514\u2500\u2500 index.html         # Admin dashboard SPA\n\u2502\n\u2514\u2500\u2500 database/\n    \u2514\u2500\u2500 schema.sql             # Database schema\n```\n\n---\n\n## Session Flow\n\n### New User Flow\n```\n1. User connects to WiFi \u2192 Router redirects to portal\n2. GET / \u2192 Splash page loads\n3. POST /api/v1/sessions \u2192 Create session, get session ID\n4. GET /api/v1/sponsor \u2192 Load main sponsor banner (track impression)\n5. User enters email, checks consent boxes\n6. POST /api/v1/sessions/:id/email \u2192 Save email\n7. GET /api/v1/next-video \u2192 Get video to play\n8. User watches video (track: view_start, view_25, view_50, view_75)\n9. After 30 seconds \u2192 POST /api/v1/sessions/:id/video-event (complete)\n10. Session authorized for 1 hour\n11. Success screen shown\n12. User redirected to internet\n```\n\n### Returning User Flow\n```\n1. User connects to WiFi \u2192 Router redirects to portal\n2. GET / \u2192 Splash page loads\n3. POST /api/v1/sessions \u2192 Create/get session\n4. GET /api/v1/sessions/check/:mac \u2192 Check existing session\n5. If authorized \u2192 Show session status with countdown\n6. If expired \u2192 Show email form (or premium options if 1hr limit reached)\n```\n\n### 1-Hour Free Limit Logic\n```javascript\n// In video-event handler:\nif (session.free_seconds_used >= 3600) {\n    return { limit_reached: true, message: \"Free limit reached\" };\n}\n\n// Grant time (max 1 hour total)\nconst remaining = 3600 - session.free_seconds_used;\nconst grant = Math.min(3600, remaining); // Grant up to 1 hour, but not exceeding limit\nsession.free_seconds_used += grant;\nsession.expires_at = NOW() + grant seconds;\n```\n\n---\n\n## Email Reminder System\n\nThe backend runs a background job every 60 seconds checking for sessions that need reminders:\n```javascript\n// Reminder timing by session type:\n- free_ad:    10 minutes before expiry\n- paid_6hr:   30 minutes before expiry\n- paid_24hr:  60 minutes before expiry\n- paid_72hr:  120 minutes before expiry\n```\n\nEmail includes:\n- Time remaining\n- Link to buy premium pass\n- Unsubscribe link\n\n---\n\n## Analytics Metrics Explained\n\n### For Sponsors/Advertisers\n\n| Metric | Definition | Industry Standard |\n|--------|------------|-------------------|\n| Impressions | Number of times ad was displayed | Yes |\n| Clicks | Number of times ad was clicked | Yes |\n| CTR | Clicks \u00f7 Impressions \u00d7 100 | Yes |\n| Unique Viewers | Distinct devices that saw ad | Yes |\n\n### For Video Ads\n\n| Metric | Definition | Industry Standard |\n|--------|------------|-------------------|\n| View Start | Video started playing | Yes (MRC) |\n| View 25% | Watched 25% of video | Yes (MRC) |\n| View 50% | Watched 50% of video | Yes (MRC) |\n| View 75% | Watched 75% of video | Yes (MRC) |\n| View Complete | Watched 100% of video | Yes (MRC) |\n| Completion Rate | Completes \u00f7 Starts \u00d7 100 | Yes |\n| Avg Watch Time | Average seconds watched | Yes |\n\n*MRC = Media Rating Council standard for video ad measurement*\n\n---\n\n## Security Considerations\n\n### Implemented\n\n- [x] Cloudflare Tunnel (no exposed ports)\n- [x] Admin dashboard behind Cloudflare Access (SSO)\n- [x] SQL parameterized queries (no SQL injection)\n- [x] CORS configured\n- [x] Helmet.js security headers\n- [x] Audit logging for admin actions\n\n### Recommended (Future)\n\n- [ ] Rate limiting on API endpoints\n- [ ] CAPTCHA for form submissions\n- [ ] MAC address validation/sanitization\n- [ ] Session token encryption\n- [ ] Database connection pooling limits\n\n---\n\n## Deployment\n\n### Start Services\n```bash\ncd ~/dockyard-wifi-portal\ndocker-compose up -d\n```\n\n### Restart After Code Changes\n```bash\ndocker-compose restart backend admin\n```\n\n### View Logs\n```bash\ndocker-compose logs --tail 50 backend\ndocker-compose logs --tail 50 admin\n```\n\n### Database Access\n```bash\ndocker exec -it dockyard-postgres psql -U wifi_app -d dockyard_wifi",
      "todo": "# Dockyard WiFi Portal - TODO List\n\n**Last Updated:** February 4, 2026\n\n---\n\n## \u2705 COMPLETED\n\n### Security\n- [x] Secrets moved to .env file (not in git)\n- [x] CORS restricted to specific origins\n- [x] CSP headers enabled (with scriptSrcAttr for inline handlers)\n- [x] Admin CSP media-src & CORS fix (v1.3.6) - admin video playback works\n- [x] Admin port locked to localhost only (127.0.0.1:3001)\n- [x] Server-side ad completion validation (nonce + timing)\n- [x] Free limit tracking (max 1 hour per device per day)\n- [x] Tester email bypass for testing\n- [x] Rate limiting (general: 100/15min, strict: 10/min, video: 5/min)\n- [x] Error sanitization (generic messages to clients, details logged - both backend & admin)\n- [x] Admin JWT validation (Cloudflare Access token verification)\n- [x] Input validation (email, MAC, UUID, string sanitization)\n- [x] Comprehensive audit logging (all admin actions tracked)\n\n### Session Management\n- [x] Session check endpoint (/api/v1/sessions/check/:mac)\n- [x] Active session display with countdown timer\n- [x] Free seconds tracking (free_seconds_used column)\n- [x] Persistent device ID (localStorage fallback for spoofed MACs)\n- [x] 1-hour daily free limit enforcement (resets at midnight)\n- [x] \"Free WiFi Limit Reached\" screen when limit hit\n- [x] Connection counters (total, free, paid per user)\n\n### Email System\n- [x] SMTP via Microsoft 365 (dockyard@rize.bm)\n- [x] Session expiry reminder emails\n- [x] Welcome email on first connection (with marketing opt-in)\n- [x] Follow-up email template (7 days after last connection)\n- [x] Unsubscribe endpoint (/api/v1/unsubscribe)\n- [x] Test email endpoint (/api/v1/test-emails)\n\n### Analytics & Tracking\n- [x] Ad impressions table\n- [x] Click tracking with CTR calculation\n- [x] Video quartile tracking (25%, 50%, 75%, 100%)\n- [x] Sponsor performance metrics\n- [x] Admin Analytics tab\n\n### Admin Dashboard\n- [x] 9 tabs: Ad Rotation, Videos, Sponsors, Sessions, Subscribers, Events, Pricing, Audit, Analytics, Settings\n- [x] Video upload and slot assignment\n- [x] Active session termination\n- [x] Subscriber export (CSV)\n- [x] Audit logging\n\n### UX Improvements\n\n### Documentation (v1.5.0)\n- [x] User Guide (docs/USER_GUIDE.md)\n- [x] Admin Guide (docs/ADMIN_GUIDE.md)\n- [x] Sponsor Onboarding Guide (docs/SPONSOR_ONBOARDING_GUIDE.md)\n\n### Video Playback (v1.5.0)\n- [x] Cross-browser video playback fixes\n- [x] Proper MIME type headers\n- [x] Enhanced video player with autoplay handling\n- [x] Video error recovery\n\n### Cookie Tracking (v1.5.0)\n- [x] Client-side free hour tracking via cookies\n- [x] Backup tracking independent of server\n- [x] Browser back button handling (returns to portal, not Google)\n- [x] \"Start Browsing\" button closes success screen properly\n\n---\n\n## \ud83d\udd04 IN PROGRESS\n\n### Email Design\n- [ ] Angel: Design branded HTML templates for all 4 emails (test emails sent to apelaez@rize.bm)\n\n### OAuth Integration (Feb 28 Deadline)\n- [x] Add Google/Facebook sign-in BUTTONS to portal UI (v1.4.0)\n- [ ] Facebook OAuth credentials (BLOCKED: awaiting business verification ~2 days)\n- [x] Build /privacy page (v1.4.6 - PIPA compliant)\n- [x] Build /terms page (v1.4.6)\n- [x] Build /api/auth/facebook/delete endpoint (v1.4.6)\n- [ ] Create 1024x1024 app icon for Facebook\n\n### Completed Jan 30\n- [x] Google OAuth - credentials added, app published in production\n- [x] Halo ticket created for Prabin to update GCP branding\n\n---\n\n## \ud83d\udccb TODO - HIGH PRIORITY\n\n### Payment Integration\n- [x] Authorize.net account setup (v1.6.0)\n- [x] Payment form on splash page (v1.6.0 - /upgrade page)\n- [x] Backend payment processing endpoint (v1.6.0)\n- [x] Transaction recording in database (v1.6.0)\n- [x] Receipt email on purchase (v1.6.0 - pending email template)\n- [x] Session upgrade on successful payment (v1.6.0)\n\n### Network Integration\n- [ ] Ubiquiti controller integration\n- [ ] RADIUS authentication\n- [ ] DHCP integration for MAC address capture\n- [ ] DNS hijack for captive portal redirect\n- [ ] Bandwidth limiting per session type\n\n---\n\n## \ud83d\udccb TODO - MEDIUM PRIORITY\n\n### User Experience\n- [x] Social login (Facebook, Google) - v1.4.0\n- [ ] Multi-language support\n- [x] Voucher/coupon codes (v1.2.0)\n\n### Admin Enhancements\n- [ ] PDF report generation\n- [ ] Scheduled report emails\n- [ ] A/B testing for ad creatives\n- [ ] Bulk video upload\n\n---\n\n## \ud83d\udccb TODO - LOW PRIORITY / FUTURE\n\n- [x] Mobile responsiveness fixes - v1.4.4\n- [ ] Mobile app for admin\n- [ ] Real-time dashboard websockets\n- [ ] Multiple location support\n- [ ] White-label capability\n\n---\n\n## \ud83d\udc1b KNOWN ISSUES\n\n1. **MAC addresses unreliable** - Browsers can't read real MAC; using localStorage device ID\n2. **Follow-up email timing** - Runs hourly; first emails won't send until 7 days after connections\n\n---\n\n## \ud83d\udcc5 DEADLINES\n\n- **Project Launch:** February 28, 2026\n- **Payment Integration:** Target mid-February\n- **Network Integration:** Requires coordination with dockyard IT\n\n---\n\n## Related Documentation\n\n| Document | Purpose |\n|----------|---------|\n| [README.md](README.md) | Technical overview and setup |\n| [DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md](DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md) | Complete project documentation for stakeholders |\n| [TODO.md](TODO.md) | Task tracking - completed and pending |\n| [HANDOFF_PROMPT.md](HANDOFF_PROMPT.md) | Session continuity for developers |\n| [CLAUDE_INSTRUCTIONS.md](CLAUDE_INSTRUCTIONS.md) | AI assistant guidelines |\n\n**Important:** Read all documentation files before making changes to understand the full project context.\n\n---\n\n## \ud83d\udd04 FRESHSALES CRM INTEGRATION\n\n### Completed \u2705\n- [x] FreshSales API connection working\n- [x] Auto-sync contacts on marketing opt-in\n- [x] Set subscription_status (1=subscribed, 2=unsubscribed)\n- [x] Add `dockyard-wifi` tag to all synced contacts\n- [x] Add lead source via cf_wifi_source field (\"Dockyard WiFi Portal\")\n- [x] Sync existing email_subscribers (batch sync completed Jan 27, 2026)\n- [x] Update contact on unsubscribe (syncs to FreshSales automatically)\n\n### Quick Wins (Ready to Implement)\n(All completed - see above)\n\n### Needs Angel/Admin Setup in FreshSales\n- [ ] Create \"Dockyard WiFi Portal\" lead source\n- [ ] Create custom fields: cf_first_wifi_visit, cf_last_wifi_visit, cf_wifi_pass_type\n- [ ] Create \"Dockyard WiFi 2026\" campaign (optional)\n- [ ] Decide: Portal sends emails vs FreshSales sends emails\n\n### Advanced (Future)\n- [ ] Log WiFi sessions as Sales Activities\n- [ ] Create Deals on pass purchases\n- [ ] Webhook: FreshSales \u2192 Portal for unsubscribes\n- [ ] Lifecycle stages (New \u2192 Engaged \u2192 Customer \u2192 Churned)\n\n### Files\n- `/backend/freshsalesService.js` - API wrapper\n- `/backend/index.js` - Auto-sync on opt-in (line ~250)\n\n### API Reference\n```\nDomain: rizetechnologies.myfreshworks.com\nAuth Header: Authorization: Token token=OT1axCqJZ33LA1FpVPSfpA\n```\n\n---\n\n## \ud83c\udd95 FROM FEB 2 MEETING (Libby/Sarah/Michael/Polina/Gilbert)\n\n### Captive Portal - Advertising Features\n- [ ] Video ad slots: 6x 30-second spots at $1,000 each (splash page)\n- [ ] Splash page sponsor banner for Main Sponsor ($20K package \u2014 details TBD)\n- [ ] Ad impression/performance analytics visible to advertisers\n- [ ] Backend portal already has video upload + analytics \u2014 verify sponsor reporting meets advertiser needs\n\n### Captive Portal - Email Automation (4 emails)\n- [x] Email 1: Auto sign-up welcome response (v1.5.0)\n- [x] Email 2: Session expiring reminder (v1.5.0)\n- [ ] Email 3: TBD \u2014 define purpose (follow-up offer? return visit promo?)\n- [ ] Email 4: TBD \u2014 define purpose (feedback survey? loyalty program?)\n- [ ] Email sponsorship pricing: define cost for sponsor placement in emails\n\n### B2B Pricing & Payment Plans\n- [ ] 1-year plan: less 5% Early Bird Discount\n- [ ] 6-month plan: pay during peak season (April-September)\n- [ ] 12-month plan: monthly payments + 5% admin fee\n- [ ] Build B2B payment/invoicing workflow (separate from B2C guest passes)\n- [ ] B2B sales PDF asset (Libby/Tuo creating)\n- [ ] B2B landing page (Libby/Tuo creating)\n\n### B2C Pricing (DECISION NEEDED)\n- [ ] Define WiFi hour pass price\n- [ ] Define 1-day pass price\n- [ ] Define 2-day pass price\n- [ ] Current pricing in admin: 6hr/$4, 24hr/$7, 72hr/$12 \u2014 confirm or update\n\n### Physical Signage & Assets (Libby/Tuo)\n- [x] QR codes for WiFi access - v1.5.0 (added to Admin Settings)\n- [ ] Digital screen content for existing Dockyard screens\n- [ ] Wall decal designs\n- [ ] Interrupter/lollipop signs\n- [ ] Ferry railing banners\n- [ ] TV screen and billboard locations (Libby sent internal doc Feb 2)\n\n### Hardware Deployment (End of February)\n- [ ] Raspberry Pi deployment for new digital screens\n- [ ] Deploy screens in customs area\n- [ ] Additional access points (Abraham/Ubiquiti \u2014 waiting)\n- [ ] Outdoor area coverage (goal: end of February)\n- [ ] Mall indoor coverage (goal: ready by February)\n\n### Network / QoS\n- [ ] Subscriber priority over guests in high-density areas\n- [ ] Bandwidth management per session type\n\n### Marketing & Promotion\n- [ ] Cruise ship staff engagement strategy (promote WiFi without conflicting with cruise lines)\n- [ ] Wayfinding signage for cruise ship passengers\n- [ ] Leverage existing customs screens for WiFi advertising\n- [ ] Email list monetization strategy (large volume expected from tourist captures)\n\n### Stakeholders\n- Libby Cook-Toppan (Tuo Collective) \u2014 Marketing/advertising lead\n- Sarah Manders (Rize) \u2014 Sales/signage coordination\n- Michael Branco (Celeste) \u2014 Network deployment\n- Polina Branco (Celeste) \u2014 Meeting coordination\n- Angel Pelaez (Rize) \u2014 Email template design",
      "changelog": "## [1.8.0] - 2026-02-04\n\n### Added\n- **Payment Gateway Admin Panel**\n  - Multi-gateway support: Authorize.net (primary) + Stripe (backup)\n  - Credential management from admin dashboard (stored in DB, not .env)\n  - Test Connection button to verify credentials without processing charges\n  - Automatic failover after 3 consecutive gateway failures\n  - Gateway event log with success/failure/failover tracking\n\n- **QR Code System**\n  - QR code generation service for signage\n  - Printable poster (8.5x11) with branding and instructions\n  - Printable sticker sheet (9 per page for cutting)\n  - Downloadable PNG (1024px) and SVG formats\n  - QR API routes: /api/qr/image, /api/qr/poster, /api/qr/stickers\n\n- **Social Login Prep**\n  - Added Stripe env vars to docker-compose.yml\n  - Added Instagram OAuth env vars\n  - Social login buttons ready (pending Meta verification)\n\n### Technical\n- New tables: payment_gateways, payment_gateway_log\n- New services: gatewayManager.js, qrGenerator.js\n- New routes: gatewayRoutes.js, qrRoutes.js\n- Payment config now reads from DB via GatewayManager\n\n## [1.7.0] - 2026-02-04\n\n### Added\n- **Admin Settings Page**\n  - 54 configurable settings across 10 categories\n  - Categories: General, Free Tier, Payments, Video Ads, Email, Vouchers, Social Login, Branding, Sponsors, Network\n  - Collapsible category sections with toggle switches for booleans\n  - Bulk save functionality with change tracking\n  - Settings stored in new `settings` database table\n\n- **Settings API Routes**\n  - GET /api/admin/settings - Fetch all settings grouped by category\n  - GET /api/admin/settings/:key - Get single setting\n  - PUT /api/admin/settings/:key - Update single setting\n  - POST /api/admin/settings/bulk - Bulk update multiple settings\n\n### Fixed\n- **Docker Environment Variables**\n  - Fixed Authorize.net credentials not being passed to backend container\n  - Added AUTHORIZE_NET_API_LOGIN_ID, TRANSACTION_KEY, PUBLIC_CLIENT_KEY, ENV to docker-compose.yml\n  - Payment config endpoint now properly reflects configured state\n\n### Technical\n- New migration: backend/migrations/add_settings_table.sql\n- New route file: backend/routes/settingsRoutes.js\n- Settings JS functions added to admin dashboard\n- Audit logging for settings changes\n\n## [1.6.0] - 2026-02-04\n\n### Added\n- **Authorize.net Payment Integration (P0)**\n  - Accept.js for PCI-compliant card tokenization\n  - Payment plans: 6hr/$4, 24hr/$7, 72hr/$12\n  - Full payment lifecycle: charge, refund, void\n  - Payment page at /upgrade with responsive design\n  - Auto-select plan from URL query parameter\n  - Device ID tracking for payment association\n\n- **Admin Payments Tab**\n  - Revenue overview dashboard (30-day stats)\n  - Plan breakdown visualization (6hr, 24hr, 72hr counts)\n  - Filterable payments table with pagination\n  - Refund and void actions from admin UI\n  - CSV export of payment data\n  - Payment audit logging\n\n- **Database Schema**\n  - payments table with full transaction details\n  - payment_audit_log for action tracking\n  - daily_revenue for aggregated stats\n  - Auto-update trigger for daily revenue\n\n- **Security**\n  - CSP updated for Authorize.net Accept.js\n  - Card data never touches server (tokenization)\n  - Payment audit trail\n\n### Technical\n- Added authorizenet npm package\n- Created services/paymentConfig.js\n- Created services/paymentService.js\n- Created routes/paymentRoutes.js\n- Payment routes wired into Express app\n- Admin server payment endpoints added\n\n---\n\n## [1.5.0] - 2026-02-04\n\n### Added\n- **Video Playback Improvements (P1)**\n  - Added proper MIME type headers for MP4 videos\n  - Enhanced video element with better cross-browser attributes (playsinline, preload, muted autoplay)\n  - Added video error handling and recovery\n  - Added Accept-Ranges header for seeking support\n  - Fixed autoplay restrictions handling\n\n- **Cookie-based Free Hour Tracking (P1)**\n  - Added client-side free hour tracking via cookies\n  - Backup tracking independent of server-side validation\n  - Daily reset at midnight\n\n- **Email Templates (P1)**\n  - Added Purchase Confirmation email (Email 5)\n  - Added Feedback Survey email (Email 6)\n  - Updated test emails endpoint to include all 6 email types\n\n- **QR Code Generation (P1)**\n  - Added /api/v1/qrcode endpoint for PNG generation\n  - Added /api/v1/qrcode/download endpoint for print-ready downloads\n  - QR codes customizable by size (up to 2000px)\n  - QR code section added to Admin Settings page\n  - Branded colors (Dockyard blue #0077b6)\n\n- **Documentation Guides (P1)**\n  - Created docs/USER_GUIDE.md for public visitors\n  - Created docs/ADMIN_GUIDE.md for administrators\n  - Created docs/SPONSOR_ONBOARDING_GUIDE.md for advertisers\n\n### Verified\n- 30-second minimum video enforcement (server-side nonce + timing validation)\n- Video rotation logic (sequential slot cycling 1-10 with fallback)\n- Social login buttons (Google OAuth working, Facebook pending credentials)\n- Voucher system (already implemented in v1.2.0)\n\n### Technical\n- Added mime-types package for MIME detection\n- Added qrcode package for QR generation\n- Enhanced express.static configuration\n\n---\n\n## [1.4.7-docs] - 2026-02-03\n\n### Added\n- Updated TODO.md with all technical items from Feb 2 planning meeting\n- Added Phase 6 (Advertising & Monetization) to PROJECT_PLAN.md\n- B2B payment plans, B2C pricing decisions needed, physical signage, hardware deployment\n- Email automation sequence (4 emails), ad slot pricing, sponsor packages\n- Key stakeholder contacts added\n\n---\n\n## [1.4.6] - 2026-01-30\n\n### Added\n- **Facebook Data Deletion Endpoint** (Facebook App Review requirement)\n  - POST /api/auth/facebook/delete - Accepts signed_request from Facebook\n  - Parses and validates Facebook signed requests with HMAC-SHA256\n  - Deletes user data (email_subscribers, sessions) for Facebook ID\n  - Returns confirmation URL and code per Facebook spec\n  - GET /api/auth/facebook/deletion-status - User-facing status page\n  - Created data_deletion_requests table for audit trail\n\n### Changed\n- **Legal Pages Updated**: Updated effective dates to January 30, 2026\n  - /pages/privacy.html - PIPA-compliant privacy policy\n  - /pages/terms.html - Terms of Service with Bermuda jurisdiction\n\n---\n\n## [1.4.5] - 2026-01-30\n\n### Fixed\n- **OAuth Environment Variables**: Added OAuth config to docker-compose.yml\n  - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET passed to backend container\n  - GOOGLE_CALLBACK_URL with default value\n  - FACEBOOK_APP_ID, FACEBOOK_APP_SECRET passed to backend container\n  - FACEBOOK_CALLBACK_URL with default value\n  - Google \"Sign in with Google\" button now visible on portal\n  - Facebook button remains hidden until credentials configured\n  - Cleaned up .env file (removed duplicate entries)\n\n---\n\n## [1.4.4] - 2026-01-30\n\n### Fixed\n- **Mobile Responsiveness** (Task 5)\n  - Added @media query for screens under 480px\n  - Increased tap targets to minimum 44px\n  - Buttons now min-height 48px on mobile\n  - Prevented horizontal scroll with overflow-x: hidden\n  - Video player scales to 50vh on mobile\n  - Improved checkbox tap targets\n  - Optimized font sizes and padding for small screens\n\n---\n\n## [1.4.3] - 2026-01-30\n\n### Added\n- **Admin Pricing Controls** (Task 4)\n  - Editable pricing in Admin dashboard\n  - PUT /api/admin/pricing/:id endpoint\n  - Edit modal for each price tier\n  - Configure: duration hours, price cents, active status\n  - Changes apply immediately to portal\n\n---\n\n## [1.4.2] - 2026-01-30\n\n### Added\n- **Sponsor Image Upload** (Task 3)\n  - File upload input in Add Sponsor form\n  - Accepts JPG, PNG, GIF, WebP (max 5MB)\n  - Stores in /uploads/sponsors/\n  - Preview after upload\n  - Backend: upload-sponsor-image endpoint\n\n---\n\n## [1.4.0] - 2026-01-30\n\n### Added\n- **Google OAuth Login** (Task 1)\n  - \"Sign in with Google\" button on portal\n  - Backend: googleAuthService.js enhanced\n  - Grants 1 hour free WiFi on successful auth\n  - Auto-hides if not configured\n\n- **Facebook OAuth Login** (Task 2)\n  - \"Sign in with Facebook\" button on portal\n  - Backend: facebookAuthService.js created\n  - Passport-facebook integration\n  - Handles case where Facebook doesnt share email\n\n### Configuration Required\nAdd to .env:\n- GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET\n- FACEBOOK_APP_ID, FACEBOOK_APP_SECRET\n\n---\n\n### Fixed\n- **CSP Headers Update**: Enhanced media-src directive for video playback\n  - Updated backend and admin CSP to include specific domain\n  - Added https://dockyardwifi.rize.bm to media-src\n  - Added https://dockyard-admin.rize.bm to CORS whitelist\n  - Ensures video playback works across all components\n\n## [1.3.5] - 2026-01-29\n### Changed\n- **Footer Link**: Made Rize Technologies clickable\n  - Links to https://rize.bm\n  - Opens in new tab\n  - White underlined styling to indicate clickability\n\n## [1.3.4] - 2026-01-29\n### Removed\n- **Reset Stats Button**: Removed from admin Analytics/Settings page\n  - Prevents accidental data loss\n  - Stats data is preserved and protected\n\n## [1.3.3] - 2026-01-29\n### Removed\n- **Multi-language Support**: Removed Spanish and Portuguese language options\n  - Removed language switcher UI from portal\n  - Removed i18n JavaScript code\n  - Deleted es.json and pt.json locale files\n  - Portal now displays English only as intended for launch\n\n## [1.3.2] - 2026-01-29\n### Fixed\n- **Voucher Time Addition**: Vouchers now ADD time instead of RESETTING session\n  - User with 50min remaining + 1hr voucher = 1hr 50min (was: reset to 59min)\n  - Checks if session is still active and adds duration to existing expiry\n  - If session expired, starts fresh from current time\n  - Updated success message to show total expiry time\n\n## [1.3.1] - 2026-01-29\n### Fixed\n- **CSP Headers for Admin Videos**: Added media-src directive to admin backend CSP\n  - Videos now play correctly in Admin Video Library and Add Rotation preview\n  - Allows media from self, https:, blob:, and data: sources\n  - Resolves Loading media violates Content Security Policy browser console errors\n\n## [1.3.0] - 2026-01-29\n### Added\n- **Multi-language Support**: Portal now supports English, Spanish, Portuguese\n  - Language switcher in top-right corner of portal card\n  - Translation files in /locales/ (en.json, es.json, pt.json)\n  - localStorage-based language preference persistence\n  - All UI strings translated including errors, buttons, labels\n  - data-i18n attributes for dynamic translation updates\n- Google OAuth foundation prepared (awaiting credentials)\n\n## [1.2.0] - 2026-01-28\n### Added\n- **Voucher/Coupon System**: Staff can generate vouchers for free WiFi access\n  - Admin dashboard Vouchers tab for generating and managing vouchers\n  - Support for free_hour (60 min) and free_day (24 hr) voucher types\n  - Single-use or multi-use vouchers with configurable usage limits\n  - Voucher expiration dates\n  - CSV export of voucher codes\n  - Voucher stats tracking (total, active, redeemed, fully used)\n- **User Voucher Redemption**: Users can redeem voucher codes on the splash page\n  - New voucher input field on the main portal",
      "todos_parsed": [
        {
          "text": "Secrets moved to .env file (not in git)",
          "done": true
        },
        {
          "text": "CORS restricted to specific origins",
          "done": true
        },
        {
          "text": "CSP headers enabled (with scriptSrcAttr for inline handlers)",
          "done": true
        },
        {
          "text": "Admin CSP media-src & CORS fix (v1.3.6) - admin video playback works",
          "done": true
        },
        {
          "text": "Admin port locked to localhost only (127.0.0.1:3001)",
          "done": true
        },
        {
          "text": "Server-side ad completion validation (nonce + timing)",
          "done": true
        },
        {
          "text": "Free limit tracking (max 1 hour per device per day)",
          "done": true
        },
        {
          "text": "Tester email bypass for testing",
          "done": true
        },
        {
          "text": "Rate limiting (general: 100/15min, strict: 10/min, video: 5/min)",
          "done": true
        },
        {
          "text": "Error sanitization (generic messages to clients, details logged - both backend & admin)",
          "done": true
        },
        {
          "text": "Admin JWT validation (Cloudflare Access token verification)",
          "done": true
        },
        {
          "text": "Input validation (email, MAC, UUID, string sanitization)",
          "done": true
        },
        {
          "text": "Comprehensive audit logging (all admin actions tracked)",
          "done": true
        },
        {
          "text": "Session check endpoint (/api/v1/sessions/check/:mac)",
          "done": true
        },
        {
          "text": "Active session display with countdown timer",
          "done": true
        },
        {
          "text": "Free seconds tracking (free_seconds_used column)",
          "done": true
        },
        {
          "text": "Persistent device ID (localStorage fallback for spoofed MACs)",
          "done": true
        },
        {
          "text": "1-hour daily free limit enforcement (resets at midnight)",
          "done": true
        },
        {
          "text": "\"Free WiFi Limit Reached\" screen when limit hit",
          "done": true
        },
        {
          "text": "Connection counters (total, free, paid per user)",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.8.0",
      "git": {
        "status": "dirty",
        "branch": "main",
        "last_commit": "53ed441 Auto-backup: $(date \"+%Y-%m-%d %H:%M\") (2 days ago)",
        "changes": [
          {
            "status": "M",
            "file": "ocker-compose.yml"
          },
          {
            "status": "??",
            "file": "docker-compose.yml.bak"
          }
        ],
        "uncommitted_count": 2
      },
      "ports_status": [
        {
          "port": 8080,
          "open": true,
          "http_code": 200,
          "healthy": true
        },
        {
          "port": 8081,
          "open": true,
          "http_code": 200,
          "healthy": true
        }
      ],
      "files": [
        "CHANGELOG.md",
        "CLAUDE.md",
        "CLAUDE_INSTRUCTIONS.md",
        "DOCKYARD_WIFI_PROJECT_DOCUMENTATION.md",
        "HANDOFF.md",
        "HANDOFF_PROMPT.md",
        "OAUTH-REQUIREMENTS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RELAY.md",
        "TODO.md",
        "admin/package-lock.json",
        "admin/package.json",
        "admin/server.js",
        "admin/voucherService.js",
        "backend/emailService.js",
        "backend/facebookAuthService.js",
        "backend/freshsalesService.js",
        "backend/googleAuthService.js",
        "backend/index.js",
        "backend/package-lock.json",
        "backend/package.json",
        "backend/voucherService.js",
        "docs/ADMIN_GUIDE.md",
        "docs/PAYMENT_INTEGRATION.md",
        "docs/SPONSOR_ONBOARDING_GUIDE.md",
        "docs/USER_GUIDE.md",
        "node_modules/.package-lock.json",
        "package-lock.json",
        "package.json"
      ],
      "health_score": 88
    },
    {
      "name": "David Bishop",
      "server": "agents",
      "type": "agent",
      "path": "/home/david",
      "domain": "davidbot.rize.bm",
      "ports": [
        9001
      ],
      "scanned_at": "2026-02-07T23:10:57.173259+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: README.md, TODO.md, CHANGELOG.md, SPEC.md, SECURITY.md, INTEGRATIONS.md, RUNBOOK.md, ESCALATION.md, AUDIT-LOG.md"
        },
        {
          "severity": "critical",
          "message": "Port 9001 not responding"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": false,
          "status": "warning"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": null,
      "todo": null,
      "changelog": null,
      "todos_parsed": [],
      "todos_open": 0,
      "todos_done": 0,
      "version": null,
      "git": {
        "status": "not_git",
        "changes": []
      },
      "ports_status": [
        {
          "port": 9001,
          "open": false,
          "http_code": 0,
          "healthy": false
        }
      ],
      "files": [],
      "health_score": 65
    },
    {
      "name": "Apex",
      "server": "agents",
      "type": "agent",
      "path": "/home/agents/apex",
      "domain": null,
      "ports": [
        9002
      ],
      "scanned_at": "2026-02-07T23:11:14.089843+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Apex \u2014 Finance Intelligence Agent\n\n**Version:** 1.1.0\n**Host:** agents@192.168.65.241\n**Port:** 9002\n**Status:** MOCK MODE (Phase 1)\n\n---\n\n## Overview\n\nApex is Rize Technology Group's finance intelligence agent. It reads data from Xero (accounting) and Halo PSA (timesheets/tickets) to identify revenue leakage, billing anomalies, and financial trends.\n\n**Phase 1 (Current):** Read-only observer with mock data. All integrations return realistic test data. No writes to any external system.\n\n**Phase 2 (Planned):** Live Xero and Halo PSA read access. Daily/weekly reports to CEO via MS Teams.\n\n**Phase 3 (Future):** Advisory mode \u2014 recommends billing corrections, draft invoices for CEO review.\n\n---\n\n## Architecture\n\n```\napex/\n\u251c\u2500\u2500 main.py              # FastAPI server \u2014 endpoints, heartbeat, Teams handler\n\u251c\u2500\u2500 .env                 # Configuration (MOCK_MODE=true, READ_ONLY_MODE=true)\n\u251c\u2500\u2500 integrations/\n\u2502   \u251c\u2500\u2500 xero_client.py   # Xero API \u2014 P&L, invoices, contacts, bank txns\n\u2502   \u2514\u2500\u2500 halo_client.py   # Halo PSA \u2014 timesheets, tickets, clients\n\u251c\u2500\u2500 analysis/\n\u2502   \u2514\u2500\u2500 revenue_leakage.py  # Cross-system leakage detection\n\u251c\u2500\u2500 reporting/\n\u2502   \u2514\u2500\u2500 financial_summary.py # Daily digest + weekly report generator\n\u2514\u2500\u2500 docs/\n    \u251c\u2500\u2500 README.md         # This file\n    \u251c\u2500\u2500 CLAUDE.md         # Claude Code instructions\n    \u251c\u2500\u2500 TODO.md           # Task tracker\n    \u251c\u2500\u2500 CHANGELOG.md      # Version history\n    \u2514\u2500\u2500 PROJECT_PLAN.md   # Roadmap\n```\n\n## Endpoints\n\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /health | GET | Health check with memory/uptime |\n| /status | GET | Agent status + config |\n| /api/teams/message | POST | Teams message handler |\n| /reports/latest | GET | Most recent generated report |\n| /reports/daily | GET | Generate daily digest |\n| /reports/weekly | GET | Generate weekly report |\n| /analysis/leakage | GET | Revenue leakage analysis |\n\n## Safety\n\n- **MOCK_MODE=true** \u2014 All integrations return mock data\n- **READ_ONLY_MODE=true** \u2014 Hardcoded startup check, exits if false\n- No write operations to Xero, Halo, or any external API\n- All actions logged with timestamps\n- Sentinel monitors via heartbeat every 5 minutes\n\n## Integrations\n\n| System | Status | Scope |\n|--------|--------|-------|\n| Xero | Mock | P&L, invoices, contacts, bank transactions |\n| Halo PSA | Mock | Timesheets, tickets, clients |\n| MS Teams | Via Homebase | Report delivery to CEO/CFO |\n| Homebase | Active | Heartbeat + bot message relay |\n\n## Running\n\n```bash\n# Service managed by systemd\nsystemctl --user status apex\nsystemctl --user restart apex  # Only when instructed\n\n# Manual test\ncd /home/agents/apex\nsource venv/bin/activate  # if using venv\npython3 main.py\n```",
      "todo": "# Apex Finance Agent \u2014 TODO\n\n## Phase 1: Mock Observer \u2014 IN PROGRESS\n- [x] FastAPI server on port 9002\n- [x] /health endpoint with memory + uptime\n- [x] Teams message handler via Homebase\n- [x] Heartbeat to Homebase every 5 minutes\n- [x] MOCK_MODE=true with hardcoded safety check\n- [x] READ_ONLY_MODE=true with hardcoded safety check\n- [x] Xero API client (mock responses)\n- [x] Halo PSA client (mock responses)\n- [x] Revenue leakage analyzer\n- [x] Daily digest generator\n- [x] Weekly report generator\n- [ ] /reports/latest endpoint in main.py\n- [ ] /reports/daily endpoint in main.py\n- [ ] /reports/weekly endpoint in main.py\n- [ ] /analysis/leakage endpoint in main.py\n- [ ] Switch LLM to Anthropic API (currently 402 on OpenRouter)\n- [ ] Scheduled report generation (APScheduler \u2014 every 6 hours)\n- [ ] MS Teams webhook for report delivery\n\n## Phase 2: Live Read-Only\n- [ ] Complete Xero OAuth flow (get Tenant ID, test refresh)\n- [ ] Test live Xero P&L, invoices, contacts\n- [ ] Test live Halo PSA timesheets, tickets\n- [ ] Build billing model classifier (AYCE / AYCE+Hourly / Bill-by-Hour)\n- [ ] Daily digest at 07:00 UTC \u2014 P&L snapshot, unbilled hours, AYCE overuse\n- [ ] Weekly report Monday 07:00 UTC \u2014 deep revenue/margin analysis\n- [ ] Bot Framework reply flow for Teams responses\n\n## Phase 3: Advisory Mode\n- [ ] Recommend billing corrections\n- [ ] Draft invoices for CEO review\n- [ ] Proactive alerts for revenue risks\n- [ ] Historical trend analysis",
      "changelog": "# Changelog \u2014 Apex Finance Agent\n\n## v1.1.0 \u2014 2026-02-07\n### Integration Stubs + Analysis\n- integrations/xero_client.py \u2014 Full Xero API client with mock data (P&L, invoices, contacts, bank txns)\n- integrations/halo_client.py \u2014 Halo PSA client with mock data (timesheets, tickets, clients, unbilled)\n- analysis/revenue_leakage.py \u2014 Cross-system leakage detection (unbilled hours, AYCE overuse, overdue)\n- reporting/financial_summary.py \u2014 Daily digest + weekly report generator with Teams formatting\n- Hardcoded READ_ONLY_MODE safety check at startup\n- MOCK_MODE fixed to true\n- Documentation: README.md, CLAUDE.md, TODO.md, CHANGELOG.md, PROJECT_PLAN.md\n\n## v1.0.0 \u2014 2026-02-06\n### Initial Deployment\n- FastAPI server on port 9002\n- /health endpoint\n- Teams message handler via Homebase\n- Heartbeat to Homebase\n- System prompt with Phase 1 restrictions",
      "todos_parsed": [
        {
          "text": "FastAPI server on port 9002",
          "done": true
        },
        {
          "text": "/health endpoint with memory + uptime",
          "done": true
        },
        {
          "text": "Teams message handler via Homebase",
          "done": true
        },
        {
          "text": "Heartbeat to Homebase every 5 minutes",
          "done": true
        },
        {
          "text": "MOCK_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "READ_ONLY_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "Xero API client (mock responses)",
          "done": true
        },
        {
          "text": "Halo PSA client (mock responses)",
          "done": true
        },
        {
          "text": "Revenue leakage analyzer",
          "done": true
        },
        {
          "text": "Daily digest generator",
          "done": true
        },
        {
          "text": "Weekly report generator",
          "done": true
        },
        {
          "text": "/reports/latest endpoint in main.py",
          "done": false
        },
        {
          "text": "/reports/daily endpoint in main.py",
          "done": false
        },
        {
          "text": "/reports/weekly endpoint in main.py",
          "done": false
        },
        {
          "text": "/analysis/leakage endpoint in main.py",
          "done": false
        },
        {
          "text": "Switch LLM to Anthropic API (currently 402 on OpenRouter)",
          "done": false
        },
        {
          "text": "Scheduled report generation (APScheduler \u2014 every 6 hours)",
          "done": false
        },
        {
          "text": "MS Teams webhook for report delivery",
          "done": false
        },
        {
          "text": "Complete Xero OAuth flow (get Tenant ID, test refresh)",
          "done": false
        },
        {
          "text": "Test live Xero P&L, invoices, contacts",
          "done": false
        }
      ],
      "todos_open": 9,
      "todos_done": 11,
      "version": "1.1.0",
      "git": {
        "status": "clean",
        "branch": "unknown",
        "last_commit": "unknown",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 9002,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "AUDIT-LOG.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DASHBOARD.md",
        "DEPLOYMENT.md",
        "ENDPOINTS_PATCH.py",
        "ESCALATION.md",
        "INTEGRATIONS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RUNBOOK.md",
        "SECURITY.md",
        "SPEC.md",
        "TODO.md",
        "TROUBLESHOOTING.md",
        "analysis/__init__.py",
        "analysis/anomaly_detector.py",
        "analysis/billing_classifier.py",
        "analysis/revenue_leakage.py",
        "analysis/timesheet_auditor.py",
        "config.py",
        "db/__init__.py",
        "db/models.py",
        "integrations/__init__.py",
        "integrations/halo_client.py",
        "integrations/homebase_client.py",
        "integrations/spreadsheet_parser.py",
        "integrations/xero_client.py",
        "main.py",
        "reporting/__init__.py",
        "reporting/daily_digest.py",
        "reporting/financial_summary.py",
        "reporting/monthly_package.py",
        "reporting/weekly_report.py"
      ],
      "health_score": 100
    },
    {
      "name": "Aegis",
      "server": "agents",
      "type": "agent",
      "path": "/home/agents/aegis",
      "domain": null,
      "ports": [
        9003
      ],
      "scanned_at": "2026-02-07T23:11:27.826390+00:00",
      "status": "ok",
      "issues": [],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SPEC.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "SECURITY.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "INTEGRATIONS.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "RUNBOOK.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "ESCALATION.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "AUDIT-LOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        }
      ],
      "readme": "# Aegis \u2014 Infrastructure Intelligence Agent\n\n**Version:** 1.1.0\n**Host:** agents@192.168.65.241\n**Port:** 9003\n**Status:** MOCK MODE (Phase 1)\n\n---\n\n## Overview\n\nAegis is Rize Technology Group's infrastructure intelligence agent. It reads data from PRTG (network monitoring), Action1 (patch management), and Halo PSA (ticketing) to identify alert patterns, compliance gaps, and operational risks.\n\n**Phase 1 (Current):** Read-only observer with mock data.\n**Phase 2 (Planned):** Live PRTG, Action1, Halo read access. Daily/weekly reports.\n**Phase 3 (Future):** Advisory mode \u2014 recommends ticket responses, suggests remediation.\n\n---\n\n## Architecture\n\n```\naegis/\n\u251c\u2500\u2500 main.py                  # FastAPI server \u2014 endpoints, heartbeat, Teams handler\n\u251c\u2500\u2500 .env                     # Configuration (MOCK_MODE=true, READ_ONLY_MODE=true)\n\u251c\u2500\u2500 integrations/\n\u2502   \u251c\u2500\u2500 prtg_client.py       # PRTG \u2014 sensors, alerts, devices, history\n\u2502   \u251c\u2500\u2500 action1_client.py    # Action1 \u2014 endpoints, patches, compliance\n\u2502   \u2514\u2500\u2500 halo_client.py       # Halo PSA \u2014 tickets, SLA breaches\n\u251c\u2500\u2500 intelligence/\n\u2502   \u251c\u2500\u2500 alert_correlator.py  # PRTG alert \u2194 Halo ticket matching\n\u2502   \u2514\u2500\u2500 pattern_detector.py  # Recurring pattern detection\n\u251c\u2500\u2500 reporting/\n\u2502   \u2514\u2500\u2500 infrastructure_report.py  # Daily briefing + weekly compliance\n\u2514\u2500\u2500 docs/\n    \u251c\u2500\u2500 README.md, CLAUDE.md, TODO.md, CHANGELOG.md, PROJECT_PLAN.md\n```\n\n## Endpoints\n\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| /health | GET | Health check with memory/uptime |\n| /status | GET | Agent status + config |\n| /api/teams/message | POST | Teams message handler |\n| /alerts/active | GET | Active PRTG alerts |\n| /correlations | GET | Alert-to-ticket correlations |\n| /reports/daily | GET | Generate daily briefing |\n| /reports/weekly | GET | Generate weekly compliance |\n| /patterns | GET | Detected recurring patterns |\n\n## Safety\n\n- **MOCK_MODE=true** \u2014 All integrations return mock data\n- **READ_ONLY_MODE=true** \u2014 Hardcoded startup check\n- No write operations to PRTG, Action1, Halo, or any external API\n- Sentinel monitors via heartbeat every 5 minutes",
      "todo": "# Aegis Infrastructure Agent \u2014 TODO\n\n## Phase 1: Mock Observer \u2014 IN PROGRESS\n- [x] FastAPI server on port 9003\n- [x] /health endpoint with memory + uptime\n- [x] Teams message handler via Homebase\n- [x] Heartbeat to Homebase every 5 minutes\n- [x] MOCK_MODE=true with hardcoded safety check\n- [x] READ_ONLY_MODE=true with hardcoded safety check\n- [x] PRTG API client (mock sensors, alerts, devices)\n- [x] Action1 API client (mock endpoints, patches, compliance)\n- [x] Halo PSA ticket client (mock tickets, SLA breaches)\n- [x] Alert correlator (PRTG alert \u2194 Halo ticket matching)\n- [x] Pattern detector (repeat offenders, flapping, concentration)\n- [x] Daily briefing generator\n- [x] Weekly compliance report generator\n- [ ] /alerts/active endpoint in main.py\n- [ ] /correlations endpoint in main.py\n- [ ] /patterns endpoint in main.py\n- [ ] /reports/daily and /reports/weekly endpoints in main.py\n- [ ] Switch LLM to Anthropic API\n- [ ] Scheduled report generation (APScheduler)\n- [ ] MS Teams webhook for report delivery\n\n## Phase 2: Live Read-Only\n- [ ] Connect to live PRTG (verify passhash works)\n- [ ] Connect to live Action1 (verify API key)\n- [ ] Connect to live Halo PSA (verify OAuth)\n- [ ] Build asset tracker (SSL certs, domains, licenses)\n- [ ] Daily briefing at 07:30 UTC\n- [ ] Weekly compliance Monday 08:00 UTC\n- [ ] Bot Framework reply flow\n\n## Phase 3: Advisory Mode\n- [ ] Recommend ticket responses\n- [ ] Suggest remediation steps\n- [ ] Proactive infrastructure risk alerts\n- [ ] Historical trend analysis",
      "changelog": "# Changelog \u2014 Aegis Infrastructure Agent\n\n## v1.1.0 \u2014 2026-02-07\n### Integration Stubs + Intelligence\n- integrations/prtg_client.py \u2014 PRTG API client with mock data (sensors, alerts, devices, history)\n- integrations/action1_client.py \u2014 Action1 RMM client with mock data (endpoints, patches, compliance)\n- integrations/halo_client.py \u2014 Halo PSA ticket client with mock data (tickets, SLA breaches)\n- intelligence/alert_correlator.py \u2014 PRTG alert \u2194 Halo ticket matching with confidence scoring\n- intelligence/pattern_detector.py \u2014 Recurring pattern detection (repeat offenders, flapping, concentration)\n- reporting/infrastructure_report.py \u2014 Daily briefing + weekly compliance report generator\n- Hardcoded READ_ONLY_MODE safety check at startup\n- MOCK_MODE fixed to true\n- Documentation: README.md, CLAUDE.md, TODO.md, CHANGELOG.md, PROJECT_PLAN.md\n\n## v1.0.0 \u2014 2026-02-06\n### Initial Deployment\n- FastAPI server on port 9003\n- /health endpoint\n- Teams message handler via Homebase\n- Heartbeat to Homebase\n- System prompt with Phase 1 restrictions",
      "todos_parsed": [
        {
          "text": "FastAPI server on port 9003",
          "done": true
        },
        {
          "text": "/health endpoint with memory + uptime",
          "done": true
        },
        {
          "text": "Teams message handler via Homebase",
          "done": true
        },
        {
          "text": "Heartbeat to Homebase every 5 minutes",
          "done": true
        },
        {
          "text": "MOCK_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "READ_ONLY_MODE=true with hardcoded safety check",
          "done": true
        },
        {
          "text": "PRTG API client (mock sensors, alerts, devices)",
          "done": true
        },
        {
          "text": "Action1 API client (mock endpoints, patches, compliance)",
          "done": true
        },
        {
          "text": "Halo PSA ticket client (mock tickets, SLA breaches)",
          "done": true
        },
        {
          "text": "Alert correlator (PRTG alert \u2194 Halo ticket matching)",
          "done": true
        },
        {
          "text": "Pattern detector (repeat offenders, flapping, concentration)",
          "done": true
        },
        {
          "text": "Daily briefing generator",
          "done": true
        },
        {
          "text": "Weekly compliance report generator",
          "done": true
        },
        {
          "text": "/alerts/active endpoint in main.py",
          "done": false
        },
        {
          "text": "/correlations endpoint in main.py",
          "done": false
        },
        {
          "text": "/patterns endpoint in main.py",
          "done": false
        },
        {
          "text": "/reports/daily and /reports/weekly endpoints in main.py",
          "done": false
        },
        {
          "text": "Switch LLM to Anthropic API",
          "done": false
        },
        {
          "text": "Scheduled report generation (APScheduler)",
          "done": false
        },
        {
          "text": "MS Teams webhook for report delivery",
          "done": false
        }
      ],
      "todos_open": 7,
      "todos_done": 13,
      "version": "1.1.0",
      "git": {
        "status": "clean",
        "branch": "unknown",
        "last_commit": "unknown",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 9003,
          "open": true,
          "http_code": 404,
          "healthy": true
        }
      ],
      "files": [
        "API.md",
        "ARCHITECTURE.md",
        "AUDIT-LOG.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "DEPLOYMENT.md",
        "ENDPOINTS_PATCH.py",
        "ESCALATION.md",
        "INTEGRATIONS.md",
        "PROJECT_PLAN.md",
        "README.md",
        "RUNBOOK.md",
        "SECURITY.md",
        "SPEC.md",
        "TODO.md",
        "TROUBLESHOOTING.md",
        "config.py",
        "db/__init__.py",
        "db/models.py",
        "integrations/__init__.py",
        "integrations/action1_client.py",
        "integrations/halo_client.py",
        "integrations/homebase_client.py",
        "integrations/prtg_client.py",
        "intelligence/__init__.py",
        "intelligence/alert_correlator.py",
        "intelligence/anomaly_detector.py",
        "intelligence/asset_tracker.py",
        "intelligence/customer_profiler.py",
        "intelligence/pattern_detector.py",
        "intelligence/ticket_analyzer.py",
        "main.py",
        "reporting/__init__.py",
        "reporting/asset_report.py",
        "reporting/compliance_report.py",
        "reporting/daily_briefing.py",
        "reporting/infrastructure_report.py"
      ],
      "health_score": 100
    },
    {
      "name": "BET Air Ambulance",
      "server": "vector",
      "type": "infrastructure",
      "path": "/home/betadmin/bet",
      "domain": "vector.rize.bm",
      "ports": [
        3000
      ],
      "scanned_at": "2026-02-07T23:11:41.593656+00:00",
      "status": "ok",
      "issues": [
        {
          "severity": "warning",
          "message": "Missing required docs: DEPLOYMENT.md"
        },
        {
          "severity": "critical",
          "message": "Port 3000 not responding"
        }
      ],
      "docs": [
        {
          "file": "README.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "TODO.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "CHANGELOG.md",
          "required": true,
          "exists": true,
          "status": "ok"
        },
        {
          "file": "DEPLOYMENT.md",
          "required": true,
          "exists": false,
          "status": "warning"
        }
      ],
      "readme": "# Vector-BET - Bermuda Emergency Transport\n\n> **Air Ambulance Operations Platform**\n> \n> **Organization**: Bermuda Emergency Transport (BET) - Nonprofit\n> \n> **Purpose**: Manage air ambulance flights, patient transport, medical crew scheduling, and insurance quoting\n\n> **Related Docs:** [TODO.md](TODO.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [ADSB_TECHNICAL.md](ADSB_TECHNICAL.md) | [HANDOFF.md](HANDOFF.md) | [CHANGELOG.md](CHANGELOG.md)\n\n## Overview\n\nVector is a comprehensive air ambulance operations platform for Bermuda Emergency Transport (BET), a nonprofit organization providing critical medical transport services for Bermuda. The platform manages the complete lifecycle of medical air transport cases, from initial intake through patient delivery, including:\n\n- **Case Management**: Full patient case lifecycle tracking\n- **Aviation Intelligence**: Real-time aircraft tracking and flight planning\n- **AI Document Intake**: Automated extraction from medical documents\n- **Crew Management**: Pilot and medical staff scheduling\n- **Insurance Quoting**: Dollar-per-mile pricing for insurance companies\n\n## Tech Stack\n\n- **Backend**: Python FastAPI + PostgreSQL\n- **Frontend**: React 19 + Vite + TailwindCSS  \n- **Server**: Ubuntu 24.04 VM (192.168.65.249)\n- **External Access**: Cloudflare Tunnels\n- **ADS-B Receiver**: Raspberry Pi + RTL-SDR (roof-mounted)\n- **AI**: Claude Sonnet 4 (Anthropic) for document extraction\n- **Monitoring**: Email alerts + PRTG endpoints\n\n## URLs\n\n| Service | URL |\n|---------|-----|\n| App | https://app.bet.bm |\n| API | https://vector.bet.bm |\n| API Docs | https://vector.bet.bm/docs |\n| Vector SSH | vector-ssh.bet.bm (via cloudflared) |\n| Pi SSH | adsb-ssh.bet.bm (via cloudflared) |\n\n## Key Features\n\n### Case Management\n- Full case lifecycle (Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)\n- Patient demographics with passport tracking\n- Companion information for family escorts\n- Clinical documentation and medical history\n- Document management (14 categories)\n- Audit logging (PIPA/HIPAA compliant)\n\n### AI Document Intake\n- Upload up to 25 documents (PDF, Word, Excel, images)\n- Claude Sonnet 4 extracts 30+ fields automatically\n- Multi-document intelligent merging\n- Background processing with progress tracking\n- One-click case creation from extracted data\n\n### Aviation Intelligence\n- Real-time aircraft tracking (ADS-B + OpenSky + FlightAware)\n- Weather and NOTAMs display\n- Flight planning with distance/time calculation\n- LJ45 range checking\n- Hidden aircraft detection\n\n### Crew Management\n- Pilot and medical staff profiles\n- License/certification tracking\n- Case crew assignments\n- Availability status\n\n### Quoting System\n- Dynamic quote calculator\n- Flat rate and per-mile pricing\n- Common routes: Bermuda to Boston, Toronto, NYC, Miami\n\n### eAPIS Integration\n- Electronic manifest generation\n- XML and text export formats\n- US/Canada customs compliance\n\n### Mobile PWA\n- Offline-capable progressive web app\n- Voice transcription for mobile intake\n- IndexedDB for offline data storage\n\n## Aviation Data Sources\n\n| Source | Type | Update Rate | Coverage |\n|--------|------|-------------|----------|\n| Local ADS-B | Primary | Real-time | ~250nm from Bermuda |\n| OpenSky Network | Secondary | 30s cache | Global |\n| FlightAware | Scraper | 8-12 min | TXKF arrivals/departures |\n| ADS-B Exchange | API | Real-time | Global |\n\n## Services\n\n### Vector Server (192.168.65.249)\n```bash\nsudo systemctl status vector-api vector-frontend adsb-tunnel\nsudo systemctl restart vector-api\nsudo journalctl -u vector-api -n 50\n```\n\n### ADS-B Receiver (192.168.111.240)\n```bash\nssh -o ProxyCommand=\"cloudflared access ssh --hostname adsb-ssh.bet.bm\" pi@adsb-ssh.bet.bm\nsudo systemctl status readsb cloudflared\n```\n\n## Quick Reference\n```bash\n# Database access\ndocker exec -it vector-db psql -U vector -d vector\n\n# Git operations\ncd /opt/vector && git add -A && git commit -m \"message\" && git push\n```\n\n## Security\n\n- All services bound to localhost\n- Cloudflare tunnels handle external access\n- Cloudflare Access policies protect endpoints\n- Anthropic API key in backend/.env\n\n## Organization\n\n**Bermuda Emergency Transport (BET)** is a nonprofit organization providing air ambulance services for Bermuda residents requiring emergency or scheduled medical transport to specialized care facilities in North America.\n\n**Technical Partner**: Rize Technologies Ltd - Bermuda",
      "todo": "# Vector-BET TODO\n\n> **Related Docs:** [README.md](README.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [ADSB_TECHNICAL.md](ADSB_TECHNICAL.md) | [HANDOFF.md](HANDOFF.md) | [CHANGELOG.md](CHANGELOG.md)\n\n---\n\n## EXISTING FEATURES (Verified Working)\n\n### Core Case Management \u2713\n- [x] Database schema design\n- [x] Basic API structure (FastAPI)\n- [x] Cases CRUD API\n- [x] Parties API\n- [x] Flights API\n- [x] Frontend scaffolding (React 19 + Vite + Tailwind)\n- [x] Dashboard with stats\n- [x] Cases list with search/filter\n- [x] Case detail page with all fields\n- [x] Workflow stepper (5 phases: Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)\n- [x] Status transitions with validation\n- [x] Inline edit mode for case fields\n\n### Patient & Companion Management \u2713\n- [x] Patient demographics (phone, email, address, weight)\n- [x] Patient passport tracking (number, expiry, country)\n- [x] Companion info fields\n- [x] Companion passport tracking\n- [x] Next of kin contact\n- [x] Past medical history\n- [x] Clinical documentation\n\n### Document Management \u2713\n- [x] Document upload/download/delete\n- [x] Document types (14 categories)\n- [x] Timeline events display\n- [x] Audit logging (PIPA/HIPAA compliant)\n- [x] Audit log viewer with export\n\n### Flight Planning \u2713\n- [x] Flight planning - multi-leg support\n- [x] Airport database (24,223 airports)\n- [x] Searchable airport dropdown\n- [x] Auto-return leg creation\n- [x] Distance/time calculation (Haversine)\n- [x] LJ45 range checking with warnings\n- [x] Facilities database (45+ hospitals)\n- [x] Facilities search API\n- [x] Destination normalization (city/state/country)\n\n### Crew Management \u2713\n- [x] Crew database (12 members: pilots + medical)\n- [x] Crew CRUD with full profile editing\n- [x] License/certification tracking\n- [x] Crew availability status\n- [x] Case crew assignments table\n\n### Settings & Admin \u2713\n- [x] Settings system (81 settings, 12 categories)\n- [x] Aircraft profiles (configurable speed, range)\n- [x] Admin sidebar layout\n- [x] User context with admin detection\n\n### Security \u2713\n- [x] Cloudflare Access authentication module\n- [x] Server-side JWT validation\n- [x] get_current_user dependency for all routes\n- [x] require_admin dependency for admin routes\n- [x] /api/users/me endpoint\n- [x] Auto-create users on first login\n- [x] File upload size limit enforcement\n- [x] File extension allowlist per document type\n- [x] Magic bytes validation\n- [x] Generic error messages (hide SQL details)\n- [x] Frontend fetches user from API\n\n### Local ADS-B Integration \u2713\n- [x] Roof-mounted ADS-B receiver (Raspberry Pi + RTL-SDR)\n- [x] Cloudflare Tunnel for Pi connectivity\n- [x] Beast protocol decoder service\n- [x] Merged data sources (local ADSB + OpenSky + FlightAware)\n- [x] Deduplication by ICAO hex\n- [x] Resilient reconnection with exponential backoff\n- [x] USB watchdog script for Pi stability\n- [x] ADSB health endpoint for PRTG monitoring\n- [x] FlightAware scraper\n- [x] Source tracking column in aviation_movements\n\n### Email & Alerting \u2713\n- [x] SMTP email service\n- [x] Source monitoring service\n- [x] Alert on source down > 30 minutes\n- [x] Cooldown to prevent alert spam\n- [x] /api/aviation/sources/status endpoint\n\n### AI Document Intake \u2713\n- [x] Claude Sonnet 4 integration\n- [x] Multi-document upload (up to 25 files)\n- [x] PDF/Word/Excel/Image extraction\n- [x] Intelligent field merging\n- [x] Confidence scoring\n- [x] Background job processing\n- [x] One-click case creation\n- [x] Patient demographics extraction\n- [x] Database columns for new fields\n- [x] Anti-hallucination validation\n\n### Aviation Intelligence \u2713\n- [x] Fixed FlightAware scraper (correct table parsing)\n- [x] FlightSchedule component with 6 tabs\n- [x] Hidden aircraft detection (blocked from FlightAware)\n- [x] Merged /api/aviation/schedule endpoint\n- [x] Search filter in FlightSchedule\n- [x] Aircraft photos from Planespotters.net\n- [x] Simplified Aviation page (removed duplicate tabs)\n- [x] Source tracking for all movements\n- [x] data_source_status table\n- [x] ADS-B Exchange API integration\n\n### Quoting System \u2713\n- [x] Dynamic Quote Calculator (flat rate AND per-mile pricing)\n- [x] Quoted/actual pricing fields on cases\n\n### eAPIS Manifest \u2713\n- [x] eAPIS Manifest Generator (XML + text export)\n\n### Reports \u2713\n- [x] Monthly Financial Report (auto-generate + email)\n- [x] Monthly Directors Report (auto-generate + email)\n- [x] Report scheduling system\n\n### Mobile PWA \u2713\n- [x] Mobile PWA with offline support\n- [x] Voice transcription for mobile intake\n- [x] IndexedDB for offline data storage\n\n### Relay Integration \u2713\n- [x] Health endpoint at /health\n- [x] Monitored in Pulse dashboard\n\n---\n\n## PLANNED FEATURES (Not Yet Implemented)\n\n### \ud83d\udea8 PRIORITY: Production Readiness\n- [ ] OpenSky API credentials (reduce rate limiting)\n- [ ] Troubleshoot ADS-B Pi connection (offline)\n- [ ] Fix Pi power supply (5V 3A + powered USB hub)\n\n### Provider Mobile App (Nurses & Paramedics)\n- [ ] Offline-capable PWA for medical crew\n- [ ] Patient notes entry even when offline\n- [ ] Sync when reconnected\n- [ ] Secure access for field staff\n\n### Aircraft Tracking Enhancement\n- [ ] FlightAware API integration (official, not scraper)\n- [ ] Assign tail number to patient case\n- [ ] Automated takeoff and landing alerts\n- [ ] Push notifications to case stakeholders\n\n### Payment Processing\n- [ ] Insurance pre-authorization workflow\n- [ ] Authorization obtained on patient's behalf\n- [ ] Credit card processing integration\n- [ ] Bank transfer support\n- [ ] Invoice generation\n\n### Schedule Management\n- [ ] 24/7 coverage scheduling (2 pilots, 1-2 nurses, 1 paramedic, office staff)\n- [ ] Shift scheduling interface\n- [ ] On-call rotation management\n- [ ] Availability conflicts detection\n\n### Phase 2: NICE TO HAVE\n- [ ] Timeline-based ePCR (electronic Patient Care Report)\n- [ ] Satellite Tracking for over-ocean flights\n- [ ] Push Notifications\n- [ ] Dark Mode for Pilots\n\n### Phase 3: FUTURE\n- [ ] NEMSIS v3.5 Compliance (US EMS reporting standard)\n- [ ] HL7/FHIR Integration (healthcare interoperability)\n- [ ] ForeFlight API\n- [ ] Real-time WebSocket Updates\n- [ ] Billing/Invoicing Module\n\n---\n\n## Common Routes (For Reference)\n\nBermuda air ambulance services commonly fly to these destinations:\n- **Bermuda \u2192 Boston** (Boston Medical Center, MGH, etc.)\n- **Bermuda \u2192 New York** (NYC area hospitals)\n- **Bermuda \u2192 Miami** (Jackson Memorial, etc.)\n- **Bermuda \u2192 Toronto** (Canadian medical facilities)\n\n---\n\n## Notes\n\n- This is **AIR AMBULANCE** software for **Bermuda Emergency Transport (BET)**, a nonprofit\n- All terminology uses patient (not passenger), pilot/medical crew (not driver)\n- Platform manages flights, not ferries or buses",
      "changelog": "# Changelog\n\n> **Related Docs:** [README.md](README.md) | [TODO.md](TODO.md) | [VECTOR_TECHNICAL_BRIEFING.md](VECTOR_TECHNICAL_BRIEFING.md) | [HANDOFF.md](HANDOFF.md)\n\n## [1.0.1] - 2026-01-28\n### Documentation\n- Updated README.md with comprehensive air ambulance description\n- Clarified BET as Bermuda Emergency Transport nonprofit\n- Reorganized TODO.md to clearly separate existing vs planned features\n- Added planned features: Provider Mobile App, Payment Processing, Schedule Management\n- Added common routes reference (Boston, NYC, Miami, Toronto)\n- Cross-referenced all markdown documentation files\n\n## [1.0.0] - 2026-01-23\n### Added\n- Relay/Pulse integration\n- Health endpoint at /health\n\n## [0.11.0] - 2026-01-27\n### Added (Session 11)\n- Display patient_email, patient_address, next_of_kin on case detail\n- Dynamic Quote Calculator (flat rate AND per-mile pricing)\n- eAPIS Manifest Generator (XML + text export)\n- Monthly Financial Report (auto-generate + email)\n- Monthly Directors Report (auto-generate + email)\n- Report scheduling system\n- Mobile PWA with offline support\n- Voice transcription for mobile intake\n- IndexedDB for offline data storage\n- ADS-B Exchange API integration\n- AI anti-hallucination validation\n\n## [0.10.0] - 2026-01-08\n### Added (Session 10)\n- Fixed FlightAware scraper (correct table parsing)\n- FlightSchedule component with 6 tabs\n- Hidden aircraft detection\n- Aircraft photos from Planespotters.net\n- Simplified Aviation page\n\n## [0.9.0] - 2026-01-07\n### Added (Session 9)\n- AI Document Intake system (Claude Sonnet 4)\n- Multi-document upload (up to 25 files)\n- Patient demographics extraction\n- Background job processing\n\n## [0.8.0] - 2026-01-07\n### Added (Session 8)\n- Local ADS-B receiver integration\n- SMTP email service\n- Source monitoring and alerting\n- FlightAware scraper\n\n## Previous\n- Full case management system\n- Aviation intelligence tracking\n- Multi-source ADS-B integration\n- OpenSky API integration\n- Crew management\n- Settings system\n- Security hardening",
      "todos_parsed": [
        {
          "text": "Database schema design",
          "done": true
        },
        {
          "text": "Basic API structure (FastAPI)",
          "done": true
        },
        {
          "text": "Cases CRUD API",
          "done": true
        },
        {
          "text": "Parties API",
          "done": true
        },
        {
          "text": "Flights API",
          "done": true
        },
        {
          "text": "Frontend scaffolding (React 19 + Vite + Tailwind)",
          "done": true
        },
        {
          "text": "Dashboard with stats",
          "done": true
        },
        {
          "text": "Cases list with search/filter",
          "done": true
        },
        {
          "text": "Case detail page with all fields",
          "done": true
        },
        {
          "text": "Workflow stepper (5 phases: Intake \u2192 Coordination \u2192 Pickup \u2192 Transport \u2192 Complete)",
          "done": true
        },
        {
          "text": "Status transitions with validation",
          "done": true
        },
        {
          "text": "Inline edit mode for case fields",
          "done": true
        },
        {
          "text": "Patient demographics (phone, email, address, weight)",
          "done": true
        },
        {
          "text": "Patient passport tracking (number, expiry, country)",
          "done": true
        },
        {
          "text": "Companion info fields",
          "done": true
        },
        {
          "text": "Companion passport tracking",
          "done": true
        },
        {
          "text": "Next of kin contact",
          "done": true
        },
        {
          "text": "Past medical history",
          "done": true
        },
        {
          "text": "Clinical documentation",
          "done": true
        },
        {
          "text": "Document upload/download/delete",
          "done": true
        }
      ],
      "todos_open": 0,
      "todos_done": 20,
      "version": "1.0.1",
      "git": {
        "status": "clean",
        "branch": "main",
        "last_commit": "129eafd Auto-backup: $(date \"+%Y-%m-%d %H:%M\") (5 days ago)",
        "changes": [],
        "uncommitted_count": 0
      },
      "ports_status": [
        {
          "port": 3000,
          "open": false,
          "http_code": 0,
          "healthy": false
        }
      ],
      "files": [
        "ADSB_TECHNICAL.md",
        "CHANGELOG.md",
        "CLAUDE.md",
        "HANDOFF.md",
        "README.md",
        "TODO.md",
        "VECTOR_TECHNICAL_BRIEFING.md",
        "frontend/README.md",
        "frontend/eslint.config.js",
        "frontend/package-lock.json",
        "frontend/package.json",
        "frontend/postcss.config.js",
        "frontend/tailwind.config.js",
        "frontend/vite.config.js"
      ],
      "health_score": 65
    }
  ],
  "issues": [
    {
      "project": "David Bishop",
      "server": "agents",
      "severity": "critical",
      "message": "Port 9001 not responding"
    },
    {
      "project": "BET Air Ambulance",
      "server": "vector",
      "severity": "critical",
      "message": "Port 3000 not responding"
    },
    {
      "project": "Dockyard WiFi",
      "server": "rize-apps",
      "severity": "warning",
      "message": "Missing required docs: DEPLOYMENT.md"
    },
    {
      "project": "David Bishop",
      "server": "agents",
      "severity": "warning",
      "message": "Missing required docs: README.md, TODO.md, CHANGELOG.md, SPEC.md, SECURITY.md, INTEGRATIONS.md, RUNBOOK.md, ESCALATION.md, AUDIT-LOG.md"
    },
    {
      "project": "BET Air Ambulance",
      "server": "vector",
      "severity": "warning",
      "message": "Missing required docs: DEPLOYMENT.md"
    },
    {
      "project": "Homebase",
      "server": "rize-apps",
      "severity": "info",
      "message": "5 uncommitted changes"
    },
    {
      "project": "Dockyard WiFi",
      "server": "rize-apps",
      "severity": "info",
      "message": "2 uncommitted changes"
    }
  ],
  "summary": {
    "total": 11,
    "healthy": 8,
    "warning": 3,
    "critical": 0
  }
}